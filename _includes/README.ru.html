<div class='toc'>
	<ol class='level-1'>
		<li><a href='#/'>/</a></li>
		<ol class='level-2'>
			<li><a href='#Haml'>Haml</a></li>
			<li><a href='#Erb'>Erb</a></li>
			<li><a href='#Builder'>Builder</a></li>
			<li><a href='#Nokogiri'>Nokogiri</a></li>
			<li><a href='#Sass'>Sass</a></li>
			<li><a href='#SCSS'>SCSS</a></li>
			<li><a href='#Less'>Less</a></li>
			<li><a href='#Liquid'>Liquid</a></li>
			<li><a href='#Markdown'>Markdown</a></li>
			<li><a href='#Textile'>Textile</a></li>
			<li><a href='#RDoc'>RDoc</a></li>
			<li><a href='#Radius'>Radius</a></li>
			<li><a href='#Markaby'>Markaby</a></li>
			<li><a href='#RABL'>RABL</a></li>
			<li><a href='#Slim'>Slim</a></li>
			<li><a href='#Creole'>Creole</a></li>
			<li><a href='#CoffeeScript'>CoffeeScript</a></li>
			<li><a href='#Yajl'>Yajl</a></li>
			<li><a href='#WLang'>WLang</a></li>
			<li><a href='#%3Ccode%3Eyield%3C/code%3E%20%20%20%20(layout)'><code>yield</code>    (layout)</a></li>
		</ol>
		<li><a href='#-'>-</a></li>
		<ol class='level-2'>
			<li><a href='#,'>,</a></li>
			<li><a href='#Mime-'>Mime-</a></li>
			<li><a href='#URL'>URL</a></li>
			<li><a href='#()'>()</a></li>
		</ol>
		<li><a href='#,'>,</a></li>
		<ol class='level-2'>
			<li><a href='#Not%20Found'>Not Found</a></li>
		</ol>
		<li><a href='#Rack%20&quot;&quot;'>Rack &quot;&quot;</a></li>
		<li><a href='#Sinatra::Base%20%20&quot;&quot;,'>Sinatra::Base  &quot;&quot;,</a></li>
		<ol class='level-2'>
			<li><a href='#config.ru'>config.ru</a></li>
			<li><a href='#config.ru?'>config.ru?</a></li>
			<li><a href='#Sinatra%20%20%20&quot;&quot;'>Sinatra   &quot;&quot;</a></li>
			<li><a href='#&quot;%20&quot;'>&quot; &quot;</a></li>
			<li><a href='#/'>/</a></li>
			<li><a href='#/'>/</a></li>
			<li><a href='#Bundler'>Bundler</a></li>
	</ol></ol>
</div>


<p>*:<br>
*</p>

<p>Sinatra   - 
(<a href="http://ru.wikipedia.org/wiki/-__">DSL</a>)
    -  Ruby   :</p>

<pre><code class="ruby"># myapp.rb
require &#39;sinatra&#39;

get &#39;/&#39; do
  &#39;Hello world!&#39;
end
</code></pre>

<p>gem:</p>

<pre><code>gem install sinatra
</code></pre>

<pre><code>:
</code></pre>

<pre><code>ruby myapp.rb
</code></pre>

<p>: http://localhost:4567</p>

<p>Thin,    : <code>gem install
thin</code>. Thin<br>
   Sinatra.</p>

<p>Sinatra    : &lt;HTTP &gt;  &lt; URL&gt;.<br>
   :</p>

<pre><code class="ruby">get &#39;/&#39; do
  # .. -  ..
end

post &#39;/&#39; do
  # .. -  ..
end

put &#39;/&#39; do
  # .. -  ..
end

patch &#39;/&#39; do
  # .. -  ..
end

delete &#39;/&#39; do
  # .. -  ..
end

options &#39;/&#39; do
  # .. -  ..
end
</code></pre>

<p>.         .</p>

<pre><code>   ,   x
</code></pre>

<p><code>params</code>:</p>

<pre><code class="ruby">get &#39;/hello/:name&#39; do
  #  &quot;GET /hello/foo&quot;  &quot;GET /hello/bar&quot;,
  #  params[:name] &#39;foo&#39;  &#39;bar&#39;
  &quot;Hello #{params[:name]}!&quot;
end
</code></pre>

<pre><code>    :
</code></pre>

<pre><code class="ruby">get &#39;/hello/:name&#39; do |n|
  &quot;Hello #{n}!&quot;
end
</code></pre>

<pre><code>   splat ( &#39;*&#39; ,
</code></pre>

<p>) ,    <code>params[:splat]</code>:</p>

<pre><code class="ruby">get &#39;/say/*/to/*&#39; do
  #  /say/hello/to/world
  params[:splat] # =&gt; [&quot;hello&quot;, &quot;world&quot;]
end

get &#39;/download/*.*&#39; do
  #  /download/path/to/file.xml
  params[:splat] # =&gt; [&quot;path/to/file&quot;, &quot;xml&quot;]
end
</code></pre>

<p>:</p>

<pre><code class="ruby">get &#39;/download/*.*&#39; do |path, ext|
  [path, ext] # =&gt; [&quot;path/to/file&quot;, &quot;xml&quot;]
end
</code></pre>

<pre><code> :
</code></pre>

<pre><code class="ruby">get %r{/hello/([\w]+)} do
  &quot;Hello, #{params[:captures].first}!&quot;
end
</code></pre>

<p>:</p>

<pre><code class="ruby">get %r{/hello/([\w]+)} do |c|
  &quot;Hello, #{c}!&quot;
end
</code></pre>

<pre><code> :
</code></pre>

<pre><code class="ruby">get &#39;/posts.?:format?&#39; do
  #  &quot;GET /posts&quot;, &quot;GET /posts.json&quot;, &quot;GET /posts.xml&quot;  ..
end
</code></pre>

<p>,           (path
traversal, . ),<br>
 .</p>

<pre><code> , , 
</code></pre>

<p>(user agent):</p>

<pre><code class="ruby">get &#39;/foo&#39;, :agent =&gt; /Songbird (\d\.\d)[\d\/]*?/ do
  &quot;You&#39;re using Songbird version #{params[:agent][0]}&quot;
end

get &#39;/foo&#39; do
  #  -songbird 
end
</code></pre>

<pre><code>`host_name`  `provides`:
</code></pre>

<pre><code class="ruby">get &#39;/&#39;, :host_name =&gt; /^admin\./ do
  &quot;Admin Area, Access denied!&quot;
end

get &#39;/&#39;, :provides =&gt; &#39;html&#39; do
  haml :index
end

get &#39;/&#39;, :provides =&gt; [&#39;rss&#39;, &#39;atom&#39;, &#39;xml&#39;] do
  builder :feed
end
</code></pre>

<pre><code>:
</code></pre>

<pre><code class="ruby">set(:probability) { |value| condition { rand &lt;= value } }

get &#39;/win_a_car&#39;, :probability =&gt; 0.1 do
  &quot;You won!&quot;
end

get &#39;/win_a_car&#39; do
  &quot;Sorry, you lost.&quot;
end
</code></pre>

<p>,    ,  :</p>

<pre><code class="ruby">set(:auth) do |*roles|   # &lt;-    
  condition do
    unless logged_in? &amp;&amp; roles.any? {|role| current_user.in_role? role }
      redirect &quot;/login/&quot;, 303
    end
  end
end

get &quot;/my/account/&quot;, :auth =&gt; [:user, :admin] do
  &quot;Your Account Details&quot;
end

get &quot;/only/admin/&quot;, :auth =&gt; :admin do
  &quot;Only admins are allowed here!&quot;
end
</code></pre>

<pre><code>  , 
</code></pre>

<p>HTTP ,   &quot;&quot; (middleware)  Rack
.    ,    .<br>
 .</p>

<pre><code>,     Rack ,
</code></pre>

<p>Rack body,    HTTP:</p>

<ul>
<li>   : <code>[ (Fixnum),  (Hash),  
(   #each)]</code>;</li>
<li>   : <code>[ (Fixnum),   ( 
#each)]</code>;</li>
<li>,   <code>#each</code>,<br>
 ;</li>
<li><p>Fixnum,    HTTP.</p>

<p>,   , ,  :</p></li>
</ul>

<pre><code class="ruby">class Stream
  def each
    100.times { |i| yield &quot;#{i}\n&quot; }
  end
end

get(&#39;/&#39;) { Stream.new }
</code></pre>

<pre><code> `stream` ( ), 
</code></pre>

<p>.</p>

<p>, Sinatra<br>
     URL.      .<br>
      (matchers) 
:</p>

<pre><code class="ruby">class AllButPattern
  Match = Struct.new(:captures)

  def initialize(except)
    @except   = except
    @captures = Match.new([])
  end

  def match(str)
    @captures unless @except === str
  end
end

def all_but(pattern)
  AllButPattern.new(pattern)
end

get all_but(&quot;/index&quot;) do
  # ...
end
</code></pre>

<p>,   , ,  ,<br>
   :</p>

<pre><code class="ruby">get // do
  pass if request.path_info == &quot;/index&quot;
  # ...
end
</code></pre>

<pre><code> :
</code></pre>

<pre><code class="ruby">get %r{^(?!/index$)} do
  # ...
end
</code></pre>

<pre><code>`./public` .    
</code></pre>

<p>,   <code>:public_folder</code>:</p>

<pre><code class="ruby">set :public_folder, File.dirname(__FILE__) + &#39;/static&#39;
</code></pre>

<p>,          URL.
,  <code>./public/css/style.css</code><br>
<code>http://example.com/css/style.css</code>.</p>

<p><code>:static_cache_control</code> (. ),<br>
<code>Cache-Control</code>.</p>

<a name='/'></a>
<h2>/</h2>

<pre><code> .   
</code></pre>

<p>:</p>

<pre><code class="ruby">get &#39;/&#39; do
  erb :index
end
</code></pre>

<p><code>views/index.erb</code>.</p>

<p>:</p>

<pre><code class="ruby">get &#39;/&#39; do
  code = &quot;&lt;%= Time.now %&gt;&quot;
  erb code
end
</code></pre>

<pre><code>,   :
</code></pre>

<pre><code class="ruby">get &#39;/&#39; do
  erb :index, :layout =&gt; :post
end
</code></pre>

<p><code>views/index.erb</code>,   <code>views/post.erb</code> ( :
<code>views/layout.erb</code>,  ).</p>

<p>,   Sinatra,    :</p>

<pre><code class="ruby">get &#39;/&#39; do
  haml :index, :format =&gt; :html5
end
</code></pre>

<pre><code>    :
</code></pre>

<pre><code class="ruby">set :haml, :format =&gt; :html5

get &#39;/&#39; do
  haml :index
end
</code></pre>

<p>,   ,  ,    <code>set</code>.</p>

<p>:</p>

<dl>
  <dt>locals</dt>
  <dd>
      ,   .
    : <tt>erb "<%= foo %>", :locals => {:foo => "bar"}</tt>
  </dd>

  <dt>default_encoding</dt>
  <dd>
    ,   ,    
    .  : <tt>settings.default_encoding</tt>.
  </dd>

  <dt>views</dt>
  <dd>
      .  : <tt>settings.views</tt>.
  </dd>

  <dt>layout</dt>
  <dd>
        (<tt>true</tt>  <tt>false</tt>).    Symbol,
     ,      . :
    <tt>erb :index, :layout => !request.xhr?</tt>
  </dd>

  <dt>content_type</dt>
  <dd>
    Content-Type  .  :  .
  </dd>

  <dt>scope</dt>
  <dd>
     ,    .  : 
    .     ,    
    -     .
  </dd>

  <dt>layout_engine</dt>
  <dd>
    ,      .
       ,     
    .  :   ,     
    . : <tt>set :rdoc, :layout_engine => :erb</tt>
  </dd>
</dl>

<p>,      <code>./views</code>. 
    :</p>

<pre><code class="ruby">set :views, settings.root + &#39;/templates&#39;
</code></pre>

<p>:<br>
(Symbol),      (<br>
<code>:&#39;subdir/template&#39;</code>).    ,<br>
    ,  .</p>

<pre><code class="ruby">get &#39;/&#39; do
  haml &#39;%div.title Hello World&#39;
end
</code></pre>

<p>,  .</p>

<pre><code> .  , 
</code></pre>

<p>,      :</p>

<pre><code class="ruby">require &#39;rdiscount&#39; #  require &#39;bluecloth&#39;
get(&#39;/&#39;) { markdown :index }
</code></pre>

<a name='Haml'></a>
<h3>Haml</h3>

<table>
  <tr>
    <td></td>
    <td><a href="http://haml.info/" title="haml">haml</a></td>
  </tr>
  <tr>
    <td> </td>
    <td><tt>.haml</tt></td>
  </tr>
  <tr>
    <td></td>
    <td><tt>haml :index, :format => :html5</tt></td>
  </tr>
</table>

<a name='Erb'></a>
<h3>Erb</h3>

<table>
  <tr>
    <td></td>
    <td>
      <a href="http://www.kuwata-lab.com/erubis/" title="erubis">erubis</a>
       erb (  Ruby)
    </td>
  </tr>
  <tr>
    <td> </td>
    <td><tt>.erb</tt>, <tt>.rhtml</tt> or <tt>.erubis</tt> ( Erubis)</td>
  </tr>
  <tr>
    <td></td>
    <td><tt>erb :index</tt></td>
  </tr>
</table>

<a name='Builder'></a>
<h3>Builder</h3>

<table>
  <tr>
    <td></td>
    <td>
      <a href="http://builder.rubyforge.org/" title="builder">builder</a>
    </td>
  </tr>
  <tr>
    <td> </td>
    <td><tt>.builder</tt></td>
  </tr>
  <tr>
    <td></td>
    <td><tt>builder { |xml| xml.em "hi" }</tt></td>
  </tr>
</table>

<pre><code>   (. ).
</code></pre>

<a name='Nokogiri'></a>
<h3>Nokogiri</h3>

<table>
  <tr>
    <td></td>
    <td><a href="http://nokogiri.org/" title="nokogiri">nokogiri</a></td>
  </tr>
  <tr>
    <td> </td>
    <td><tt>.nokogiri</tt></td>
  </tr>
  <tr>
    <td></td>
    <td><tt>nokogiri { |xml| xml.em "hi" }</tt></td>
  </tr>
</table>

<pre><code>   (. ).
</code></pre>

<a name='Sass'></a>
<h3>Sass</h3>

<table>
  <tr>
    <td></td>
    <td><a href="http://sass-lang.com/" title="sass">sass</a></td>
  </tr>
  <tr>
    <td> </td>
    <td><tt>.sass</tt></td>
  </tr>
  <tr>
    <td></td>
    <td><tt>sass :stylesheet, :style => :expanded</tt></td>
  </tr>
</table>

<a name='SCSS'></a>
<h3>SCSS</h3>

<table>
  <tr>
    <td></td>
    <td><a href="http://sass-lang.com/" title="sass">sass</a></td>
  </tr>
  <tr>
    <td> </td>
    <td><tt>.scss</tt></td>
  </tr>
  <tr>
    <td></td>
    <td><tt>scss :stylesheet, :style => :expanded</tt></td>
  </tr>
</table>

<a name='Less'></a>
<h3>Less</h3>

<table>
  <tr>
    <td></td>
    <td><a href="http://www.lesscss.org/" title="less">less</a></td>
  </tr>
  <tr>
    <td> </td>
    <td><tt>.less</tt></td>
  </tr>
  <tr>
    <td></td>
    <td><tt>less :stylesheet</tt></td>
  </tr>
</table>

<a name='Liquid'></a>
<h3>Liquid</h3>

<table>
  <tr>
    <td></td>
    <td><a href="http://www.liquidmarkup.org/" title="liquid">liquid</a></td>
  </tr>
  <tr>
    <td> </td>
    <td><tt>.liquid</tt></td>
  </tr>
  <tr>
    <td></td>
    <td><tt>liquid :index, :locals => { :key => 'value' }</tt></td>
  </tr>
</table>

<p>Liquid      Ruby ( <code>yield</code>), 
        .</p>

<a name='Markdown'></a>
<h3>Markdown</h3>

<table>
  <tr>
    <td></td>
    <td>
        :
        <a href="https://github.com/rtomayko/rdiscount" title="RDiscount">RDiscount</a>,
        <a href="https://github.com/vmg/redcarpet" title="RedCarpet">RedCarpet</a>,
        <a href="http://deveiate.org/projects/BlueCloth" title="BlueCloth">BlueCloth</a>,
        <a href="http://kramdown.rubyforge.org/" title="kramdown">kramdown</a>,
        <a href="http://maruku.rubyforge.org/" title="maruku">maruku</a>
    </td>
  </tr>
  <tr>
    <td> </td>
    <td><tt>.markdown</tt>, <tt>.mkd</tt> and <tt>.md</tt></td>
  </tr>
  <tr>
    <td></td>
    <td><tt>markdown :index, :layout_engine => :erb</tt></td>
  </tr>
</table>

<p>Markdown       .
, ,  ,<br>
  :</p>

<pre><code class="ruby">erb :overview, :locals =&gt; { :text =&gt; markdown(:introduction) }
</code></pre>

<p>,      <code>markdown</code>   :</p>

<pre><code class="ruby">%h1 Hello From Haml!
%p= markdown(:greetings)
</code></pre>

<pre><code>Ruby  Markdown, ,   
</code></pre>

<p>Markdown.   ,<br>
    ,<br>
 <code>:layout_engine</code>.</p>

<a name='Textile'></a>
<h3>Textile</h3>

<table>
  <tr>
    <td></td>
    <td><a href="http://redcloth.org/" title="RedCloth">RedCloth</a></td>
  </tr>
  <tr>
    <td> </td>
    <td><tt>.textile</tt></td>
  </tr>
  <tr>
    <td></td>
    <td><tt>textile :index, :layout_engine => :erb</tt></td>
  </tr>
</table>

<p>Textile       .
, ,  ,<br>
  :</p>

<pre><code class="ruby">erb :overview, :locals =&gt; { :text =&gt; textile(:introduction) }
</code></pre>

<p>,      <code>textile</code>   :</p>

<pre><code class="ruby">%h1 Hello From Haml!
%p= textile(:greetings)
</code></pre>

<pre><code>Ruby  Textile, ,   
</code></pre>

<p>Textile.   ,<br>
    ,<br>
 <code>:layout_engine</code>.</p>

<a name='RDoc'></a>
<h3>RDoc</h3>

<table>
  <tr>
    <td></td>
    <td><a href="http://rdoc.rubyforge.org/" title="RDoc">RDoc</a></td>
  </tr>
  <tr>
    <td> </td>
    <td><tt>.rdoc</tt></td>
  </tr>
  <tr>
    <td></td>
    <td><tt>rdoc :README, :layout_engine => :erb</tt></td>
  </tr>
</table>

<p>RDoc       .
, ,  ,<br>
  :</p>

<pre><code class="ruby">erb :overview, :locals =&gt; { :text =&gt; rdoc(:introduction) }
</code></pre>

<p>,      <code>rdoc</code>   :</p>

<pre><code class="ruby">%h1 Hello From Haml!
%p= rdoc(:greetings)
</code></pre>

<pre><code>Ruby  RDoc, ,    
</code></pre>

<p>RDoc.   ,<br>
  ,<br>
<code>:layout_engine</code>.</p>

<a name='Radius'></a>
<h3>Radius</h3>

<table>
  <tr>
    <td></td>
    <td><a href="http://radius.rubyforge.org/" title="Radius">Radius</a></td>
  </tr>
  <tr>
    <td> </td>
    <td><tt>.radius</tt></td>
  </tr>
  <tr>
    <td></td>
    <td><tt>radius :index, :locals => { :key => 'value' }</tt></td>
  </tr>
</table>

<p>Radius      Ruby ,<br>
       .</p>

<a name='Markaby'></a>
<h3>Markaby</h3>

<table>
  <tr>
    <td></td>
    <td><a href="http://markaby.github.com/" title="Markaby">Markaby</a></td>
  </tr>
  <tr>
    <td> </td>
    <td><tt>.mab</tt></td>
  </tr>
  <tr>
    <td></td>
    <td><tt>markaby { h1 "Welcome!" }</tt></td>
  </tr>
</table>

<pre><code>   (. ).
</code></pre>

<a name='RABL'></a>
<h3>RABL</h3>

<table>
  <tr>
    <td></td>
    <td><a href="https://github.com/nesquena/rabl" title="Rabl">Rabl</a></td>
  </tr>
  <tr>
    <td> </td>
    <td><tt>.rabl</tt></td>
  </tr>
  <tr>
    <td></td>
    <td><tt>rabl :index</tt></td>
  </tr>
</table>

<a name='Slim'></a>
<h3>Slim</h3>

<table>
  <tr>
    <td></td>
    <td><a href="http://slim-lang.com/" title="Slim Lang">Slim Lang</a></td>
  </tr>
  <tr>
    <td> </td>
    <td><tt>.slim</tt></td>
  </tr>
  <tr>
    <td></td>
    <td><tt>slim :index</tt></td>
  </tr>
</table>

<a name='Creole'></a>
<h3>Creole</h3>

<table>
  <tr>
    <td></td>
    <td><a href="https://github.com/minad/creole" title="Creole">Creole</a></td>
  </tr>
  <tr>
    <td> </td>
    <td><tt>.creole</tt></td>
  </tr>
  <tr>
    <td></td>
    <td><tt>creole :wiki, :layout_engine => :erb</tt></td>
  </tr>
</table>

<p>Creole       .
, ,  ,<br>
  :</p>

<pre><code class="ruby">erb :overview, :locals =&gt; { :text =&gt; creole(:introduction) }
</code></pre>

<p>,      <code>creole</code>   :</p>

<pre><code class="ruby">%h1 Hello From Haml!
%p= creole(:greetings)
</code></pre>

<pre><code>Ruby  Creole, ,   
</code></pre>

<p>Creole.   ,<br>
    ,<br>
 <code>:layout_engine</code>.</p>

<a name='CoffeeScript'></a>
<h3>CoffeeScript</h3>

<table>
  <tr>
    <td></td>
    <td>
      <a href="https://github.com/josh/ruby-coffee-script" title="Ruby CoffeeScript">
        CoffeeScript
      </a>  
      <a href="https://github.com/sstephenson/execjs/blob/master/README.md#readme" title="ExecJS">
         JavaScript
      </a>
    </td>
  </tr>
  <tr>
    <td> </td>
    <td><tt>.coffee</tt></td>
  </tr>
  <tr>
    <td></td>
    <td><tt>coffee :index</tt></td>
  </tr>
</table>

<a name='Yajl'></a>
<h3>Yajl</h3>

<table>
  <tr>
    <td></td>
    <td><a href="https://github.com/brianmario/yajl-ruby" title="yajl-ruby">yajl-ruby</a></td>
  </tr>
  <tr>
    <td> </td>
    <td><tt>.yajl</tt></td>
  </tr>
  <tr>
    <td></td>
    <td>
      <tt>
        yajl :index,
             :locals => { :key => 'qux' },
             :callback => 'present',
             :variable => 'resource'
      </tt>
    </td>
  </tr>
</table>

<pre><code>  Ruby,  
</code></pre>

<p>json     <code>#to_json</code>.</p>

<pre><code class="ruby">json = { :foo =&gt; &#39;bar&#39; }
json[:baz] = key
</code></pre>

<p><code>:callback</code>  <code>:variable</code>   &quot;&quot; 
.</p>

<pre><code class="ruby">var resource = {&quot;foo&quot;:&quot;bar&quot;,&quot;baz&quot;:&quot;qux&quot;}; present(resource);
</code></pre>

<a name='WLang'></a>
<h3>WLang</h3>

<table>
  <tr>
    <td></td>
    <td><a href="https://github.com/blambeau/wlang/" title="wlang">wlang</a></td>
  </tr>
  <tr>
    <td> </td>
    <td><tt>.wlang</tt></td>
  </tr>
  <tr>
    <td></td>
    <td><tt>wlang :index, :locals => { :key => 'value' }</tt></td>
  </tr>
</table>

<p>WLang      Ruby  (
 <code>yield</code>),<br>
.</p>

<pre><code> ,    .
</code></pre>

<p>,     , 
   :</p>

<pre><code class="ruby">get &#39;/:id&#39; do
  @foo = Foo.find(params[:id])
  haml &#39;%h1= @foo.name&#39;
end
</code></pre>

<pre><code>  :
</code></pre>

<pre><code class="ruby">get &#39;/:id&#39; do
  foo = Foo.find(params[:id])
  haml &#39;%h1= bar.name&#39;, :locals =&gt; { :bar =&gt; foo }
end
</code></pre>

<p>,       .</p>

<a name='%3Ccode%3Eyield%3C/code%3E%20%20%20%20(layout)'></a>
<h3><code>yield</code>    (layout)</h3>

<p>(layout)    ,<br>
<code>yield</code>.
         <code>:template</code>,
  ,      :</p>

<pre><code class="ruby">    erb :post, :layout =&gt; false do
      erb :index
    end
</code></pre>

<pre><code> `erb :index, :layout =&gt; :post`.
</code></pre>

<p>:</p>

<pre><code class="ruby">    erb :main_layout, :layout =&gt; false do
      erb :admin_layout do
        erb :user
      end
    end
</code></pre>

<pre><code>  :
</code></pre>

<pre><code class="ruby">    erb :admin_layout, :layout =&gt; :main_layout do
      erb :user
    end
</code></pre>

<p>,<br>
 :
<code>erb</code>, <code>haml</code>, <code>liquid</code>, <code>slim</code>, <code>wlang</code>.
    <code>render</code>   .</p>

<pre><code>    :
</code></pre>

<pre><code class="ruby">require &#39;sinatra&#39;

get &#39;/&#39; do
  haml :index
end

__END__

@@ layout
%html
  = yield

@@ index
%div.title Hello world.
</code></pre>

<p>:  ,    ,<br>
Sinatra,   .  <code>enable :inline_templates</code>
,       .</p>

<pre><code>   `template` :
</code></pre>

<pre><code class="ruby">template :layout do
  &quot;%html\n  =yield\n&quot;
end

template :index do
  &#39;%div.title Hello World!&#39;
end

get &#39;/&#39; do
  haml :index
end
</code></pre>

<pre><code>&quot;layout&quot; ,     
</code></pre>

<p>.<br>
 <code>:layout =&gt; false</code>      : <code>set :haml,
:layout =&gt; false</code>:</p>

<pre><code class="ruby">get &#39;/&#39; do
  haml :index, :layout =&gt; !request.xhr?
end
</code></pre>

<pre><code>  , 
</code></pre>

<p><code>Tilt.register</code>. ,      <code>tt</code> 
 Textile:</p>

<pre><code class="ruby">Tilt.register :tt, Tilt[:textile]
</code></pre>

<pre><code> Tilt,    , 
</code></pre>

<p>:</p>

<pre><code class="ruby">Tilt.register :myat, MyAwesomeTemplateEngine

helpers do
  def myat(*args) render(:myat, *args) end
end

get &#39;/&#39; do
  myat :index
end
</code></pre>

<p><code>./views/index.myat</code>.     Tilt, 
https://github.com/rtomayko/tilt</p>

<p><code>before</code>-        ,<br>
,     ,     . 
,   ,     :</p>

<pre><code class="ruby">before do
  @note = &#39;Hi!&#39;
  request.path_info = &#39;/foo/bar/baz&#39;
end

get &#39;/foo/*&#39; do
  @note #=&gt; &#39;Hi!&#39;
  params[:splat] #=&gt; &#39;bar/baz&#39;
end
</code></pre>

<p><code>after</code>-<br>
    ,     . 
,   <code>before</code>-  ,<br>
<code>after</code>-:</p>

<pre><code class="ruby">after do
  puts response.status
end
</code></pre>

<p>:     <code>body</code>,<br>
,        <code>after</code>-,<br>
  .</p>

<pre><code>URL   ,  
 :
</code></pre>

<pre><code class="ruby">before &#39;/protected/*&#39; do
  authenticate!
end

after &#39;/create/:slug&#39; do |slug|
  session[:last_slug] = slug
end
</code></pre>

<p>,    :</p>

<pre><code class="ruby">before :agent =&gt; /Songbird/ do
  # ...
end

after &#39;/blog/*&#39;, :host_name =&gt; &#39;example.com&#39; do
  # ...
end
</code></pre>

<a name='-'></a>
<h2>-</h2>

<p><code>helpers</code>,   -,<br>
        :</p>

<pre><code class="ruby">helpers do
  def bar(name)
    &quot;#{name}bar&quot;
  end
end

get &#39;/:name&#39; do
  bar(params[:name])
end
</code></pre>

<ul>
<li>     :</li>
</ul>

<pre><code class="ruby">module FooUtils
  def foo(name) &quot;#{name}foo&quot; end
end

module BarUtils
  def bar(name) &quot;#{name}bar&quot; end
end

helpers FooUtils, BarUtils
</code></pre>

<pre><code>  .
</code></pre>

<p>,     .<br>
,           :</p>

<pre><code class="ruby">enable :sessions

get &#39;/&#39; do
  &quot;value = &quot; &lt;&lt; session[:value].inspect
end

get &#39;/:value&#39; do
  session[:value] = params[:value]
end
</code></pre>

<p>,    <code>enable :sessions</code><br>
 (cookies).      ,    (,
      ).<br>
   Rack &quot;&quot; (middleware), 
 .   * *  <code>enable :sessions</code>,<br>
    ,     &quot;&quot;:</p>

<pre><code class="ruby">use Rack::Session::Pool, :expire_after =&gt; 2592000

get &#39;/&#39; do
  &quot;value = &quot; &lt;&lt; session[:value].inspect
end

get &#39;/:value&#39; do
  session[:value] = params[:value]
end
</code></pre>

<p>.    Sinatra.   ,<br>
     , , ,<br>
 ,<br>
:</p>

<pre><code class="ruby">set :session_secret, &#39;super secret&#39;
</code></pre>

<pre><code>  ,    ,  
</code></pre>

<p><code>sessions</code>:</p>

<pre><code class="ruby">set :sessions, :domain =&gt; &#39;foo.com&#39;
</code></pre>

<pre><code>    ,
</code></pre>

<p>:</p>

<pre><code class="ruby">halt
</code></pre>

<pre><code> :
</code></pre>

<pre><code class="ruby">halt 410
</code></pre>

<p>:</p>

<pre><code class="ruby">halt &#39;this will be the body&#39;
</code></pre>

<p>,  :</p>

<pre><code class="ruby">halt 401, &#39;go away!&#39;
</code></pre>

<p>:</p>

<pre><code class="ruby">halt 402, {&#39;Content-Type&#39; =&gt; &#39;text/plain&#39;}, &#39;revenge&#39;
</code></pre>

<p>, ,     <code>halt</code>:</p>

<pre><code class="ruby">halt erb(:error)
</code></pre>

<pre><code>   ,
</code></pre>

<p><code>pass</code>:</p>

<pre><code class="ruby">get &#39;/guess/:who&#39; do
  pass unless params[:who] == &#39;Frank&#39;
  &#39;You got me!&#39;
end

get &#39;/guess/*&#39; do
  &#39;You missed!&#39;
end
</code></pre>

<pre><code>,     
</code></pre>

<p>.     ,<br>
  404.</p>

<p><code>pass</code>  , ,<br>
  .      <code>call</code>:</p>

<pre><code class="ruby">get &#39;/foo&#39; do
  status, headers, body = call env.merge(&quot;PATH_INFO&quot; =&gt; &#39;/bar&#39;)
  [status, headers, body.map(&amp;:upcase)]
end

get &#39;/bar&#39; do
  &quot;bar&quot;
end
</code></pre>

<p>,<br>
,  <code>&quot;bar&quot;</code>  -,<br>
<code>/foo</code>,   <code>/bar</code>.</p>

<p>,         ,<br>
  ,  <code>call!</code>  <code>call</code>.</p>

<pre><code> `call`,   Rack.
</code></pre>

<a name=','></a>
<h3>,</h3>

<pre><code>  HTTP    
</code></pre>

<p>.   ,<br>
 , ,<br>
 .       - <code>body</code>.
    <code>body</code>,<br>
,      .</p>

<pre><code class="ruby">get &#39;/foo&#39; do
  body &quot;bar&quot;
end

after do
  puts body
end
</code></pre>

<pre><code>  `body`,    
</code></pre>

<p>Rack (<br>
 , . &quot; &quot;).</p>

<pre><code>    :
</code></pre>

<pre><code class="ruby">get &#39;/foo&#39; do
  status 418
  headers \
    &quot;Allow&quot;   =&gt; &quot;BREW, POST, GET, PROPFIND, WHEN&quot;,
    &quot;Refresh&quot; =&gt; &quot;Refresh: 20; http://www.ietf.org/rfc/rfc2324.txt&quot;
  body &quot;I&#39;m a tea pot!&quot;
end
</code></pre>

<p><code>body</code>,  <code>headers</code>  <code>status</code>,   ,
   .</p>

<p>.<br>
    ,     .<br>
  <code>stream</code>    &quot;&quot;.</p>

<pre><code class="ruby">get &#39;/&#39; do
  stream do |out|
    out &lt;&lt; &quot;It&#39;s gonna be legen -\n&quot;
    sleep 0.5
    out &lt;&lt; &quot; (wait for it) \n&quot;
    sleep 1
    out &lt;&lt; &quot;- dary!\n&quot;
  end
end
</code></pre>

<pre><code> API,
</code></pre>

<p><a href="http://dev.w3.org/html5/eventsource/">Server Sent Events</a>,
     <a href="http://en.wikipedia.org/wiki/WebSocket">WebSockets</a>.
         ,</p>

<ul>
<li>     .</li>
</ul>

<p>,   ,<br>
 ,      -.
 , , WEBRick,      .
    ,<br>
   ,  ,   <code>stream</code>, . 
     Shotgun.</p>

<pre><code> `keep_open`,     
</code></pre>

<p><code>close</code>   ,<br>
.      , ,  Thin 
Rainbows.        :</p>

<pre><code class="ruby"># long polling

set :server, :thin
connections = []

get &#39;/subscribe&#39; do
  #  
  stream(:keep_open) { |out| connections &lt;&lt; out }

  #  &quot; &quot;
  connections.reject!(&amp;:closed?)

  # 
  &quot;subscribed&quot;
end

post &#39;/message&#39; do
  connections.each do |out|
    #     
    out &lt;&lt; params[:message] &lt;&lt; &quot;\n&quot;

    #     
    out.close
  end

  # 
  &quot;message received&quot;
end
</code></pre>

<pre><code> `logger`    
</code></pre>

<p><code>Logger</code>:</p>

<pre><code class="ruby">get &#39;/&#39; do
  logger.info &quot;loading data&quot;
  # ...
end
</code></pre>

<pre><code>    Rack. 
</code></pre>

<p>,      (dummy) ,<br>
       .</p>

<p>,<br>
<code>Sinatra::Application</code>,       <code>Sinatra::Base</code>, 
, ,    :</p>

<pre><code class="ruby">class MyApp &lt; Sinatra::Base
  configure :production, :development do
    enable :logging
  end
end
</code></pre>

<pre><code> &quot;&quot;,  
</code></pre>

<p><code>logging</code>  <code>nil</code>.   ,  ,<br>
<code>logger</code>  <code>nil</code>.    ,<br>
. Sinatra   ,    <code>env[&#39;rack.logger&#39;]</code>.</p>

<a name='Mime-'></a>
<h3>Mime-</h3>

<p><code>send_file</code>   ,<br>
mime-,  Sinatra    .  <code>mime_type</code>
     :</p>

<pre><code class="ruby">configure do
  mime_type :foo, &#39;text/foo&#39;
end
</code></pre>

<pre><code>  `content_type` -:
</code></pre>

<pre><code class="ruby">get &#39;/&#39; do
  content_type :foo
  &quot;foo foo foo&quot;
end
</code></pre>

<a name='URL'></a>
<h3>URL</h3>

<p>URL,     <code>url</code>, ,  Haml:</p>

<pre><code class="ruby">%a{:href =&gt; url(&#39;/foo&#39;)} foo
</code></pre>

<pre><code>   Rack,  
</code></pre>

<p>.</p>

<p><code>url</code>    <code>to</code> (  ).</p>

<a name='()'></a>
<h3>()</h3>

<pre><code>    `redirect`:
</code></pre>

<pre><code class="ruby">get &#39;/foo&#39; do
  redirect to(&#39;/bar&#39;)
end
</code></pre>

<p><code>halt</code>:</p>

<pre><code class="ruby">redirect to(&#39;/bar&#39;), 303
redirect &#39;http://google.com&#39;, &#39;wrong place, buddy&#39;
</code></pre>

<pre><code> ,  ,   
</code></pre>

<p>,   <code>redirect back</code>:</p>

<pre><code class="ruby">get &#39;/foo&#39; do
  &quot;&lt;a href=&#39;/bar&#39;&gt;do something&lt;/a&gt;&quot;
end

get &#39;/bar&#39; do
  do_something
  redirect back
end
</code></pre>

<ul>
<li>   ,<br>
:</li>
</ul>

<pre><code class="ruby">redirect to(&#39;/bar?sum=42&#39;)
</code></pre>

<p>:</p>

<pre><code class="ruby">enable :sessions

get &#39;/foo&#39; do
  session[:secret] = &#39;foo&#39;
  redirect to(&#39;/bar&#39;)
end

get &#39;/bar&#39; do
  session[:secret]
end
</code></pre>

<pre><code>  HTTP .

 Cache-Control  :
</code></pre>

<pre><code class="ruby">get &#39;/&#39; do
  cache_control :public
  &quot;cache it!&quot;
end
</code></pre>

<p>:    <code>before</code>-:</p>

<pre><code class="ruby">before do
  cache_control :public, :must_revalidate, :max_age =&gt; 60
end
</code></pre>

<pre><code>`expires`    , 
</code></pre>

<p><code>Cache-Control</code>   :</p>

<pre><code class="ruby">before do
  expires 500, :public, :must_revalidate
end
</code></pre>

<pre><code>,    
</code></pre>

<p><code>etag</code>  <code>last_modified</code>.   </p>

<ul>
<li>**   ,<br>
,        :</li>
</ul>

<pre><code class="ruby">get &#39;/article/:id&#39; do
  @article = Article.find params[:id]
  last_modified @article.updated_at
  etag @article.sha1
  erb :article
end
</code></pre>

<p><a href="http://en.wikipedia.org/wiki/HTTP_ETag#Strong_and_weak_validation">weak ETag</a>:</p>

<pre><code class="ruby">etag @article.sha1, :weak
</code></pre>

<ul>
<li>     ,<br>
.<br>
,  <a href="https://github.com/rtomayko/rack-cache">rack-cache</a>:</li>
</ul>

<pre><code class="ruby">require &#39;rack/cache&#39;
require &#39;sinatra&#39;

use Rack::Cache

get &#39;/&#39; do
  cache_control :public, :max_age =&gt; 36000
  sleep 5
  &quot;hello&quot;
end
</code></pre>

<p><code>:static_cache_control</code> (. ),<br>
<code>Cache-Control</code>   .</p>

<p>RFC 2616      -, 
 If-Match  If-None-Match   <code>*</code>,<br>
,     . Sinatra , 
,       (GET)   (PUT)
,  ,    (  , ,
  POST)  .<br>
 <code>:new_resource</code>:</p>

<pre><code class="ruby">get &#39;/create&#39; do
  etag &#39;&#39;, :new_resource =&gt; true
  Article.create
  erb :new_article
end
</code></pre>

<pre><code>weak ETag,   `:kind`:
</code></pre>

<pre><code class="ruby">etag &#39;&#39;, :new_resource =&gt; true, :kind =&gt; :weak
</code></pre>

<pre><code>    `send_file`:
</code></pre>

<pre><code class="ruby">get &#39;/&#39; do
  send_file &#39;foo.png&#39;
end
</code></pre>

<pre><code>:
</code></pre>

<pre><code class="ruby">send_file &#39;foo.png&#39;, :type =&gt; :jpg
</code></pre>

<p>:</p>

<dl>
  <dt>filename</dt>
  <dd> ,  :   .</dd>

  <dt>last_modified</dt>
  <dd>   Last-Modified,  : mtime (
      ) .</dd>

  <dt>type</dt>
  <dd> ,  :    .</dd>

  <dt>disposition</dt>
  <dd>   Content-Disposition,  : <tt>nil</tt>
      ( ), <tt>:attachment</tt>  <tt>:inline</tt>.</dd>

  <dt>length</dt>
  <dd>   Content-Length,  :  .</dd>

  <dt>status</dt>
  <dd> . ,        
        .</dd>
</dl>

<pre><code> Rack    ,
</code></pre>

<p>,         Ruby
.  <code>send_file</code><br>
 (range)    Sinatra.</p>

<pre><code>    ( ,
</code></pre>

<p>,  )   <code>request</code> :</p>

<pre><code class="ruby">#    http://example.com/example
get &#39;/foo&#39; do
  t = %w[text/css text/html application/javascript]
  request.accept              # [&#39;text/html&#39;, &#39;*/*&#39;]
  request.accept? &#39;text/xml&#39;  # true
  request.preferred_type(t)   # &#39;text/html&#39;
  request.body                #  ,   (. )
  request.scheme              # &quot;http&quot;
  request.script_name         # &quot;/example&quot;
  request.path_info           # &quot;/foo&quot;
  request.port                # 80
  request.request_method      # &quot;GET&quot;
  request.query_string        # &quot;&quot;
  request.content_length      #   
  request.media_type          #   
  request.host                # &quot;example.com&quot;
  request.get?                # true (     HTTP)
  request.form_data?          # false
  request[&quot;some_param&quot;]       #   some_param.    params
  request.referrer            #     &#39;/&#39;
  request.user_agent          # user agent (  :agent )
  request.cookies             # ,  cookies 
  request.xhr?                #    ajax ?
  request.url                 # &quot;http://example.com/example/foo&quot;
  request.path                # &quot;/example/foo&quot;
  request.ip                  # IP- 
  request.secure?             # false (true,     SSL)
  request.forwarded?          # true (     )
  request.env                 # &quot;&quot; env ,  Rack
end
</code></pre>

<p>,   <code>script_name</code>  <code>path_info</code>,<br>
:</p>

<pre><code class="ruby">before { request.path_info = &quot;/&quot; }

get &quot;/&quot; do
  &quot;all requests end up here&quot;
end
</code></pre>

<p><code>request.body</code>  IO  StringIO :</p>

<pre><code class="ruby">post &quot;/api&quot; do
  request.body.rewind  #  ,  -    
  data = JSON.parse request.body.read
  &quot;Hello #{data[&#39;name&#39;]}!&quot;
end
</code></pre>

<pre><code>`attachment`,   ,  
 ,   :
</code></pre>

<pre><code class="ruby">get &#39;/&#39; do
  attachment
  &quot;store it!&quot;
end
</code></pre>

<pre><code> :
</code></pre>

<pre><code class="ruby">get &#39;/&#39; do
  attachment &quot;info.txt&quot;
  &quot;store it!&quot;
end
</code></pre>

<p>Sinatra  - <code>time_for</code>,<br>
  Time.     <code>DateTime</code>, <code>Date</code> 
 :</p>

<pre><code class="ruby">get &#39;/&#39; do
  pass if Time.now &gt; time_for(&#39;Dec 23, 2012&#39;)
  &quot;still time&quot;
end
</code></pre>

<pre><code>Sinatra  `expires`, `last_modified` 
</code></pre>

<p>.        ,
 <code>time_for</code>   :</p>

<pre><code class="ruby">helpers do
  def time_for(value)
    case value
    when :yesterday then Time.now - 24*60*60
    when :tomorrow  then Time.now + 24*60*60
    else super
    end
  end
end

get &#39;/&#39; do
  last_modified :yesterday
  expires :tomorrow
  &quot;hello&quot;
end
</code></pre>

<p><code>find_template</code>:</p>

<pre><code class="ruby">find_template settings.views, &#39;foo&#39;, Tilt[:haml] do |file|
  puts &quot;could be #{file}&quot;
end
</code></pre>

<pre><code>.    ,   
</code></pre>

<p>,<br>
. ,   ,<br>
  :</p>

<pre><code class="ruby">set :views, [&#39;views&#39;, &#39;templates&#39;]

helpers do
  def find_template(views, name, engine, &amp;block)
    Array(views).each { |v| super(v, name, engine, &amp;block) }
  end
end
</code></pre>

<p>,<br>
:</p>

<pre><code class="ruby">set :views, :sass =&gt; &#39;views/sass&#39;, :haml =&gt; &#39;templates&#39;, :default =&gt; &#39;views&#39;

helpers do
  def find_template(views, name, engine, &amp;block)
    _, folder = views.detect { |k,v| engine == Tilt[k] }
    folder ||= views[:default]
    super(folder, name, engine, &amp;block)
  end
end
</code></pre>

<pre><code>        !
</code></pre>

<p>,  <code>find_template</code>  ,      ,
       .<br>
,   ,  <code>render</code>  <code>break</code>,<br>
  .      ,
       (<code>set :environment,
:development</code>).      ,    -
&quot;&quot; .</p>

<pre><code>     , 
</code></pre>

<p>(environment):</p>

<pre><code class="ruby">configure do
  #   
  set :option, &#39;value&#39;

  #   
  set :a =&gt; 1, :b =&gt; 2

  #   ,   `set :option, true`
  enable :option

  #   ,   `set :option, false`
  disable :option

  #     &quot;&quot;   
  set(:css_dir) { File.join(views, &#39;css&#39;) }
end
</code></pre>

<p>,   (RACK_ENV ) <code>:production</code>:</p>

<pre><code class="ruby">configure :production do
  ...
end
</code></pre>

<p>,   <code>:production</code>  <code>:test</code>:</p>

<pre><code class="ruby">configure :production, :test do
  ...
end
</code></pre>

<pre><code>     `settings`:
</code></pre>

<pre><code class="ruby">configure do
  set :foo, &#39;bar&#39;
end

get &#39;/&#39; do
  settings.foo? # =&gt; true
  settings.foo  # =&gt; &#39;bar&#39;
  ...
end
</code></pre>

<p>Sinatra 
<a href="https://github.com/rkh/rack-protection#readme">Rack::Protection</a><br>
   .       ( 
   ):</p>

<pre><code class="ruby">disable :protection
</code></pre>

<ul>
<li> ,<br>
<code>protection</code>:</li>
</ul>

<pre><code class="ruby">set :protection, :except =&gt; :path_traversal
</code></pre>

<pre><code>   :
</code></pre>

<pre><code class="ruby">set :protection, :except =&gt; [:path_traversal, :session_hijacking]
</code></pre>

<dl>
  <dt>absolute_redirects</dt>
  <dd>
     ,  Sinatra    
    ,      RFC 2616 (HTTP
    1.1),     .
  </dd>
  <dd>
      ,       ,
        .  ,  <tt>url</tt> 
        URL,     <tt>false</tt>
     .
  </dd>
  <dd>  .</dd>

  <dt>add_charsets</dt>
  <dd>
    mime-,    <tt>content_type</tt>   
      .       
      : <tt>settings.add_charsets &lt;&lt; "application/foobar"</tt>
  </dd>

  <dt>app_file</dt>
  <dd>
        ,    
     ,      ,
     .
  </dd>

  <dt>bind</dt>
  <dd>
     IP- ( : 0.0.0.0).  
     .
  </dd>

  <dt>default_encoding</dt>
  <dd>,   ( : <tt>"utf-8"</tt>).</dd>

  <dt>dump_errors</dt>
  <dd>   .</dd>

  <dt>environment</dt>
  <dd>
     ,  ,  <tt>ENV['RACK_ENV']</tt> 
    <tt>"development"</tt>,  <tt>ENV['RACK_ENV']</tt> .
  </dd>

  <dt>logging</dt>
  <dd> .</dd>

  <dt>lock</dt>
  <dd>
        ,   
            Ruby .
  </dd>
  <dd>
    ,     - (thread-safe).
      .</dd>

  <dt>method_override</dt>
  <dd>
     ""  <tt>_method</tt>,  
    PUT/DELETE   ,     .
  </dd>

  <dt>port</dt>
  <dd>
    ,     .
       .
  </dd>

  <dt>prefixed_redirects</dt>
  <dd>
        <tt>request.script_name</tt>  ,  
      .  , <tt>redirect '/foo'</tt>   
     <tt>redirect to('/foo')</tt>.   .
  </dd>

  <dt>protection</dt>
  <dd>     .   .</dd>

  <dt>public_dir</dt>
  <dd>  <tt>public_folder</tt>.</dd>

  <dt>public_folder</dt>
  <dd>
      ,     .
    ,      
    (.  <tt>static</tt> ).
  </dd>

  <dt>reload_templates</dt>
  <dd>
          .   
    .
  </dd>

  <dt>root</dt>
  <dd>    .</dd>

  <dt>raise_errors</dt>
  <dd>
      (  ).
          <tt>test</tt>.
  </dd>

  <dt>run</dt>
  <dd>
     , Sinatra    -. 
    ,   rackup   .
  </dd>

  <dt>running</dt>
  <dd>    ?    !</dd>

  <dt>server</dt>
  <dd>
       ,     
     .  : <tt>['thin', 'mongrel', 'webrick']</tt>, 
     .</dd>

  <dt>sessions</dt>
  <dd>
         (cookie)   <tt>Rack::Session::Cookie</tt>.
      " " .
  </dd>

  <dt>show_exceptions</dt>
  <dd>
     /  (stack trace)  .  
        <tt>development</tt>.
  </dd>
  <dd>
       
    <tt>:after_handler</tt>       ,
         .
  </dd>

  <dt>static</dt>
  <dd>  Sinatra    .</dd>
  <dd>,   - -   .</dd>
  <dd>    .</dd>
  <dd>         .</dd>

  <dt>static_cache_control</dt>
  <dd>
     Sinatra   ,   , 
       <tt>Cache-Control</tt>.   
    - <tt>cache_control</tt>.   .
  </dd>
  <dd>
     ,     :
    <tt>set :static_cache_control, [:public, :max_age => 300]</tt>
  </dd>

  <dt>threaded</dt>
  <dd>
     ,  Thin   <tt>EventMachine.defer</tt> 
     .
  </dd>

  <dt>views</dt>
  <dd>    .</dd>
</dl>

<a name=','></a>
<h2>,</h2>

<p>3  , : <code>&quot;development&quot;</code>, <code>&quot;production&quot;</code> 
<code>&quot;test&quot;</code>.        <code>RACK_ENV</code>.
    <code>&quot;development&quot;</code>.<br>
  .<br>
<code>not_found</code>  <code>error</code>,      .<br>
<code>&quot;production&quot;</code>  <code>&quot;test&quot;</code>    .</p>

<pre><code>    `-e`
</code></pre>

<pre><code>ruby my_app.rb -e [ENVIRONMENT]
</code></pre>

<pre><code> `development?`, `test?` 
</code></pre>

<p>+production?,    .</p>

<pre><code>  ,   , 
</code></pre>

<p><code>before</code>-,   ,     <code>haml</code>, <code>erb</code>,
<code>halt</code>  ..   .</p>

<a name='Not%20Found'></a>
<h3>Not Found</h3>

<p><code>Sinatra::NotFound</code>,     404,
   <code>not_found</code> :</p>

<pre><code class="ruby">not_found do
  &#39;This is nowhere to be found.&#39;
end
</code></pre>

<p><code>error</code>  ,<br>
,   . -<br>
<code>sinatra.error</code>  Rack:</p>

<pre><code class="ruby">error do
  &#39;Sorry there was a nasty error - &#39; + env[&#39;sinatra.error&#39;].name
end
</code></pre>

<p>:</p>

<pre><code class="ruby">error MyCustomError do
  &#39;So what happened was...&#39; + env[&#39;sinatra.error&#39;].message
end
</code></pre>

<p>,   :</p>

<pre><code class="ruby">get &#39;/&#39; do
  raise MyCustomError, &#39;something bad&#39;
end
</code></pre>

<p>:</p>

<pre><code>So what happened was... something bad
</code></pre>

<pre><code>     HTTP:
</code></pre>

<pre><code class="ruby">error 403 do
  &#39;Access forbidden&#39;
end

get &#39;/secret&#39; do
  403
end
</code></pre>

<p>:</p>

<pre><code class="ruby">error 400..510 do
  &#39;Boom&#39;
end
</code></pre>

<p>Sinatra   <code>not_found</code>  <code>error</code> , 
     ( <code>:development</code>).</p>

<a name='Rack%20&quot;&quot;'></a>
<h2>Rack &quot;&quot;</h2>

<p>Sinatra  <a href="http://rack.rubyforge.org/">Rack</a>,  </p>

<ul>
<li><p>Ruby.<br>
Rack   &quot;&quot; (&quot;middleware&quot;) 
,  &quot;&quot;    , 
/  HTTP /<br>
.</p>

<p>Sinatra     &quot;&quot;    <code>use</code>:</p></li>
</ul>

<pre><code class="ruby">require &#39;sinatra&#39;
require &#39;my_custom_middleware&#39;

use Rack::Lint
use MyCustomMiddleware

get &#39;/hello&#39; do
  &#39;Hello World&#39;
end
</code></pre>

<p><code>use</code>  ,<br>
<a href="http://rack.rubyforge.org/doc/classes/Rack/Builder.html">Rack::Builder</a> DSL
(    rackup ). ,  <code>use</code><br>
 ,   :</p>

<pre><code class="ruby">use Rack::Auth::Basic do |username, password|
  username == &#39;admin&#39; &amp;&amp; password == &#39;secret&#39;
end
</code></pre>

<p>Rack     &quot;&quot;  ,
,  URL, ,  . Sinatra
     ,<br>
,      (<code>use</code>)  .</p>

<p><a href="https://github.com/rack/rack/tree/master/lib/rack">rack</a>,
<a href="https://github.com/rack/rack-contrib#readme">rack-contrib</a>,
<a href="http://coderack.org/">CodeRack</a><br>
<a href="https://github.com/rack/rack/wiki/List-of-Middleware">Rack wiki</a>.</p>

<p>Sinatra       ,
,   Rack.
<a href="http://rdoc.info/github/brynary/rack-test/master/frames">Rack::Test</a>
:</p>

<pre><code class="ruby">require &#39;my_sinatra_app&#39;
require &#39;test/unit&#39;
require &#39;rack/test&#39;

class MyAppTest &lt; Test::Unit::TestCase
  include Rack::Test::Methods

  def app
    Sinatra::Application
  end

  def test_my_default
    get &#39;/&#39;
    assert_equal &#39;Hello World!&#39;, last_response.body
  end

  def test_with_params
    get &#39;/meet&#39;, :name =&gt; &#39;Frank&#39;
    assert_equal &#39;Hello Frank!&#39;, last_response.body
  end

  def test_with_rack_env
    get &#39;/&#39;, {}, &#39;HTTP_USER_AGENT&#39; =&gt; &#39;Songbird&#39;
    assert_equal &quot;You&#39;re using Songbird!&quot;, last_response.body
  end
end
</code></pre>

<a name='Sinatra::Base%20%20&quot;&quot;,'></a>
<h2>Sinatra::Base  &quot;&quot;,</h2>

<pre><code>  (  DSL 
</code></pre>

<p>,  )     .<br>
  ,    -
(  , <code>./public</code>  <code>./views</code> , ,
     ..).   ,<br>
    ,   Rack middleware
(&quot;&quot;), Rails metal,     ,
 Sinatra.      <code>Sinatra::Base</code>:</p>

<pre><code class="ruby">require &#39;sinatra/base&#39;

class MyApp &lt; Sinatra::Base
  set :sessions, true
  set :foo, &#39;bar&#39;

  get &#39;/&#39; do
    &#39;Hello world!&#39;
  end
end
</code></pre>

<p>,  <code>Sinatra::Base</code>   ,<br>
  DSL  .<br>
  <code>Sinatra::Base</code>     :</p>

<ul>
<li>   <code>sinatra/base</code>  <code>sinatra</code>,   ,
Sinatra,<br>
.</li>
<li>  ,  ,<br>
<code>Sinatra::Base</code>.</li>
</ul>

<p><code>Sinatra::Base</code>    .  ,<br>
,   . 
<a href="http://www.sinatrarb.com/configuration.html">  </a>
       .</p>

<p>,    ( )<br>
.      ,<br>
    .</p>

<pre><code>  ,    
Sinatra    Ruby.   
</code></pre>

<p>,    .<br>
    .</p>

<pre><code> ,      
</code></pre>

<p>:</p>

<pre><code>app_file                       Sinatra::Base
run                 $0 == app_file          false
logging             true                    false
method_override     true                    false
inline_templates    true                    false
static              true                    false
</code></pre>

<pre><code>  :  
</code></pre>

<p><code>run!</code>:</p>

<pre><code class="ruby"># my_app.rb
require &#39;sinatra/base&#39;

class MyApp &lt; Sinatra::Base
  # ...    ...

  #  ,    
  run! if app_file == $0
end
</code></pre>

<p>:</p>

<pre><code>ruby my_app.rb
</code></pre>

<pre><code> `config.ru`,  
</code></pre>

<p>Rack-  .</p>

<pre><code class="ruby"># config.ru
require &#39;./my_app&#39;
run MyApp
</code></pre>

<p>:</p>

<pre><code>rackup -p 4567
</code></pre>

<a name='config.ru'></a>
<h3>config.ru</h3>

<p>:</p>

<pre><code class="ruby"># app.rb
require &#39;sinatra&#39;

get &#39;/&#39; do
  &#39;Hello world!&#39;
end
</code></pre>

<p><code>config.ru</code>:</p>

<pre><code class="ruby">require &#39;./app&#39;
run Sinatra::Application
</code></pre>

<a name='config.ru?'></a>
<h3>config.ru?</h3>

<p>,   , ,<br>
<code>config.ru</code>:</p>

<ul>
<li>       Rack-
(Passenger, Unicorn, Heroku, ...);</li>
<li>      <code>Sinatra::Base</code>;</li>
<li>   Sinatra    &quot;&quot; Rack.</li>
</ul>

<p>**     <code>config.ru</code>  ,
      .<br>
  ,<br>
<code>config.ru</code>.**</p>

<a name='Sinatra%20%20%20&quot;&quot;'></a>
<h3>Sinatra   &quot;&quot;</h3>

<p>Sinatra   &quot;&quot; Rack,    Sinatra
       Rack endpoint<br>
&quot;&quot;.  endpoint ( )    Sinatra
,  ,   Rack (Rails/Ramaze/Camping/...):</p>

<pre><code class="ruby">require &#39;sinatra/base&#39;

class LoginScreen &lt; Sinatra::Base
  enable :sessions

  get(&#39;/login&#39;) { haml :login }

  post(&#39;/login&#39;) do
    if params[:name] == &#39;admin&#39; &amp;&amp; params[:password] == &#39;admin&#39;
      session[&#39;user_name&#39;] = params[:name]
    else
      redirect &#39;/login&#39;
    end
  end
end

class MyApp &lt; Sinatra::Base
  # &quot;&quot;    
  use LoginScreen

  before do
    unless session[&#39;user_name&#39;]
      halt &quot;Access denied, please &lt;a href=&#39;/login&#39;&gt;login&lt;/a&gt;.&quot;
    end
  end

  get(&#39;/&#39;) { &quot;Hello #{session[&#39;user_name&#39;]}.&quot; }
end
</code></pre>

<a name='&quot;%20&quot;'></a>
<h3>&quot; &quot;</h3>

<p>Sinatra  &quot; &quot; (,<br>
).     <code>Sinatra.new</code>:</p>

<pre><code class="ruby">require &#39;sinatra/base&#39;
my_app = Sinatra.new { get(&#39;/&#39;) { &quot;hi&quot; } }
my_app.run!
</code></pre>

<pre><code> ,   
</code></pre>

<p>:</p>

<pre><code class="ruby"># config.ru
require &#39;sinatra/base&#39;

controller = Sinatra.new do
  enable :logging
  helpers MyHelpers
end

map(&#39;/a&#39;) do
  run Sinatra.new(controller) { get(&#39;/&#39;) { &#39;a&#39; } }
end

map(&#39;/b&#39;) do
  run Sinatra.new(controller) { get(&#39;/&#39;) { &#39;b&#39; } }
end
</code></pre>

<pre><code>  Sinatra   
</code></pre>

<p>Sinatra   .</p>

<p>,  Sinatra  &quot;&quot;  :</p>

<pre><code class="ruby">require &#39;sinatra/base&#39;

use Sinatra do
  get(&#39;/&#39;) { ... }
end

run RailsProject::Application
</code></pre>

<pre><code>  ,   
</code></pre>

<p>.</p>

<a name='/'></a>
<h3>/</h3>

<p>Sinatra    <code>Sinatra::Base</code>.<br>
 DSL   (<code>require &#39;sinatra&#39;</code>),<br>
<code>Sinatra::Application</code>,    ,    .
       ,  <code>get</code>  <code>before</code>, 
       <code>request</code>  <code>session</code>,<br>
       .</p>

<p>,    <code>set</code>,    :</p>

<pre><code class="ruby">class MyApp &lt; Sinatra::Base
  #     !
  set :foo, 42
  foo # =&gt; 42

  get &#39;/foo&#39; do
    #       !
  end
end
</code></pre>

<pre><code>  :
</code></pre>

<ul>
<li>   ;</li>
<li>,  ;</li>
<li>,   <code>helpers</code>;</li>
<li>,     <code>set</code>;</li>
<li><p>,   <code>Sinatra.new</code>.</p>

<pre><code>( )
</code></pre>

<p>:</p></li>
<li><p>,    (<code>configure { |c| ... }</code>);</p></li>
<li><p><code>settings</code>    .</p></li>
</ul>

<a name='/'></a>
<h3>/</h3>

<pre><code>     ,
    .   
</code></pre>

<p><code>request</code>  <code>session</code> ,<br>
,   <code>erb</code>  <code>haml</code>.<br>
    ,  -
<code>settings</code>:</p>

<pre><code class="ruby">class MyApp &lt; Sinatra::Base
  #     !
  get &#39;/define_route/:name&#39; do
    #    &#39;/define_route/:name&#39;
    @value = 42

    settings.get(&quot;/#{params[:name]}&quot;) do
      #    &quot;/#{params[:name]}&quot;
      @value # =&gt; nil ( )
    end

    &quot;Route defined!&quot;
  end
end
</code></pre>

<pre><code>  :
</code></pre>

<ul>
<li>get/head/post/put/delete/options ;</li>
<li>before/after ;</li>
<li>-;</li>
<li>/.</li>
</ul>

<p>. ,<br>
,        .  ,<br>
 ,  ,  /<br>
   ( ,     <code>self</code> ).<br>
   , 
<code>Sinatra::Delegator.delegate :method_name</code>.</p>

<pre><code> :
</code></pre>

<ul>
<li>   ,    <code>require &#39;sinatra&#39;</code>;</li>
<li><p>,    <code>Sinatra::Delegator</code>.</p>

<p>: 
<a href="https://github.com/sinatra/sinatra/blob/ca06364/lib/sinatra/base.rb#L1609-1633"> Sinatra::Delegator</a>
<a href="https://github.com/sinatra/sinatra/blob/ca06364/lib/sinatra/main.rb#L28-30">  </a>.</p></li>
</ul>

<p>Sinatra     :</p>

<pre><code>ruby myapp.rb [-h] [-x] [-e ENVIRONMENT] [-p PORT] [-o HOST] [-s HANDLER]
</code></pre>

<p>:</p>

<pre><code>-h #  
-p #   (  4567)
-o #   (  0.0.0.0)
-e #  ,  (  development)
-s #  rack / (  thin)
-x #  - (  )
</code></pre>

<p>Ruby  :</p>

<dl>
  <dt>Ruby 1.8.7</dt>
  <dd>1.8.7  ,   ,      
     ,    1.9.2    JRuby 
    Rubinius.  1.8.7      Sinatra 2.0  Ruby
    2.0,      1.8.8 ( ).   ,
    ,    . <b>Ruby 1.8.6  
    .</b>     1.8.6,   Sinatra
    1.2,         ,  
      Sinatra 1.4.0.</dd>

  <dt>Ruby 1.9.2</dt>
  <dd>1.9.2      .
      1.9.2p0,
    ,        Sinatra. 
            Ruby 1.9.4/2.0, 
       1.9     ,  
       Ruby.</dd>

  <dt>Ruby 1.9.3</dt>
  <dd>1.9.3  . ,    1.9.3 
         .</dd>

  <dt>Rubinius</dt>
  <dd>Rubinius   (Rubinius &gt;= 1.2.4), ,  
   , .   2.0  .</dd>

  <dt>JRuby</dt>
  <dd>JRuby   (JRuby &gt;= 1.6.5).    
    .   ,   
  JRuby, , ,   JRuby Rack-,   Thin 
     JRuby.    C  JRuby 
   ,       RDiscount,
  Redcarpet  RedCloth.</dd>
</dl>

<pre><code>    Ruby.
</code></pre>

<p>Ruby   ,  ,<br>
  Sinatra:</p>

<ul>
<li>  JRuby  Rubinius;</li>
<li>Ruby Enterprise Edition;</li>
<li>MacRuby, Maglev, IronRuby;</li>
<li>Ruby 1.9.0  1.9.1 (    ).</li>
</ul>

<p>,     , , ,  - 
   ,         ,
 .</p>

<pre><code>CI-   Ruby,   
</code></pre>

<p>( 2.0.0),   1.9.4,      ,<br>
   . ,  1.9.4p0  2.0.0p0 
.</p>

<p>Sinatra      ,<br>
   Ruby.</p>

<p>Sinatra  Cardinal, SmallRuby, BlueRuby<br>
 Ruby  1.8.7.</p>

<pre><code>   Sinatra,   
  master  Sinatra,   .

   ,    
</code></pre>

<p>:</p>

<pre><code>gem install sinatra --pre
</code></pre>

<pre><code> .
</code></pre>

<a name='Bundler'></a>
<h3>Bundler</h3>

<pre><code>     Sinatra, 
</code></pre>

<p><a href="http://gembundler.com/">Bundler</a>.</p>

<p>Bundler,      :</p>

<pre><code>gem install bundler
</code></pre>

<p><code>Gemfile</code>    :</p>

<pre><code class="ruby">source :rubygems
gem &#39;sinatra&#39;, :git =&gt; &quot;git://github.com/sinatra/sinatra.git&quot;

#  
gem &#39;haml&#39;                    # ,   haml
gem &#39;activerecord&#39;, &#39;~&gt; 3.0&#39;  #  ,    ActiveRecord 3.x
</code></pre>

<p>,<br>
  . ,   Sinatra (Rack  Tilt)
Bundler    .</p>

<pre><code>  :
</code></pre>

<pre><code>bundle exec ruby myapp.rb
</code></pre>

<p><code>sinatra/lib</code>   <code>$LOAD_PATH</code>:</p>

<pre><code>cd myapp
git clone git://github.com/sinatra/sinatra.git
ruby -Isinatra/lib myapp.rb
</code></pre>

<p>Sinatra:</p>

<pre><code>cd myapp/sinatra
git pull
</code></pre>

<pre><code>gem:
</code></pre>

<pre><code>git clone git://github.com/sinatra/sinatra.git
cd sinatra
rake sinatra.gemspec
rake install
</code></pre>

<pre><code>(gem)   root,   
</code></pre>

<pre><code>sudo rake install
</code></pre>

<p>Sinatra  <a href="http://semver.org/">Semantic Versioning</a>, SemVer 
SemVerTag.</p>

<ul>
<li><a href="http://www.sinatrarb.com/">- </a><br>
,      .</li>
<li><a href="http://www.sinatrarb.com/contributing">  </a><br>
?  ?  ?</li>
<li><a href="http://github.com/sinatra/sinatra/issues">  /</a></li>
<li><a href="http://twitter.com/sinatra">Twitter</a></li>
<li><a href="http://groups.google.com/group/sinatrarb/topics"> </a></li>
<li>[#sinatra](irc://chat.freenode.net/#sinatra)  http://freenode.net</li>
<li><a href="http://sinatra-book.gittr.com">Sinatra Book</a><br></li>
<li><a href="http://recipes.sinatrarb.com/">Sinatra Recipes</a><br></li>
<li>API   <a href="http://rubydoc.info/gems/sinatra"> </a>
<a href="http://rubydoc.info/github/sinatra/sinatra"> HEAD</a> 
http://rubydoc.info</li>
<li><a href="http://travis-ci.org/sinatra/sinatra">  </a></li>
</ul>
