<div class='toc'>
	<ol class='level-1'>
		<li><a href='#/'>/</a></li>
		<ol class='level-2'>
			<li><a href='#Haml'>Haml</a></li>
			<li><a href='#Erb'>Erb</a></li>
			<li><a href='#Builder'>Builder</a></li>
			<li><a href='#Nokogiri'>Nokogiri</a></li>
			<li><a href='#Sass'>Sass</a></li>
			<li><a href='#SCSS'>SCSS</a></li>
			<li><a href='#Less'>Less</a></li>
			<li><a href='#Liquid'>Liquid</a></li>
			<li><a href='#Markdown'>Markdown</a></li>
			<li><a href='#Textile'>Textile</a></li>
			<li><a href='#RDoc'>RDoc</a></li>
			<li><a href='#Radius'>Radius</a></li>
			<li><a href='#Markaby'>Markaby</a></li>
			<li><a href='#RABL'>RABL</a></li>
			<li><a href='#Slim'>Slim</a></li>
			<li><a href='#Creole'>Creole</a></li>
			<li><a href='#CoffeeScript'>CoffeeScript</a></li>
			<li><a href='#Yajl'>Yajl</a></li>
			<li><a href='#WLang'>WLang</a></li>
			<li><a href='#%3Ccode%3Eyield%3C/code%3E%20%20%20%20(layout)'><code>yield</code>    (layout)</a></li>
		</ol>
		<li><a href='#-'>-</a></li>
		<ol class='level-2'>
			<li><a href='#,'>,</a></li>
			<li><a href='#Mime-'>Mime-</a></li>
			<li><a href='#URL'>URL</a></li>
			<li><a href='#()'>()</a></li>
		</ol>
		<li><a href='#,'>,</a></li>
		<ol class='level-2'>
			<li><a href='#Not%20Found'>Not Found</a></li>
		</ol>
		<li><a href='#Rack%20&quot;&quot;'>Rack &quot;&quot;</a></li>
		<li><a href='#Sinatra::Base%20%20&quot;&quot;,'>Sinatra::Base  &quot;&quot;,</a></li>
		<ol class='level-2'>
			<li><a href='#config.ru'>config.ru</a></li>
			<li><a href='#config.ru?'>config.ru?</a></li>
			<li><a href='#Sinatra%20%20%20&quot;&quot;'>Sinatra   &quot;&quot;</a></li>
			<li><a href='#&quot;%20&quot;'>&quot; &quot;</a></li>
			<li><a href='#/'>/</a></li>
			<li><a href='#/'>/</a></li>
			<li><a href='#Bundler'>Bundler</a></li>
	</ol></ol>
</div>


<p>*:<br>
*</p>

<p>Sinatra   - 
(<a href="http://ru.wikipedia.org/wiki/-__">DSL</a>)
    -  Ruby   :</p>
<pre class="highlight ruby"><span class="c1"># myapp.rb</span>
<span class="nb">require</span> <span class="s1">'sinatra'</span>

<span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="s1">'Hello world!'</span>
<span class="k">end</span>
</pre>
<p>gem:</p>
<pre class="highlight text">gem install sinatra
</pre><pre class="highlight text">:
</pre><pre class="highlight text">ruby myapp.rb
</pre>
<p>: http://localhost:4567</p>

<p>Thin,    : <code>gem install
thin</code>. Thin<br>
   Sinatra.</p>

<p>Sinatra    : &lt;HTTP &gt;  &lt; URL&gt;.<br>
   :</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="c1"># .. -  ..</span>
<span class="k">end</span>

<span class="n">post</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="c1"># .. -  ..</span>
<span class="k">end</span>

<span class="n">put</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="c1"># .. -  ..</span>
<span class="k">end</span>

<span class="n">patch</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="c1"># .. -  ..</span>
<span class="k">end</span>

<span class="n">delete</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="c1"># .. -  ..</span>
<span class="k">end</span>

<span class="n">options</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="c1"># .. -  ..</span>
<span class="k">end</span>
</pre>
<p>.         .</p>
<pre class="highlight text">   ,   x
</pre>
<p><code>params</code>:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/hello/:name'</span> <span class="k">do</span>
  <span class="c1">#  &quot;GET /hello/foo&quot;  &quot;GET /hello/bar&quot;,</span>
  <span class="c1">#  params[:name] 'foo'  'bar'</span>
  <span class="s2">&quot;Hello </span><span class="si">#{</span><span class="n">params</span><span class="o">[</span><span class="ss">:name</span><span class="o">]</span><span class="si">}</span><span class="s2">!&quot;</span>
<span class="k">end</span>
</pre><pre class="highlight text">    :
</pre><pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/hello/:name'</span> <span class="k">do</span> <span class="o">|</span><span class="n">n</span><span class="o">|</span>
  <span class="s2">&quot;Hello </span><span class="si">#{</span><span class="n">n</span><span class="si">}</span><span class="s2">!&quot;</span>
<span class="k">end</span>
</pre><pre class="highlight text">   splat ( '*' ,
</pre>
<p>) ,    <code>params[:splat]</code>:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/say/*/to/*'</span> <span class="k">do</span>
  <span class="c1">#  /say/hello/to/world</span>
  <span class="n">params</span><span class="o">[</span><span class="ss">:splat</span><span class="o">]</span> <span class="c1"># =&gt; [&quot;hello&quot;, &quot;world&quot;]</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/download/*.*'</span> <span class="k">do</span>
  <span class="c1">#  /download/path/to/file.xml</span>
  <span class="n">params</span><span class="o">[</span><span class="ss">:splat</span><span class="o">]</span> <span class="c1"># =&gt; [&quot;path/to/file&quot;, &quot;xml&quot;]</span>
<span class="k">end</span>
</pre>
<p>:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/download/*.*'</span> <span class="k">do</span> <span class="o">|</span><span class="n">path</span><span class="p">,</span> <span class="n">ext</span><span class="o">|</span>
  <span class="o">[</span><span class="n">path</span><span class="p">,</span> <span class="n">ext</span><span class="o">]</span> <span class="c1"># =&gt; [&quot;path/to/file&quot;, &quot;xml&quot;]</span>
<span class="k">end</span>
</pre><pre class="highlight text"> :
</pre><pre class="highlight ruby"><span class="n">get</span> <span class="sr">%r{/hello/([</span><span class="se">\w</span><span class="sr">]+)}</span> <span class="k">do</span>
  <span class="s2">&quot;Hello, </span><span class="si">#{</span><span class="n">params</span><span class="o">[</span><span class="ss">:captures</span><span class="o">]</span><span class="nf">.first</span><span class="si">}</span><span class="s2">!&quot;</span>
<span class="k">end</span>
</pre>
<p>:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="sr">%r{/hello/([</span><span class="se">\w</span><span class="sr">]+)}</span> <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span>
  <span class="s2">&quot;Hello, </span><span class="si">#{</span><span class="n">c</span><span class="si">}</span><span class="s2">!&quot;</span>
<span class="k">end</span>
</pre><pre class="highlight text"> :
</pre><pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/posts.?:format?'</span> <span class="k">do</span>
  <span class="c1">#  &quot;GET /posts&quot;, &quot;GET /posts.json&quot;, &quot;GET /posts.xml&quot;  ..</span>
<span class="k">end</span>
</pre>
<p>,           (path
traversal, . ),<br>
 .</p>
<pre class="highlight text"> , , 
</pre>
<p>(user agent):</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/foo'</span><span class="p">,</span> <span class="ss">:agent</span> <span class="o">=&gt;</span> <span class="sr">/Songbird (\d\.\d)[\d\/]*?/</span> <span class="k">do</span>
  <span class="s2">&quot;You're using Songbird version </span><span class="si">#{</span><span class="n">params</span><span class="o">[</span><span class="ss">:agent</span><span class="o">][</span><span class="mi">0</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/foo'</span> <span class="k">do</span>
  <span class="c1">#  -songbird </span>
<span class="k">end</span>
</pre><pre class="highlight text">`host_name`  `provides`:
</pre><pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/'</span><span class="p">,</span> <span class="ss">:host_name</span> <span class="o">=&gt;</span> <span class="sr">/^admin\./</span> <span class="k">do</span>
  <span class="s2">&quot;Admin Area, Access denied!&quot;</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/'</span><span class="p">,</span> <span class="ss">:provides</span> <span class="o">=&gt;</span> <span class="s1">'html'</span> <span class="k">do</span>
  <span class="n">haml</span> <span class="ss">:index</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/'</span><span class="p">,</span> <span class="ss">:provides</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="s1">'rss'</span><span class="p">,</span> <span class="s1">'atom'</span><span class="p">,</span> <span class="s1">'xml'</span><span class="o">]</span> <span class="k">do</span>
  <span class="n">builder</span> <span class="ss">:feed</span>
<span class="k">end</span>
</pre><pre class="highlight text">:
</pre><pre class="highlight ruby"><span class="n">set</span><span class="p">(</span><span class="ss">:probability</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">value</span><span class="o">|</span> <span class="n">condition</span> <span class="p">{</span> <span class="nb">rand</span> <span class="o">&lt;=</span> <span class="n">value</span> <span class="p">}</span> <span class="p">}</span>

<span class="n">get</span> <span class="s1">'/win_a_car'</span><span class="p">,</span> <span class="ss">:probability</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="o">.</span><span class="mi">1</span> <span class="k">do</span>
  <span class="s2">&quot;You won!&quot;</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/win_a_car'</span> <span class="k">do</span>
  <span class="s2">&quot;Sorry, you lost.&quot;</span>
<span class="k">end</span>
</pre>
<p>,    ,  :</p>
<pre class="highlight ruby"><span class="n">set</span><span class="p">(</span><span class="ss">:auth</span><span class="p">)</span> <span class="k">do</span> <span class="o">|*</span><span class="n">roles</span><span class="o">|</span>   <span class="c1"># &lt;-    </span>
  <span class="n">condition</span> <span class="k">do</span>
    <span class="k">unless</span> <span class="n">logged_in?</span> <span class="o">&amp;&amp;</span> <span class="n">roles</span><span class="nf">.any?</span> <span class="p">{</span><span class="o">|</span><span class="n">role</span><span class="o">|</span> <span class="n">current_user</span><span class="nf">.in_role?</span> <span class="n">role</span> <span class="p">}</span>
      <span class="n">redirect</span> <span class="s2">&quot;/login/&quot;</span><span class="p">,</span> <span class="mi">303</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s2">&quot;/my/account/&quot;</span><span class="p">,</span> <span class="ss">:auth</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:user</span><span class="p">,</span> <span class="ss">:admin</span><span class="o">]</span> <span class="k">do</span>
  <span class="s2">&quot;Your Account Details&quot;</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s2">&quot;/only/admin/&quot;</span><span class="p">,</span> <span class="ss">:auth</span> <span class="o">=&gt;</span> <span class="ss">:admin</span> <span class="k">do</span>
  <span class="s2">&quot;Only admins are allowed here!&quot;</span>
<span class="k">end</span>
</pre><pre class="highlight text">  , 
</pre>
<p>HTTP ,   &quot;&quot; (middleware)  Rack
.    ,    .<br>
 .</p>
<pre class="highlight text">,     Rack ,
</pre>
<p>Rack body,    HTTP:</p>

<ul>
<li>   : <code>[ (Fixnum),  (Hash),  
(   #each)]</code>;</li>
<li>   : <code>[ (Fixnum),   ( 
#each)]</code>;</li>
<li>,   <code>#each</code>,<br>
 ;</li>
<li><p>Fixnum,    HTTP.</p>

<p>,   , ,  :</p></li>
</ul>
<pre class="highlight ruby"><span class="k">class</span> <span class="nc">Stream</span>
  <span class="k">def</span> <span class="nf">each</span>
    <span class="mi">100</span><span class="nf">.times</span> <span class="p">{</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span> <span class="k">yield</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">i</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)</span> <span class="p">{</span> <span class="no">Stream</span><span class="nf">.new</span> <span class="p">}</span>
</pre><pre class="highlight text"> `stream` ( ), 
</pre>
<p>.</p>

<p>, Sinatra<br>
     URL.      .<br>
      (matchers) 
:</p>
<pre class="highlight ruby"><span class="k">class</span> <span class="nc">AllButPattern</span>
  <span class="nc">Match</span> <span class="o">=</span> <span class="no">Struct</span><span class="nf">.new</span><span class="p">(</span><span class="ss">:captures</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">except</span><span class="p">)</span>
    <span class="vi">@except</span>   <span class="o">=</span> <span class="n">except</span>
    <span class="vi">@captures</span> <span class="o">=</span> <span class="no">Match</span><span class="nf">.new</span><span class="p">(</span><span class="o">[]</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">match</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
    <span class="vi">@captures</span> <span class="k">unless</span> <span class="vi">@except</span> <span class="o">===</span> <span class="n">str</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">all_but</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
  <span class="no">AllButPattern</span><span class="nf">.new</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">get</span> <span class="n">all_but</span><span class="p">(</span><span class="s2">&quot;/index&quot;</span><span class="p">)</span> <span class="k">do</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</pre>
<p>,   , ,  ,<br>
   :</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="sr">//</span> <span class="k">do</span>
  <span class="n">pass</span> <span class="k">if</span> <span class="n">request</span><span class="nf">.path_info</span> <span class="o">==</span> <span class="s2">&quot;/index&quot;</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</pre><pre class="highlight text"> :
</pre><pre class="highlight ruby"><span class="n">get</span> <span class="sr">%r{^(?!/index$)}</span> <span class="k">do</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</pre><pre class="highlight text">`./public` .    
</pre>
<p>,   <code>:public_folder</code>:</p>
<pre class="highlight ruby"><span class="n">set</span> <span class="ss">:public_folder</span><span class="p">,</span> <span class="no">File</span><span class="nf">.dirname</span><span class="p">(</span><span class="kp">__FILE__</span><span class="p">)</span> <span class="o">+</span> <span class="s1">'/static'</span>
</pre>
<p>,          URL.
,  <code>./public/css/style.css</code><br>
<code>http://example.com/css/style.css</code>.</p>

<p><code>:static_cache_control</code> (. ),<br>
<code>Cache-Control</code>.</p>

<a name='/'></a>
<h2>/</h2>
<pre class="highlight text"> .   
</pre>
<p>:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">erb</span> <span class="ss">:index</span>
<span class="k">end</span>
</pre>
<p><code>views/index.erb</code>.</p>

<p>:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">code</span> <span class="o">=</span> <span class="s2">&quot;&lt;%= Time.now %&gt;&quot;</span>
  <span class="n">erb</span> <span class="n">code</span>
<span class="k">end</span>
</pre><pre class="highlight text">,   :
</pre><pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">erb</span> <span class="ss">:index</span><span class="p">,</span> <span class="ss">:layout</span> <span class="o">=&gt;</span> <span class="ss">:post</span>
<span class="k">end</span>
</pre>
<p><code>views/index.erb</code>,   <code>views/post.erb</code> ( :
<code>views/layout.erb</code>,  ).</p>

<p>,   Sinatra,    :</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">haml</span> <span class="ss">:index</span><span class="p">,</span> <span class="ss">:format</span> <span class="o">=&gt;</span> <span class="ss">:html5</span>
<span class="k">end</span>
</pre><pre class="highlight text">    :
</pre><pre class="highlight ruby"><span class="n">set</span> <span class="ss">:haml</span><span class="p">,</span> <span class="ss">:format</span> <span class="o">=&gt;</span> <span class="ss">:html5</span>

<span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">haml</span> <span class="ss">:index</span>
<span class="k">end</span>
</pre>
<p>,   ,  ,    <code>set</code>.</p>

<p>:</p>

<dl>
  <dt>locals</dt>
  <dd>
      ,   .
    : <tt>erb "<%= foo %>", :locals => {:foo => "bar"}</tt>
  </dd>

  <dt>default_encoding</dt>
  <dd>
    ,   ,    
    .  : <tt>settings.default_encoding</tt>.
  </dd>

  <dt>views</dt>
  <dd>
      .  : <tt>settings.views</tt>.
  </dd>

  <dt>layout</dt>
  <dd>
        (<tt>true</tt>  <tt>false</tt>).    Symbol,
     ,      . :
    <tt>erb :index, :layout => !request.xhr?</tt>
  </dd>

  <dt>content_type</dt>
  <dd>
    Content-Type  .  :  .
  </dd>

  <dt>scope</dt>
  <dd>
     ,    .  : 
    .     ,    
    -     .
  </dd>

  <dt>layout_engine</dt>
  <dd>
    ,      .
       ,     
    .  :   ,     
    . : <tt>set :rdoc, :layout_engine => :erb</tt>
  </dd>
</dl>

<p>,      <code>./views</code>. 
    :</p>
<pre class="highlight ruby"><span class="n">set</span> <span class="ss">:views</span><span class="p">,</span> <span class="n">settings</span><span class="nf">.root</span> <span class="o">+</span> <span class="s1">'/templates'</span>
</pre>
<p>:<br>
(Symbol),      (<br>
<code>:&#39;subdir/template&#39;</code>).    ,<br>
    ,  .</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">haml</span> <span class="s1">'%div.title Hello World'</span>
<span class="k">end</span>
</pre>
<p>,  .</p>
<pre class="highlight text"> .  , 
</pre>
<p>,      :</p>
<pre class="highlight ruby"><span class="nb">require</span> <span class="s1">'rdiscount'</span> <span class="c1">#  require 'bluecloth'</span>
<span class="n">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)</span> <span class="p">{</span> <span class="n">markdown</span> <span class="ss">:index</span> <span class="p">}</span>
</pre>
<a name='Haml'></a>
<h3>Haml</h3>

<table>
  <tr>
    <td></td>
    <td><a href="http://haml.info/" title="haml">haml</a></td>
  </tr>
  <tr>
    <td> </td>
    <td><tt>.haml</tt></td>
  </tr>
  <tr>
    <td></td>
    <td><tt>haml :index, :format => :html5</tt></td>
  </tr>
</table>

<a name='Erb'></a>
<h3>Erb</h3>

<table>
  <tr>
    <td></td>
    <td>
      <a href="http://www.kuwata-lab.com/erubis/" title="erubis">erubis</a>
       erb (  Ruby)
    </td>
  </tr>
  <tr>
    <td> </td>
    <td><tt>.erb</tt>, <tt>.rhtml</tt> or <tt>.erubis</tt> ( Erubis)</td>
  </tr>
  <tr>
    <td></td>
    <td><tt>erb :index</tt></td>
  </tr>
</table>

<a name='Builder'></a>
<h3>Builder</h3>

<table>
  <tr>
    <td></td>
    <td>
      <a href="http://builder.rubyforge.org/" title="builder">builder</a>
    </td>
  </tr>
  <tr>
    <td> </td>
    <td><tt>.builder</tt></td>
  </tr>
  <tr>
    <td></td>
    <td><tt>builder { |xml| xml.em "hi" }</tt></td>
  </tr>
</table>
<pre class="highlight text">   (. ).
</pre>
<a name='Nokogiri'></a>
<h3>Nokogiri</h3>

<table>
  <tr>
    <td></td>
    <td><a href="http://nokogiri.org/" title="nokogiri">nokogiri</a></td>
  </tr>
  <tr>
    <td> </td>
    <td><tt>.nokogiri</tt></td>
  </tr>
  <tr>
    <td></td>
    <td><tt>nokogiri { |xml| xml.em "hi" }</tt></td>
  </tr>
</table>
<pre class="highlight text">   (. ).
</pre>
<a name='Sass'></a>
<h3>Sass</h3>

<table>
  <tr>
    <td></td>
    <td><a href="http://sass-lang.com/" title="sass">sass</a></td>
  </tr>
  <tr>
    <td> </td>
    <td><tt>.sass</tt></td>
  </tr>
  <tr>
    <td></td>
    <td><tt>sass :stylesheet, :style => :expanded</tt></td>
  </tr>
</table>

<a name='SCSS'></a>
<h3>SCSS</h3>

<table>
  <tr>
    <td></td>
    <td><a href="http://sass-lang.com/" title="sass">sass</a></td>
  </tr>
  <tr>
    <td> </td>
    <td><tt>.scss</tt></td>
  </tr>
  <tr>
    <td></td>
    <td><tt>scss :stylesheet, :style => :expanded</tt></td>
  </tr>
</table>

<a name='Less'></a>
<h3>Less</h3>

<table>
  <tr>
    <td></td>
    <td><a href="http://www.lesscss.org/" title="less">less</a></td>
  </tr>
  <tr>
    <td> </td>
    <td><tt>.less</tt></td>
  </tr>
  <tr>
    <td></td>
    <td><tt>less :stylesheet</tt></td>
  </tr>
</table>

<a name='Liquid'></a>
<h3>Liquid</h3>

<table>
  <tr>
    <td></td>
    <td><a href="http://www.liquidmarkup.org/" title="liquid">liquid</a></td>
  </tr>
  <tr>
    <td> </td>
    <td><tt>.liquid</tt></td>
  </tr>
  <tr>
    <td></td>
    <td><tt>liquid :index, :locals => { :key => 'value' }</tt></td>
  </tr>
</table>

<p>Liquid      Ruby ( <code>yield</code>), 
        .</p>

<a name='Markdown'></a>
<h3>Markdown</h3>

<table>
  <tr>
    <td></td>
    <td>
        :
        <a href="https://github.com/rtomayko/rdiscount" title="RDiscount">RDiscount</a>,
        <a href="https://github.com/vmg/redcarpet" title="RedCarpet">RedCarpet</a>,
        <a href="http://deveiate.org/projects/BlueCloth" title="BlueCloth">BlueCloth</a>,
        <a href="http://kramdown.rubyforge.org/" title="kramdown">kramdown</a>,
        <a href="http://maruku.rubyforge.org/" title="maruku">maruku</a>
    </td>
  </tr>
  <tr>
    <td> </td>
    <td><tt>.markdown</tt>, <tt>.mkd</tt> and <tt>.md</tt></td>
  </tr>
  <tr>
    <td></td>
    <td><tt>markdown :index, :layout_engine => :erb</tt></td>
  </tr>
</table>

<p>Markdown       .
, ,  ,<br>
  :</p>
<pre class="highlight ruby"><span class="n">erb</span> <span class="ss">:overview</span><span class="p">,</span> <span class="ss">:locals</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:text</span> <span class="o">=&gt;</span> <span class="n">markdown</span><span class="p">(</span><span class="ss">:introduction</span><span class="p">)</span> <span class="p">}</span>
</pre>
<p>,      <code>markdown</code>   :</p>
<pre class="highlight ruby"><span class="o">%</span><span class="n">h1</span> <span class="no">Hello</span> <span class="no">From</span> <span class="no">Haml</span><span class="o">!</span>
<span class="o">%</span><span class="nb">p</span><span class="o">=</span> <span class="n">markdown</span><span class="p">(</span><span class="ss">:greetings</span><span class="p">)</span>
</pre><pre class="highlight text">Ruby  Markdown, ,   
</pre>
<p>Markdown.   ,<br>
    ,<br>
 <code>:layout_engine</code>.</p>

<a name='Textile'></a>
<h3>Textile</h3>

<table>
  <tr>
    <td></td>
    <td><a href="http://redcloth.org/" title="RedCloth">RedCloth</a></td>
  </tr>
  <tr>
    <td> </td>
    <td><tt>.textile</tt></td>
  </tr>
  <tr>
    <td></td>
    <td><tt>textile :index, :layout_engine => :erb</tt></td>
  </tr>
</table>

<p>Textile       .
, ,  ,<br>
  :</p>
<pre class="highlight ruby"><span class="n">erb</span> <span class="ss">:overview</span><span class="p">,</span> <span class="ss">:locals</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:text</span> <span class="o">=&gt;</span> <span class="n">textile</span><span class="p">(</span><span class="ss">:introduction</span><span class="p">)</span> <span class="p">}</span>
</pre>
<p>,      <code>textile</code>   :</p>
<pre class="highlight ruby"><span class="o">%</span><span class="n">h1</span> <span class="no">Hello</span> <span class="no">From</span> <span class="no">Haml</span><span class="o">!</span>
<span class="o">%</span><span class="nb">p</span><span class="o">=</span> <span class="n">textile</span><span class="p">(</span><span class="ss">:greetings</span><span class="p">)</span>
</pre><pre class="highlight text">Ruby  Textile, ,   
</pre>
<p>Textile.   ,<br>
    ,<br>
 <code>:layout_engine</code>.</p>

<a name='RDoc'></a>
<h3>RDoc</h3>

<table>
  <tr>
    <td></td>
    <td><a href="http://rdoc.rubyforge.org/" title="RDoc">RDoc</a></td>
  </tr>
  <tr>
    <td> </td>
    <td><tt>.rdoc</tt></td>
  </tr>
  <tr>
    <td></td>
    <td><tt>rdoc :README, :layout_engine => :erb</tt></td>
  </tr>
</table>

<p>RDoc       .
, ,  ,<br>
  :</p>
<pre class="highlight ruby"><span class="n">erb</span> <span class="ss">:overview</span><span class="p">,</span> <span class="ss">:locals</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:text</span> <span class="o">=&gt;</span> <span class="n">rdoc</span><span class="p">(</span><span class="ss">:introduction</span><span class="p">)</span> <span class="p">}</span>
</pre>
<p>,      <code>rdoc</code>   :</p>
<pre class="highlight ruby"><span class="o">%</span><span class="n">h1</span> <span class="no">Hello</span> <span class="no">From</span> <span class="no">Haml</span><span class="o">!</span>
<span class="o">%</span><span class="nb">p</span><span class="o">=</span> <span class="n">rdoc</span><span class="p">(</span><span class="ss">:greetings</span><span class="p">)</span>
</pre><pre class="highlight text">Ruby  RDoc, ,    
</pre>
<p>RDoc.   ,<br>
  ,<br>
<code>:layout_engine</code>.</p>

<a name='Radius'></a>
<h3>Radius</h3>

<table>
  <tr>
    <td></td>
    <td><a href="http://radius.rubyforge.org/" title="Radius">Radius</a></td>
  </tr>
  <tr>
    <td> </td>
    <td><tt>.radius</tt></td>
  </tr>
  <tr>
    <td></td>
    <td><tt>radius :index, :locals => { :key => 'value' }</tt></td>
  </tr>
</table>

<p>Radius      Ruby ,<br>
       .</p>

<a name='Markaby'></a>
<h3>Markaby</h3>

<table>
  <tr>
    <td></td>
    <td><a href="http://markaby.github.com/" title="Markaby">Markaby</a></td>
  </tr>
  <tr>
    <td> </td>
    <td><tt>.mab</tt></td>
  </tr>
  <tr>
    <td></td>
    <td><tt>markaby { h1 "Welcome!" }</tt></td>
  </tr>
</table>
<pre class="highlight text">   (. ).
</pre>
<a name='RABL'></a>
<h3>RABL</h3>

<table>
  <tr>
    <td></td>
    <td><a href="https://github.com/nesquena/rabl" title="Rabl">Rabl</a></td>
  </tr>
  <tr>
    <td> </td>
    <td><tt>.rabl</tt></td>
  </tr>
  <tr>
    <td></td>
    <td><tt>rabl :index</tt></td>
  </tr>
</table>

<a name='Slim'></a>
<h3>Slim</h3>

<table>
  <tr>
    <td></td>
    <td><a href="http://slim-lang.com/" title="Slim Lang">Slim Lang</a></td>
  </tr>
  <tr>
    <td> </td>
    <td><tt>.slim</tt></td>
  </tr>
  <tr>
    <td></td>
    <td><tt>slim :index</tt></td>
  </tr>
</table>

<a name='Creole'></a>
<h3>Creole</h3>

<table>
  <tr>
    <td></td>
    <td><a href="https://github.com/minad/creole" title="Creole">Creole</a></td>
  </tr>
  <tr>
    <td> </td>
    <td><tt>.creole</tt></td>
  </tr>
  <tr>
    <td></td>
    <td><tt>creole :wiki, :layout_engine => :erb</tt></td>
  </tr>
</table>

<p>Creole       .
, ,  ,<br>
  :</p>
<pre class="highlight ruby"><span class="n">erb</span> <span class="ss">:overview</span><span class="p">,</span> <span class="ss">:locals</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:text</span> <span class="o">=&gt;</span> <span class="n">creole</span><span class="p">(</span><span class="ss">:introduction</span><span class="p">)</span> <span class="p">}</span>
</pre>
<p>,      <code>creole</code>   :</p>
<pre class="highlight ruby"><span class="o">%</span><span class="n">h1</span> <span class="no">Hello</span> <span class="no">From</span> <span class="no">Haml</span><span class="o">!</span>
<span class="o">%</span><span class="nb">p</span><span class="o">=</span> <span class="n">creole</span><span class="p">(</span><span class="ss">:greetings</span><span class="p">)</span>
</pre><pre class="highlight text">Ruby  Creole, ,   
</pre>
<p>Creole.   ,<br>
    ,<br>
 <code>:layout_engine</code>.</p>

<a name='CoffeeScript'></a>
<h3>CoffeeScript</h3>

<table>
  <tr>
    <td></td>
    <td>
      <a href="https://github.com/josh/ruby-coffee-script" title="Ruby CoffeeScript">
        CoffeeScript
      </a>  
      <a href="https://github.com/sstephenson/execjs/blob/master/README.md#readme" title="ExecJS">
         JavaScript
      </a>
    </td>
  </tr>
  <tr>
    <td> </td>
    <td><tt>.coffee</tt></td>
  </tr>
  <tr>
    <td></td>
    <td><tt>coffee :index</tt></td>
  </tr>
</table>

<a name='Yajl'></a>
<h3>Yajl</h3>

<table>
  <tr>
    <td></td>
    <td><a href="https://github.com/brianmario/yajl-ruby" title="yajl-ruby">yajl-ruby</a></td>
  </tr>
  <tr>
    <td> </td>
    <td><tt>.yajl</tt></td>
  </tr>
  <tr>
    <td></td>
    <td>
      <tt>
        yajl :index,
             :locals => { :key => 'qux' },
             :callback => 'present',
             :variable => 'resource'
      </tt>
    </td>
  </tr>
</table>
<pre class="highlight text">  Ruby,  
</pre>
<p>json     <code>#to_json</code>.</p>
<pre class="highlight ruby"><span class="n">json</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">:foo</span> <span class="o">=&gt;</span> <span class="s1">'bar'</span> <span class="p">}</span>
<span class="n">json</span><span class="o">[</span><span class="ss">:baz</span><span class="o">]</span> <span class="o">=</span> <span class="n">key</span>
</pre>
<p><code>:callback</code>  <code>:variable</code>   &quot;&quot; 
.</p>
<pre class="highlight ruby"><span class="n">var</span> <span class="n">resource</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;foo&quot;</span><span class="ss">:&quot;bar&quot;</span><span class="p">,</span><span class="s2">&quot;baz&quot;</span><span class="ss">:&quot;qux&quot;</span><span class="p">};</span> <span class="n">present</span><span class="p">(</span><span class="n">resource</span><span class="p">);</span>
</pre>
<a name='WLang'></a>
<h3>WLang</h3>

<table>
  <tr>
    <td></td>
    <td><a href="https://github.com/blambeau/wlang/" title="wlang">wlang</a></td>
  </tr>
  <tr>
    <td> </td>
    <td><tt>.wlang</tt></td>
  </tr>
  <tr>
    <td></td>
    <td><tt>wlang :index, :locals => { :key => 'value' }</tt></td>
  </tr>
</table>

<p>WLang      Ruby  (
 <code>yield</code>),<br>
.</p>
<pre class="highlight text"> ,    .
</pre>
<p>,     , 
   :</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/:id'</span> <span class="k">do</span>
  <span class="vi">@foo</span> <span class="o">=</span> <span class="no">Foo</span><span class="nf">.find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
  <span class="n">haml</span> <span class="s1">'%h1= @foo.name'</span>
<span class="k">end</span>
</pre><pre class="highlight text">  :
</pre><pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/:id'</span> <span class="k">do</span>
  <span class="n">foo</span> <span class="o">=</span> <span class="no">Foo</span><span class="nf">.find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
  <span class="n">haml</span> <span class="s1">'%h1= bar.name'</span><span class="p">,</span> <span class="ss">:locals</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:bar</span> <span class="o">=&gt;</span> <span class="n">foo</span> <span class="p">}</span>
<span class="k">end</span>
</pre>
<p>,       .</p>

<a name='%3Ccode%3Eyield%3C/code%3E%20%20%20%20(layout)'></a>
<h3><code>yield</code>    (layout)</h3>

<p>(layout)    ,<br>
<code>yield</code>.
         <code>:template</code>,
  ,      :</p>
<pre class="highlight ruby">    <span class="n">erb</span> <span class="ss">:post</span><span class="p">,</span> <span class="ss">:layout</span> <span class="o">=&gt;</span> <span class="kp">false</span> <span class="k">do</span>
      <span class="n">erb</span> <span class="ss">:index</span>
    <span class="k">end</span>
</pre><pre class="highlight text"> `erb :index, :layout =&gt; :post`.
</pre>
<p>:</p>
<pre class="highlight ruby">    <span class="n">erb</span> <span class="ss">:main_layout</span><span class="p">,</span> <span class="ss">:layout</span> <span class="o">=&gt;</span> <span class="kp">false</span> <span class="k">do</span>
      <span class="n">erb</span> <span class="ss">:admin_layout</span> <span class="k">do</span>
        <span class="n">erb</span> <span class="ss">:user</span>
      <span class="k">end</span>
    <span class="k">end</span>
</pre><pre class="highlight text">  :
</pre><pre class="highlight ruby">    <span class="n">erb</span> <span class="ss">:admin_layout</span><span class="p">,</span> <span class="ss">:layout</span> <span class="o">=&gt;</span> <span class="ss">:main_layout</span> <span class="k">do</span>
      <span class="n">erb</span> <span class="ss">:user</span>
    <span class="k">end</span>
</pre>
<p>,<br>
 :
<code>erb</code>, <code>haml</code>, <code>liquid</code>, <code>slim</code>, <code>wlang</code>.
    <code>render</code>   .</p>
<pre class="highlight text">    :
</pre><pre class="highlight ruby"><span class="nb">require</span> <span class="s1">'sinatra'</span>

<span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">haml</span> <span class="ss">:index</span>
<span class="k">end</span>

<span class="cp">__END__

@@ layout
%html
  = yield

@@ index
%div.title Hello world.
</span></pre>
<p>:  ,    ,<br>
Sinatra,   .  <code>enable :inline_templates</code>
,       .</p>
<pre class="highlight text">   `template` :
</pre><pre class="highlight ruby"><span class="n">template</span> <span class="ss">:layout</span> <span class="k">do</span>
  <span class="s2">&quot;%html</span><span class="se">\n</span><span class="s2">  =yield</span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="k">end</span>

<span class="n">template</span> <span class="ss">:index</span> <span class="k">do</span>
  <span class="s1">'%div.title Hello World!'</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">haml</span> <span class="ss">:index</span>
<span class="k">end</span>
</pre><pre class="highlight text">&quot;layout&quot; ,     
</pre>
<p>.<br>
 <code>:layout =&gt; false</code>      : <code>set :haml,
:layout =&gt; false</code>:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">haml</span> <span class="ss">:index</span><span class="p">,</span> <span class="ss">:layout</span> <span class="o">=&gt;</span> <span class="o">!</span><span class="n">request</span><span class="nf">.xhr?</span>
<span class="k">end</span>
</pre><pre class="highlight text">  , 
</pre>
<p><code>Tilt.register</code>. ,      <code>tt</code> 
 Textile:</p>
<pre class="highlight ruby"><span class="no">Tilt</span><span class="nf">.register</span> <span class="ss">:tt</span><span class="p">,</span> <span class="no">Tilt</span><span class="o">[</span><span class="ss">:textile</span><span class="o">]</span>
</pre><pre class="highlight text"> Tilt,    , 
</pre>
<p>:</p>
<pre class="highlight ruby"><span class="no">Tilt</span><span class="nf">.register</span> <span class="ss">:myat</span><span class="p">,</span> <span class="no">MyAwesomeTemplateEngine</span>

<span class="n">helpers</span> <span class="k">do</span>
  <span class="k">def</span> <span class="nf">myat</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span> <span class="n">render</span><span class="p">(</span><span class="ss">:myat</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span> <span class="k">end</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">myat</span> <span class="ss">:index</span>
<span class="k">end</span>
</pre>
<p><code>./views/index.myat</code>.     Tilt, 
https://github.com/rtomayko/tilt</p>

<p><code>before</code>-        ,<br>
,     ,     . 
,   ,     :</p>
<pre class="highlight ruby"><span class="n">before</span> <span class="k">do</span>
  <span class="vi">@note</span> <span class="o">=</span> <span class="s1">'Hi!'</span>
  <span class="n">request</span><span class="nf">.path_info</span> <span class="o">=</span> <span class="s1">'/foo/bar/baz'</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/foo/*'</span> <span class="k">do</span>
  <span class="vi">@note</span> <span class="c1">#=&gt; 'Hi!'</span>
  <span class="n">params</span><span class="o">[</span><span class="ss">:splat</span><span class="o">]</span> <span class="c1">#=&gt; 'bar/baz'</span>
<span class="k">end</span>
</pre>
<p><code>after</code>-<br>
    ,     . 
,   <code>before</code>-  ,<br>
<code>after</code>-:</p>
<pre class="highlight ruby"><span class="n">after</span> <span class="k">do</span>
  <span class="nb">puts</span> <span class="n">response</span><span class="nf">.status</span>
<span class="k">end</span>
</pre>
<p>:     <code>body</code>,<br>
,        <code>after</code>-,<br>
  .</p>
<pre class="highlight text">URL   ,  
 :
</pre><pre class="highlight ruby"><span class="n">before</span> <span class="s1">'/protected/*'</span> <span class="k">do</span>
  <span class="n">authenticate!</span>
<span class="k">end</span>

<span class="n">after</span> <span class="s1">'/create/:slug'</span> <span class="k">do</span> <span class="o">|</span><span class="n">slug</span><span class="o">|</span>
  <span class="n">session</span><span class="o">[</span><span class="ss">:last_slug</span><span class="o">]</span> <span class="o">=</span> <span class="n">slug</span>
<span class="k">end</span>
</pre>
<p>,    :</p>
<pre class="highlight ruby"><span class="n">before</span> <span class="ss">:agent</span> <span class="o">=&gt;</span> <span class="sr">/Songbird/</span> <span class="k">do</span>
  <span class="c1"># ...</span>
<span class="k">end</span>

<span class="n">after</span> <span class="s1">'/blog/*'</span><span class="p">,</span> <span class="ss">:host_name</span> <span class="o">=&gt;</span> <span class="s1">'example.com'</span> <span class="k">do</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</pre>
<a name='-'></a>
<h2>-</h2>

<p><code>helpers</code>,   -,<br>
        :</p>
<pre class="highlight ruby"><span class="n">helpers</span> <span class="k">do</span>
  <span class="k">def</span> <span class="nf">bar</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
    <span class="s2">&quot;</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">bar&quot;</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/:name'</span> <span class="k">do</span>
  <span class="n">bar</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:name</span><span class="o">]</span><span class="p">)</span>
<span class="k">end</span>
</pre>
<ul>
<li>     :</li>
</ul>
<pre class="highlight ruby"><span class="k">module</span> <span class="nn">FooUtils</span>
  <span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">foo&quot;</span> <span class="k">end</span>
<span class="k">end</span>

<span class="k">module</span> <span class="nn">BarUtils</span>
  <span class="k">def</span> <span class="nf">bar</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">bar&quot;</span> <span class="k">end</span>
<span class="k">end</span>

<span class="n">helpers</span> <span class="no">FooUtils</span><span class="p">,</span> <span class="no">BarUtils</span>
</pre><pre class="highlight text">  .
</pre>
<p>,     .<br>
,           :</p>
<pre class="highlight ruby"><span class="n">enable</span> <span class="ss">:sessions</span>

<span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="s2">&quot;value = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">session</span><span class="o">[</span><span class="ss">:value</span><span class="o">]</span><span class="nf">.inspect</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/:value'</span> <span class="k">do</span>
  <span class="n">session</span><span class="o">[</span><span class="ss">:value</span><span class="o">]</span> <span class="o">=</span> <span class="n">params</span><span class="o">[</span><span class="ss">:value</span><span class="o">]</span>
<span class="k">end</span>
</pre>
<p>,    <code>enable :sessions</code><br>
 (cookies).      ,    (,
      ).<br>
   Rack &quot;&quot; (middleware), 
 .   * *  <code>enable :sessions</code>,<br>
    ,     &quot;&quot;:</p>
<pre class="highlight ruby"><span class="n">use</span> <span class="no">Rack</span><span class="o">::</span><span class="no">Session</span><span class="o">::</span><span class="no">Pool</span><span class="p">,</span> <span class="ss">:expire_after</span> <span class="o">=&gt;</span> <span class="mi">2592000</span>

<span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="s2">&quot;value = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">session</span><span class="o">[</span><span class="ss">:value</span><span class="o">]</span><span class="nf">.inspect</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/:value'</span> <span class="k">do</span>
  <span class="n">session</span><span class="o">[</span><span class="ss">:value</span><span class="o">]</span> <span class="o">=</span> <span class="n">params</span><span class="o">[</span><span class="ss">:value</span><span class="o">]</span>
<span class="k">end</span>
</pre>
<p>.    Sinatra.   ,<br>
     , , ,<br>
 ,<br>
:</p>
<pre class="highlight ruby"><span class="n">set</span> <span class="ss">:session_secret</span><span class="p">,</span> <span class="s1">'super secret'</span>
</pre><pre class="highlight text">  ,    ,  
</pre>
<p><code>sessions</code>:</p>
<pre class="highlight ruby"><span class="n">set</span> <span class="ss">:sessions</span><span class="p">,</span> <span class="ss">:domain</span> <span class="o">=&gt;</span> <span class="s1">'foo.com'</span>
</pre><pre class="highlight text">    ,
</pre>
<p>:</p>
<pre class="highlight ruby"><span class="n">halt</span>
</pre><pre class="highlight text"> :
</pre><pre class="highlight ruby"><span class="n">halt</span> <span class="mi">410</span>
</pre>
<p>:</p>
<pre class="highlight ruby"><span class="n">halt</span> <span class="s1">'this will be the body'</span>
</pre>
<p>,  :</p>
<pre class="highlight ruby"><span class="n">halt</span> <span class="mi">401</span><span class="p">,</span> <span class="s1">'go away!'</span>
</pre>
<p>:</p>
<pre class="highlight ruby"><span class="n">halt</span> <span class="mi">402</span><span class="p">,</span> <span class="p">{</span><span class="s1">'Content-Type'</span> <span class="o">=&gt;</span> <span class="s1">'text/plain'</span><span class="p">},</span> <span class="s1">'revenge'</span>
</pre>
<p>, ,     <code>halt</code>:</p>
<pre class="highlight ruby"><span class="n">halt</span> <span class="n">erb</span><span class="p">(</span><span class="ss">:error</span><span class="p">)</span>
</pre><pre class="highlight text">   ,
</pre>
<p><code>pass</code>:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/guess/:who'</span> <span class="k">do</span>
  <span class="n">pass</span> <span class="k">unless</span> <span class="n">params</span><span class="o">[</span><span class="ss">:who</span><span class="o">]</span> <span class="o">==</span> <span class="s1">'Frank'</span>
  <span class="s1">'You got me!'</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/guess/*'</span> <span class="k">do</span>
  <span class="s1">'You missed!'</span>
<span class="k">end</span>
</pre><pre class="highlight text">,     
</pre>
<p>.     ,<br>
  404.</p>

<p><code>pass</code>  , ,<br>
  .      <code>call</code>:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/foo'</span> <span class="k">do</span>
  <span class="n">status</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">body</span> <span class="o">=</span> <span class="n">call</span> <span class="n">env</span><span class="nf">.merge</span><span class="p">(</span><span class="s2">&quot;PATH_INFO&quot;</span> <span class="o">=&gt;</span> <span class="s1">'/bar'</span><span class="p">)</span>
  <span class="o">[</span><span class="n">status</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">body</span><span class="nf">.map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:upcase</span><span class="p">)</span><span class="o">]</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/bar'</span> <span class="k">do</span>
  <span class="s2">&quot;bar&quot;</span>
<span class="k">end</span>
</pre>
<p>,<br>
,  <code>&quot;bar&quot;</code>  -,<br>
<code>/foo</code>,   <code>/bar</code>.</p>

<p>,         ,<br>
  ,  <code>call!</code>  <code>call</code>.</p>
<pre class="highlight text"> `call`,   Rack.
</pre>
<a name=','></a>
<h3>,</h3>
<pre class="highlight text">  HTTP    
</pre>
<p>.   ,<br>
 , ,<br>
 .       - <code>body</code>.
    <code>body</code>,<br>
,      .</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/foo'</span> <span class="k">do</span>
  <span class="n">body</span> <span class="s2">&quot;bar&quot;</span>
<span class="k">end</span>

<span class="n">after</span> <span class="k">do</span>
  <span class="nb">puts</span> <span class="n">body</span>
<span class="k">end</span>
</pre><pre class="highlight text">  `body`,    
</pre>
<p>Rack (<br>
 , . &quot; &quot;).</p>
<pre class="highlight text">    :
</pre><pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/foo'</span> <span class="k">do</span>
  <span class="n">status</span> <span class="mi">418</span>
  <span class="n">headers</span> <span class="p">\</span>
    <span class="s2">&quot;Allow&quot;</span>   <span class="o">=&gt;</span> <span class="s2">&quot;BREW, POST, GET, PROPFIND, WHEN&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Refresh&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Refresh: 20; http://www.ietf.org/rfc/rfc2324.txt&quot;</span>
  <span class="n">body</span> <span class="s2">&quot;I'm a tea pot!&quot;</span>
<span class="k">end</span>
</pre>
<p><code>body</code>,  <code>headers</code>  <code>status</code>,   ,
   .</p>

<p>.<br>
    ,     .<br>
  <code>stream</code>    &quot;&quot;.</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">stream</span> <span class="k">do</span> <span class="o">|</span><span class="n">out</span><span class="o">|</span>
    <span class="n">out</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;It's gonna be legen -</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="nb">sleep</span> <span class="mi">0</span><span class="o">.</span><span class="mi">5</span>
    <span class="n">out</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot; (wait for it) </span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="nb">sleep</span> <span class="mi">1</span>
    <span class="n">out</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;- dary!</span><span class="se">\n</span><span class="s2">&quot;</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre><pre class="highlight text"> API,
</pre>
<p><a href="http://dev.w3.org/html5/eventsource/">Server Sent Events</a>,
     <a href="http://en.wikipedia.org/wiki/WebSocket">WebSockets</a>.
         ,</p>

<ul>
<li>     .</li>
</ul>

<p>,   ,<br>
 ,      -.
 , , WEBRick,      .
    ,<br>
   ,  ,   <code>stream</code>, . 
     Shotgun.</p>
<pre class="highlight text"> `keep_open`,     
</pre>
<p><code>close</code>   ,<br>
.      , ,  Thin 
Rainbows.        :</p>
<pre class="highlight ruby"><span class="c1"># long polling</span>

<span class="n">set</span> <span class="ss">:server</span><span class="p">,</span> <span class="ss">:thin</span>
<span class="n">connections</span> <span class="o">=</span> <span class="o">[]</span>

<span class="n">get</span> <span class="s1">'/subscribe'</span> <span class="k">do</span>
  <span class="c1">#  </span>
  <span class="n">stream</span><span class="p">(</span><span class="ss">:keep_open</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">out</span><span class="o">|</span> <span class="n">connections</span> <span class="o">&lt;&lt;</span> <span class="n">out</span> <span class="p">}</span>

  <span class="c1">#  &quot; &quot;</span>
  <span class="n">connections</span><span class="nf">.reject!</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:closed?</span><span class="p">)</span>

  <span class="c1"># </span>
  <span class="s2">&quot;subscribed&quot;</span>
<span class="k">end</span>

<span class="n">post</span> <span class="s1">'/message'</span> <span class="k">do</span>
  <span class="n">connections</span><span class="nf">.each</span> <span class="k">do</span> <span class="o">|</span><span class="n">out</span><span class="o">|</span>
    <span class="c1">#     </span>
    <span class="n">out</span> <span class="o">&lt;&lt;</span> <span class="n">params</span><span class="o">[</span><span class="ss">:message</span><span class="o">]</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

    <span class="c1">#     </span>
    <span class="n">out</span><span class="nf">.close</span>
  <span class="k">end</span>

  <span class="c1"># </span>
  <span class="s2">&quot;message received&quot;</span>
<span class="k">end</span>
</pre><pre class="highlight text"> `logger`    
</pre>
<p><code>Logger</code>:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">logger</span><span class="nf">.info</span> <span class="s2">&quot;loading data&quot;</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</pre><pre class="highlight text">    Rack. 
</pre>
<p>,      (dummy) ,<br>
       .</p>

<p>,<br>
<code>Sinatra::Application</code>,       <code>Sinatra::Base</code>, 
, ,    :</p>
<pre class="highlight ruby"><span class="k">class</span> <span class="nc">MyApp</span> <span class="o">&lt;</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">configure</span> <span class="ss">:production</span><span class="p">,</span> <span class="ss">:development</span> <span class="k">do</span>
    <span class="n">enable</span> <span class="ss">:logging</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre><pre class="highlight text"> &quot;&quot;,  
</pre>
<p><code>logging</code>  <code>nil</code>.   ,  ,<br>
<code>logger</code>  <code>nil</code>.    ,<br>
. Sinatra   ,    <code>env[&#39;rack.logger&#39;]</code>.</p>

<a name='Mime-'></a>
<h3>Mime-</h3>

<p><code>send_file</code>   ,<br>
mime-,  Sinatra    .  <code>mime_type</code>
     :</p>
<pre class="highlight ruby"><span class="n">configure</span> <span class="k">do</span>
  <span class="n">mime_type</span> <span class="ss">:foo</span><span class="p">,</span> <span class="s1">'text/foo'</span>
<span class="k">end</span>
</pre><pre class="highlight text">  `content_type` -:
</pre><pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">content_type</span> <span class="ss">:foo</span>
  <span class="s2">&quot;foo foo foo&quot;</span>
<span class="k">end</span>
</pre>
<a name='URL'></a>
<h3>URL</h3>

<p>URL,     <code>url</code>, ,  Haml:</p>
<pre class="highlight ruby"><span class="o">%</span><span class="n">a</span><span class="p">{</span><span class="ss">:href</span> <span class="o">=&gt;</span> <span class="n">url</span><span class="p">(</span><span class="s1">'/foo'</span><span class="p">)}</span> <span class="n">foo</span>
</pre><pre class="highlight text">   Rack,  
</pre>
<p>.</p>

<p><code>url</code>    <code>to</code> (  ).</p>

<a name='()'></a>
<h3>()</h3>
<pre class="highlight text">    `redirect`:
</pre><pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/foo'</span> <span class="k">do</span>
  <span class="n">redirect</span> <span class="n">to</span><span class="p">(</span><span class="s1">'/bar'</span><span class="p">)</span>
<span class="k">end</span>
</pre>
<p><code>halt</code>:</p>
<pre class="highlight ruby"><span class="n">redirect</span> <span class="n">to</span><span class="p">(</span><span class="s1">'/bar'</span><span class="p">),</span> <span class="mi">303</span>
<span class="n">redirect</span> <span class="s1">'http://google.com'</span><span class="p">,</span> <span class="s1">'wrong place, buddy'</span>
</pre><pre class="highlight text"> ,  ,   
</pre>
<p>,   <code>redirect back</code>:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/foo'</span> <span class="k">do</span>
  <span class="s2">&quot;&lt;a href='/bar'&gt;do something&lt;/a&gt;&quot;</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/bar'</span> <span class="k">do</span>
  <span class="n">do_something</span>
  <span class="n">redirect</span> <span class="n">back</span>
<span class="k">end</span>
</pre>
<ul>
<li>   ,<br>
:</li>
</ul>
<pre class="highlight ruby"><span class="n">redirect</span> <span class="n">to</span><span class="p">(</span><span class="s1">'/bar?sum=42'</span><span class="p">)</span>
</pre>
<p>:</p>
<pre class="highlight ruby"><span class="n">enable</span> <span class="ss">:sessions</span>

<span class="n">get</span> <span class="s1">'/foo'</span> <span class="k">do</span>
  <span class="n">session</span><span class="o">[</span><span class="ss">:secret</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'foo'</span>
  <span class="n">redirect</span> <span class="n">to</span><span class="p">(</span><span class="s1">'/bar'</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/bar'</span> <span class="k">do</span>
  <span class="n">session</span><span class="o">[</span><span class="ss">:secret</span><span class="o">]</span>
<span class="k">end</span>
</pre><pre class="highlight text">  HTTP .

 Cache-Control  :
</pre><pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">cache_control</span> <span class="ss">:public</span>
  <span class="s2">&quot;cache it!&quot;</span>
<span class="k">end</span>
</pre>
<p>:    <code>before</code>-:</p>
<pre class="highlight ruby"><span class="n">before</span> <span class="k">do</span>
  <span class="n">cache_control</span> <span class="ss">:public</span><span class="p">,</span> <span class="ss">:must_revalidate</span><span class="p">,</span> <span class="ss">:max_age</span> <span class="o">=&gt;</span> <span class="mi">60</span>
<span class="k">end</span>
</pre><pre class="highlight text">`expires`    , 
</pre>
<p><code>Cache-Control</code>   :</p>
<pre class="highlight ruby"><span class="n">before</span> <span class="k">do</span>
  <span class="n">expires</span> <span class="mi">500</span><span class="p">,</span> <span class="ss">:public</span><span class="p">,</span> <span class="ss">:must_revalidate</span>
<span class="k">end</span>
</pre><pre class="highlight text">,    
</pre>
<p><code>etag</code>  <code>last_modified</code>.   </p>

<ul>
<li>**   ,<br>
,        :</li>
</ul>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/article/:id'</span> <span class="k">do</span>
  <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="nf">.find</span> <span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span>
  <span class="n">last_modified</span> <span class="vi">@article</span><span class="nf">.updated_at</span>
  <span class="n">etag</span> <span class="vi">@article</span><span class="nf">.sha1</span>
  <span class="n">erb</span> <span class="ss">:article</span>
<span class="k">end</span>
</pre>
<p><a href="http://en.wikipedia.org/wiki/HTTP_ETag#Strong_and_weak_validation">weak ETag</a>:</p>
<pre class="highlight ruby"><span class="n">etag</span> <span class="vi">@article</span><span class="nf">.sha1</span><span class="p">,</span> <span class="ss">:weak</span>
</pre>
<ul>
<li>     ,<br>
.<br>
,  <a href="https://github.com/rtomayko/rack-cache">rack-cache</a>:</li>
</ul>
<pre class="highlight ruby"><span class="nb">require</span> <span class="s1">'rack/cache'</span>
<span class="nb">require</span> <span class="s1">'sinatra'</span>

<span class="n">use</span> <span class="no">Rack</span><span class="o">::</span><span class="no">Cache</span>

<span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">cache_control</span> <span class="ss">:public</span><span class="p">,</span> <span class="ss">:max_age</span> <span class="o">=&gt;</span> <span class="mi">36000</span>
  <span class="nb">sleep</span> <span class="mi">5</span>
  <span class="s2">&quot;hello&quot;</span>
<span class="k">end</span>
</pre>
<p><code>:static_cache_control</code> (. ),<br>
<code>Cache-Control</code>   .</p>

<p>RFC 2616      -, 
 If-Match  If-None-Match   <code>*</code>,<br>
,     . Sinatra , 
,       (GET)   (PUT)
,  ,    (  , ,
  POST)  .<br>
 <code>:new_resource</code>:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/create'</span> <span class="k">do</span>
  <span class="n">etag</span> <span class="s1">''</span><span class="p">,</span> <span class="ss">:new_resource</span> <span class="o">=&gt;</span> <span class="kp">true</span>
  <span class="no">Article</span><span class="nf">.create</span>
  <span class="n">erb</span> <span class="ss">:new_article</span>
<span class="k">end</span>
</pre><pre class="highlight text">weak ETag,   `:kind`:
</pre><pre class="highlight ruby"><span class="n">etag</span> <span class="s1">''</span><span class="p">,</span> <span class="ss">:new_resource</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:kind</span> <span class="o">=&gt;</span> <span class="ss">:weak</span>
</pre><pre class="highlight text">    `send_file`:
</pre><pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">send_file</span> <span class="s1">'foo.png'</span>
<span class="k">end</span>
</pre><pre class="highlight text">:
</pre><pre class="highlight ruby"><span class="n">send_file</span> <span class="s1">'foo.png'</span><span class="p">,</span> <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="ss">:jpg</span>
</pre>
<p>:</p>

<dl>
  <dt>filename</dt>
  <dd> ,  :   .</dd>

  <dt>last_modified</dt>
  <dd>   Last-Modified,  : mtime (
      ) .</dd>

  <dt>type</dt>
  <dd> ,  :    .</dd>

  <dt>disposition</dt>
  <dd>   Content-Disposition,  : <tt>nil</tt>
      ( ), <tt>:attachment</tt>  <tt>:inline</tt>.</dd>

  <dt>length</dt>
  <dd>   Content-Length,  :  .</dd>

  <dt>status</dt>
  <dd> . ,        
        .</dd>
</dl>
<pre class="highlight text"> Rack    ,
</pre>
<p>,         Ruby
.  <code>send_file</code><br>
 (range)    Sinatra.</p>
<pre class="highlight text">    ( ,
</pre>
<p>,  )   <code>request</code> :</p>
<pre class="highlight ruby"><span class="c1">#    http://example.com/example</span>
<span class="n">get</span> <span class="s1">'/foo'</span> <span class="k">do</span>
  <span class="n">t</span> <span class="o">=</span> <span class="sx">%w[text/css text/html application/javascript]</span>
  <span class="n">request</span><span class="nf">.accept</span>              <span class="c1"># ['text/html', '*/*']</span>
  <span class="n">request</span><span class="nf">.accept?</span> <span class="s1">'text/xml'</span>  <span class="c1"># true</span>
  <span class="n">request</span><span class="nf">.preferred_type</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>   <span class="c1"># 'text/html'</span>
  <span class="n">request</span><span class="nf">.body</span>                <span class="c1">#  ,   (. )</span>
  <span class="n">request</span><span class="nf">.scheme</span>              <span class="c1"># &quot;http&quot;</span>
  <span class="n">request</span><span class="nf">.script_name</span>         <span class="c1"># &quot;/example&quot;</span>
  <span class="n">request</span><span class="nf">.path_info</span>           <span class="c1"># &quot;/foo&quot;</span>
  <span class="n">request</span><span class="nf">.port</span>                <span class="c1"># 80</span>
  <span class="n">request</span><span class="nf">.request_method</span>      <span class="c1"># &quot;GET&quot;</span>
  <span class="n">request</span><span class="nf">.query_string</span>        <span class="c1"># &quot;&quot;</span>
  <span class="n">request</span><span class="nf">.content_length</span>      <span class="c1">#   </span>
  <span class="n">request</span><span class="nf">.media_type</span>          <span class="c1">#   </span>
  <span class="n">request</span><span class="nf">.host</span>                <span class="c1"># &quot;example.com&quot;</span>
  <span class="n">request</span><span class="nf">.get?</span>                <span class="c1"># true (     HTTP)</span>
  <span class="n">request</span><span class="nf">.form_data?</span>          <span class="c1"># false</span>
  <span class="n">request</span><span class="o">[</span><span class="s2">&quot;some_param&quot;</span><span class="o">]</span>       <span class="c1">#   some_param.    params</span>
  <span class="n">request</span><span class="nf">.referrer</span>            <span class="c1">#     '/'</span>
  <span class="n">request</span><span class="nf">.user_agent</span>          <span class="c1"># user agent (  :agent )</span>
  <span class="n">request</span><span class="nf">.cookies</span>             <span class="c1"># ,  cookies </span>
  <span class="n">request</span><span class="nf">.xhr?</span>                <span class="c1">#    ajax ?</span>
  <span class="n">request</span><span class="nf">.url</span>                 <span class="c1"># &quot;http://example.com/example/foo&quot;</span>
  <span class="n">request</span><span class="nf">.path</span>                <span class="c1"># &quot;/example/foo&quot;</span>
  <span class="n">request</span><span class="nf">.ip</span>                  <span class="c1"># IP- </span>
  <span class="n">request</span><span class="nf">.secure?</span>             <span class="c1"># false (true,     SSL)</span>
  <span class="n">request</span><span class="nf">.forwarded?</span>          <span class="c1"># true (     )</span>
  <span class="n">request</span><span class="nf">.env</span>                 <span class="c1"># &quot;&quot; env ,  Rack</span>
<span class="k">end</span>
</pre>
<p>,   <code>script_name</code>  <code>path_info</code>,<br>
:</p>
<pre class="highlight ruby"><span class="n">before</span> <span class="p">{</span> <span class="n">request</span><span class="nf">.path_info</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span> <span class="p">}</span>

<span class="n">get</span> <span class="s2">&quot;/&quot;</span> <span class="k">do</span>
  <span class="s2">&quot;all requests end up here&quot;</span>
<span class="k">end</span>
</pre>
<p><code>request.body</code>  IO  StringIO :</p>
<pre class="highlight ruby"><span class="n">post</span> <span class="s2">&quot;/api&quot;</span> <span class="k">do</span>
  <span class="n">request</span><span class="nf">.body.rewind</span>  <span class="c1">#  ,  -    </span>
  <span class="n">data</span> <span class="o">=</span> <span class="no">JSON</span><span class="nf">.parse</span> <span class="n">request</span><span class="nf">.body.read</span>
  <span class="s2">&quot;Hello </span><span class="si">#{</span><span class="n">data</span><span class="o">[</span><span class="s1">'name'</span><span class="o">]</span><span class="si">}</span><span class="s2">!&quot;</span>
<span class="k">end</span>
</pre><pre class="highlight text">`attachment`,   ,  
 ,   :
</pre><pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">attachment</span>
  <span class="s2">&quot;store it!&quot;</span>
<span class="k">end</span>
</pre><pre class="highlight text"> :
</pre><pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">attachment</span> <span class="s2">&quot;info.txt&quot;</span>
  <span class="s2">&quot;store it!&quot;</span>
<span class="k">end</span>
</pre>
<p>Sinatra  - <code>time_for</code>,<br>
  Time.     <code>DateTime</code>, <code>Date</code> 
 :</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">pass</span> <span class="k">if</span> <span class="no">Time</span><span class="nf">.now</span> <span class="o">&gt;</span> <span class="n">time_for</span><span class="p">(</span><span class="s1">'Dec 23, 2012'</span><span class="p">)</span>
  <span class="s2">&quot;still time&quot;</span>
<span class="k">end</span>
</pre><pre class="highlight text">Sinatra  `expires`, `last_modified` 
</pre>
<p>.        ,
 <code>time_for</code>   :</p>
<pre class="highlight ruby"><span class="n">helpers</span> <span class="k">do</span>
  <span class="k">def</span> <span class="nf">time_for</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">case</span> <span class="n">value</span>
    <span class="k">when</span> <span class="ss">:yesterday</span> <span class="k">then</span> <span class="no">Time</span><span class="nf">.now</span> <span class="o">-</span> <span class="mi">24</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span>
    <span class="k">when</span> <span class="ss">:tomorrow</span>  <span class="k">then</span> <span class="no">Time</span><span class="nf">.now</span> <span class="o">+</span> <span class="mi">24</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span>
    <span class="k">else</span> <span class="k">super</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">last_modified</span> <span class="ss">:yesterday</span>
  <span class="n">expires</span> <span class="ss">:tomorrow</span>
  <span class="s2">&quot;hello&quot;</span>
<span class="k">end</span>
</pre>
<p><code>find_template</code>:</p>
<pre class="highlight ruby"><span class="n">find_template</span> <span class="n">settings</span><span class="nf">.views</span><span class="p">,</span> <span class="s1">'foo'</span><span class="p">,</span> <span class="no">Tilt</span><span class="o">[</span><span class="ss">:haml</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">file</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="s2">&quot;could be </span><span class="si">#{</span><span class="n">file</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="k">end</span>
</pre><pre class="highlight text">.    ,   
</pre>
<p>,<br>
. ,   ,<br>
  :</p>
<pre class="highlight ruby"><span class="n">set</span> <span class="ss">:views</span><span class="p">,</span> <span class="o">[</span><span class="s1">'views'</span><span class="p">,</span> <span class="s1">'templates'</span><span class="o">]</span>

<span class="n">helpers</span> <span class="k">do</span>
  <span class="k">def</span> <span class="nf">find_template</span><span class="p">(</span><span class="n">views</span><span class="p">,</span> <span class="nb">name</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
    <span class="nb">Array</span><span class="p">(</span><span class="n">views</span><span class="p">)</span><span class="nf">.each</span> <span class="p">{</span> <span class="o">|</span><span class="n">v</span><span class="o">|</span> <span class="k">super</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">name</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">)</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre>
<p>,<br>
:</p>
<pre class="highlight ruby"><span class="n">set</span> <span class="ss">:views</span><span class="p">,</span> <span class="ss">:sass</span> <span class="o">=&gt;</span> <span class="s1">'views/sass'</span><span class="p">,</span> <span class="ss">:haml</span> <span class="o">=&gt;</span> <span class="s1">'templates'</span><span class="p">,</span> <span class="ss">:default</span> <span class="o">=&gt;</span> <span class="s1">'views'</span>

<span class="n">helpers</span> <span class="k">do</span>
  <span class="k">def</span> <span class="nf">find_template</span><span class="p">(</span><span class="n">views</span><span class="p">,</span> <span class="nb">name</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">folder</span> <span class="o">=</span> <span class="n">views</span><span class="nf">.detect</span> <span class="p">{</span> <span class="o">|</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="o">|</span> <span class="n">engine</span> <span class="o">==</span> <span class="no">Tilt</span><span class="o">[</span><span class="n">k</span><span class="o">]</span> <span class="p">}</span>
    <span class="n">folder</span> <span class="o">||=</span> <span class="n">views</span><span class="o">[</span><span class="ss">:default</span><span class="o">]</span>
    <span class="k">super</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="nb">name</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre><pre class="highlight text">        !
</pre>
<p>,  <code>find_template</code>  ,      ,
       .<br>
,   ,  <code>render</code>  <code>break</code>,<br>
  .      ,
       (<code>set :environment,
:development</code>).      ,    -
&quot;&quot; .</p>
<pre class="highlight text">     , 
</pre>
<p>(environment):</p>
<pre class="highlight ruby"><span class="n">configure</span> <span class="k">do</span>
  <span class="c1">#   </span>
  <span class="n">set</span> <span class="ss">:option</span><span class="p">,</span> <span class="s1">'value'</span>

  <span class="c1">#   </span>
  <span class="n">set</span> <span class="ss">:a</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="ss">:b</span> <span class="o">=&gt;</span> <span class="mi">2</span>

  <span class="c1">#   ,   `set :option, true`</span>
  <span class="n">enable</span> <span class="ss">:option</span>

  <span class="c1">#   ,   `set :option, false`</span>
  <span class="n">disable</span> <span class="ss">:option</span>

  <span class="c1">#     &quot;&quot;   </span>
  <span class="n">set</span><span class="p">(</span><span class="ss">:css_dir</span><span class="p">)</span> <span class="p">{</span> <span class="no">File</span><span class="nf">.join</span><span class="p">(</span><span class="n">views</span><span class="p">,</span> <span class="s1">'css'</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>
</pre>
<p>,   (RACK_ENV ) <code>:production</code>:</p>
<pre class="highlight ruby"><span class="n">configure</span> <span class="ss">:production</span> <span class="k">do</span>
  <span class="nf">..</span><span class="o">.</span>
<span class="k">end</span>
</pre>
<p>,   <code>:production</code>  <code>:test</code>:</p>
<pre class="highlight ruby"><span class="n">configure</span> <span class="ss">:production</span><span class="p">,</span> <span class="ss">:test</span> <span class="k">do</span>
  <span class="nf">..</span><span class="o">.</span>
<span class="k">end</span>
</pre><pre class="highlight text">     `settings`:
</pre><pre class="highlight ruby"><span class="n">configure</span> <span class="k">do</span>
  <span class="n">set</span> <span class="ss">:foo</span><span class="p">,</span> <span class="s1">'bar'</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">settings</span><span class="nf">.foo?</span> <span class="c1"># =&gt; true</span>
  <span class="n">settings</span><span class="nf">.foo</span>  <span class="c1"># =&gt; 'bar'</span>
  <span class="nf">..</span><span class="o">.</span>
<span class="k">end</span>
</pre>
<p>Sinatra 
<a href="https://github.com/rkh/rack-protection#readme">Rack::Protection</a><br>
   .       ( 
   ):</p>
<pre class="highlight ruby"><span class="n">disable</span> <span class="ss">:protection</span>
</pre>
<ul>
<li> ,<br>
<code>protection</code>:</li>
</ul>
<pre class="highlight ruby"><span class="n">set</span> <span class="ss">:protection</span><span class="p">,</span> <span class="ss">:except</span> <span class="o">=&gt;</span> <span class="ss">:path_traversal</span>
</pre><pre class="highlight text">   :
</pre><pre class="highlight ruby"><span class="n">set</span> <span class="ss">:protection</span><span class="p">,</span> <span class="ss">:except</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:path_traversal</span><span class="p">,</span> <span class="ss">:session_hijacking</span><span class="o">]</span>
</pre>
<dl>
  <dt>absolute_redirects</dt>
  <dd>
     ,  Sinatra    
    ,      RFC 2616 (HTTP
    1.1),     .
  </dd>
  <dd>
      ,       ,
        .  ,  <tt>url</tt> 
        URL,     <tt>false</tt>
     .
  </dd>
  <dd>  .</dd>

  <dt>add_charsets</dt>
  <dd>
    mime-,    <tt>content_type</tt>   
      .       
      : <tt>settings.add_charsets &lt;&lt; "application/foobar"</tt>
  </dd>

  <dt>app_file</dt>
  <dd>
        ,    
     ,      ,
     .
  </dd>

  <dt>bind</dt>
  <dd>
     IP- ( : 0.0.0.0).  
     .
  </dd>

  <dt>default_encoding</dt>
  <dd>,   ( : <tt>"utf-8"</tt>).</dd>

  <dt>dump_errors</dt>
  <dd>   .</dd>

  <dt>environment</dt>
  <dd>
     ,  ,  <tt>ENV['RACK_ENV']</tt> 
    <tt>"development"</tt>,  <tt>ENV['RACK_ENV']</tt> .
  </dd>

  <dt>logging</dt>
  <dd> .</dd>

  <dt>lock</dt>
  <dd>
        ,   
            Ruby .
  </dd>
  <dd>
    ,     - (thread-safe).
      .</dd>

  <dt>method_override</dt>
  <dd>
     ""  <tt>_method</tt>,  
    PUT/DELETE   ,     .
  </dd>

  <dt>port</dt>
  <dd>
    ,     .
       .
  </dd>

  <dt>prefixed_redirects</dt>
  <dd>
        <tt>request.script_name</tt>  ,  
      .  , <tt>redirect '/foo'</tt>   
     <tt>redirect to('/foo')</tt>.   .
  </dd>

  <dt>protection</dt>
  <dd>     .   .</dd>

  <dt>public_dir</dt>
  <dd>  <tt>public_folder</tt>.</dd>

  <dt>public_folder</dt>
  <dd>
      ,     .
    ,      
    (.  <tt>static</tt> ).
  </dd>

  <dt>reload_templates</dt>
  <dd>
          .   
    .
  </dd>

  <dt>root</dt>
  <dd>    .</dd>

  <dt>raise_errors</dt>
  <dd>
      (  ).
          <tt>test</tt>.
  </dd>

  <dt>run</dt>
  <dd>
     , Sinatra    -. 
    ,   rackup   .
  </dd>

  <dt>running</dt>
  <dd>    ?    !</dd>

  <dt>server</dt>
  <dd>
       ,     
     .  : <tt>['thin', 'mongrel', 'webrick']</tt>, 
     .</dd>

  <dt>sessions</dt>
  <dd>
         (cookie)   <tt>Rack::Session::Cookie</tt>.
      " " .
  </dd>

  <dt>show_exceptions</dt>
  <dd>
     /  (stack trace)  .  
        <tt>development</tt>.
  </dd>
  <dd>
       
    <tt>:after_handler</tt>       ,
         .
  </dd>

  <dt>static</dt>
  <dd>  Sinatra    .</dd>
  <dd>,   - -   .</dd>
  <dd>    .</dd>
  <dd>         .</dd>

  <dt>static_cache_control</dt>
  <dd>
     Sinatra   ,   , 
       <tt>Cache-Control</tt>.   
    - <tt>cache_control</tt>.   .
  </dd>
  <dd>
     ,     :
    <tt>set :static_cache_control, [:public, :max_age => 300]</tt>
  </dd>

  <dt>threaded</dt>
  <dd>
     ,  Thin   <tt>EventMachine.defer</tt> 
     .
  </dd>

  <dt>views</dt>
  <dd>    .</dd>
</dl>

<a name=','></a>
<h2>,</h2>

<p>3  , : <code>&quot;development&quot;</code>, <code>&quot;production&quot;</code> 
<code>&quot;test&quot;</code>.        <code>RACK_ENV</code>.
    <code>&quot;development&quot;</code>.<br>
  .<br>
<code>not_found</code>  <code>error</code>,      .<br>
<code>&quot;production&quot;</code>  <code>&quot;test&quot;</code>    .</p>
<pre class="highlight text">    `-e`
</pre><pre class="highlight text">ruby my_app.rb -e [ENVIRONMENT]
</pre><pre class="highlight text"> `development?`, `test?` 
</pre>
<p>+production?,    .</p>
<pre class="highlight text">  ,   , 
</pre>
<p><code>before</code>-,   ,     <code>haml</code>, <code>erb</code>,
<code>halt</code>  ..   .</p>

<a name='Not%20Found'></a>
<h3>Not Found</h3>

<p><code>Sinatra::NotFound</code>,     404,
   <code>not_found</code> :</p>
<pre class="highlight ruby"><span class="n">not_found</span> <span class="k">do</span>
  <span class="s1">'This is nowhere to be found.'</span>
<span class="k">end</span>
</pre>
<p><code>error</code>  ,<br>
,   . -<br>
<code>sinatra.error</code>  Rack:</p>
<pre class="highlight ruby"><span class="n">error</span> <span class="k">do</span>
  <span class="s1">'Sorry there was a nasty error - '</span> <span class="o">+</span> <span class="n">env</span><span class="o">[</span><span class="s1">'sinatra.error'</span><span class="o">]</span><span class="nf">.name</span>
<span class="k">end</span>
</pre>
<p>:</p>
<pre class="highlight ruby"><span class="n">error</span> <span class="no">MyCustomError</span> <span class="k">do</span>
  <span class="s1">'So what happened was...'</span> <span class="o">+</span> <span class="n">env</span><span class="o">[</span><span class="s1">'sinatra.error'</span><span class="o">]</span><span class="nf">.message</span>
<span class="k">end</span>
</pre>
<p>,   :</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="k">raise</span> <span class="no">MyCustomError</span><span class="p">,</span> <span class="s1">'something bad'</span>
<span class="k">end</span>
</pre>
<p>:</p>
<pre class="highlight text">So what happened was... something bad
</pre><pre class="highlight text">     HTTP:
</pre><pre class="highlight ruby"><span class="n">error</span> <span class="mi">403</span> <span class="k">do</span>
  <span class="s1">'Access forbidden'</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/secret'</span> <span class="k">do</span>
  <span class="mi">403</span>
<span class="k">end</span>
</pre>
<p>:</p>
<pre class="highlight ruby"><span class="n">error</span> <span class="mi">400</span><span class="nf">..</span><span class="mi">510</span> <span class="k">do</span>
  <span class="s1">'Boom'</span>
<span class="k">end</span>
</pre>
<p>Sinatra   <code>not_found</code>  <code>error</code> , 
     ( <code>:development</code>).</p>

<a name='Rack%20&quot;&quot;'></a>
<h2>Rack &quot;&quot;</h2>

<p>Sinatra  <a href="http://rack.rubyforge.org/">Rack</a>,  </p>

<ul>
<li><p>Ruby.<br>
Rack   &quot;&quot; (&quot;middleware&quot;) 
,  &quot;&quot;    , 
/  HTTP /<br>
.</p>

<p>Sinatra     &quot;&quot;    <code>use</code>:</p></li>
</ul>
<pre class="highlight ruby"><span class="nb">require</span> <span class="s1">'sinatra'</span>
<span class="nb">require</span> <span class="s1">'my_custom_middleware'</span>

<span class="n">use</span> <span class="no">Rack</span><span class="o">::</span><span class="no">Lint</span>
<span class="n">use</span> <span class="no">MyCustomMiddleware</span>

<span class="n">get</span> <span class="s1">'/hello'</span> <span class="k">do</span>
  <span class="s1">'Hello World'</span>
<span class="k">end</span>
</pre>
<p><code>use</code>  ,<br>
<a href="http://rack.rubyforge.org/doc/classes/Rack/Builder.html">Rack::Builder</a> DSL
(    rackup ). ,  <code>use</code><br>
 ,   :</p>
<pre class="highlight ruby"><span class="n">use</span> <span class="no">Rack</span><span class="o">::</span><span class="no">Auth</span><span class="o">::</span><span class="no">Basic</span> <span class="k">do</span> <span class="o">|</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="o">|</span>
  <span class="n">username</span> <span class="o">==</span> <span class="s1">'admin'</span> <span class="o">&amp;&amp;</span> <span class="n">password</span> <span class="o">==</span> <span class="s1">'secret'</span>
<span class="k">end</span>
</pre>
<p>Rack     &quot;&quot;  ,
,  URL, ,  . Sinatra
     ,<br>
,      (<code>use</code>)  .</p>

<p><a href="https://github.com/rack/rack/tree/master/lib/rack">rack</a>,
<a href="https://github.com/rack/rack-contrib#readme">rack-contrib</a>,
<a href="http://coderack.org/">CodeRack</a><br>
<a href="https://github.com/rack/rack/wiki/List-of-Middleware">Rack wiki</a>.</p>

<p>Sinatra       ,
,   Rack.
<a href="http://rdoc.info/github/brynary/rack-test/master/frames">Rack::Test</a>
:</p>
<pre class="highlight ruby"><span class="nb">require</span> <span class="s1">'my_sinatra_app'</span>
<span class="nb">require</span> <span class="s1">'test/unit'</span>
<span class="nb">require</span> <span class="s1">'rack/test'</span>

<span class="k">class</span> <span class="nc">MyAppTest</span> <span class="o">&lt;</span> <span class="no">Test</span><span class="o">::</span><span class="no">Unit</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="kp">include</span> <span class="no">Rack</span><span class="o">::</span><span class="no">Test</span><span class="o">::</span><span class="no">Methods</span>

  <span class="k">def</span> <span class="nf">app</span>
    <span class="no">Sinatra</span><span class="o">::</span><span class="no">Application</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">test_my_default</span>
    <span class="n">get</span> <span class="s1">'/'</span>
    <span class="n">assert_equal</span> <span class="s1">'Hello World!'</span><span class="p">,</span> <span class="n">last_response</span><span class="nf">.body</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">test_with_params</span>
    <span class="n">get</span> <span class="s1">'/meet'</span><span class="p">,</span> <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">'Frank'</span>
    <span class="n">assert_equal</span> <span class="s1">'Hello Frank!'</span><span class="p">,</span> <span class="n">last_response</span><span class="nf">.body</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">test_with_rack_env</span>
    <span class="n">get</span> <span class="s1">'/'</span><span class="p">,</span> <span class="p">{},</span> <span class="s1">'HTTP_USER_AGENT'</span> <span class="o">=&gt;</span> <span class="s1">'Songbird'</span>
    <span class="n">assert_equal</span> <span class="s2">&quot;You're using Songbird!&quot;</span><span class="p">,</span> <span class="n">last_response</span><span class="nf">.body</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre>
<a name='Sinatra::Base%20%20&quot;&quot;,'></a>
<h2>Sinatra::Base  &quot;&quot;,</h2>
<pre class="highlight text">  (  DSL 
</pre>
<p>,  )     .<br>
  ,    -
(  , <code>./public</code>  <code>./views</code> , ,
     ..).   ,<br>
    ,   Rack middleware
(&quot;&quot;), Rails metal,     ,
 Sinatra.      <code>Sinatra::Base</code>:</p>
<pre class="highlight ruby"><span class="nb">require</span> <span class="s1">'sinatra/base'</span>

<span class="k">class</span> <span class="nc">MyApp</span> <span class="o">&lt;</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">set</span> <span class="ss">:sessions</span><span class="p">,</span> <span class="kp">true</span>
  <span class="n">set</span> <span class="ss">:foo</span><span class="p">,</span> <span class="s1">'bar'</span>

  <span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
    <span class="s1">'Hello world!'</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre>
<p>,  <code>Sinatra::Base</code>   ,<br>
  DSL  .<br>
  <code>Sinatra::Base</code>     :</p>

<ul>
<li>   <code>sinatra/base</code>  <code>sinatra</code>,   ,
Sinatra,<br>
.</li>
<li>  ,  ,<br>
<code>Sinatra::Base</code>.</li>
</ul>

<p><code>Sinatra::Base</code>    .  ,<br>
,   . 
<a href="http://www.sinatrarb.com/configuration.html">  </a>
       .</p>

<p>,    ( )<br>
.      ,<br>
    .</p>
<pre class="highlight text">  ,    
Sinatra    Ruby.   
</pre>
<p>,    .<br>
    .</p>
<pre class="highlight text"> ,      
</pre>
<p>:</p>
<pre class="highlight text">app_file                       Sinatra::Base
run                 $0 == app_file          false
logging             true                    false
method_override     true                    false
inline_templates    true                    false
static              true                    false
</pre><pre class="highlight text">  :  
</pre>
<p><code>run!</code>:</p>
<pre class="highlight ruby"><span class="c1"># my_app.rb</span>
<span class="nb">require</span> <span class="s1">'sinatra/base'</span>

<span class="k">class</span> <span class="nc">MyApp</span> <span class="o">&lt;</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Base</span>
  <span class="c1"># ...    ...</span>

  <span class="c1">#  ,    </span>
  <span class="n">run!</span> <span class="k">if</span> <span class="n">app_file</span> <span class="o">==</span> <span class="vg">$0</span>
<span class="k">end</span>
</pre>
<p>:</p>
<pre class="highlight text">ruby my_app.rb
</pre><pre class="highlight text"> `config.ru`,  
</pre>
<p>Rack-  .</p>
<pre class="highlight ruby"><span class="c1"># config.ru</span>
<span class="nb">require</span> <span class="s1">'./my_app'</span>
<span class="n">run</span> <span class="no">MyApp</span>
</pre>
<p>:</p>
<pre class="highlight text">rackup -p 4567
</pre>
<a name='config.ru'></a>
<h3>config.ru</h3>

<p>:</p>
<pre class="highlight ruby"><span class="c1"># app.rb</span>
<span class="nb">require</span> <span class="s1">'sinatra'</span>

<span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="s1">'Hello world!'</span>
<span class="k">end</span>
</pre>
<p><code>config.ru</code>:</p>
<pre class="highlight ruby"><span class="nb">require</span> <span class="s1">'./app'</span>
<span class="n">run</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Application</span>
</pre>
<a name='config.ru?'></a>
<h3>config.ru?</h3>

<p>,   , ,<br>
<code>config.ru</code>:</p>

<ul>
<li>       Rack-
(Passenger, Unicorn, Heroku, ...);</li>
<li>      <code>Sinatra::Base</code>;</li>
<li>   Sinatra    &quot;&quot; Rack.</li>
</ul>

<p>**     <code>config.ru</code>  ,
      .<br>
  ,<br>
<code>config.ru</code>.**</p>

<a name='Sinatra%20%20%20&quot;&quot;'></a>
<h3>Sinatra   &quot;&quot;</h3>

<p>Sinatra   &quot;&quot; Rack,    Sinatra
       Rack endpoint<br>
&quot;&quot;.  endpoint ( )    Sinatra
,  ,   Rack (Rails/Ramaze/Camping/...):</p>
<pre class="highlight ruby"><span class="nb">require</span> <span class="s1">'sinatra/base'</span>

<span class="k">class</span> <span class="nc">LoginScreen</span> <span class="o">&lt;</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">enable</span> <span class="ss">:sessions</span>

  <span class="n">get</span><span class="p">(</span><span class="s1">'/login'</span><span class="p">)</span> <span class="p">{</span> <span class="n">haml</span> <span class="ss">:login</span> <span class="p">}</span>

  <span class="n">post</span><span class="p">(</span><span class="s1">'/login'</span><span class="p">)</span> <span class="k">do</span>
    <span class="k">if</span> <span class="n">params</span><span class="o">[</span><span class="ss">:name</span><span class="o">]</span> <span class="o">==</span> <span class="s1">'admin'</span> <span class="o">&amp;&amp;</span> <span class="n">params</span><span class="o">[</span><span class="ss">:password</span><span class="o">]</span> <span class="o">==</span> <span class="s1">'admin'</span>
      <span class="n">session</span><span class="o">[</span><span class="s1">'user_name'</span><span class="o">]</span> <span class="o">=</span> <span class="n">params</span><span class="o">[</span><span class="ss">:name</span><span class="o">]</span>
    <span class="k">else</span>
      <span class="n">redirect</span> <span class="s1">'/login'</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">MyApp</span> <span class="o">&lt;</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Base</span>
  <span class="c1"># &quot;&quot;    </span>
  <span class="n">use</span> <span class="no">LoginScreen</span>

  <span class="n">before</span> <span class="k">do</span>
    <span class="k">unless</span> <span class="n">session</span><span class="o">[</span><span class="s1">'user_name'</span><span class="o">]</span>
      <span class="n">halt</span> <span class="s2">&quot;Access denied, please &lt;a href='/login'&gt;login&lt;/a&gt;.&quot;</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)</span> <span class="p">{</span> <span class="s2">&quot;Hello </span><span class="si">#{</span><span class="n">session</span><span class="o">[</span><span class="s1">'user_name'</span><span class="o">]</span><span class="si">}</span><span class="s2">.&quot;</span> <span class="p">}</span>
<span class="k">end</span>
</pre>
<a name='&quot;%20&quot;'></a>
<h3>&quot; &quot;</h3>

<p>Sinatra  &quot; &quot; (,<br>
).     <code>Sinatra.new</code>:</p>
<pre class="highlight ruby"><span class="nb">require</span> <span class="s1">'sinatra/base'</span>
<span class="n">my_app</span> <span class="o">=</span> <span class="no">Sinatra</span><span class="nf">.new</span> <span class="p">{</span> <span class="n">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)</span> <span class="p">{</span> <span class="s2">&quot;hi&quot;</span> <span class="p">}</span> <span class="p">}</span>
<span class="n">my_app</span><span class="nf">.run!</span>
</pre><pre class="highlight text"> ,   
</pre>
<p>:</p>
<pre class="highlight ruby"><span class="c1"># config.ru</span>
<span class="nb">require</span> <span class="s1">'sinatra/base'</span>

<span class="n">controller</span> <span class="o">=</span> <span class="no">Sinatra</span><span class="nf">.new</span> <span class="k">do</span>
  <span class="n">enable</span> <span class="ss">:logging</span>
  <span class="n">helpers</span> <span class="no">MyHelpers</span>
<span class="k">end</span>

<span class="n">map</span><span class="p">(</span><span class="s1">'/a'</span><span class="p">)</span> <span class="k">do</span>
  <span class="n">run</span> <span class="no">Sinatra</span><span class="nf">.new</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span> <span class="p">{</span> <span class="n">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)</span> <span class="p">{</span> <span class="s1">'a'</span> <span class="p">}</span> <span class="p">}</span>
<span class="k">end</span>

<span class="n">map</span><span class="p">(</span><span class="s1">'/b'</span><span class="p">)</span> <span class="k">do</span>
  <span class="n">run</span> <span class="no">Sinatra</span><span class="nf">.new</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span> <span class="p">{</span> <span class="n">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)</span> <span class="p">{</span> <span class="s1">'b'</span> <span class="p">}</span> <span class="p">}</span>
<span class="k">end</span>
</pre><pre class="highlight text">  Sinatra   
</pre>
<p>Sinatra   .</p>

<p>,  Sinatra  &quot;&quot;  :</p>
<pre class="highlight ruby"><span class="nb">require</span> <span class="s1">'sinatra/base'</span>

<span class="n">use</span> <span class="no">Sinatra</span> <span class="k">do</span>
  <span class="n">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)</span> <span class="p">{</span> <span class="nf">..</span><span class="o">.</span> <span class="p">}</span>
<span class="k">end</span>

<span class="n">run</span> <span class="no">RailsProject</span><span class="o">::</span><span class="no">Application</span>
</pre><pre class="highlight text">  ,   
</pre>
<p>.</p>

<a name='/'></a>
<h3>/</h3>

<p>Sinatra    <code>Sinatra::Base</code>.<br>
 DSL   (<code>require &#39;sinatra&#39;</code>),<br>
<code>Sinatra::Application</code>,    ,    .
       ,  <code>get</code>  <code>before</code>, 
       <code>request</code>  <code>session</code>,<br>
       .</p>

<p>,    <code>set</code>,    :</p>
<pre class="highlight ruby"><span class="k">class</span> <span class="nc">MyApp</span> <span class="o">&lt;</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Base</span>
  <span class="c1">#     !</span>
  <span class="n">set</span> <span class="ss">:foo</span><span class="p">,</span> <span class="mi">42</span>
  <span class="n">foo</span> <span class="c1"># =&gt; 42</span>

  <span class="n">get</span> <span class="s1">'/foo'</span> <span class="k">do</span>
    <span class="c1">#       !</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre><pre class="highlight text">  :
</pre>
<ul>
<li>   ;</li>
<li>,  ;</li>
<li>,   <code>helpers</code>;</li>
<li>,     <code>set</code>;</li>
<li><p>,   <code>Sinatra.new</code>.</p>
<pre class="highlight text">( )
</pre>
<p>:</p></li>
<li><p>,    (<code>configure { |c| ... }</code>);</p></li>
<li><p><code>settings</code>    .</p></li>
</ul>

<a name='/'></a>
<h3>/</h3>
<pre class="highlight text">     ,
    .   
</pre>
<p><code>request</code>  <code>session</code> ,<br>
,   <code>erb</code>  <code>haml</code>.<br>
    ,  -
<code>settings</code>:</p>
<pre class="highlight ruby"><span class="k">class</span> <span class="nc">MyApp</span> <span class="o">&lt;</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Base</span>
  <span class="c1">#     !</span>
  <span class="n">get</span> <span class="s1">'/define_route/:name'</span> <span class="k">do</span>
    <span class="c1">#    '/define_route/:name'</span>
    <span class="vi">@value</span> <span class="o">=</span> <span class="mi">42</span>

    <span class="n">settings</span><span class="nf">.get</span><span class="p">(</span><span class="s2">&quot;/</span><span class="si">#{</span><span class="n">params</span><span class="o">[</span><span class="ss">:name</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">do</span>
      <span class="c1">#    &quot;/#{params[:name]}&quot;</span>
      <span class="vi">@value</span> <span class="c1"># =&gt; nil ( )</span>
    <span class="k">end</span>

    <span class="s2">&quot;Route defined!&quot;</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre><pre class="highlight text">  :
</pre>
<ul>
<li>get/head/post/put/delete/options ;</li>
<li>before/after ;</li>
<li>-;</li>
<li>/.</li>
</ul>

<p>. ,<br>
,        .  ,<br>
 ,  ,  /<br>
   ( ,     <code>self</code> ).<br>
   , 
<code>Sinatra::Delegator.delegate :method_name</code>.</p>
<pre class="highlight text"> :
</pre>
<ul>
<li>   ,    <code>require &#39;sinatra&#39;</code>;</li>
<li><p>,    <code>Sinatra::Delegator</code>.</p>

<p>: 
<a href="https://github.com/sinatra/sinatra/blob/ca06364/lib/sinatra/base.rb#L1609-1633"> Sinatra::Delegator</a>
<a href="https://github.com/sinatra/sinatra/blob/ca06364/lib/sinatra/main.rb#L28-30">  </a>.</p></li>
</ul>

<p>Sinatra     :</p>
<pre class="highlight text">ruby myapp.rb [-h] [-x] [-e ENVIRONMENT] [-p PORT] [-o HOST] [-s HANDLER]
</pre>
<p>:</p>
<pre class="highlight text">-h #  
-p #   (  4567)
-o #   (  0.0.0.0)
-e #  ,  (  development)
-s #  rack / (  thin)
-x #  - (  )
</pre>
<p>Ruby  :</p>

<dl>
  <dt>Ruby 1.8.7</dt>
  <dd>1.8.7  ,   ,      
     ,    1.9.2    JRuby 
    Rubinius.  1.8.7      Sinatra 2.0  Ruby
    2.0,      1.8.8 ( ).   ,
    ,    . <b>Ruby 1.8.6  
    .</b>     1.8.6,   Sinatra
    1.2,         ,  
      Sinatra 1.4.0.</dd>

  <dt>Ruby 1.9.2</dt>
  <dd>1.9.2      .
      1.9.2p0,
    ,        Sinatra. 
            Ruby 1.9.4/2.0, 
       1.9     ,  
       Ruby.</dd>

  <dt>Ruby 1.9.3</dt>
  <dd>1.9.3  . ,    1.9.3 
         .</dd>

  <dt>Rubinius</dt>
  <dd>Rubinius   (Rubinius &gt;= 1.2.4), ,  
   , .   2.0  .</dd>

  <dt>JRuby</dt>
  <dd>JRuby   (JRuby &gt;= 1.6.5).    
    .   ,   
  JRuby, , ,   JRuby Rack-,   Thin 
     JRuby.    C  JRuby 
   ,       RDiscount,
  Redcarpet  RedCloth.</dd>
</dl>
<pre class="highlight text">    Ruby.
</pre>
<p>Ruby   ,  ,<br>
  Sinatra:</p>

<ul>
<li>  JRuby  Rubinius;</li>
<li>Ruby Enterprise Edition;</li>
<li>MacRuby, Maglev, IronRuby;</li>
<li>Ruby 1.9.0  1.9.1 (    ).</li>
</ul>

<p>,     , , ,  - 
   ,         ,
 .</p>
<pre class="highlight text">CI-   Ruby,   
</pre>
<p>( 2.0.0),   1.9.4,      ,<br>
   . ,  1.9.4p0  2.0.0p0 
.</p>

<p>Sinatra      ,<br>
   Ruby.</p>

<p>Sinatra  Cardinal, SmallRuby, BlueRuby<br>
 Ruby  1.8.7.</p>
<pre class="highlight text">   Sinatra,   
  master  Sinatra,   .

   ,    
</pre>
<p>:</p>
<pre class="highlight text">gem install sinatra --pre
</pre><pre class="highlight text"> .
</pre>
<a name='Bundler'></a>
<h3>Bundler</h3>
<pre class="highlight text">     Sinatra, 
</pre>
<p><a href="http://gembundler.com/">Bundler</a>.</p>

<p>Bundler,      :</p>
<pre class="highlight text">gem install bundler
</pre>
<p><code>Gemfile</code>    :</p>
<pre class="highlight ruby"><span class="n">source</span> <span class="ss">:rubygems</span>
<span class="n">gem</span> <span class="s1">'sinatra'</span><span class="p">,</span> <span class="ss">:git</span> <span class="o">=&gt;</span> <span class="s2">&quot;git://github.com/sinatra/sinatra.git&quot;</span>

<span class="c1">#  </span>
<span class="n">gem</span> <span class="s1">'haml'</span>                    <span class="c1"># ,   haml</span>
<span class="n">gem</span> <span class="s1">'activerecord'</span><span class="p">,</span> <span class="s1">'~&gt; 3.0'</span>  <span class="c1">#  ,    ActiveRecord 3.x</span>
</pre>
<p>,<br>
  . ,   Sinatra (Rack  Tilt)
Bundler    .</p>
<pre class="highlight text">  :
</pre><pre class="highlight text">bundle exec ruby myapp.rb
</pre>
<p><code>sinatra/lib</code>   <code>$LOAD_PATH</code>:</p>
<pre class="highlight text">cd myapp
git clone git://github.com/sinatra/sinatra.git
ruby -Isinatra/lib myapp.rb
</pre>
<p>Sinatra:</p>
<pre class="highlight text">cd myapp/sinatra
git pull
</pre><pre class="highlight text">gem:
</pre><pre class="highlight text">git clone git://github.com/sinatra/sinatra.git
cd sinatra
rake sinatra.gemspec
rake install
</pre><pre class="highlight text">(gem)   root,   
</pre><pre class="highlight text">sudo rake install
</pre>
<p>Sinatra  <a href="http://semver.org/">Semantic Versioning</a>, SemVer 
SemVerTag.</p>

<ul>
<li><a href="http://www.sinatrarb.com/">- </a><br>
,      .</li>
<li><a href="http://www.sinatrarb.com/contributing">  </a><br>
?  ?  ?</li>
<li><a href="http://github.com/sinatra/sinatra/issues">  /</a></li>
<li><a href="http://twitter.com/sinatra">Twitter</a></li>
<li><a href="http://groups.google.com/group/sinatrarb/topics"> </a></li>
<li>[#sinatra](irc://chat.freenode.net/#sinatra)  http://freenode.net</li>
<li><a href="http://sinatra-book.gittr.com">Sinatra Book</a><br></li>
<li><a href="http://recipes.sinatrarb.com/">Sinatra Recipes</a><br></li>
<li>API   <a href="http://rubydoc.info/gems/sinatra"> </a>
<a href="http://rubydoc.info/github/sinatra/sinatra"> HEAD</a> 
http://rubydoc.info</li>
<li><a href="http://travis-ci.org/sinatra/sinatra">  </a></li>
</ul>
