<div class='toc'>
	<ol class='level-1'>
		<li><a href='#Conte%C3%BAdo'>Conteúdo</a></li>
		<li><a href='#Rotas'>Rotas</a></li>
		<li><a href='#Condi%C3%A7%C3%B5es'>Condições</a></li>
		<li><a href='#Retorno%20de%20valores'>Retorno de valores</a></li>
		<li><a href='#Validadores%20de%20Rota%20Personalizados'>Validadores de Rota Personalizados</a></li>
		<li><a href='#Arquivos%20est%C3%A1ticos'>Arquivos estáticos</a></li>
		<li><a href='#Views%20/%20Templates'>Views / Templates</a></li>
		<ol class='level-2'>
			<li><a href='#Literal%20Templates'>Literal Templates</a></li>
			<li><a href='#Linguagens%20de%20template%20dispon%C3%ADveis'>Linguagens de template disponíveis</a></li>
			<ol class='level-3'>
				<li><a href='#Haml%20Templates'>Haml Templates</a></li>
				<li><a href='#Erb%20Templates'>Erb Templates</a></li>
				<li><a href='#Builder%20Templates'>Builder Templates</a></li>
				<li><a href='#Nokogiri%20Templates'>Nokogiri Templates</a></li>
				<li><a href='#Sass%20Templates'>Sass Templates</a></li>
				<li><a href='#SCSS%20Templates'>SCSS Templates</a></li>
				<li><a href='#Less%20Templates'>Less Templates</a></li>
				<li><a href='#Liquid%20Templates'>Liquid Templates</a></li>
				<li><a href='#Markdown%20Templates'>Markdown Templates</a></li>
				<li><a href='#RDoc%20Templates'>RDoc Templates</a></li>
				<li><a href='#AsciiDoc%20Templates'>AsciiDoc Templates</a></li>
				<li><a href='#Radius%20Templates'>Radius Templates</a></li>
				<li><a href='#Markaby%20Templates'>Markaby Templates</a></li>
				<li><a href='#RABL%20Templates'>RABL Templates</a></li>
				<li><a href='#Slim%20Templates'>Slim Templates</a></li>
				<li><a href='#Creole%20Templates'>Creole Templates</a></li>
				<li><a href='#MediaWiki%20Templates'>MediaWiki Templates</a></li>
				<li><a href='#CoffeeScript%20Templates'>CoffeeScript Templates</a></li>
				<li><a href='#Stylus%20Templates'>Stylus Templates</a></li>
				<li><a href='#Yajl%20Templates'>Yajl Templates</a></li>
				<li><a href='#WLang%20Templates'>WLang Templates</a></li>
		</ol></ol>
		<li><a href='#Acessando%20Vari%C3%A1veis%20nos%20Templates'>Acessando Variáveis nos Templates</a></li>
		<ol class='level-2'>
			<li><a href='#Templates%20com%20%3Ccode%3Eyield%3C/code%3E%20e%20layouts%20aninhados'>Templates com <code>yield</code> e layouts aninhados</a></li>
			<li><a href='#Templates%20Inline'>Templates Inline</a></li>
			<li><a href='#Templates%20nomeados'>Templates nomeados</a></li>
			<li><a href='#Associando%20extens%C3%B5es%20de%20arquivos'>Associando extensões de arquivos</a></li>
			<li><a href='#Adicionando%20seu%20Pr%C3%B3prio%20Engine%20de%20Template'>Adicionando seu Próprio Engine de Template</a></li>
			<li><a href='#Customizando%20l%C3%B3gica%20para%20encontrar%20templates'>Customizando lógica para encontrar templates</a></li>
		</ol>
		<li><a href='#Filtros'>Filtros</a></li>
		<li><a href='#Helpers'>Helpers</a></li>
		<ol class='level-2'>
			<li><a href='#Utilizando%20Sess%C3%B5es'>Utilizando Sessões</a></li>
			<li><a href='#Halting'>Halting</a></li>
			<li><a href='#Passing'>Passing</a></li>
			<li><a href='#Desencadeando%20Outra%20Rota'>Desencadeando Outra Rota</a></li>
		</ol>
		<li><a href='#Configura%C3%A7%C3%A3o'>Configuração</a></li>
		<li><a href='#Tratamento%20de%20Erros'>Tratamento de Erros</a></li>
		<ol class='level-2'>
			<li><a href='#N%C3%A3o%20Encontrado'>Não Encontrado</a></li>
			<li><a href='#Erro'>Erro</a></li>
		</ol>
		<li><a href='#Mime%20Types'>Mime Types</a></li>
		<li><a href='#Rack%20Middleware'>Rack Middleware</a></li>
		<li><a href='#Testando'>Testando</a></li>
		<li><a href='#Sinatra::Base%20-%20Middleware,%20Bibliotecas%20e%20aplicativos%20modulares'>Sinatra::Base - Middleware, Bibliotecas e aplicativos modulares</a></li>
		<li><a href='#Linha%20de%20Comando'>Linha de Comando</a></li>
		<li><a href='#A%20%C3%BAltima%20vers%C3%A3o'>A última versão</a></li>
		<li><a href='#Mais'>Mais</a></li>
	</ol>
</div>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body>

<p><em>Atenção: Este documento é apenas uma tradução da versão em inglês e
pode estar desatualizado.</em></p>

<p>Alguns dos trechos de código a seguir utilizam caracteres UTF-8. Então, caso esteja utilizando uma versão de ruby inferior à <code>2.0.0</code>, adicione o encoding no início de seus arquivos:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre><span style="color:#777"># encoding: utf-8</span>
</pre></div>
</div>
</div>

<p>Sinatra é uma <a href="http://pt.wikipedia.org/wiki/Linguagem_de_dom%C3%ADnio_espec%C3%ADfico">DSL</a> para
criar aplicações web em Ruby com o mínimo de esforço e rapidez:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre><span style="color:#777"># minha_app.rb</span>
require <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">sinatra</span><span style="color:#710">'</span></span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Olá Mundo!</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Instale a gem:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>gem install sinatra
</pre></div>
</div>
</div>

<p>Em seguida execute:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>ruby minha_app.rb
</pre></div>
</div>
</div>

<p>Acesse: <a href="http://localhost:4567">localhost:4567</a></p>

<p>É recomendado também executar <code>gem install thin</code>. Caso esta gem esteja disponível, o
Sinatra irá utilizá-la.</p>

<a name='Conte%C3%BAdo'></a>
<h2>Conteúdo</h2>



<a name='Rotas'></a>
<h2>Rotas</h2>

<p>No Sinatra, uma rota é um método HTTP emparelhado com um padrão de URL.
Cada rota possui um bloco de execução:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  .. mostrando alguma coisa ..
<span style="color:#080;font-weight:bold">end</span>

post <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  .. criando alguma coisa ..
<span style="color:#080;font-weight:bold">end</span>

put <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  .. atualizando alguma coisa ..
<span style="color:#080;font-weight:bold">end</span>

patch <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  .. modificando alguma coisa ..
<span style="color:#080;font-weight:bold">end</span>

delete <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  .. removendo alguma coisa ..
<span style="color:#080;font-weight:bold">end</span>

options <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  .. estabelecendo alguma coisa ..pe
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>As rotas são interpretadas na ordem em que são definidas. A primeira
rota encontrada responde a requisição.</p>

<p>Padrões de rota podem conter parâmetros nomeados, acessíveis por meio do
hash <code>params</code>:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/ola/:nome</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  <span style="color:#777"># corresponde a "GET /ola/foo" e "GET /ola/bar"</span>
  <span style="color:#777"># params['nome'] é 'foo' ou 'bar'</span>
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">Olá </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>params[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">nome</span><span style="color:#710">'</span></span>]<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20">!</span><span style="color:#710">"</span></span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Você também pode acessar parâmetros nomeados por meio dos parâmetros de
um bloco:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/ola/:nome</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span> |n|
  <span style="color:#777"># corresponde a "GET /ola/foo" e "GET /ola/bar"</span>
  <span style="color:#777"># params['nome'] é 'foo' ou 'bar'</span>
  <span style="color:#777"># n guarda o valor de params['nome']</span>
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">Olá </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>n<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20">!</span><span style="color:#710">"</span></span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Padrões de rota também podem conter parâmetros splat (curinga),
acessível por meio do array <code>params['splat']</code>:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/diga/*/para/*</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  <span style="color:#777"># corresponde a /diga/ola/para/mundo</span>
  params[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">splat</span><span style="color:#710">'</span></span>] <span style="color:#777"># =&gt; ["ola", "mundo"]</span>
<span style="color:#080;font-weight:bold">end</span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/download/*.*</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  <span style="color:#777"># corresponde a /download/caminho/do/arquivo.xml</span>
  params[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">splat</span><span style="color:#710">'</span></span>] <span style="color:#777"># =&gt; ["caminho/do/arquivo", "xml"]</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Ou com parâmetros de um bloco:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/download/*.*</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span> |caminho, ext|
  [caminho, ext] <span style="color:#777"># =&gt; ["caminho/do/arquivo", "xml"]</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Rotas podem casar com expressões regulares:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#D20">\A</span><span style="color:#D20">\/</span><span style="color:#808">ola</span><span style="color:#D20">\/</span><span style="color:#808">([</span><span style="color:#D20">\w</span><span style="color:#808">]+)</span><span style="color:#D20">\z</span><span style="color:#404">/</span></span> <span style="color:#080;font-weight:bold">do</span>
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">Olá, </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>params[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">captures</span><span style="color:#710">'</span></span>].first<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20">!</span><span style="color:#710">"</span></span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Ou com parâmetros de um bloco:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">%r{</span><span style="color:#808">/ola/([</span><span style="color:#D20">\w</span><span style="color:#808">]+)</span><span style="color:#404">}</span></span> <span style="color:#080;font-weight:bold">do</span> |c|
  <span style="color:#777"># corresponde a "GET /meta/ola/mundo", "GET /ola/mundo/1234" etc.</span>
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">Olá, </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>c<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20">!</span><span style="color:#710">"</span></span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Padrões de rota podem contar com parâmetros opcionais:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/posts.?:formato?</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  <span style="color:#777"># corresponde a "GET /posts" e qualquer extensão "GET /posts.json", "GET /posts.xml", etc.</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Rotas também podem utilizar query strings:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/posts</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  <span style="color:#777"># corresponde a "GET /posts?titulo=foo&amp;autor=bar"</span>
  titulo = params[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">titulo</span><span style="color:#710">'</span></span>]
  autor = params[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">autor</span><span style="color:#710">'</span></span>]
  <span style="color:#777"># utiliza as variaveis titulo e autor; a query é opicional para a rota /posts</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>A propósito, a menos que você desative a proteção contra ataques (veja
abaixo), o caminho solicitado pode ser alterado antes de concluir a
comparação com as suas rotas.</p>

<a name='Condi%C3%A7%C3%B5es'></a>
<h2>Condições</h2>

<p>Rotas podem incluir uma variedade de condições, tal como o <code>user agent</code>:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/foo</span><span style="color:#710">'</span></span>, <span style="color:#A60">:agent</span> =&gt; <span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">Songbird (</span><span style="color:#D20">\d</span><span style="color:#D20">\.</span><span style="color:#D20">\d</span><span style="color:#808">)[</span><span style="color:#D20">\d</span><span style="color:#D20">\/</span><span style="color:#808">]*?</span><span style="color:#404">/</span></span> <span style="color:#080;font-weight:bold">do</span>
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">Você está usando o Songbird versão </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>params[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">agent</span><span style="color:#710">'</span></span>][<span style="color:#00D">0</span>]<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">"</span></span>
<span style="color:#080;font-weight:bold">end</span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/foo</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  <span style="color:#777"># Correspondente a navegadores que não sejam Songbird</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Outras condições disponíveis são <code>host_name</code> e <code>provides</code>:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span>, <span style="color:#A60">:host_name</span> =&gt; <span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">^admin</span><span style="color:#D20">\.</span><span style="color:#404">/</span></span> <span style="color:#080;font-weight:bold">do</span>
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">Área administrativa. Acesso negado!</span><span style="color:#710">"</span></span>
<span style="color:#080;font-weight:bold">end</span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span>, <span style="color:#A60">:provides</span> =&gt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">html</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  haml <span style="color:#A60">:index</span>
<span style="color:#080;font-weight:bold">end</span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span>, <span style="color:#A60">:provides</span> =&gt; [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">rss</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">atom</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">xml</span><span style="color:#710">'</span></span>] <span style="color:#080;font-weight:bold">do</span>
  builder <span style="color:#A60">:feed</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>
<p><code>provides</code> procura pelos Accept header das requisições</p>

<p>Você pode facilmente definir suas próprias condições:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>set(<span style="color:#A60">:probabilidade</span>) { |valor| condition { rand &lt;= valor } }

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/ganha_um_carro</span><span style="color:#710">'</span></span>, <span style="color:#A60">:probabilidade</span> =&gt; <span style="color:#60E">0.1</span> <span style="color:#080;font-weight:bold">do</span>
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">Você ganhou!</span><span style="color:#710">"</span></span>
<span style="color:#080;font-weight:bold">end</span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/ganha_um_carro</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">Sinto muito, você perdeu.</span><span style="color:#710">"</span></span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Use splat, para uma condição que leva vários valores:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>set(<span style="color:#A60">:auth</span>) <span style="color:#080;font-weight:bold">do</span> |*roles|   <span style="color:#777"># &lt;- observe o splat aqui</span>
  condition <span style="color:#080;font-weight:bold">do</span>
    <span style="color:#080;font-weight:bold">unless</span> logged_in? &amp;&amp; roles.any? {|role| current_user.in_role? role }
      redirect <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">/login/</span><span style="color:#710">"</span></span>, <span style="color:#00D">303</span>
    <span style="color:#080;font-weight:bold">end</span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">/minha/conta/</span><span style="color:#710">"</span></span>, <span style="color:#A60">:auth</span> =&gt; [<span style="color:#A60">:usuario</span>, <span style="color:#A60">:administrador</span>] <span style="color:#080;font-weight:bold">do</span>
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">Detalhes da sua conta</span><span style="color:#710">"</span></span>
<span style="color:#080;font-weight:bold">end</span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">/apenas/administrador/</span><span style="color:#710">"</span></span>, <span style="color:#A60">:auth</span> =&gt; <span style="color:#A60">:administrador</span> <span style="color:#080;font-weight:bold">do</span>
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">Apenas administradores são permitidos aqui!</span><span style="color:#710">"</span></span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<a name='Retorno%20de%20valores'></a>
<h2>Retorno de valores</h2>

<p>O valor de retorno do bloco de uma rota determina pelo menos o corpo da
resposta passado para o cliente HTTP, ou pelo menos o próximo middleware
na pilha Rack. Frequentemente, isto é uma <code>string</code>, tal como nos
exemplos acima. Entretanto, outros valores também são aceitos.</p>

<p>Você pode retornar uma resposta válida ou um objeto para o Rack, sendo
eles de qualquer tipo de objeto que queira. Além disso, é possível
retornar um código de status HTTP.</p>

<ul>
  <li>
    <p>Um array com três elementros: <code>[status (Fixnum), cabecalho (Hash),
  corpo da resposta (responde à #each)]</code></p>
  </li>
  <li>
    <p>Um array com dois elementros: <code>[status (Fixnum), corpo da resposta
  (responde à #each)]</code></p>
  </li>
  <li>
    <p>Um objeto que responda à <code>#each</code> sem passar nada, mas, sim, <code>strings</code>
  para um dado bloco</p>
  </li>
  <li>
    <p>Um objeto <code>Fixnum</code> representando o código de status</p>
  </li>
</ul>

<p>Dessa forma, podemos implementar facilmente um exemplo de streaming:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre><span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Stream</span>
  <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">each</span>
    <span style="color:#00D">100</span>.times { |i| <span style="color:#080;font-weight:bold">yield</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>i<span style="font-weight:bold;color:#666">}</span></span><span style="color:#b0b">\n</span><span style="color:#710">"</span></span> }
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>

get(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span>) { <span style="color:#036;font-weight:bold">Stream</span>.new }
</pre></div>
</div>
</div>

<p>Você também pode usar o método auxiliar <code>stream</code> (descrito abaixo) para
incorporar a lógica de streaming na rota.</p>

<a name='Validadores%20de%20Rota%20Personalizados'></a>
<h2>Validadores de Rota Personalizados</h2>

<p>Como apresentado acima, a estrutura do Sinatra conta com suporte
embutido para uso de padrões de String e expressões regulares como
validadores de rota. No entanto, ele não pára por aí. Você pode
facilmente definir os seus próprios validadores:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre><span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">AllButPattern</span>
  <span style="color:#036;font-weight:bold">Match</span> = <span style="color:#036;font-weight:bold">Struct</span>.new(<span style="color:#A60">:captures</span>)

  <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">initialize</span>(except)
    <span style="color:#33B">@except</span>   = except
    <span style="color:#33B">@captures</span> = <span style="color:#036;font-weight:bold">Match</span>.new([])
  <span style="color:#080;font-weight:bold">end</span>

  <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">match</span>(str)
    <span style="color:#33B">@captures</span> <span style="color:#080;font-weight:bold">unless</span> <span style="color:#33B">@except</span> === str
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>

<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">all_but</span>(pattern)
  <span style="color:#036;font-weight:bold">AllButPattern</span>.new(pattern)
<span style="color:#080;font-weight:bold">end</span>

get all_but(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">/index</span><span style="color:#710">"</span></span>) <span style="color:#080;font-weight:bold">do</span>
  <span style="color:#777"># ...</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Note que o exemplo acima pode ser robusto e complicado em excesso. Pode
também ser implementado como:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#404">/</span></span> <span style="color:#080;font-weight:bold">do</span>
  pass <span style="color:#080;font-weight:bold">if</span> request.path_info == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">/index</span><span style="color:#710">"</span></span>
  <span style="color:#777"># ...</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Ou, usando algo mais denso à frente:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">%r{</span><span style="color:#808">^(?!/index$)</span><span style="color:#404">}</span></span> <span style="color:#080;font-weight:bold">do</span>
  <span style="color:#777"># ...</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<a name='Arquivos%20est%C3%A1ticos'></a>
<h2>Arquivos estáticos</h2>

<p>Arquivos estáticos são disponibilizados a partir do diretório
<code>./public</code>. Você pode especificar um local diferente pela opção
<code>:public_folder</code></p>

<div>
<div class="CodeRay">
  <div class="code"><pre>set <span style="color:#A60">:public_folder</span>, <span style="color:#036;font-weight:bold">File</span>.dirname(<span style="color:#069">__FILE__</span>) + <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/estatico</span><span style="color:#710">'</span></span>
</pre></div>
</div>
</div>

<p>Note que o nome do diretório público não é incluido na URL. Um arquivo
<code>./public/css/style.css</code> é disponibilizado como
<code>http://exemplo.com/css/style.css</code>.</p>

<a name='Views%20/%20Templates'></a>
<h2>Views / Templates</h2>

<p>Cada linguagem de template é exposta através de seu próprio método de renderização. Estes metodos simplesmente retornam uma string:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  erb <span style="color:#A60">:index</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Isto renderiza <code>views/index.rb</code></p>

<p>Ao invés do nome do template, você também pode passar direto o conteúdo do template:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  code = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">&lt;%= Time.now %&gt;</span><span style="color:#710">"</span></span>
  erb code
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Templates também aceitam um segundo argumento, um hash de opções:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  erb <span style="color:#A60">:index</span>, <span style="color:#A60">:layout</span> =&gt; <span style="color:#A60">:post</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Isto irá renderizar a <code>views/index.erb</code> inclusa dentro da <code>views/post.erb</code> (o padrão é a <code>views/layout.erb</code>, se existir).</p>

<p>Qualquer opção não reconhecida pelo Sinatra será passada adiante para o engine de template:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  haml <span style="color:#A60">:index</span>, <span style="color:#A60">:format</span> =&gt; <span style="color:#A60">:html5</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Você também pode definir opções padrões para um tipo de template:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>set <span style="color:#A60">:haml</span>, <span style="color:#A60">:format</span> =&gt; <span style="color:#A60">:html5</span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  haml <span style="color:#A60">:index</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Opções passadas para o método de renderização sobrescreve as opções definitas através do método <code>set</code>.</p>

<p>Opções disponíveis:</p>

<dl>
  <dt>locals</dt>
  <dd>
    Lista de locais passado para o documento. Conveniente para *partials*
    Exemplo: <tt>erb "&lt;%= foo %&gt;", :locals =&gt; {:foo =&gt; "bar"}</tt>
  </dd>

  <dt>default_encoding</dt>
  <dd>
    String encoding para ser utilizada em caso de incerteza. o padrão é <tt>settings.default_encoding</tt>.
  </dd>

  <dt>views</dt>
  <dd>
    Diretório de onde os templates são carregados. O padrão é <tt>settings.views</tt>.
  </dd>

  <dt>layout</dt>
  <dd>
    Para definir quando utilizar ou não um
    layout (<tt>true</tt> ou <tt>false</tt>). E se for um
    Symbol, especifica qual template usar. Exemplo:
    <tt>erb :index, :layout =&gt; !request.xhr?</tt>
  </dd>

  <dt>content_type</dt>
  <dd>
    O *Content-Type* que o template produz. O padrão depente
    da linguagem de template utilizada.
  </dd>

  <dt>scope</dt>
  <dd>
    Escopo em que o template será renderizado. Padrão é a
    instancia da aplicação. Se você mudar isto as variáveis
    de instânciae metodos auxiliares não serão
    disponibilizados.
  </dd>

  <dt>layout_engine</dt>
  <dd>
    A engine de template utilizada para renderizar seu layout.
    Útil para linguagens que não suportam templates de outra
    forma. O padrão é a engine do template utilizado. Exemplo: 
    <tt>set :rdoc, :layout_engine =&gt; :erb</tt>
  </dd>

  <dt>layout_options</dt>
  <dd>
    Opções especiais utilizadas apenas para renderizar o
    layout. Exemplo:
    <tt>set :rdoc, :layout_options =&gt; { :views =&gt; 'views/layouts' }</tt>
  </dd>
</dl>

<p>É pressuposto que os templates estarão localizados direto sob o diretório <code>./views</code>. Para usar um diretório diferente:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>set <span style="color:#A60">:views</span>, settings.root + <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/templates</span><span style="color:#710">'</span></span>
</pre></div>
</div>
</div>

<p>Uma coisa importante para se lembrar é que você sempre deve
referenciar os templates utilizando <em>symbols</em>, mesmo que
eles estejam em um subdiretório (neste caso use:
<code>:'subdir/template'</code> or <code>'subdir/template'.to_sym</code>). Você deve 
utilizar um <em>symbol</em> porque senão o método de renderização irá
renderizar qualquer outra string que você passe diretamente
para ele</p>

<a name='Literal%20Templates'></a>
<h3>Literal Templates</h3>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  haml <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">%div.title Olá Mundo</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Renderiza um template string.</p>

<a name='Linguagens%20de%20template%20dispon%C3%ADveis'></a>
<h3>Linguagens de template disponíveis</h3>

<p>Algumas linguagens possuem multiplas implementações. Para especificar qual implementação deverá ser utilizada (e para ser <em>thread-safe</em>), você deve simplesmente requere-la primeiro:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>require <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">rdiscount</span><span style="color:#710">'</span></span> <span style="color:#777"># ou require 'bluecloth'</span>
get(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span>) { markdown <span style="color:#A60">:index</span> }
</pre></div>
</div>
</div>

<a name='Haml%20Templates'></a>
<h4>Haml Templates</h4>

<table>
  <tr>
    <td>Dependencia</td>
    <td><a href="http://haml.info/" title="haml">haml</a></td>
  </tr>
  <tr>
    <td>Extencao do Arquivo</td>
    <td><tt>.haml</tt></td>
  </tr>
  <tr>
    <td>Exemplo</td>
    <td><tt>haml :index, :format =&gt; :html5</tt></td>
  </tr>
</table>

<a name='Erb%20Templates'></a>
<h4>Erb Templates</h4>

<table>
  <tr>
    <td>Dependencia</td>
    <td>
      <a href="http://www.kuwata-lab.com/erubis/" title="erubis">erubis</a>
      or erb (included in Ruby)
    </td>
  </tr>
  <tr>
    <td>Extencao do Arquivos</td>
    <td>
<tt>.erb</tt>, <tt>.rhtml</tt> or <tt>.erubis</tt> (Erubis only)</td>
  </tr>
  <tr>
    <td>Exemplo</td>
    <td><tt>erb :index</tt></td>
  </tr>
</table>

<a name='Builder%20Templates'></a>
<h4>Builder Templates</h4>

<table>
  <tr>
    <td>Dependencia</td>
    <td>
      <a href="https://github.com/jimweirich/builder" title="builder">builder</a>
    </td>
  </tr>
  <tr>
    <td>Extencao do Arquivo</td>
    <td><tt>.builder</tt></td>
  </tr>
  <tr>
    <td>Exemplo</td>
    <td><tt>builder { |xml| xml.em "hi" }</tt></td>
  </tr>
</table>

<p>It also takes a block for inline templates (see exemplo).</p>

<a name='Nokogiri%20Templates'></a>
<h4>Nokogiri Templates</h4>

<table>
  <tr>
    <td>Dependencia</td>
    <td><a href="http://nokogiri.org/" title="nokogiri">nokogiri</a></td>
  </tr>
  <tr>
    <td>Extencao do Arquivo</td>
    <td><tt>.nokogiri</tt></td>
  </tr>
  <tr>
    <td>Exemplo</td>
    <td><tt>nokogiri { |xml| xml.em "hi" }</tt></td>
  </tr>
</table>

<p>It also takes a block for inline templates (see exemplo).</p>

<a name='Sass%20Templates'></a>
<h4>Sass Templates</h4>

<table>
  <tr>
    <td>Dependencia</td>
    <td><a href="http://sass-lang.com/" title="sass">sass</a></td>
  </tr>
  <tr>
    <td>Extencao do Arquivo</td>
    <td><tt>.sass</tt></td>
  </tr>
  <tr>
    <td>Exemplo</td>
    <td><tt>sass :stylesheet, :style =&gt; :expanded</tt></td>
  </tr>
</table>

<a name='SCSS%20Templates'></a>
<h4>SCSS Templates</h4>

<table>
  <tr>
    <td>Dependencia</td>
    <td><a href="http://sass-lang.com/" title="sass">sass</a></td>
  </tr>
  <tr>
    <td>Extencao do Arquivo</td>
    <td><tt>.scss</tt></td>
  </tr>
  <tr>
    <td>Exemplo</td>
    <td><tt>scss :stylesheet, :style =&gt; :expanded</tt></td>
  </tr>
</table>

<a name='Less%20Templates'></a>
<h4>Less Templates</h4>

<table>
  <tr>
    <td>Dependencia</td>
    <td><a href="http://www.lesscss.org/" title="less">less</a></td>
  </tr>
  <tr>
    <td>Extencao do Arquivo</td>
    <td><tt>.less</tt></td>
  </tr>
  <tr>
    <td>Exemplo</td>
    <td><tt>less :stylesheet</tt></td>
  </tr>
</table>

<a name='Liquid%20Templates'></a>
<h4>Liquid Templates</h4>

<table>
  <tr>
    <td>Dependencia</td>
    <td><a href="http://www.liquidmarkup.org/" title="liquid">liquid</a></td>
  </tr>
  <tr>
    <td>Extencao do Arquivo</td>
    <td><tt>.liquid</tt></td>
  </tr>
  <tr>
    <td>Exemplo</td>
    <td><tt>liquid :index, :locals =&gt; { :key =&gt; 'value' }</tt></td>
  </tr>
</table>

<p>Já que você não pode chamar o Ruby (exceto pelo método <code>yield</code>) pelo template Liquid,
você quase sempre precisará passar o <code>locals</code> para ele.</p>

<a name='Markdown%20Templates'></a>
<h4>Markdown Templates</h4>

<table>
  <tr>
    <td>Dependencia</td>
    <td>
      Anyone of:
        <a href="https://github.com/rtomayko/rdiscount" title="RDiscount">RDiscount</a>,
        <a href="https://github.com/vmg/redcarpet" title="RedCarpet">RedCarpet</a>,
        <a href="http://deveiate.org/projects/BlueCloth" title="BlueCloth">BlueCloth</a>,
        <a href="http://kramdown.gettalong.org/" title="kramdown">kramdown</a>,
        <a href="https://github.com/bhollis/maruku" title="maruku">maruku</a>
    </td>
  </tr>
  <tr>
    <td>Extencao do Arquivos</td>
    <td>
<tt>.markdown</tt>, <tt>.mkd</tt> and <tt>.md</tt>
</td>
  </tr>
  <tr>
    <td>Exemplo</td>
    <td><tt>markdown :index, :layout_engine =&gt; :erb</tt></td>
  </tr>
</table>

<p>Não é possível chamar métodos por este template, nem passar <em>locals</em> para o mesmo. Portanto normalmente é utilizado junto a outra engine de renderização:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>erb <span style="color:#A60">:overview</span>, <span style="color:#A60">:locals</span> =&gt; { <span style="color:#A60">:text</span> =&gt; markdown(<span style="color:#A60">:introducao</span>) }
</pre></div>
</div>
</div>

<p>Note que vcoê também pode chamar o método <code>markdown</code> dentro de outros templates:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>%h1 <span style="color:#036;font-weight:bold">Olá</span> <span style="color:#080;font-weight:bold">do</span> Haml!
%p= markdown(<span style="color:#A60">:saudacoes</span>)
</pre></div>
</div>
</div>

<p>Já que você não pode chamar o Ruby pelo Markdown, você não
pode utilizar um layout escrito em Markdown. Contudo é
possível utilizar outra engine de renderização como template, 
deve-se passar a <code>:layout_engine</code> como opção.</p>

<table>
  <tr>
    <td>Dependencia</td>
    <td><a href="http://redcloth.org/" title="RedCloth">RedCloth</a></td>
  </tr>
  <tr>
    <td>Extencao do Arquivo</td>
    <td><tt>.textile</tt></td>
  </tr>
  <tr>
    <td>Exemplo</td>
    <td><tt>textile :index, :layout_engine =&gt; :erb</tt></td>
  </tr>
</table>

<p>Não é possível chamar métodos por este template, nem passar <em>locals</em> para o mesmo. Portanto normalmente é utilizado junto a outra engine de renderização:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>erb <span style="color:#A60">:overview</span>, <span style="color:#A60">:locals</span> =&gt; { <span style="color:#A60">:text</span> =&gt; textile(<span style="color:#A60">:introducao</span>) }
</pre></div>
</div>
</div>

<p>Note que vcoê também pode chamar o método <code>textile</code> dentro de outros templates:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>%h1 <span style="color:#036;font-weight:bold">Olá</span> <span style="color:#080;font-weight:bold">do</span> Haml!
%p= textile(<span style="color:#A60">:saudacoes</span>)
</pre></div>
</div>
</div>

<p>Já que você não pode chamar o Ruby pelo Textile, você não
pode utilizar um layout escrito em Textile. Contudo é
possível utilizar outra engine de renderização como template, 
deve-se passar a <code>:layout_engine</code> como opção.</p>

<a name='RDoc%20Templates'></a>
<h4>RDoc Templates</h4>

<table>
  <tr>
    <td>Dependencia</td>
    <td><a href="http://rdoc.sourceforge.net/" title="RDoc">RDoc</a></td>
  </tr>
  <tr>
    <td>Extencao do Arquivo</td>
    <td><tt>.rdoc</tt></td>
  </tr>
  <tr>
    <td>Exemplo</td>
    <td><tt>rdoc :README, :layout_engine =&gt; :erb</tt></td>
  </tr>
</table>

<p>Não é possível chamar métodos por este template, nem passar <em>locals</em> para o mesmo. Portanto normalmente é utilizado junto a outra engine de renderização:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>erb <span style="color:#A60">:overview</span>, <span style="color:#A60">:locals</span> =&gt; { <span style="color:#A60">:text</span> =&gt; rdoc(<span style="color:#A60">:introducao</span>) }
</pre></div>
</div>
</div>

<p>Note que vcoê também pode chamar o método <code>rdoc</code> dentro de outros templates:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>%h1 <span style="color:#036;font-weight:bold">Olá</span> <span style="color:#080;font-weight:bold">do</span> Haml!
%p= rdoc(<span style="color:#A60">:saudacoes</span>)
</pre></div>
</div>
</div>

<p>Já que você não pode chamar o Ruby pelo RDoc, você não
pode utilizar um layout escrito em RDoc. Contudo é
possível utilizar outra engine de renderização como template, 
deve-se passar a <code>:layout_engine</code> como opção.</p>

<a name='AsciiDoc%20Templates'></a>
<h4>AsciiDoc Templates</h4>

<table>
  <tr>
    <td>Dependencia</td>
    <td><a href="http://asciidoctor.org/" title="Asciidoctor">Asciidoctor</a></td>
  </tr>
  <tr>
    <td>Extencao do Arquivo</td>
    <td>
<tt>.asciidoc</tt>, <tt>.adoc</tt> and <tt>.ad</tt>
</td>
  </tr>
  <tr>
    <td>Exemplo</td>
    <td><tt>asciidoc :README, :layout_engine =&gt; :erb</tt></td>
  </tr>
</table>

<p>Já que você não pode chamar o Ruby pelo template AsciiDoc,
você quase sempre precisará passar o <code>locals</code> para ele.</p>

<a name='Radius%20Templates'></a>
<h4>Radius Templates</h4>

<table>
  <tr>
    <td>Dependencia</td>
    <td><a href="https://github.com/jlong/radius" title="Radius">Radius</a></td>
  </tr>
  <tr>
    <td>Extencao do Arquivo</td>
    <td><tt>.radius</tt></td>
  </tr>
  <tr>
    <td>Exemplo</td>
    <td><tt>radius :index, :locals =&gt; { :key =&gt; 'value' }</tt></td>
  </tr>
</table>

<p>Já que você não pode chamar o Ruby pelo template Radius,
você quase sempre precisará passar o <code>locals</code> para ele.</p>

<a name='Markaby%20Templates'></a>
<h4>Markaby Templates</h4>

<table>
  <tr>
    <td>Dependencia</td>
    <td><a href="http://markaby.github.com/" title="Markaby">Markaby</a></td>
  </tr>
  <tr>
    <td>Extencao do Arquivo</td>
    <td><tt>.mab</tt></td>
  </tr>
  <tr>
    <td>Exemplo</td>
    <td><tt>markaby { h1 "Welcome!" }</tt></td>
  </tr>
</table>

<p>Este também recebe um bloco para templates (veja o exemplo).</p>

<a name='RABL%20Templates'></a>
<h4>RABL Templates</h4>

<table>
  <tr>
    <td>Dependencia</td>
    <td><a href="https://github.com/nesquena/rabl" title="Rabl">Rabl</a></td>
  </tr>
  <tr>
    <td>Extencao do Arquivo</td>
    <td><tt>.rabl</tt></td>
  </tr>
  <tr>
    <td>Exemplo</td>
    <td><tt>rabl :index</tt></td>
  </tr>
</table>

<a name='Slim%20Templates'></a>
<h4>Slim Templates</h4>

<table>
  <tr>
    <td>Dependencia</td>
    <td><a href="http://slim-lang.com/" title="Slim Lang">Slim Lang</a></td>
  </tr>
  <tr>
    <td>Extencao do Arquivo</td>
    <td><tt>.slim</tt></td>
  </tr>
  <tr>
    <td>Exemplo</td>
    <td><tt>slim :index</tt></td>
  </tr>
</table>

<a name='Creole%20Templates'></a>
<h4>Creole Templates</h4>

<table>
  <tr>
    <td>Dependencia</td>
    <td><a href="https://github.com/minad/creole" title="Creole">Creole</a></td>
  </tr>
  <tr>
    <td>Extencao do Arquivo</td>
    <td><tt>.creole</tt></td>
  </tr>
  <tr>
    <td>Exemplo</td>
    <td><tt>creole :wiki, :layout_engine =&gt; :erb</tt></td>
  </tr>
</table>

<p>Não é possível chamar métodos por este template, nem passar <em>locals</em> para o mesmo. Portanto normalmente é utilizado junto a outra engine de renderização:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>erb <span style="color:#A60">:overview</span>, <span style="color:#A60">:locals</span> =&gt; { <span style="color:#A60">:text</span> =&gt; creole(<span style="color:#A60">:introduction</span>) }
</pre></div>
</div>
</div>

<p>Note que vcoê também pode chamar o método <code>creole</code> dentro de outros templates:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>%h1 <span style="color:#036;font-weight:bold">Olá</span> <span style="color:#080;font-weight:bold">do</span> Haml!
%p= creole(<span style="color:#A60">:saudacoes</span>)
</pre></div>
</div>
</div>

<p>Já que você não pode chamar o Ruby pelo Creole, você não
pode utilizar um layout escrito em Creole. Contudo é
possível utilizar outra engine de renderização como template, 
deve-se passar a <code>:layout_engine</code> como opção.</p>

<a name='MediaWiki%20Templates'></a>
<h4>MediaWiki Templates</h4>

<table>
  <tr>
    <td>Dependencia</td>
    <td><a href="https://github.com/nricciar/wikicloth" title="WikiCloth">WikiCloth</a></td>
  </tr>
  <tr>
    <td>Extencao do Arquivo</td>
    <td>
<tt>.mediawiki</tt> and <tt>.mw</tt>
</td>
  </tr>
  <tr>
    <td>Exemplo</td>
    <td><tt>mediawiki :wiki, :layout_engine =&gt; :erb</tt></td>
  </tr>
</table>

<p>It is not possible to call methods from MediaWiki markup, nor to pass locals to
it. You therefore will usually use it in combination with another rendering
engine:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>erb <span style="color:#A60">:overview</span>, <span style="color:#A60">:locals</span> =&gt; { <span style="color:#A60">:text</span> =&gt; mediawiki(<span style="color:#A60">:introduction</span>) }
</pre></div>
</div>
</div>

<p>Note that you may also call the <code>mediawiki</code> method from within other templates:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>%h1 <span style="color:#036;font-weight:bold">Hello</span> <span style="color:#036;font-weight:bold">From</span> Haml!
%p= mediawiki(<span style="color:#A60">:greetings</span>)
</pre></div>
</div>
</div>

<p>Já que você não pode chamar o Ruby pelo MediaWiki, você não
pode utilizar um layout escrito em MediaWiki. Contudo é
possível utilizar outra engine de renderização como template, 
deve-se passar a <code>:layout_engine</code> como opção.</p>

<a name='CoffeeScript%20Templates'></a>
<h4>CoffeeScript Templates</h4>

<table>
  <tr>
    <td>Dependencia</td>
    <td>
      <a href="https://github.com/josh/ruby-coffee-script" title="Ruby CoffeeScript">
        CoffeeScript
      </a> and a
      <a href="https://github.com/sstephenson/execjs/blob/master/README.md#readme" title="ExecJS">
        way to execute javascript
      </a>
    </td>
  </tr>
  <tr>
    <td>Extencao do Arquivo</td>
    <td><tt>.coffee</tt></td>
  </tr>
  <tr>
    <td>Exemplo</td>
    <td><tt>coffee :index</tt></td>
  </tr>
</table>

<a name='Stylus%20Templates'></a>
<h4>Stylus Templates</h4>

<table>
  <tr>
    <td>Dependencia</td>
    <td>
      <a href="https://github.com/lucasmazza/ruby-stylus" title="Ruby Stylus">
        Stylus
      </a> and a
      <a href="https://github.com/sstephenson/execjs/blob/master/README.md#readme" title="ExecJS">
        way to execute javascript
      </a>
    </td>
  </tr>
  <tr>
    <td>Extencao do Arquivo</td>
    <td><tt>.styl</tt></td>
  </tr>
  <tr>
    <td>Exemplo</td>
    <td><tt>stylus :index</tt></td>
  </tr>
</table>

<p>Antes que vcoê possa utilizar o template Stylus primeiro você deve carregar <code>stylus</code> e <code>stylus/tilt</code>:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>require <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">sinatra</span><span style="color:#710">'</span></span>
require <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">stylus</span><span style="color:#710">'</span></span>
require <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">stylus/tilt</span><span style="color:#710">'</span></span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  stylus <span style="color:#A60">:exemplo</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<a name='Yajl%20Templates'></a>
<h4>Yajl Templates</h4>

<table>
  <tr>
    <td>Dependencia</td>
    <td><a href="https://github.com/brianmario/yajl-ruby" title="yajl-ruby">yajl-ruby</a></td>
  </tr>
  <tr>
    <td>Extencao do Arquivo</td>
    <td><tt>.yajl</tt></td>
  </tr>
  <tr>
    <td>Exemplo</td>
    <td>
      <tt>
        yajl :index,
             :locals =&gt; { :key =&gt; 'qux' },
             :callback =&gt; 'present',
             :variable =&gt; 'resource'
      </tt>
    </td>
  </tr>
</table>

<p>O código-fonte do template é executado como uma string Ruby e a variável resultante em json é convertida utilizando <code>#to_json</code>:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>json = { <span style="color:#A60">:foo</span> =&gt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">bar</span><span style="color:#710">'</span></span> }
json[<span style="color:#A60">:baz</span>] = key
</pre></div>
</div>
</div>

<p>O <code>:callback</code> e <code>:variable</code> são opções que podem ser utilizadas para o objeto de renderização:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre><span style="color:#080;font-weight:bold">var</span> resource = {<span style="color:#606"><span style="color:#404">"</span><span>foo</span><span style="color:#404">"</span></span>:<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">bar</span><span style="color:#710">"</span></span>,<span style="color:#606"><span style="color:#404">"</span><span>baz</span><span style="color:#404">"</span></span>:<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">qux</span><span style="color:#710">"</span></span>};
present(resource);
</pre></div>
</div>
</div>

<a name='WLang%20Templates'></a>
<h4>WLang Templates</h4>

<table>
  <tr>
    <td>Dependencia</td>
    <td><a href="https://github.com/blambeau/wlang/" title="WLang">WLang</a></td>
  </tr>
  <tr>
    <td>Extencao do Arquivo</td>
    <td><tt>.wlang</tt></td>
  </tr>
  <tr>
    <td>Exemplo</td>
    <td><tt>wlang :index, :locals =&gt; { :key =&gt; 'value' }</tt></td>
  </tr>
</table>

<p>Já que você não pode chamar o Ruby (exceto pelo método
<code>yield</code>) pelo template WLang,
você quase sempre precisará passar o <code>locals</code> para ele.</p>

<a name='Acessando%20Vari%C3%A1veis%20nos%20Templates'></a>
<h2>Acessando Variáveis nos Templates</h2>

<p>Templates são avaliados dentro do mesmo contexto como manipuladores de
rota. Variáveis de instância setadas em rotas manipuladas são
diretamente acessadas por templates:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/:id</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  <span style="color:#33B">@foo</span> = <span style="color:#036;font-weight:bold">Foo</span>.find(params[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">id</span><span style="color:#710">'</span></span>])
  haml <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">%h1= @foo.nome</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Ou, especifique um hash explícito para variáveis locais:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/:id</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  foo = <span style="color:#036;font-weight:bold">Foo</span>.find(params[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">id</span><span style="color:#710">'</span></span>])
  haml <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">%h1= foo.nome</span><span style="color:#710">'</span></span>, <span style="color:#A60">:locals</span> =&gt; { <span style="color:#A60">:foo</span> =&gt; foo }
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Isso é tipicamente utilizando quando renderizamos templates como
partials dentro de outros templates.</p>

<a name='Templates%20com%20%3Ccode%3Eyield%3C/code%3E%20e%20layouts%20aninhados'></a>
<h3>Templates com <code>yield</code> e layouts aninhados</h3>

<p>O layout geralmente é apenas um template que executa <code>yield</code>. 
Tal template pode ser utilizado pela opção <code>:template</code> descrita acima ou pode ser renderizado através de um bloco, como a seguir:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>erb <span style="color:#A60">:post</span>, <span style="color:#A60">:layout</span> =&gt; <span style="color:#069">false</span> <span style="color:#080;font-weight:bold">do</span>
  erb <span style="color:#A60">:index</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Este código é quase equivalente a <code>erb :index, :layout =&gt; :post</code></p>

<p>Passando blocos para os métodos de renderização é útil para criar layouts aninhados:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>erb <span style="color:#A60">:main_layout</span>, <span style="color:#A60">:layout</span> =&gt; <span style="color:#069">false</span> <span style="color:#080;font-weight:bold">do</span>
  erb <span style="color:#A60">:admin_layout</span> <span style="color:#080;font-weight:bold">do</span>
    erb <span style="color:#A60">:user</span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Também pode ser feito com menos linhas de código:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>erb <span style="color:#A60">:admin_layout</span>, <span style="color:#A60">:layout</span> =&gt; <span style="color:#A60">:main_layout</span> <span style="color:#080;font-weight:bold">do</span>
  erb <span style="color:#A60">:user</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Atualmente os métodos listados aceitam blocos: <code>erb</code>, <code>haml</code>,
<code>liquid</code>, <code>slim </code>, <code>wlang</code>. E também o método <code>render</code>.</p>

<a name='Templates%20Inline'></a>
<h3>Templates Inline</h3>

<p>Templates podem ser definidos no final do arquivo fonte(.rb):</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>require <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">sinatra</span><span style="color:#710">'</span></span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  haml <span style="color:#A60">:index</span>
<span style="color:#080;font-weight:bold">end</span>

<span style="color:#777">__END__

@@ layout
%html
  = yield

@@ index
%div.title Olá Mundo.</span>
</pre></div>
</div>
</div>

<p>NOTA: Templates inline definidos no arquivo fonte são automaticamente
carregados pelo sinatra. Digite `enable :inline_templates` se você
tem templates inline no outro arquivo fonte.</p>

<a name='Templates%20nomeados'></a>
<h3>Templates nomeados</h3>

<p>Templates também podem ser definidos utilizando o método top-level
<code>template</code>:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>template <span style="color:#A60">:layout</span> <span style="color:#080;font-weight:bold">do</span>
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">%html</span><span style="color:#b0b">\n</span><span style="color:#D20">  =yield</span><span style="color:#b0b">\n</span><span style="color:#710">"</span></span>
<span style="color:#080;font-weight:bold">end</span>

template <span style="color:#A60">:index</span> <span style="color:#080;font-weight:bold">do</span>
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">%div.title Olá Mundo!</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">end</span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  haml <span style="color:#A60">:index</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Se existir um template com nome “layout”, ele será utilizado toda vez
que um template for renderizado. Você pode desabilitar layouts passando
<code>:layout =&gt; false</code>.</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  haml <span style="color:#A60">:index</span>, <span style="color:#A60">:layout</span> =&gt; !request.xhr?
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<a name='Associando%20extens%C3%B5es%20de%20arquivos'></a>
<h3>Associando extensões de arquivos</h3>

<p>Para associar uma extensão de arquivo com um engine de template use o método <code>Tilt.register</code>. Por exemplo, se você quiser usar a extensão <code>tt</code> para os templates Textile você pode fazer o seguinte:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre><span style="color:#036;font-weight:bold">Tilt</span>.register <span style="color:#A60">:tt</span>, <span style="color:#036;font-weight:bold">Tilt</span>[<span style="color:#A60">:textile</span>]
</pre></div>
</div>
</div>

<a name='Adicionando%20seu%20Pr%C3%B3prio%20Engine%20de%20Template'></a>
<h3>Adicionando seu Próprio Engine de Template</h3>

<p>Primeiro registre seu engine utilizando o Tilt, e então crie um método de renderização:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre><span style="color:#036;font-weight:bold">Tilt</span>.register <span style="color:#A60">:myat</span>, <span style="color:#036;font-weight:bold">MyAwesomeTemplateEngine</span>

helpers <span style="color:#080;font-weight:bold">do</span>
  <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">myat</span>(*args) render(<span style="color:#A60">:myat</span>, *args) <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  myat <span style="color:#A60">:index</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Renderize <code>./views/index.myat</code>. Veja
https://github.com/rtomayko/tilt para saber mais sobre Tilt.</p>

<a name='Customizando%20l%C3%B3gica%20para%20encontrar%20templates'></a>
<h3>Customizando lógica para encontrar templates</h3>

<p>Para implementar sua própria lógica para busca de templates você pode escrever seu próprio método <code>#find_template</code></p>

<div>
<div class="CodeRay">
  <div class="code"><pre>configure <span style="color:#080;font-weight:bold">do</span>
  set <span style="color:#A60">:views</span> [ <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">./views/a</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">./views/b</span><span style="color:#710">'</span></span> ]
<span style="color:#080;font-weight:bold">end</span>

<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">find_template</span>(views, name, engine, &amp;block)
  Array(views).each <span style="color:#080;font-weight:bold">do</span> |v|
    <span style="color:#080;font-weight:bold">super</span>(v, name, engine, &amp;block)
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<a name='Filtros'></a>
<h2>Filtros</h2>

<p>Filtros Before são avaliados antes de cada requisição dentro do contexto
da requisição e podem modificar a requisição e a reposta. Variáveis de
instância setadas nos filtros são acessadas através de rotas e
templates:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>before <span style="color:#080;font-weight:bold">do</span>
  <span style="color:#33B">@nota</span> = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Oi!</span><span style="color:#710">'</span></span>
  request.path_info = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/foo/bar/baz</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">end</span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/foo/*</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  <span style="color:#33B">@nota</span> <span style="color:#777">#=&gt; 'Oi!'</span>
  params[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">splat</span><span style="color:#710">'</span></span>] <span style="color:#777">#=&gt; 'bar/baz'</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Filtros After são avaliados após cada requisição dentro do contexto da
requisição e também podem modificar a requisição e a resposta. Variáveis de
instância e rotas definidas nos filtros before são acessadas através dos
filtros after:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>after <span style="color:#080;font-weight:bold">do</span>
  puts response.status
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Filtros opcionalmente têm um padrão, fazendo com que sejam avaliados
somente se o caminho do pedido coincidir com esse padrão:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>before <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/protected/*</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  authenticate!
<span style="color:#080;font-weight:bold">end</span>

after <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/create/:slug</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span> |slug|
  session[<span style="color:#A60">:last_slug</span>] = slug
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<a name='Helpers'></a>
<h2>Helpers</h2>

<p>Use o método de alto nível <code>helpers</code> para definir métodos auxiliares
para utilizar em manipuladores de rotas e modelos:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>helpers <span style="color:#080;font-weight:bold">do</span>
  <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">bar</span>(nome)
    <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>nome<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20">bar</span><span style="color:#710">"</span></span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/:nome</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  bar(params[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">nome</span><span style="color:#710">'</span></span>])
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<a name='Utilizando%20Sess%C3%B5es'></a>
<h3>Utilizando Sessões</h3>

<p>Sessões são usadas para manter um estado durante uma requisição. Se ativa, você terá disponível um hash de sessão para cada sessão de usuário:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>enable <span style="color:#A60">:sessions</span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">value = </span><span style="color:#710">"</span></span> &lt;&lt; session[<span style="color:#A60">:value</span>].inspect
<span style="color:#080;font-weight:bold">end</span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/:value</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  session[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">value</span><span style="color:#710">'</span></span>] = params[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">value</span><span style="color:#710">'</span></span>]
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Note que <code>enable :sessions</code> utilizará um cookie para guardar todos os dados da sessão. Isso nem sempre pode ser o que você quer (guardar muitos dados irá aumentar o seu tráfego, por exemplo). Você pode utilizar qualquer Rack middleware de sessão: para fazer isso <strong>não</strong> utilize o método <code>enable :sessions</code>, ao invés disso utilize seu middleware de sessão como utilizaria qualquer outro:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>use <span style="color:#036;font-weight:bold">Rack</span>::<span style="color:#036;font-weight:bold">Session</span>::<span style="color:#036;font-weight:bold">Pool</span>, <span style="color:#A60">:expire_after</span> =&gt; <span style="color:#00D">2592000</span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">value = </span><span style="color:#710">"</span></span> &lt;&lt; session[<span style="color:#A60">:value</span>].inspect
<span style="color:#080;font-weight:bold">end</span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/:value</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  session[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">value</span><span style="color:#710">'</span></span>] = params[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">value</span><span style="color:#710">'</span></span>]
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Para melhorar a segurança, os dados da sessão guardados no cookie é assinado com uma chave secreta da sessão. Uma chave aleatória é gerada para você pelo Sinatra. Contudo, já que a chave mudará cada vez que você inicia sua aplicação, você talvez queira defini-la você mesmo para que todas as instâncias da aplicação compartilhe-a:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>set <span style="color:#A60">:session_secret</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">super secret</span><span style="color:#710">'</span></span>
</pre></div>
</div>
</div>

<p>Se você quiser fazer outras configurações, você também pode guardar um hash com as opções nas configurações da <code>session</code>:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>set <span style="color:#A60">:sessions</span>, <span style="color:#A60">:domain</span> =&gt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">foo.com</span><span style="color:#710">'</span></span>
</pre></div>
</div>
</div>

<p>Para compartilhar sua sessão entre outros aplicativos em um subdomínio de foo.com, utilize o prefixo <em>.</em>:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>set <span style="color:#A60">:sessions</span>, <span style="color:#A60">:domain</span> =&gt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">.foo.com</span><span style="color:#710">'</span></span>
</pre></div>
</div>
</div>

<a name='Halting'></a>
<h3>Halting</h3>

<p>Para parar imediatamente uma requisição com um filtro ou rota utilize:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>halt
</pre></div>
</div>
</div>

<p>Você também pode especificar o status quando parar…</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>halt <span style="color:#00D">410</span>
</pre></div>
</div>
</div>

<p>Ou com corpo de texto…</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>halt <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">isso será o corpo do texto</span><span style="color:#710">'</span></span>
</pre></div>
</div>
</div>

<p>Ou também…</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>halt <span style="color:#00D">401</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">vamos embora!</span><span style="color:#710">'</span></span>
</pre></div>
</div>
</div>

<p>Com cabeçalhos…</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>halt <span style="color:#00D">402</span>, {<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Content-Type</span><span style="color:#710">'</span></span> =&gt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">text/plain</span><span style="color:#710">'</span></span>}, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">revanche</span><span style="color:#710">'</span></span>
</pre></div>
</div>
</div>

<p>É obviamente possivel combinar um template com o <code>halt</code>:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>halt erb(<span style="color:#A60">:error</span>)
</pre></div>
</div>
</div>

<a name='Passing'></a>
<h3>Passing</h3>

<p>Uma rota pode processar aposta para a próxima rota correspondente usando
<code>pass</code>:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/adivinhar/:quem</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  pass <span style="color:#080;font-weight:bold">unless</span> params[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">quem</span><span style="color:#710">'</span></span>] == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Frank</span><span style="color:#710">'</span></span>
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Você me pegou!</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">end</span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/adivinhar/*</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Você falhou!</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>O bloqueio da rota é imediatamente encerrado e o controle continua com a
próxima rota de parâmetro. Se o parâmetro da rota não for encontrado, um
404 é retornado.</p>

<a name='Desencadeando%20Outra%20Rota'></a>
<h3>Desencadeando Outra Rota</h3>

<p>As vezes o <code>pass</code> não é o que você quer, ao invés dele talvez você queira obter o resultado chamando outra rota. Utilize o método <code>call</code> neste caso:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/foo</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  status, headers, body = call env.merge(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">PATH_INFO</span><span style="color:#710">"</span></span> =&gt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/bar</span><span style="color:#710">'</span></span>)
  [status, headers, body.map(&amp;<span style="color:#A60">:upcase</span>)]
<span style="color:#080;font-weight:bold">end</span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/bar</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">bar</span><span style="color:#710">"</span></span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Note que no exemplo acima você ganharia performance ao simplemente mover o <code>"bar"</code> em um helper usado por ambos <code>/foo</code> e <code>/bar</code>.</p>

<p>Se você quer que a requisição seja enviada para a mesma instancia da aplicação ao invês de uma duplicada, use <code>call!</code> no lugar de <code>call</code>.</p>

<p>Veja a especificação do Rack se você quer aprender mais sobre o <code>call</code>.</p>

<a name='Configura%C3%A7%C3%A3o'></a>
<h2>Configuração</h2>

<p>Rodando uma vez, na inicialização, em qualquer ambiente:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>configure <span style="color:#080;font-weight:bold">do</span>
  ...
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Rodando somente quando o ambiente (<code>RACK_ENV</code> environment variável) é
setado para <code>:production</code>:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>configure <span style="color:#A60">:production</span> <span style="color:#080;font-weight:bold">do</span>
  ...
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Rodando quando o ambiente é setado para <code>:production</code> ou <code>:test</code>:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>configure <span style="color:#A60">:production</span>, <span style="color:#A60">:test</span> <span style="color:#080;font-weight:bold">do</span>
  ...
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<a name='Tratamento%20de%20Erros'></a>
<h2>Tratamento de Erros</h2>

<p>Tratamento de erros rodam dentro do mesmo contexto como rotas e filtros
before, o que significa que você pega todos os presentes que tem para
oferecer, como <code>haml</code>, <code>erb</code>, <code>halt</code>, etc.</p>

<a name='N%C3%A3o%20Encontrado'></a>
<h3>Não Encontrado</h3>

<p>Quando um <code>Sinatra::NotFound</code> exception é levantado, ou o código de
status da reposta é 404, o manipulador <code>not_found</code> é invocado:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>not_found <span style="color:#080;font-weight:bold">do</span>
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Isto está longe de ser encontrado</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<a name='Erro'></a>
<h3>Erro</h3>

<p>O manipulador <code>error</code> é invocado toda a vez que uma exceção é lançada a
partir de um bloco de rota ou um filtro. O objeto da exceção pode ser
obtido a partir da variável Rack <code>sinatra.error</code>:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>error <span style="color:#080;font-weight:bold">do</span>
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Desculpe, houve um erro desagradável - </span><span style="color:#710">'</span></span> + env[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">sinatra.error</span><span style="color:#710">'</span></span>].message
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Erros customizados:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>error <span style="color:#036;font-weight:bold">MeuErroCustomizado</span> <span style="color:#080;font-weight:bold">do</span>
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Então que aconteceu foi...</span><span style="color:#710">'</span></span> + env[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">sinatra.error</span><span style="color:#710">'</span></span>].message
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Então, se isso acontecer:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  raise <span style="color:#036;font-weight:bold">MeuErroCustomizado</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">alguma coisa ruim</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Você receberá isso:</p>

<pre><code>Então que aconteceu foi... alguma coisa ruim
</code></pre>

<p>Alternativamente, você pode instalar manipulador de erro para um código
de status:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>error <span style="color:#00D">403</span> <span style="color:#080;font-weight:bold">do</span>
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Accesso negado</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">end</span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/secreto</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  <span style="color:#00D">403</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Ou um range:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>error <span style="color:#00D">400</span>..<span style="color:#00D">510</span> <span style="color:#080;font-weight:bold">do</span>
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Boom</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>O Sinatra instala os manipuladores especiais <code>not_found</code> e <code>error</code>
quando roda sobre o ambiente de desenvolvimento.</p>

<a name='Mime%20Types'></a>
<h2>Mime Types</h2>

<p>Quando utilizamos <code>send_file</code> ou arquivos estáticos você pode ter mime
types Sinatra não entendidos. Use <code>mime_type</code> para registrar eles por
extensão de arquivos:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>mime_type <span style="color:#A60">:foo</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">text/foo</span><span style="color:#710">'</span></span>
</pre></div>
</div>
</div>

<p>Você também pode utilizar isto com o helper <code>content_type</code>:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>content_type <span style="color:#A60">:foo</span>
</pre></div>
</div>
</div>

<a name='Rack%20Middleware'></a>
<h2>Rack Middleware</h2>

<p>O Sinatra roda no <a href="http://rack.github.io/">Rack</a>, uma interface
padrão mínima para frameworks web em Ruby. Um das capacidades mais
interessantes do Rack para desenvolver aplicativos é suporte a
“middleware” – componentes que ficam entre o servidor e sua aplicação
monitorando e/ou manipulando o request/response do HTTP para prover
vários tipos de funcionalidades comuns.</p>

<p>O Sinatra faz construtores pipelines do middleware Rack facilmente em um
nível superior utilizando o método <code>use</code>:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>require <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">sinatra</span><span style="color:#710">'</span></span>
require <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">meu_middleware_customizado</span><span style="color:#710">'</span></span>

use <span style="color:#036;font-weight:bold">Rack</span>::<span style="color:#036;font-weight:bold">Lint</span>
use <span style="color:#036;font-weight:bold">MeuMiddlewareCustomizado</span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/ola</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Olá mundo</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>A semântica de <code>use</code> é idêntica aquela definida para a DSL
<a href="http://rubydoc.info/github/rack/rack/master/Rack/Builder">Rack::Builder</a>
(mais frequentemente utilizada para arquivos rackup). Por exemplo, o
método <code>use</code> aceita múltiplos argumentos/variáveis bem como blocos:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>use <span style="color:#036;font-weight:bold">Rack</span>::<span style="color:#036;font-weight:bold">Auth</span>::<span style="color:#036;font-weight:bold">Basic</span> <span style="color:#080;font-weight:bold">do</span> |usuario, senha|
  usuario == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">admin</span><span style="color:#710">'</span></span> &amp;&amp; senha == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">secreto</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>O Rack é distribuido com uma variedade de middleware padrões para logs,
debugs, rotas de URL, autenticação, e manipuladores de sessão. Sinatra
utilizada muitos desses componentes automaticamente baseando sobre
configuração, então, tipicamente você não tem <code>use</code> explicitamente.</p>

<a name='Testando'></a>
<h2>Testando</h2>

<p>Testes no Sinatra podem ser escritos utilizando qualquer biblioteca ou
framework de teste baseados no Rack.
<a href="http://gitrdoc.com/brynary/rack-test">Rack::Test</a> é recomendado:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>require <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">minha_aplicacao_sinatra</span><span style="color:#710">'</span></span>
require <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">rack/test</span><span style="color:#710">'</span></span>

<span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MinhaAplicacaoTeste</span> &lt; <span style="color:#036;font-weight:bold">Minitest</span>::<span style="color:#036;font-weight:bold">Test</span>
  include <span style="color:#036;font-weight:bold">Rack</span>::<span style="color:#036;font-weight:bold">Test</span>::<span style="color:#036;font-weight:bold">Methods</span>

  <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">app</span>
    <span style="color:#036;font-weight:bold">Sinatra</span>::<span style="color:#036;font-weight:bold">Application</span>
  <span style="color:#080;font-weight:bold">end</span>

  <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">meu_test_default</span>
    get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span>
    assert_equal <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Ola Mundo!</span><span style="color:#710">'</span></span>, last_response.body
  <span style="color:#080;font-weight:bold">end</span>

  <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">teste_com_parametros</span>
    get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/atender</span><span style="color:#710">'</span></span>, <span style="color:#A60">:name</span> =&gt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Frank</span><span style="color:#710">'</span></span>
    assert_equal <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Olá Frank!</span><span style="color:#710">'</span></span>, last_response.bodymeet
  <span style="color:#080;font-weight:bold">end</span>

  <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">test_com_ambiente_rack</span>
    get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span>, {}, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">HTTP_USER_AGENT</span><span style="color:#710">'</span></span> =&gt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Songbird</span><span style="color:#710">'</span></span>
    assert_equal <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">Você está utilizando o Songbird!</span><span style="color:#710">"</span></span>, last_response.body
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>NOTA: Os módulos de classe embutidos <code>Sinatra::Test</code> e
<code>Sinatra::TestHarness</code> são depreciados na versão 0.9.2.</p>

<a name='Sinatra::Base%20-%20Middleware,%20Bibliotecas%20e%20aplicativos%20modulares'></a>
<h2>Sinatra::Base - Middleware, Bibliotecas e aplicativos modulares</h2>

<p>Definir sua aplicação em um nível superior de trabalho funciona bem para
micro aplicativos, mas tem consideráveis incovenientes na construção de
componentes reutilizáveis como um middleware Rack, metal Rails,
bibliotecas simples como um componente de servidor, ou mesmo extensões
Sinatra. A DSL de nível superior polui o espaço do objeto e assume um
estilo de configuração de micro aplicativos (exemplo: uma simples
arquivo de aplicação, diretórios <code>./public</code> e <code>./views</code>, logs, página de
detalhes de exceção, etc.). É onde o <code>Sinatra::Base</code> entra em jogo:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>require <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">sinatra/base</span><span style="color:#710">'</span></span>

<span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MinhaApp</span> &lt; <span style="color:#036;font-weight:bold">Sinatra</span>::<span style="color:#036;font-weight:bold">Base</span>
  set <span style="color:#A60">:sessions</span>, <span style="color:#069">true</span>
  set <span style="color:#A60">:foo</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">bar</span><span style="color:#710">'</span></span>

  get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
    <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Ola mundo!</span><span style="color:#710">'</span></span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>A classe <code>MinhaApp</code> é um componente Rack independente que pode agir como
um middleware Rack, uma aplicação Rack, ou metal Rails. Você pode
utilizar ou executar esta classe com um arquivo rackup <code>config.ru</code>;
ou, controlar um componente de servidor fornecendo como biblioteca:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre><span style="color:#036;font-weight:bold">MinhaApp</span>.run! <span style="color:#A60">:host</span> =&gt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">localhost</span><span style="color:#710">'</span></span>, <span style="color:#A60">:port</span> =&gt; <span style="color:#00D">9090</span>
</pre></div>
</div>
</div>

<p>Os métodos disponíveis para subclasses <code>Sinatra::Base</code> são exatamente como
aqueles disponíveis via a DSL de nível superior. Aplicações de nível
mais alto podem ser convertidas para componentes <code>Sinatra::Base</code> com duas
modificações:</p>

<ul>
  <li>
    <p>Seu arquivo deve requerer <code>sinatra/base</code> ao invés de <code>sinatra</code>;
outra coisa, todos os métodos DSL do Sinatra são importados para o
espaço principal.</p>
  </li>
  <li>
    <p>Coloque as rotas da sua aplicação, manipuladores de erro, filtros e
opções na subclasse de um <code>Sinatra::Base</code>.</p>
  </li>
</ul>

<p><code>Sinatra::Base</code> é um quadro branco. Muitas opções são desabilitadas por
padrão, incluindo o servidor embutido. Veja <a href="http://sinatra.github.com/configuration.html">Opções e
Configurações</a> para
detalhes de opções disponíveis e seus comportamentos.</p>

<p>SIDEBAR: A DSL de alto nível do Sinatra é implementada utilizando um simples
sistema de delegação. A classe <code>Sinatra::Application</code> – uma subclasse especial
da <code>Sinatra::Base</code> – recebe todos os <code>:get</code>, <code>:put</code>, <code>:post</code>, <code>:delete</code>,
<code>:before</code>, <code>:error</code>, <code>:not_found</code>, <code>:configure</code>, e <code>:set messages</code> enviados
para o alto nível. Dê uma olhada no código você mesmo: aqui está o
<a href="http://github.com/sinatra/sinatra/blob/ceac46f0bc129a6e994a06100aa854f606fe5992/lib/sinatra/base.rb#L1128">Sinatra::Delegator
mixin</a>
sendo <a href="http://github.com/sinatra/sinatra/blob/ceac46f0bc129a6e994a06100aa854f606fe5992/lib/sinatra/main.rb#L28">incluido dentro de um espaço
principal</a></p>

<a name='Linha%20de%20Comando'></a>
<h2>Linha de Comando</h2>

<p>Aplicações Sinatra podem ser executadas diretamente:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>ruby minhaapp.rb [-h] [-x] [-e AMBIENTE] [-p PORTA] [-o HOST] [-s SERVIDOR]
</pre></div>
</div>
</div>

<p>As opções são:</p>

<pre><code>-h # ajuda
-p # define a porta (padrão é 4567)
-o # define o host (padrão é 0.0.0.0)
-e # define o ambiente (padrão é development)
-s # especifica o servidor/manipulador rack (padrão é thin)
-x # ativa o bloqueio (padrão é desligado)
</code></pre>

<a name='A%20%C3%BAltima%20vers%C3%A3o'></a>
<h2>A última versão</h2>

<p>Se você gostaria de utilizar o código da última versão do Sinatra, crie
um clone local e execute sua aplicação com o diretório <code>sinatra/lib</code> no
<code>LOAD_PATH</code>:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>cd minhaapp
git clone git://github.com/sinatra/sinatra.git
ruby -I sinatra/lib minhaapp.rb
</pre></div>
</div>
</div>

<p>Alternativamente, você pode adicionar o diretório do <code>sinatra/lib</code> no
<code>LOAD_PATH</code> do seu aplicativo:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre><span style="color:#d70">$LOAD_PATH</span>.unshift <span style="color:#036;font-weight:bold">File</span>.dirname(<span style="color:#069">__FILE__</span>) + <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/sinatra/lib</span><span style="color:#710">'</span></span>
require <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">rubygems</span><span style="color:#710">'</span></span>
require <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">sinatra</span><span style="color:#710">'</span></span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/sobre</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">Estou rodando a versão</span><span style="color:#710">"</span></span> + <span style="color:#036;font-weight:bold">Sinatra</span>::<span style="color:#036;font-weight:bold">VERSION</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Para atualizar o código do Sinatra no futuro:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>cd meuprojeto/sinatra
git pull
</pre></div>
</div>
</div>

<a name='Mais'></a>
<h2>Mais</h2>

<ul>
  <li>
<a href="http://www.sinatrarb.com/">Website do Projeto</a> - Documentação
  adicional, novidades e links para outros recursos.</li>
  <li>
<a href="http://www.sinatrarb.com/contributing">Contribuir</a> - Encontrar um
  bug? Precisa de ajuda? Tem um patch?</li>
  <li><a href="http://github.com/sinatra/sinatra/issues">Acompanhar Questões</a></li>
  <li><a href="http://twitter.com/sinatra">Twitter</a></li>
  <li><a href="http://groups.google.com/group/sinatrarb/topics">Lista de Email</a></li>
  <li>
<a href="https://github.com/sinatra/sinatra-book/">Sinatra Book</a> Livro de Receitas</li>
  <li>Documentação da API para a <a href="http://rubydoc.info/gems/sinatra">última release</a>
</li>
  <li>
<a href="irc://chat.freenode.net/#sinatra">IRC: #sinatra</a> em
  <a href="http://freenode.net">freenode.net</a>
</li>
  <li><a href="http://travis-ci.org/sinatra/sinatra">Servidor de CI</a></li>
</ul>
</body></html>
