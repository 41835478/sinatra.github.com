<div class='toc'>
	<ol class='level-1'>
		<li><a href='#/'>/</a></li>
		<ol class='level-2'>
			<li><a href='#Haml'>Haml</a></li>
			<li><a href='#Erb'>Erb</a></li>
			<li><a href='#Erubis'>Erubis</a></li>
			<li><a href='#Builder'>Builder</a></li>
			<li><a href='#Nokogiri'>Nokogiri</a></li>
			<li><a href='#Sass'>Sass</a></li>
			<li><a href='#Scss'>Scss</a></li>
			<li><a href='#Less'>Less</a></li>
			<li><a href='#Liquid'>Liquid</a></li>
			<li><a href='#Markdown'>Markdown</a></li>
			<li><a href='#Textile'>Textile</a></li>
			<li><a href='#RDoc'>RDoc</a></li>
			<li><a href='#Radius'>Radius</a></li>
			<li><a href='#Markaby'>Markaby</a></li>
			<li><a href='#Slim'>Slim</a></li>
			<li><a href='#Creole'>Creole</a></li>
			<li><a href='#CoffeeScript'>CoffeeScript</a></li>
			<li><a href='#Sessions'>Sessions</a></li>
			<li><a href='#URL'>URL</a></li>
		</ol>
		<li><a href='#Rack'>Rack</a></li>
		<li><a href='#Sinatra::Base%20-'>Sinatra::Base -</a></li>
		<ol class='level-2'>
			<li><a href='#vs.'>vs.</a></li>
			<li><a href='#config.ru'>config.ru</a></li>
			<li><a href='#config.ru?'>config.ru?</a></li>
			<li><a href='#Sinatra'>Sinatra</a></li>
			<li><a href='#/'>/</a></li>
			<li><a href='#/'>/</a></li>
			<li><a href='#Bundler'>Bundler</a></li>
	</ol></ol>
</div>


<p>*
*</p>

<p>SinatraRubyweb<a href="http://en.wikipedia.org/wiki/Domain-specific_language">DSL</a></p>

<pre><code class="ruby"># myapp.rb
require &#39;sinatra&#39;

get &#39;/&#39; do
  &#39;Hello world!&#39;
end
</code></pre>

<p>gem</p>

<pre><code class="shell">gem install sinatra
ruby myapp.rb
</code></pre>

<p><a href="http://localhost:4567">localhost:4567</a></p>

<p><code>gem install thin</code>Sinatrathin</p>

<p>SinatraHTTPURL</p>

<pre><code class="ruby">get &#39;/&#39; do
  ..  ..
end

post &#39;/&#39; do
  ..  ..
end

put &#39;/&#39; do
  ..  ..
end

delete &#39;/&#39; do
  ..  ..
end

options &#39;/&#39; do
  ..  ..
end
</code></pre>

<p><code>params</code></p>

<pre><code class="ruby">get &#39;/hello/:name&#39; do
  #  &quot;GET /hello/foo&quot;  &quot;GET /hello/bar&quot;
  # params[:name]  &#39;foo&#39;  &#39;bar&#39;
  &quot;Hello #{params[:name]}!&quot;
end
</code></pre>

<pre><code class="ruby">get &#39;/hello/:name&#39; do |n|
  &quot;Hello #{n}!&quot;
end
</code></pre>

<p><code>params[:splat]</code></p>

<pre><code class="ruby">get &#39;/say/*/to/*&#39; do
  #  /say/hello/to/world
  params[:splat] # =&gt; [&quot;hello&quot;, &quot;world&quot;]
end

get &#39;/download/*.*&#39; do
  #  /download/path/to/file.xml
  params[:splat] # =&gt; [&quot;path/to/file&quot;, &quot;xml&quot;]
end
</code></pre>

<pre><code class="ruby">get %r{/hello/([\w]+)} do
  &quot;Hello, #{params[:captures].first}!&quot;
end
</code></pre>

<pre><code class="ruby">get %r{/hello/([\w]+)} do |c|
  &quot;Hello, #{c}!&quot;
end
</code></pre>

<p>user agent</p>

<pre><code class="ruby">get &#39;/foo&#39;, :agent =&gt; /Songbird (\d\.\d)[\d\/]*?/ do
  &quot;Songbird #{params[:agent][0]}&quot;
end

get &#39;/foo&#39; do
  # Songbird
end
</code></pre>

<p><code>host_name</code>  <code>provides</code></p>

<pre><code class="ruby">get &#39;/&#39;, :host_name =&gt; /^admin\./ do
  &quot;&quot;
end

get &#39;/&#39;, :provides =&gt; &#39;html&#39; do
  haml :index
end

get &#39;/&#39;, :provides =&gt; [&#39;rss&#39;, &#39;atom&#39;, &#39;xml&#39;] do
  builder :feed
end
</code></pre>

<pre><code class="ruby">set(:probability) { |value| condition { rand &lt;= value } }

get &#39;/win_a_car&#39;, :probability =&gt; 0.1 do
  &quot;You won!&quot;
end

get &#39;/win_a_car&#39; do
  &quot;Sorry, you lost.&quot;
end
</code></pre>

<p>HTTP
Rack</p>

<p>Rack Rack
bodyHTTP</p>

<ul>
<li><p>:
<code>[ (Fixnum),  (Hash),  ( #each)]</code></p></li>
<li><p>: <code>[ (Fixnum),  ( #each)]</code></p></li>
<li><p><code>#each</code> </p></li>
<li></li>
</ul>

<pre><code class="ruby">class Stream
  def each
    100.times { |i| yield &quot;#{i}\n&quot; }
  end
end

get(&#39;/&#39;) { Stream.new }
</code></pre>

<p>Sinatra
 :</p>

<pre><code class="ruby">class AllButPattern
  Match = Struct.new(:captures)

  def initialize(except)
    @except   = except
    @captures = Match.new([])
  end

  def match(str)
    @captures unless @except === str
  end
end

def all_but(pattern)
  AllButPattern.new(pattern)
end

get all_but(&quot;/index&quot;) do
  # ...
end
</code></pre>

<p>:</p>

<pre><code class="ruby">get // do
  pass if request.path_info == &quot;/index&quot;
  # ...
end
</code></pre>

<p>:</p>

<pre><code class="ruby">get %r{^(?!/index$)} do
  # ...
end
</code></pre>

<p><code>./public_folder</code> <code>:public</code></p>

<pre><code class="ruby">set :public_folder, File.dirname(__FILE__) + &#39;/static&#39;
</code></pre>

<p>publicURL
<code>./public/css/style.css</code>
<code>http://example.com/css/style.css</code></p>

<a name='/'></a>
<h2>/</h2>

<p><code>./views</code> </p>

<pre><code class="ruby">set :views, File.dirname(__FILE__) + &#39;/templates&#39;
</code></pre>

<p><code>:&#39;subdir/template&#39;</code> </p>

<a name='Haml'></a>
<h3>Haml</h3>

<p><code>haml</code> gem/library HAML </p>

<pre><code class="ruby">#  haml
require &#39;haml&#39;

get &#39;/&#39; do
  haml :index
end
</code></pre>

<p><code>./views/index.haml</code></p>

<p><a href="http://haml.info/docs/yardoc/file.HAML_REFERENCE.html#options">Haml</a>
Sinatra 
<a href="http://www.sinatrarb.com/configuration.html"></a></p>

<pre><code class="ruby">set :haml, {:format =&gt; :html5 } # Haml :xhtml

get &#39;/&#39; do
  haml :index, :haml_options =&gt; {:format =&gt; :html4 } # :html4
end
</code></pre>

<a name='Erb'></a>
<h3>Erb</h3>

<pre><code class="ruby">#  erb
require &#39;erb&#39;

get &#39;/&#39; do
  erb :index
end
</code></pre>

<p><code>./views/index.erb</code></p>

<a name='Erubis'></a>
<h3>Erubis</h3>

<p><code>erubis</code> gem/library erubis </p>

<pre><code class="ruby">#  erubis
require &#39;erubis&#39;

get &#39;/&#39; do
  erubis :index
end
</code></pre>

<p><code>./views/index.erubis</code></p>

<p>ErubisErb:</p>

<pre><code class="ruby">require &#39;erubis&#39;
Tilt.register :erb, Tilt[:erubis]

get &#39;/&#39; do
  erb :index
end
</code></pre>

<p>Erubis <code>./views/index.erb</code></p>

<a name='Builder'></a>
<h3>Builder</h3>

<p><code>builder</code> gem/library  builder templates</p>

<pre><code class="ruby"># builder
require &#39;builder&#39;

get &#39;/&#39; do
  builder :index
end
</code></pre>

<p><code>./views/index.builder</code></p>

<a name='Nokogiri'></a>
<h3>Nokogiri</h3>

<p><code>nokogiri</code> gem/library  nokogiri </p>

<pre><code class="ruby">#  nokogiri
require &#39;nokogiri&#39;

get &#39;/&#39; do
  nokogiri :index
end
</code></pre>

<p><code>./views/index.nokogiri</code></p>

<a name='Sass'></a>
<h3>Sass</h3>

<p><code>haml</code>  <code>sass</code> gem/library  Sass </p>

<pre><code class="ruby">#  haml  sass
require &#39;sass&#39;

get &#39;/stylesheet.css&#39; do
  sass :stylesheet
end
</code></pre>

<p><code>./views/stylesheet.sass</code></p>

<p><a href="http://sass-lang.com/docs/yardoc/file.SASS_REFERENCE.html#options">Sass
</a>
Sinatra 
<a href="http://www.sinatrarb.com/configuration.html"></a>,</p>

<pre><code class="ruby">set :sass, {:style =&gt; :compact } #  Sass  :nested

get &#39;/stylesheet.css&#39; do
  sass :stylesheet, :style =&gt; :expanded # 
end
</code></pre>

<a name='Scss'></a>
<h3>Scss</h3>

<p><code>haml</code>  <code>sass</code> gem/library  Scss templates</p>

<pre><code class="ruby">#  haml  sass
require &#39;sass&#39;

get &#39;/stylesheet.css&#39; do
  scss :stylesheet
end
</code></pre>

<p><code>./views/stylesheet.scss</code></p>

<p><a href="http://sass-lang.com/docs/yardoc/file.SASS_REFERENCE.html#options">Scss</a>
Sinatra 
<a href="http://www.sinatrarb.com/configuration.html"></a>,</p>

<pre><code class="ruby">set :scss, :style =&gt; :compact # default Scss style is :nested

get &#39;/stylesheet.css&#39; do
  scss :stylesheet, :style =&gt; :expanded # overridden
end
</code></pre>

<a name='Less'></a>
<h3>Less</h3>

<p><code>less</code> gem/library  Less </p>

<pre><code class="ruby">#  less
require &#39;less&#39;

get &#39;/stylesheet.css&#39; do
  less :stylesheet
end
</code></pre>

<p><code>./views/stylesheet.less</code></p>

<a name='Liquid'></a>
<h3>Liquid</h3>

<p><code>liquid</code> gem/library  Liquid </p>

<pre><code class="ruby">#  liquid
require &#39;liquid&#39;

get &#39;/&#39; do
  liquid :index
end
</code></pre>

<p><code>./views/index.liquid</code></p>

<p>Liquid  Ruby  ( <code>yield</code>) 
locals</p>

<pre><code class="ruby">liquid :index, :locals =&gt; { :key =&gt; &#39;value&#39; }
</code></pre>

<a name='Markdown'></a>
<h3>Markdown</h3>

<p><code>rdiscount</code> gem/library  Markdown </p>

<pre><code class="ruby"># rdiscount
require &quot;rdiscount&quot;

get &#39;/&#39; do
  markdown :index
end
</code></pre>

<p><code>./views/index.markdown</code> (<code>md</code>  <code>mkd</code> )</p>

<p>markdown locals</p>

<pre><code class="ruby">erb :overview, :locals =&gt; { :text =&gt; markdown(:introduction) }
</code></pre>

<p>markdown </p>

<pre><code class="ruby">%h1 Hello From Haml!
%p= markdown(:greetings)
</code></pre>

<p>MarkdownRubyMarkdown</p>

<p><code>:layout_engine</code>:</p>

<pre><code class="ruby">get &#39;/&#39; do
  markdown :index, :layout_engine =&gt; :erb
end
</code></pre>

<p><code>./views/index.md</code>  <code>./views/layout.erb</code> </p>

<p>:</p>

<pre><code class="ruby">set :markdown, :layout_engine =&gt; :haml, :layout =&gt; :post

get &#39;/&#39; do
  markdown :index
end
</code></pre>

<p><code>./views/index.markdown</code> ( Markdown ) 
<code>./views/post.haml</code> .</p>

<p>BlueClothRDiscountMarkdown:</p>

<pre><code class="ruby">require &#39;bluecloth&#39;

Tilt.register &#39;markdown&#39;, BlueClothTemplate
Tilt.register &#39;mkd&#39;,      BlueClothTemplate
Tilt.register &#39;md&#39;,       BlueClothTemplate

get &#39;/&#39; do
  markdown :index
end
</code></pre>

<p>BlueCloth <code>./views/index.md</code> </p>

<a name='Textile'></a>
<h3>Textile</h3>

<p><code>RedCloth</code> gem/library  Textile </p>

<pre><code class="ruby"># redcloth
require &quot;redcloth&quot;

get &#39;/&#39; do
  textile :index
end
</code></pre>

<p><code>./views/index.textile</code></p>

<p>textile locals</p>

<pre><code class="ruby">erb :overview, :locals =&gt; { :text =&gt; textile(:introduction) }
</code></pre>

<p><code>textile</code></p>

<pre><code class="ruby">%h1 Hello From Haml!
%p= textile(:greetings)
</code></pre>

<p>TextileRubyTextile</p>

<p><code>:layout_engine</code>:</p>

<pre><code class="ruby">get &#39;/&#39; do
  textile :index, :layout_engine =&gt; :erb
end
</code></pre>

<p><code>./views/index.textile</code>  <code>./views/layout.erb</code></p>

<p>:</p>

<pre><code class="ruby">set :textile, :layout_engine =&gt; :haml, :layout =&gt; :post

get &#39;/&#39; do
  textile :index
end
</code></pre>

<p><code>./views/index.textile</code> ( Textile ) 
<code>./views/post.haml</code> .</p>

<a name='RDoc'></a>
<h3>RDoc</h3>

<p><code>RDoc</code> gem/library RDoc</p>

<pre><code class="ruby"># rdoc/markup/to_html
require &quot;rdoc&quot;
require &quot;rdoc/markup/to_html&quot;

get &#39;/&#39; do
  rdoc :index
end
</code></pre>

<p><code>./views/index.rdoc</code></p>

<p>rdoclocals</p>

<pre><code class="ruby">erb :overview, :locals =&gt; { :text =&gt; rdoc(:introduction) }
</code></pre>

<p><code>rdoc</code></p>

<pre><code class="ruby">%h1 Hello From Haml!
%p= rdoc(:greetings)
</code></pre>

<p>RDocRubyRDoc</p>

<p><code>:layout_engine</code>:</p>

<pre><code class="ruby">get &#39;/&#39; do
  rdoc :index, :layout_engine =&gt; :erb
end
</code></pre>

<p><code>./views/index.rdoc</code>  <code>./views/layout.erb</code> </p>

<p>:</p>

<pre><code class="ruby">set :rdoc, :layout_engine =&gt; :haml, :layout =&gt; :post

get &#39;/&#39; do
  rdoc :index
end
</code></pre>

<p><code>./views/index.rdoc</code> ( RDoc ) 
<code>./views/post.haml</code> .</p>

<a name='Radius'></a>
<h3>Radius</h3>

<p><code>radius</code> gem/library  Radius </p>

<pre><code class="ruby"># radius
require &#39;radius&#39;

get &#39;/&#39; do
  radius :index
end
</code></pre>

<p><code>./views/index.radius</code></p>

<p>Radius  Ruby  ( <code>yield</code>) 
locals</p>

<pre><code class="ruby">radius :index, :locals =&gt; { :key =&gt; &#39;value&#39; }
</code></pre>

<a name='Markaby'></a>
<h3>Markaby</h3>

<p><code>markaby</code> gem/libraryMarkaby</p>

<pre><code class="ruby"># markaby
require &#39;markaby&#39;

get &#39;/&#39; do
  markaby :index
end
</code></pre>

<p><code>./views/index.mab</code></p>

<p>Markaby:</p>

<pre><code class="ruby">get &#39;/&#39; do
  markaby { h1 &quot;Welcome!&quot; }
end
</code></pre>

<a name='Slim'></a>
<h3>Slim</h3>

<p><code>slim</code> gem/library  Slim </p>

<pre><code class="ruby">#  slim
require &#39;slim&#39;

get &#39;/&#39; do
  slim :index
end
</code></pre>

<p><code>./views/index.slim</code></p>

<a name='Creole'></a>
<h3>Creole</h3>

<p><code>creole</code> gem/library  Creole </p>

<pre><code class="ruby">#  creole
require &#39;creole&#39;

get &#39;/&#39; do
  creole :index
end
</code></pre>

<p><code>./views/index.creole</code></p>

<a name='CoffeeScript'></a>
<h3>CoffeeScript</h3>

<p><code>coffee-script</code> gem/library 
Javascript:</p>

<ul>
<li><p><code>node</code> ( Node.js) </p></li>
<li><p>OSX</p></li>
<li><p><code>therubyracer</code> gem/library</p></li>
</ul>

<p><a href="http://github.com/josh/ruby-coffee-script">github.com/josh/ruby-coffee-script</a></p>

<p>CoffeeScript :</p>

<pre><code class="ruby"># coffee-script
require &#39;coffee-script&#39;

get &#39;/application.js&#39; do
  coffee :application
end
</code></pre>

<p><code>./views/application.coffee</code></p>

<pre><code class="ruby">get &#39;/&#39; do
  haml &#39;%div.title Hello World&#39;
end
</code></pre>

<pre><code class="ruby">get &#39;/:id&#39; do
  @foo = Foo.find(params[:id])
  haml &#39;%h1= @foo.name&#39;
end
</code></pre>

<pre><code class="ruby">get &#39;/:id&#39; do
  foo = Foo.find(params[:id])
  haml &#39;%h1= foo.name&#39;, :locals =&gt; { :foo =&gt; foo }
end
</code></pre>

<pre><code class="ruby">require &#39;sinatra&#39;

get &#39;/&#39; do
  haml :index
end

__END__

@@ layout
%html
  = yield

@@ index
%div.title Hello world!!!!!
</code></pre>

<p>sinatra</p>

<p><code>enable :inline_templates</code></p>

<p><code>template</code> </p>

<pre><code class="ruby">template :layout do
  &quot;%html\n  =yield\n&quot;
end

template :index do
  &#39;%div.title Hello World!&#39;
end

get &#39;/&#39; do
  haml :index
end
</code></pre>

<p>layout
 <code>:layout =&gt; false</code>
<code>set :haml, :layout =&gt; false</code></p>

<pre><code class="ruby">get &#39;/&#39; do
  haml :index, :layout =&gt; !request.xhr?
end
</code></pre>

<p><code>Tilt.register</code> <code>tt</code>
Textile:</p>

<pre><code class="ruby">Tilt.register :tt, Tilt[:textile]
</code></pre>

<p>Tilt:</p>

<pre><code class="ruby">Tilt.register :myat, MyAwesomeTemplateEngine

helpers do
  def myat(*args) render(:myat, *args) end
end

get &#39;/&#39; do
  myat :index
end
</code></pre>

<p><code>./views/index.myat</code>
<a href="https://github.com/rtomayko/tilt">github.com/rtomayko/tilt</a>
Tilt.</p>

<pre><code class="ruby">before do
  @note = &#39;Hi!&#39;
  request.path_info = &#39;/foo/bar/baz&#39;
end

get &#39;/foo/*&#39; do
  @note #=&gt; &#39;Hi!&#39;
  params[:splat] #=&gt; &#39;bar/baz&#39;
end
</code></pre>

<pre><code class="ruby">after do
  puts response.status
end
</code></pre>

<p><code>body</code> </p>

<pre><code class="ruby">before &#39;/protected/*&#39; do
  authenticate!
end

after &#39;/create/:slug&#39; do |slug|
  session[:last_slug] = slug
end
</code></pre>

<p>:</p>

<pre><code class="ruby">before :agent =&gt; /Songbird/ do
  # ...
end

after &#39;/blog/*&#39;, :host_name =&gt; &#39;example.com&#39; do
  # ...
end
</code></pre>

<p><code>helpers</code>  </p>

<pre><code class="ruby">helpers do
  def bar(name)
    &quot;#{name}bar&quot;
  end
end

get &#39;/:name&#39; do
  bar(params[:name])
end
</code></pre>

<a name='Sessions'></a>
<h3>Sessions</h3>

<p>Session
session:</p>

<pre><code class="ruby">enable :sessions

get &#39;/&#39; do
  &quot;value = &quot; &lt;&lt; session[:value].inspect
end

get &#39;/:value&#39; do
  session[:value] = params[:value]
end
</code></pre>

<p><code>enable :sessions</code> cookie</p>

<p>Rack session **
<code>enable :sessions</code> </p>

<pre><code class="ruby">use Rack::Session::Pool, :expire_after =&gt; 2592000

get &#39;/&#39; do
  &quot;value = &quot; &lt;&lt; session[:value].inspect
end

get &#39;/:value&#39; do
  session[:value] = params[:value]
end
</code></pre>

<pre><code class="ruby">halt
</code></pre>

<pre><code class="ruby">halt 410
</code></pre>

<pre><code class="ruby">halt &#39;this will be the body&#39;
</code></pre>

<p>;</p>

<pre><code class="ruby">halt 401, &#39;go away!&#39;
</code></pre>

<pre><code class="ruby">halt 402, {&#39;Content-Type&#39; =&gt; &#39;text/plain&#39;}, &#39;revenge&#39;
</code></pre>

<p><code>pass</code></p>

<pre><code class="ruby">get &#39;/guess/:who&#39; do
  pass unless params[:who] == &#39;Frank&#39;
  &#39;You got me!&#39;
end

get &#39;/guess/*&#39; do
  &#39;You missed!&#39;
end
</code></pre>

<p>404</p>

<p><code>pass</code> 
 <code>call</code> :</p>

<pre><code class="ruby">get &#39;/foo&#39; do
  status, headers, body = call env.merge(&quot;PATH_INFO&quot; =&gt; &#39;/bar&#39;)
  [status, headers, body.map(&amp;:upcase)]
end

get &#39;/bar&#39; do
  &quot;bar&quot;
end
</code></pre>

<pre><code>&lt;tt&gt;&quot;bar&quot;&lt;/tt&gt;&lt;tt&gt;/foo&lt;/tt&gt;
</code></pre>

<p><code>/bar</code>helper</p>

<p><code>call!</code> 
<code>call</code>.</p>

<p>Rack specification  <code>call</code>.</p>

<p><code>body</code><br>
:</p>

<pre><code class="ruby">get &#39;/foo&#39; do
  body &quot;bar&quot;
end

after do
  puts body
end
</code></pre>

<p><code>body</code>Rack
streaming</p>

<p>:</p>

<pre><code class="ruby">get &#39;/foo&#39; do
  status 418
  headers \
    &quot;Allow&quot;   =&gt; &quot;BREW, POST, GET, PROPFIND, WHEN&quot;,
    &quot;Refresh&quot; =&gt; &quot;Refresh: 20; http://www.ietf.org/rfc/rfc2324.txt&quot;
  body &quot;I&#39;m a tea pot!&quot;
end
</code></pre>

<p><code>body</code>,  <code>headers</code>  <code>status</code> 
.</p>

<p><code>send_file</code> 
Sinatra <code>mime_type</code> </p>

<pre><code class="ruby">mime_type :foo, &#39;text/foo&#39;
</code></pre>

<p><code>content_type</code> </p>

<pre><code class="ruby">get &#39;/&#39; do
  content_type :foo
  &quot;foo foo foo&quot;
end
</code></pre>

<a name='URL'></a>
<h3>URL</h3>

<p>URL <code>url</code>  Haml:</p>

<pre><code class="ruby">%a{:href =&gt; url(&#39;/foo&#39;)} foo
</code></pre>

<p>RackURL</p>

<p><code>to</code> ().</p>

<p><code>redirect</code> :</p>

<pre><code class="ruby">get &#39;/foo&#39; do
  redirect to(&#39;/bar&#39;)
end
</code></pre>

<p><code>halt</code>:</p>

<pre><code class="ruby">redirect to(&#39;/bar&#39;), 303
redirect &#39;http://google.com&#39;, &#39;wrong place, buddy&#39;
</code></pre>

<p><code>redirect back</code>:</p>

<pre><code class="ruby">get &#39;/foo&#39; do
  &quot;&lt;a href=&#39;/bar&#39;&gt;do something&lt;/a&gt;&quot;
end

get &#39;/bar&#39; do
  do_something
  redirect back
end
</code></pre>

<p>redirectquery:</p>

<pre><code class="ruby">redirect to(&#39;/bar?sum=42&#39;)
</code></pre>

<p>session:</p>

<pre><code class="ruby">enable :sessions

get &#39;/foo&#39; do
  session[:secret] = &#39;foo&#39;
  redirect to(&#39;/bar&#39;)
end

get &#39;/bar&#39; do
  session[:secret]
end
</code></pre>

<p>HTTP</p>

<p>Cache-Control :</p>

<pre><code class="ruby">get &#39;/&#39; do
  cache_control :public
  &quot;cache it!&quot;
end
</code></pre>

<p>: .</p>

<pre><code class="ruby">before do
  cache_control :public, :must_revalidate, :max_age =&gt; 60
end
</code></pre>

<p><code>expires</code>  <code>Cache-Control</code></p>

<pre><code class="ruby">before do
  expires 500, :public, :must_revalidate
end
</code></pre>

<p><code>etag</code>  <code>last_modified</code>.
**helpers</p>

<pre><code class="ruby">get &#39;/article/:id&#39; do
  @article = Article.find params[:id]
  last_modified @article.updated_at
  etag @article.sha1
  erb :article
end
</code></pre>

<p><a href="http://en.wikipedia.org/wiki/HTTP_ETag#Strong_and_weak_validation">weak
ETag</a>
:</p>

<pre><code class="ruby">etag @article.sha1, :weak
</code></pre>

<p><a href="https://github.com/rtomayko/rack-cache">rack-cache</a>:</p>

<pre><code class="ruby">require &quot;rack/cache&quot;
require &quot;sinatra&quot;

use Rack::Cache

get &#39;/&#39; do
  cache_control :public, :max_age =&gt; 36000
  sleep 5
  &quot;hello&quot;
end
</code></pre>

<p><code>send_file</code> :</p>

<pre><code class="ruby">get &#39;/&#39; do
  send_file &#39;foo.png&#39;
end
</code></pre>

<p>:</p>

<pre><code class="ruby">send_file &#39;foo.png&#39;, :type =&gt; :jpg
</code></pre>

<p>:</p>

<dl>
    <dt>filename</dt>
    <dd></dd>

    <dt>last_modified</dt>
    <dd>Last-Modified mtime</dd>

    <dt>type</dt>
    <dd></dd>

    <dt>disposition</dt>
    <dd>
         Content-Disposition <tt>nil</tt> (), <tt>:attachment</tt> 
        <tt>:inline</tt>
    </dd>

    <dt>length</dt>
    <dd>Content-Length </dd>
</dl>

<p>RackRubystreaming
 Sinatrarange</p>

<p><code>request</code></p>

<pre><code class="ruby">#  http://example.com/example 
get &#39;/foo&#39; do
  request.body              # 
  request.scheme            # &quot;http&quot;
  request.script_name       # &quot;/example&quot;
  request.path_info         # &quot;/foo&quot;
  request.port              # 80
  request.request_method    # &quot;GET&quot;
  request.query_string      # &quot;&quot;
  request.content_length    # request.body
  request.media_type        # request.body
  request.host              # &quot;example.com&quot;
  request.get?              # true ()
  request.form_data?        # false
  request[&quot;SOME_HEADER&quot;]    # SOME_HEADER header
  request.referrer          # referrer  &#39;/&#39;
  request.user_agent        # user agent ( :agent )
  request.cookies           #  cookies 
  request.xhr?              # ajax
  request.url               # &quot;http://example.com/example/foo&quot;
  request.path              # &quot;/example/foo&quot;
  request.ip                # IP
  request.secure?           # falsessltrue
  request.forwarded?        # true 
  request.env               # Rackenv
end
</code></pre>

<p><code>script_name</code>  <code>path_info</code> </p>

<pre><code class="ruby">before { request.path_info = &quot;/&quot; }

get &quot;/&quot; do
  &quot;all requests end up here&quot;
end
</code></pre>

<p><code>request.body</code> IOStringIO</p>

<pre><code class="ruby">post &quot;/api&quot; do
  request.body.rewind  # 
  data = JSON.parse request.body.read
  &quot;Hello #{data[&#39;name&#39;]}!&quot;
end
</code></pre>

<p><code>attachment</code> </p>

<pre><code class="ruby">get &#39;/&#39; do
  attachment
  &quot;store it!&quot;
end
</code></pre>

<p>:</p>

<pre><code class="ruby">get &#39;/&#39; do
  attachment &quot;info.txt&quot;
  &quot;store it!&quot;
end
</code></pre>

<p><code>find_template</code> :</p>

<pre><code class="ruby">find_template settings.views, &#39;foo&#39;, Tilt[:haml] do |file|
  puts &quot;could be #{file}&quot;
end
</code></pre>

<p>:</p>

<pre><code class="ruby">set :views, [&#39;views&#39;, &#39;templates&#39;]

helpers do
  def find_template(views, name, engine, &amp;block)
    Array(views).each { |v| super(v, name, engine, &amp;block) }
  end
end
</code></pre>

<p>:</p>

<pre><code class="ruby">set :views, :sass =&gt; &#39;views/sass&#39;, :haml =&gt; &#39;templates&#39;, :default =&gt; &#39;views&#39;

helpers do
  def find_template(views, name, engine, &amp;block)
    _, folder = views.detect { |k,v| engine == Tilt[k] }
    folder ||= views[:default]
    super(folder, name, engine, &amp;block)
  end
end
</code></pre>

<p><code>find_template</code> </p>

<p><code>render</code>  <code>break</code> 
development mode</p>

<pre><code class="ruby">configure do
  # setting one option
  set :option, &#39;value&#39;

  # setting multiple options
  set :a =&gt; 1, :b =&gt; 2

  # same as `set :option, true`
  enable :option

  # same as `set :option, false`
  disable :option

  # you can also have dynamic settings with blocks
  set(:css_dir) { File.join(views, &#39;css&#39;) }
end
</code></pre>

<p>(RACK_ENV environment )  <code>:production</code></p>

<pre><code class="ruby">configure :production do
  ...
end
</code></pre>

<p><code>:production</code>  <code>:test</code></p>

<pre><code class="ruby">configure :production, :test do
  ...
end
</code></pre>

<p><code>settings</code> :</p>

<pre><code class="ruby">configure do
  set :foo, &#39;bar&#39;
end

get &#39;/&#39; do
  settings.foo? # =&gt; true
  settings.foo  # =&gt; &#39;bar&#39;
  ...
end
</code></pre>

<dl>
    <dt>absolute_redirects</dt>
    <dd>
        <p>
            Sinatra Sinatra
            RFC 2616 (HTTP 1.1), 

        <p>
            
             <tt>url</tt>   URL
            <tt>false</tt> 

        <p>
            
    </dd>

    <dt>add_charsets</dt>
    <dd>
        <p>
             <tt>content_type</tt>  
        </p>

        <p>
            :
            <tt>settings.add_charsets << "application/foobar"</tt>
        </p>
    </dd>

    <dt>app_file</dt>
    <dd>
         viewspublic
    </dd>

    <dt>bind</dt>
    <dd>
        IP  (: 0.0.0.0) 
    </dd>

    <dt>default_encoding</dt>
    <dd>
         ( <tt>"utf-8"</tt>)
    </dd>

    <dt>dump_errors</dt>
    <dd>
        log
    </dd>

    <dt>environment</dt>
    <dd>
         <tt>ENV['RACK_ENV']</tt>  <tt>"development"</tt> 
    </dd>

    <dt>logging</dt>
    <dd>
        logger
    </dd>

    <dt>lock</dt>
    <dd>
        <p>
             
        </p>

        <p>
             
        </p>
    </dd>

    <dt>method_override</dt>
    <dd>
         <tt>_method</tt>   put/delete 
    </dd>

    <dt>port</dt>
    <dd>
        
    </dd>

    <dt>prefixed_redirects</dt>
    <dd>
         <tt>request.script_name</tt> 
         <tt>redirect '/foo'</tt> 
        <tt>redirect to('/foo')</tt>
    </dd>

    <dt>public_folder</dt>
    <dd>
        public
    </dd>

    <dt>reload_templates</dt>
    <dd>
         development mode Ruby 1.8.6
         Rubybug
    </dd>

    <dt>root</dt>
    <dd>
        
    </dd>

    <dt>raise_errors</dt>
    <dd>
        
    </dd>

    <dt>run</dt>
    <dd>
        Sinatraweb rackup
    </dd>

    <dt>running</dt>
    <dd>
         
    </dd>

    <dt>server</dt>
    <dd>
          [thin, mongrel, webrick],
         
    </dd>

    <dt>sessions</dt>
    <dd>
        cookiesesson
    </dd>

    <dt>show_exceptions</dt>
    <dd>
        stack trace
    </dd>

    <dt>static</dt>
    <dd>
        Sinatra  
        
    </dd>

    <dt>views</dt>
    <dd>
        views 
    </dd>
</dl>

<p><code>haml</code>, <code>erb</code>, <code>halt</code></p>

<p><code>Sinatra::NotFound</code> 
404<code>not_found</code> </p>

<pre><code class="ruby">not_found do
  &#39;This is nowhere to be found&#39;
end
</code></pre>

<p><code>error</code> 
<code>sinatra.error</code> Rack </p>

<pre><code class="ruby">error do
  &#39;Sorry there was a nasty error - &#39; + env[&#39;sinatra.error&#39;].name
end
</code></pre>

<pre><code class="ruby">error MyCustomError do
  &#39;So what happened was...&#39; + env[&#39;sinatra.error&#39;].message
end
</code></pre>

<pre><code class="ruby">get &#39;/&#39; do
  raise MyCustomError, &#39;something bad&#39;
end
</code></pre>

<pre><code>So what happened was... something bad
</code></pre>

<pre><code class="ruby">error 403 do
  &#39;Access forbidden&#39;
end

get &#39;/secret&#39; do
  403
end
</code></pre>

<pre><code class="ruby">error 400..510 do
  &#39;Boom&#39;
end
</code></pre>

<p>developmentSinatra <code>not_found</code>  <code>error</code></p>

<a name='Rack'></a>
<h2>Rack</h2>

<p>Sinatra  <a href="http://rack.rubyforge.org/">Rack</a>, Ruby
web
Rack
 / HTTP/ </p>

<p>Sinatra Rack  <code>use</code> </p>

<pre><code class="ruby">require &#39;sinatra&#39;
require &#39;my_custom_middleware&#39;

use Rack::Lint
use MyCustomMiddleware

get &#39;/hello&#39; do
  &#39;Hello World&#39;
end
</code></pre>

<p><code>use</code> 
<a href="http://rack.rubyforge.org/doc/classes/Rack/Builder.html">Rack::Builder</a>
DSL(rack)<code>use</code> 
/ </p>

<pre><code class="ruby">use Rack::Auth::Basic do |username, password|
  username == &#39;admin&#39; &amp;&amp; password == &#39;secret&#39;
end
</code></pre>

<p>Rack
URLsession Sinatra
 <code>use</code> </p>

<p>SinatraRack
<a href="http://gitrdoc.com/brynary/rack-test">Rack::Test</a> </p>

<pre><code class="ruby">require &#39;my_sinatra_app&#39;
require &#39;test/unit&#39;
require &#39;rack/test&#39;

class MyAppTest &lt; Test::Unit::TestCase
  include Rack::Test::Methods

  def app
    Sinatra::Application
  end

  def test_my_default
    get &#39;/&#39;
    assert_equal &#39;Hello World!&#39;, last_response.body
  end

  def test_with_params
    get &#39;/meet&#39;, :name =&gt; &#39;Frank&#39;
    assert_equal &#39;Hello Frank!&#39;, last_response.body
  end

  def test_with_rack_env
    get &#39;/&#39;, {}, &#39;HTTP_USER_AGENT&#39; =&gt; &#39;Songbird&#39;
    assert_equal &quot;You&#39;re using Songbird!&quot;, last_response.body
  end
end
</code></pre>

<p>:  Sinatra::Test  Sinatra::TestHarness   0.9.2</p>

<a name='Sinatra::Base%20-'></a>
<h2>Sinatra::Base -</h2>

<p>RackRails
metal
SinatraDSLObject
 (,  ./public 
./views   Sinatra::Base</p>

<pre><code class="ruby">require &#39;sinatra/base&#39;

class MyApp &lt; Sinatra::Base
  set :sessions, true
  set :foo, &#39;bar&#39;

  get &#39;/&#39; do
    &#39;Hello world!&#39;
  end
end
</code></pre>

<p>Sinatra::Base DSL 
Sinatra::Base</p>

<ul>
<li><p><code>sinatra/base</code>  <code>sinatra</code>;
Sinatra DSL  </p></li>
<li><p>Sinatra::Base</p></li>
</ul>

<p><code>+Sinatra::Base+</code> </p>

<p><a href="http://sinatra.github.com/configuration.html"></a></p>

<a name='vs.'></a>
<h3>vs.</h3>

<p>:</p>

<ul>
<li><p>RubySinatra</p></li>
<li><p>Object<br>
library/gem</p></li>
</ul>

<p>settings :</p>

<pre><code>Setting             Classic                 Modular

app_file            file loading sinatra    nil
run                 $0 == app_file          false
logging             true                    false
method_override     true                    false
inline_templates    true                    false
</code></pre>

<p><code>run!</code>:</p>

<pre><code class="ruby"># my_app.rb
require &#39;sinatra/base&#39;

class MyApp &lt; Sinatra::Base
  # ... app code here ...

  # start the server if ruby file executed directly
  run! if app_file == $0
end
</code></pre>

<p>:</p>

<pre><code>ruby my_app.rb
</code></pre>

<p><code>config.ru</code>Rack:</p>

<pre><code class="ruby"># config.ru
require &#39;./my_app&#39;
run MyApp
</code></pre>

<p>:</p>

<pre><code>rackup -p 4567
</code></pre>

<a name='config.ru'></a>
<h3>config.ru</h3>

<p>:</p>

<pre><code class="ruby"># app.rb
require &#39;sinatra&#39;

get &#39;/&#39; do
  &#39;Hello world!&#39;
end
</code></pre>

<p><code>config.ru</code>:</p>

<pre><code class="ruby">require &#39;./app&#39;
run Sinatra::Application
</code></pre>

<a name='config.ru?'></a>
<h3>config.ru?</h3>

<p><code>config.ru</code>:</p>

<ul>
<li><p>Rack  (Passenger, Unicorn, Heroku, ).</p></li>
<li><p><code>Sinatra::Base</code>.</p></li>
<li><p>Sinatra</p></li>
</ul>

<p><strong><code>config.ru</code>
  <code>config.ru</code>.</strong></p>

<a name='Sinatra'></a>
<h3>Sinatra</h3>

<p>SinatraRackSinatra
Rack
SinatraRack
(Rails/Ramaze/Camping/)</p>

<pre><code class="ruby">require &#39;sinatra/base&#39;

class LoginScreen &lt; Sinatra::Base
  enable :sessions

  get(&#39;/login&#39;) { haml :login }

  post(&#39;/login&#39;) do
    if params[:name] = &#39;admin&#39; and params[:password] = &#39;admin&#39;
      session[&#39;user_name&#39;] = params[:name]
    else
      redirect &#39;/login&#39;
    end
  end
end

class MyApp &lt; Sinatra::Base
  # 
  use LoginScreen

  before do
    unless session[&#39;user_name&#39;]
      halt &quot;Access denied, please &lt;a href=&#39;/login&#39;&gt;login&lt;/a&gt;.&quot;
    end
  end

  get(&#39;/&#39;) { &quot;Hello #{session[&#39;user_name&#39;]}.&quot; }
end
</code></pre>

<a name='/'></a>
<h3>/</h3>

<p>SinatraSinatra::Base
DSL(<code>require &#39;sinatra&#39;</code>)
Sinatra::Application
 `get`  `before`
`request`  `session`, </p>

<p>`set` </p>

<pre><code class="ruby">class MyApp &lt; Sinatra::Base
  # 
  set :foo, 42
  foo # =&gt; 42

  get &#39;/foo&#39; do
    # 
  end
end
</code></pre>

<ul>
<li></li>
<li></li>
<li><p>`helpers` </p></li>
<li><p>`set`/</p></li>
<li><p>(<code>configure { |c| ... }</code>)</p></li>
<li><p>`settings`</p></li>
</ul>

<a name='/'></a>
<h3>/</h3>

<p>`request`  `session`  `erb` 
`haml``settings`</p>

<pre><code class="ruby">class MyApp &lt; Sinatra::Base
  # !
  get &#39;/define_route/:name&#39; do
    #  &#39;/define_route/:name&#39; 
    @value = 42

    settings.get(&quot;/#{params[:name]}&quot;) do
      #  &quot;/#{params[:name]}&quot; 
      @value # =&gt; nil ()
    end

    &quot;Route defined!&quot;
  end
end
</code></pre>

<ul>
<li><p>get/head/post/put/delete </p></li>
<li><p>/ </p></li>
<li></li>
<li><p>/</p></li>
</ul>

<p>100%, :</p>

<p>/( `self`)</p>

<p><code>Sinatra::Delegator.delegate :method_name</code></p>

<ul>
<li><p><code>require &quot;sinatra&quot;</code></p></li>
<li><p>`Sinatra::Delegator` mixin</p></li>
</ul>

<p>: <a href="http://github.com/sinatra/sinatra/blob/ceac46f0bc129a6e994a06100aa854f606fe5992/lib/sinatra/base.rb#L1128">Sinatra::Delegator
mixin</a></p>

<p><a href="http://github.com/sinatra/sinatra/blob/ceac46f0bc129a6e994a06100aa854f606fe5992/lib/sinatra/main.rb#L28"></a></p>

<p>Sinatra </p>

<pre><code>ruby myapp.rb [-h] [-x] [-e ENVIRONMENT] [-p PORT] [-o HOST] [-s HANDLER]



-h # help
-p #  ( 4567)
-o #  ( 0.0.0.0)
-e #  ( development)
-s #  rack / ( thin)
-x #  ( off)
</code></pre>

<p>Ruby 1.8.7, 1.9.2, JRuby  Rubinius Sinatra</p>

<p>Ruby:</p>

<dl>
    <dt>Ruby 1.8.6</dt>
    <dd>
        1.8.6Sinatra Sinatra
        1.3.0 RDoc 
        CoffeScriptRuby
        1.8.6Hash
        1.1.1Sinatra
        Rack1.1.x
        Rack \>= 1.21.8.6
    </dd>

    <dt>Ruby 1.8.7</dt>
    <dd>
        1.8.7   1.9.2
         JRuby  Rubinius.
    </dd>

    <dt>Ruby 1.9.2</dt>
    <dd>
        1.9.2  Radius  Markaby 1.9
        1.9.2p0,  segmentation faults.
    </dd>

    <dt>Rubinius</dt>
    <dd>
        Rubinius  (Rubinius \>= 1.2.2) Textile
    </dd>

    <dt>JRuby</dt>
    <dd>
        JRuby  (JRuby \>= 1.5.6) 
        JRubyJRuby rack   Thin web
        JRuby
    </dd>
</dl>

<p>Ruby</p>

<p>Ruby   Sinatra:</p>

<ul>
<li><p>JRuby  Rubinius </p></li>
<li><p>MacRuby</p></li>
<li><p>Maglev</p></li>
<li><p>IronRuby</p></li>
<li><p>Ruby 1.9.0 and 1.9.1</p></li>
</ul>

<p>SinatraRuby</p>

<p>Sinatra  master</p>

<pre><code>cd myapp
git clone git://github.com/sinatra/sinatra.git
ruby -Isinatra/lib myapp.rb
</code></pre>

<p>gems</p>

<pre><code>gem install sinatra --pre
</code></pre>

<a name='Bundler'></a>
<h3>Bundler</h3>

<p>Sinatra
<a href="http://gembundler.com/">Bundler</a> </p>

<p>bundler:</p>

<pre><code>gem install bundler
</code></pre>

<p><code>Gemfile</code>:</p>

<pre><code class="ruby">source :rubygems
gem &#39;sinatra&#39;, :git =&gt; &quot;git://github.com/sinatra/sinatra.git&quot;

# 
gem &#39;haml&#39;                    # haml
gem &#39;activerecord&#39;, &#39;~&gt; 3.0&#39;  #  ActiveRecord 3.x
</code></pre>

<p>Sinatra
(Rack and Tilt)  Bundler</p>

<p>:</p>

<pre><code>bundle exec ruby myapp.rb
</code></pre>

<p><code>sinatra/lib</code><br>
<code>$LOAD_PATH</code>:</p>

<pre><code>cd myapp
git clone git://github.com/sinatra/sinatra.git
ruby -Isinatra/lib myapp.rb
</code></pre>

<p>Sinatra :</p>

<pre><code>cd myapp/sinatra
git pull
</code></pre>

<p>gem :</p>

<pre><code>git clone git://github.com/sinatra/sinatra.git
cd sinatra
rake sinatra.gemspec
rake install
</code></pre>

<p>root gems</p>

<pre><code>sudo rake install
</code></pre>

<ul>
<li><p><a href="http://www.sinatrarb.com/"></a> - </p></li>
<li><p><a href="http://www.sinatrarb.com/contributing"></a> - bug
 patch?</p></li>
<li><p><a href="http://github.com/sinatra/sinatra/issues"></a></p></li>
<li><p><a href="http://twitter.com/sinatra">Twitter</a></p></li>
<li><p><a href="http://groups.google.com/group/sinatrarb/topics"></a></p></li>
<li><p>[IRC: #sinatra](irc://chat.freenode.net/#sinatra) on
<a href="http://freenode.net">freenode.net</a></p></li>
</ul>
