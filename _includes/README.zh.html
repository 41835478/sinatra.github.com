<div class='toc'>
	<ol class='level-1'>
		<li><a href='#/'>/</a></li>
		<ol class='level-2'>
			<li><a href='#Haml'>Haml</a></li>
			<li><a href='#Erb'>Erb</a></li>
			<li><a href='#Erubis'>Erubis</a></li>
			<li><a href='#Builder'>Builder</a></li>
			<li><a href='#Nokogiri'>Nokogiri</a></li>
			<li><a href='#Sass'>Sass</a></li>
			<li><a href='#Scss'>Scss</a></li>
			<li><a href='#Less'>Less</a></li>
			<li><a href='#Liquid'>Liquid</a></li>
			<li><a href='#Markdown'>Markdown</a></li>
			<li><a href='#Textile'>Textile</a></li>
			<li><a href='#RDoc'>RDoc</a></li>
			<li><a href='#Radius'>Radius</a></li>
			<li><a href='#Markaby'>Markaby</a></li>
			<li><a href='#Slim'>Slim</a></li>
			<li><a href='#Creole'>Creole</a></li>
			<li><a href='#CoffeeScript'>CoffeeScript</a></li>
			<li><a href='#Sessions'>Sessions</a></li>
			<li><a href='#URL'>URL</a></li>
		</ol>
		<li><a href='#Rack'>Rack</a></li>
		<li><a href='#Sinatra::Base%20-'>Sinatra::Base -</a></li>
		<ol class='level-2'>
			<li><a href='#vs.'>vs.</a></li>
			<li><a href='#config.ru'>config.ru</a></li>
			<li><a href='#config.ru?'>config.ru?</a></li>
			<li><a href='#Sinatra'>Sinatra</a></li>
			<li><a href='#/'>/</a></li>
			<li><a href='#/'>/</a></li>
			<li><a href='#Bundler'>Bundler</a></li>
	</ol></ol>
</div>


<p>*
*</p>

<p>SinatraRubyweb<a href="http://en.wikipedia.org/wiki/Domain-specific_language">DSL</a></p>
<pre class="highlight text"># myapp.rb
require 'sinatra'

get '/' do
  'Hello world!'
end
</pre>
<p>gem</p>
<pre class="highlight text">gem install sinatra
ruby myapp.rb
</pre>
<p><a href="http://localhost:4567">localhost:4567</a></p>

<p><code>gem install thin</code>Sinatrathin</p>

<p>SinatraHTTPURL</p>
<pre class="highlight text">get '/' do
  ..  ..
end

post '/' do
  ..  ..
end

put '/' do
  ..  ..
end

delete '/' do
  ..  ..
end

options '/' do
  ..  ..
end
</pre>
<p><code>params</code></p>
<pre class="highlight text">get '/hello/:name' do
  #  &quot;GET /hello/foo&quot;  &quot;GET /hello/bar&quot;
  # params[:name]  'foo'  'bar'
  &quot;Hello #{params[:name]}!&quot;
end
</pre><pre class="highlight text">get '/hello/:name' do |n|
  &quot;Hello #{n}!&quot;
end
</pre>
<p><code>params[:splat]</code></p>
<pre class="highlight text">get '/say/*/to/*' do
  #  /say/hello/to/world
  params[:splat] # =&gt; [&quot;hello&quot;, &quot;world&quot;]
end

get '/download/*.*' do
  #  /download/path/to/file.xml
  params[:splat] # =&gt; [&quot;path/to/file&quot;, &quot;xml&quot;]
end
</pre><pre class="highlight text">get %r{/hello/([\w]+)} do
  &quot;Hello, #{params[:captures].first}!&quot;
end
</pre><pre class="highlight text">get %r{/hello/([\w]+)} do |c|
  &quot;Hello, #{c}!&quot;
end
</pre>
<p>user agent</p>
<pre class="highlight text">get '/foo', :agent =&gt; /Songbird (\d\.\d)[\d\/]*?/ do
  &quot;Songbird #{params[:agent][0]}&quot;
end

get '/foo' do
  # Songbird
end
</pre>
<p><code>host_name</code>  <code>provides</code></p>
<pre class="highlight text">get '/', :host_name =&gt; /^admin\./ do
  &quot;&quot;
end

get '/', :provides =&gt; 'html' do
  haml :index
end

get '/', :provides =&gt; ['rss', 'atom', 'xml'] do
  builder :feed
end
</pre><pre class="highlight text">set(:probability) { |value| condition { rand &lt;= value } }

get '/win_a_car', :probability =&gt; 0.1 do
  &quot;You won!&quot;
end

get '/win_a_car' do
  &quot;Sorry, you lost.&quot;
end
</pre>
<p>HTTP
Rack</p>

<p>Rack Rack
bodyHTTP</p>

<ul>
<li><p>:
<code>[ (Fixnum),  (Hash),  ( #each)]</code></p></li>
<li><p>: <code>[ (Fixnum),  ( #each)]</code></p></li>
<li><p><code>#each</code> </p></li>
<li></li>
</ul>
<pre class="highlight text">class Stream
  def each
    100.times { |i| yield &quot;#{i}\n&quot; }
  end
end

get('/') { Stream.new }
</pre>
<p>Sinatra
 :</p>
<pre class="highlight text">class AllButPattern
  Match = Struct.new(:captures)

  def initialize(except)
    @except   = except
    @captures = Match.new([])
  end

  def match(str)
    @captures unless @except === str
  end
end

def all_but(pattern)
  AllButPattern.new(pattern)
end

get all_but(&quot;/index&quot;) do
  # ...
end
</pre>
<p>:</p>
<pre class="highlight text">get // do
  pass if request.path_info == &quot;/index&quot;
  # ...
end
</pre>
<p>:</p>
<pre class="highlight text">get %r{^(?!/index$)} do
  # ...
end
</pre>
<p><code>./public_folder</code> <code>:public</code></p>
<pre class="highlight text">set :public_folder, File.dirname(__FILE__) + '/static'
</pre>
<p>publicURL
<code>./public/css/style.css</code>
<code>http://example.com/css/style.css</code></p>

<a name='/'></a>
<h2>/</h2>

<p><code>./views</code> </p>
<pre class="highlight text">set :views, File.dirname(__FILE__) + '/templates'
</pre>
<p><code>:&#39;subdir/template&#39;</code> </p>

<a name='Haml'></a>
<h3>Haml</h3>

<p><code>haml</code> gem/library HAML </p>
<pre class="highlight text">#  haml
require 'haml'

get '/' do
  haml :index
end
</pre>
<p><code>./views/index.haml</code></p>

<p><a href="http://haml.info/docs/yardoc/file.HAML_REFERENCE.html#options">Haml</a>
Sinatra 
<a href="http://www.sinatrarb.com/configuration.html"></a></p>
<pre class="highlight text">set :haml, {:format =&gt; :html5 } # Haml :xhtml

get '/' do
  haml :index, :haml_options =&gt; {:format =&gt; :html4 } # :html4
end
</pre>
<a name='Erb'></a>
<h3>Erb</h3>
<pre class="highlight text">#  erb
require 'erb'

get '/' do
  erb :index
end
</pre>
<p><code>./views/index.erb</code></p>

<a name='Erubis'></a>
<h3>Erubis</h3>

<p><code>erubis</code> gem/library erubis </p>
<pre class="highlight text">#  erubis
require 'erubis'

get '/' do
  erubis :index
end
</pre>
<p><code>./views/index.erubis</code></p>

<p>ErubisErb:</p>
<pre class="highlight text">require 'erubis'
Tilt.register :erb, Tilt[:erubis]

get '/' do
  erb :index
end
</pre>
<p>Erubis <code>./views/index.erb</code></p>

<a name='Builder'></a>
<h3>Builder</h3>

<p><code>builder</code> gem/library  builder templates</p>
<pre class="highlight text"># builder
require 'builder'

get '/' do
  builder :index
end
</pre>
<p><code>./views/index.builder</code></p>

<a name='Nokogiri'></a>
<h3>Nokogiri</h3>

<p><code>nokogiri</code> gem/library  nokogiri </p>
<pre class="highlight text">#  nokogiri
require 'nokogiri'

get '/' do
  nokogiri :index
end
</pre>
<p><code>./views/index.nokogiri</code></p>

<a name='Sass'></a>
<h3>Sass</h3>

<p><code>haml</code>  <code>sass</code> gem/library  Sass </p>
<pre class="highlight text">#  haml  sass
require 'sass'

get '/stylesheet.css' do
  sass :stylesheet
end
</pre>
<p><code>./views/stylesheet.sass</code></p>

<p><a href="http://sass-lang.com/docs/yardoc/file.SASS_REFERENCE.html#options">Sass
</a>
Sinatra 
<a href="http://www.sinatrarb.com/configuration.html"></a>,</p>
<pre class="highlight text">set :sass, {:style =&gt; :compact } #  Sass  :nested

get '/stylesheet.css' do
  sass :stylesheet, :style =&gt; :expanded # 
end
</pre>
<a name='Scss'></a>
<h3>Scss</h3>

<p><code>haml</code>  <code>sass</code> gem/library  Scss templates</p>
<pre class="highlight text">#  haml  sass
require 'sass'

get '/stylesheet.css' do
  scss :stylesheet
end
</pre>
<p><code>./views/stylesheet.scss</code></p>

<p><a href="http://sass-lang.com/docs/yardoc/file.SASS_REFERENCE.html#options">Scss</a>
Sinatra 
<a href="http://www.sinatrarb.com/configuration.html"></a>,</p>
<pre class="highlight text">set :scss, :style =&gt; :compact # default Scss style is :nested

get '/stylesheet.css' do
  scss :stylesheet, :style =&gt; :expanded # overridden
end
</pre>
<a name='Less'></a>
<h3>Less</h3>

<p><code>less</code> gem/library  Less </p>
<pre class="highlight text">#  less
require 'less'

get '/stylesheet.css' do
  less :stylesheet
end
</pre>
<p><code>./views/stylesheet.less</code></p>

<a name='Liquid'></a>
<h3>Liquid</h3>

<p><code>liquid</code> gem/library  Liquid </p>
<pre class="highlight text">#  liquid
require 'liquid'

get '/' do
  liquid :index
end
</pre>
<p><code>./views/index.liquid</code></p>

<p>Liquid  Ruby  ( <code>yield</code>) 
locals</p>
<pre class="highlight text">liquid :index, :locals =&gt; { :key =&gt; 'value' }
</pre>
<a name='Markdown'></a>
<h3>Markdown</h3>

<p><code>rdiscount</code> gem/library  Markdown </p>
<pre class="highlight text"># rdiscount
require &quot;rdiscount&quot;

get '/' do
  markdown :index
end
</pre>
<p><code>./views/index.markdown</code> (<code>md</code>  <code>mkd</code> )</p>

<p>markdown locals</p>
<pre class="highlight text">erb :overview, :locals =&gt; { :text =&gt; markdown(:introduction) }
</pre>
<p>markdown </p>
<pre class="highlight text">%h1 Hello From Haml!
%p= markdown(:greetings)
</pre>
<p>MarkdownRubyMarkdown</p>

<p><code>:layout_engine</code>:</p>
<pre class="highlight text">get '/' do
  markdown :index, :layout_engine =&gt; :erb
end
</pre>
<p><code>./views/index.md</code>  <code>./views/layout.erb</code> </p>

<p>:</p>
<pre class="highlight text">set :markdown, :layout_engine =&gt; :haml, :layout =&gt; :post

get '/' do
  markdown :index
end
</pre>
<p><code>./views/index.markdown</code> ( Markdown ) 
<code>./views/post.haml</code> .</p>

<p>BlueClothRDiscountMarkdown:</p>
<pre class="highlight text">require 'bluecloth'

Tilt.register 'markdown', BlueClothTemplate
Tilt.register 'mkd',      BlueClothTemplate
Tilt.register 'md',       BlueClothTemplate

get '/' do
  markdown :index
end
</pre>
<p>BlueCloth <code>./views/index.md</code> </p>

<a name='Textile'></a>
<h3>Textile</h3>

<p><code>RedCloth</code> gem/library  Textile </p>
<pre class="highlight text"># redcloth
require &quot;redcloth&quot;

get '/' do
  textile :index
end
</pre>
<p><code>./views/index.textile</code></p>

<p>textile locals</p>
<pre class="highlight text">erb :overview, :locals =&gt; { :text =&gt; textile(:introduction) }
</pre>
<p><code>textile</code></p>
<pre class="highlight text">%h1 Hello From Haml!
%p= textile(:greetings)
</pre>
<p>TextileRubyTextile</p>

<p><code>:layout_engine</code>:</p>
<pre class="highlight text">get '/' do
  textile :index, :layout_engine =&gt; :erb
end
</pre>
<p><code>./views/index.textile</code>  <code>./views/layout.erb</code></p>

<p>:</p>
<pre class="highlight text">set :textile, :layout_engine =&gt; :haml, :layout =&gt; :post

get '/' do
  textile :index
end
</pre>
<p><code>./views/index.textile</code> ( Textile ) 
<code>./views/post.haml</code> .</p>

<a name='RDoc'></a>
<h3>RDoc</h3>

<p><code>RDoc</code> gem/library RDoc</p>
<pre class="highlight text"># rdoc/markup/to_html
require &quot;rdoc&quot;
require &quot;rdoc/markup/to_html&quot;

get '/' do
  rdoc :index
end
</pre>
<p><code>./views/index.rdoc</code></p>

<p>rdoclocals</p>
<pre class="highlight text">erb :overview, :locals =&gt; { :text =&gt; rdoc(:introduction) }
</pre>
<p><code>rdoc</code></p>
<pre class="highlight text">%h1 Hello From Haml!
%p= rdoc(:greetings)
</pre>
<p>RDocRubyRDoc</p>

<p><code>:layout_engine</code>:</p>
<pre class="highlight text">get '/' do
  rdoc :index, :layout_engine =&gt; :erb
end
</pre>
<p><code>./views/index.rdoc</code>  <code>./views/layout.erb</code> </p>

<p>:</p>
<pre class="highlight text">set :rdoc, :layout_engine =&gt; :haml, :layout =&gt; :post

get '/' do
  rdoc :index
end
</pre>
<p><code>./views/index.rdoc</code> ( RDoc ) 
<code>./views/post.haml</code> .</p>

<a name='Radius'></a>
<h3>Radius</h3>

<p><code>radius</code> gem/library  Radius </p>
<pre class="highlight text"># radius
require 'radius'

get '/' do
  radius :index
end
</pre>
<p><code>./views/index.radius</code></p>

<p>Radius  Ruby  ( <code>yield</code>) 
locals</p>
<pre class="highlight text">radius :index, :locals =&gt; { :key =&gt; 'value' }
</pre>
<a name='Markaby'></a>
<h3>Markaby</h3>

<p><code>markaby</code> gem/libraryMarkaby</p>
<pre class="highlight text"># markaby
require 'markaby'

get '/' do
  markaby :index
end
</pre>
<p><code>./views/index.mab</code></p>

<p>Markaby:</p>
<pre class="highlight text">get '/' do
  markaby { h1 &quot;Welcome!&quot; }
end
</pre>
<a name='Slim'></a>
<h3>Slim</h3>

<p><code>slim</code> gem/library  Slim </p>
<pre class="highlight text">#  slim
require 'slim'

get '/' do
  slim :index
end
</pre>
<p><code>./views/index.slim</code></p>

<a name='Creole'></a>
<h3>Creole</h3>

<p><code>creole</code> gem/library  Creole </p>
<pre class="highlight text">#  creole
require 'creole'

get '/' do
  creole :index
end
</pre>
<p><code>./views/index.creole</code></p>

<a name='CoffeeScript'></a>
<h3>CoffeeScript</h3>

<p><code>coffee-script</code> gem/library 
Javascript:</p>

<ul>
<li><p><code>node</code> ( Node.js) </p></li>
<li><p>OSX</p></li>
<li><p><code>therubyracer</code> gem/library</p></li>
</ul>

<p><a href="http://github.com/josh/ruby-coffee-script">github.com/josh/ruby-coffee-script</a></p>

<p>CoffeeScript :</p>
<pre class="highlight text"># coffee-script
require 'coffee-script'

get '/application.js' do
  coffee :application
end
</pre>
<p><code>./views/application.coffee</code></p>
<pre class="highlight text">get '/' do
  haml '%div.title Hello World'
end
</pre><pre class="highlight text">get '/:id' do
  @foo = Foo.find(params[:id])
  haml '%h1= @foo.name'
end
</pre><pre class="highlight text">get '/:id' do
  foo = Foo.find(params[:id])
  haml '%h1= foo.name', :locals =&gt; { :foo =&gt; foo }
end
</pre><pre class="highlight text">require 'sinatra'

get '/' do
  haml :index
end

__END__

@@ layout
%html
  = yield

@@ index
%div.title Hello world!!!!!
</pre>
<p>sinatra</p>

<p><code>enable :inline_templates</code></p>

<p><code>template</code> </p>
<pre class="highlight text">template :layout do
  &quot;%html\n  =yield\n&quot;
end

template :index do
  '%div.title Hello World!'
end

get '/' do
  haml :index
end
</pre>
<p>layout
 <code>:layout =&gt; false</code>
<code>set :haml, :layout =&gt; false</code></p>
<pre class="highlight text">get '/' do
  haml :index, :layout =&gt; !request.xhr?
end
</pre>
<p><code>Tilt.register</code> <code>tt</code>
Textile:</p>
<pre class="highlight text">Tilt.register :tt, Tilt[:textile]
</pre>
<p>Tilt:</p>
<pre class="highlight text">Tilt.register :myat, MyAwesomeTemplateEngine

helpers do
  def myat(*args) render(:myat, *args) end
end

get '/' do
  myat :index
end
</pre>
<p><code>./views/index.myat</code>
<a href="https://github.com/rtomayko/tilt">github.com/rtomayko/tilt</a>
Tilt.</p>
<pre class="highlight text">before do
  @note = 'Hi!'
  request.path_info = '/foo/bar/baz'
end

get '/foo/*' do
  @note #=&gt; 'Hi!'
  params[:splat] #=&gt; 'bar/baz'
end
</pre><pre class="highlight text">after do
  puts response.status
end
</pre>
<p><code>body</code> </p>
<pre class="highlight text">before '/protected/*' do
  authenticate!
end

after '/create/:slug' do |slug|
  session[:last_slug] = slug
end
</pre>
<p>:</p>
<pre class="highlight text">before :agent =&gt; /Songbird/ do
  # ...
end

after '/blog/*', :host_name =&gt; 'example.com' do
  # ...
end
</pre>
<p><code>helpers</code>  </p>
<pre class="highlight text">helpers do
  def bar(name)
    &quot;#{name}bar&quot;
  end
end

get '/:name' do
  bar(params[:name])
end
</pre>
<a name='Sessions'></a>
<h3>Sessions</h3>

<p>Session
session:</p>
<pre class="highlight text">enable :sessions

get '/' do
  &quot;value = &quot; &lt;&lt; session[:value].inspect
end

get '/:value' do
  session[:value] = params[:value]
end
</pre>
<p><code>enable :sessions</code> cookie</p>

<p>Rack session **
<code>enable :sessions</code> </p>
<pre class="highlight text">use Rack::Session::Pool, :expire_after =&gt; 2592000

get '/' do
  &quot;value = &quot; &lt;&lt; session[:value].inspect
end

get '/:value' do
  session[:value] = params[:value]
end
</pre><pre class="highlight text">halt
</pre><pre class="highlight text">halt 410
</pre><pre class="highlight text">halt 'this will be the body'
</pre>
<p>;</p>
<pre class="highlight text">halt 401, 'go away!'
</pre><pre class="highlight text">halt 402, {'Content-Type' =&gt; 'text/plain'}, 'revenge'
</pre>
<p><code>pass</code></p>
<pre class="highlight text">get '/guess/:who' do
  pass unless params[:who] == 'Frank'
  'You got me!'
end

get '/guess/*' do
  'You missed!'
end
</pre>
<p>404</p>

<p><code>pass</code> 
 <code>call</code> :</p>
<pre class="highlight text">get '/foo' do
  status, headers, body = call env.merge(&quot;PATH_INFO&quot; =&gt; '/bar')
  [status, headers, body.map(&amp;:upcase)]
end

get '/bar' do
  &quot;bar&quot;
end
</pre><pre class="highlight text">&lt;tt&gt;&quot;bar&quot;&lt;/tt&gt;&lt;tt&gt;/foo&lt;/tt&gt;
</pre>
<p><code>/bar</code>helper</p>

<p><code>call!</code> 
<code>call</code>.</p>

<p>Rack specification  <code>call</code>.</p>

<p><code>body</code><br>
:</p>
<pre class="highlight text">get '/foo' do
  body &quot;bar&quot;
end

after do
  puts body
end
</pre>
<p><code>body</code>Rack
streaming</p>

<p>:</p>
<pre class="highlight text">get '/foo' do
  status 418
  headers \
    &quot;Allow&quot;   =&gt; &quot;BREW, POST, GET, PROPFIND, WHEN&quot;,
    &quot;Refresh&quot; =&gt; &quot;Refresh: 20; http://www.ietf.org/rfc/rfc2324.txt&quot;
  body &quot;I'm a tea pot!&quot;
end
</pre>
<p><code>body</code>,  <code>headers</code>  <code>status</code> 
.</p>

<p><code>send_file</code> 
Sinatra <code>mime_type</code> </p>
<pre class="highlight text">mime_type :foo, 'text/foo'
</pre>
<p><code>content_type</code> </p>
<pre class="highlight text">get '/' do
  content_type :foo
  &quot;foo foo foo&quot;
end
</pre>
<a name='URL'></a>
<h3>URL</h3>

<p>URL <code>url</code>  Haml:</p>
<pre class="highlight text">%a{:href =&gt; url('/foo')} foo
</pre>
<p>RackURL</p>

<p><code>to</code> ().</p>

<p><code>redirect</code> :</p>
<pre class="highlight text">get '/foo' do
  redirect to('/bar')
end
</pre>
<p><code>halt</code>:</p>
<pre class="highlight text">redirect to('/bar'), 303
redirect 'http://google.com', 'wrong place, buddy'
</pre>
<p><code>redirect back</code>:</p>
<pre class="highlight text">get '/foo' do
  &quot;&lt;a href='/bar'&gt;do something&lt;/a&gt;&quot;
end

get '/bar' do
  do_something
  redirect back
end
</pre>
<p>redirectquery:</p>
<pre class="highlight text">redirect to('/bar?sum=42')
</pre>
<p>session:</p>
<pre class="highlight text">enable :sessions

get '/foo' do
  session[:secret] = 'foo'
  redirect to('/bar')
end

get '/bar' do
  session[:secret]
end
</pre>
<p>HTTP</p>

<p>Cache-Control :</p>
<pre class="highlight text">get '/' do
  cache_control :public
  &quot;cache it!&quot;
end
</pre>
<p>: .</p>
<pre class="highlight text">before do
  cache_control :public, :must_revalidate, :max_age =&gt; 60
end
</pre>
<p><code>expires</code>  <code>Cache-Control</code></p>
<pre class="highlight text">before do
  expires 500, :public, :must_revalidate
end
</pre>
<p><code>etag</code>  <code>last_modified</code>.
**helpers</p>
<pre class="highlight text">get '/article/:id' do
  @article = Article.find params[:id]
  last_modified @article.updated_at
  etag @article.sha1
  erb :article
end
</pre>
<p><a href="http://en.wikipedia.org/wiki/HTTP_ETag#Strong_and_weak_validation">weak
ETag</a>
:</p>
<pre class="highlight text">etag @article.sha1, :weak
</pre>
<p><a href="https://github.com/rtomayko/rack-cache">rack-cache</a>:</p>
<pre class="highlight text">require &quot;rack/cache&quot;
require &quot;sinatra&quot;

use Rack::Cache

get '/' do
  cache_control :public, :max_age =&gt; 36000
  sleep 5
  &quot;hello&quot;
end
</pre>
<p><code>send_file</code> :</p>
<pre class="highlight text">get '/' do
  send_file 'foo.png'
end
</pre>
<p>:</p>
<pre class="highlight text">send_file 'foo.png', :type =&gt; :jpg
</pre>
<p>:</p>

<dl>
    <dt>filename</dt>
    <dd></dd>

    <dt>last_modified</dt>
    <dd>Last-Modified mtime</dd>

    <dt>type</dt>
    <dd></dd>

    <dt>disposition</dt>
    <dd>
         Content-Disposition <tt>nil</tt> (), <tt>:attachment</tt> 
        <tt>:inline</tt>
    </dd>

    <dt>length</dt>
    <dd>Content-Length </dd>
</dl>

<p>RackRubystreaming
 Sinatrarange</p>

<p><code>request</code></p>
<pre class="highlight text">#  http://example.com/example 
get '/foo' do
  request.body              # 
  request.scheme            # &quot;http&quot;
  request.script_name       # &quot;/example&quot;
  request.path_info         # &quot;/foo&quot;
  request.port              # 80
  request.request_method    # &quot;GET&quot;
  request.query_string      # &quot;&quot;
  request.content_length    # request.body
  request.media_type        # request.body
  request.host              # &quot;example.com&quot;
  request.get?              # true ()
  request.form_data?        # false
  request[&quot;SOME_HEADER&quot;]    # SOME_HEADER header
  request.referrer          # referrer  '/'
  request.user_agent        # user agent ( :agent )
  request.cookies           #  cookies 
  request.xhr?              # ajax
  request.url               # &quot;http://example.com/example/foo&quot;
  request.path              # &quot;/example/foo&quot;
  request.ip                # IP
  request.secure?           # falsessltrue
  request.forwarded?        # true 
  request.env               # Rackenv
end
</pre>
<p><code>script_name</code>  <code>path_info</code> </p>
<pre class="highlight text">before { request.path_info = &quot;/&quot; }

get &quot;/&quot; do
  &quot;all requests end up here&quot;
end
</pre>
<p><code>request.body</code> IOStringIO</p>
<pre class="highlight text">post &quot;/api&quot; do
  request.body.rewind  # 
  data = JSON.parse request.body.read
  &quot;Hello #{data['name']}!&quot;
end
</pre>
<p><code>attachment</code> </p>
<pre class="highlight text">get '/' do
  attachment
  &quot;store it!&quot;
end
</pre>
<p>:</p>
<pre class="highlight text">get '/' do
  attachment &quot;info.txt&quot;
  &quot;store it!&quot;
end
</pre>
<p><code>find_template</code> :</p>
<pre class="highlight text">find_template settings.views, 'foo', Tilt[:haml] do |file|
  puts &quot;could be #{file}&quot;
end
</pre>
<p>:</p>
<pre class="highlight text">set :views, ['views', 'templates']

helpers do
  def find_template(views, name, engine, &amp;block)
    Array(views).each { |v| super(v, name, engine, &amp;block) }
  end
end
</pre>
<p>:</p>
<pre class="highlight text">set :views, :sass =&gt; 'views/sass', :haml =&gt; 'templates', :default =&gt; 'views'

helpers do
  def find_template(views, name, engine, &amp;block)
    _, folder = views.detect { |k,v| engine == Tilt[k] }
    folder ||= views[:default]
    super(folder, name, engine, &amp;block)
  end
end
</pre>
<p><code>find_template</code> </p>

<p><code>render</code>  <code>break</code> 
development mode</p>
<pre class="highlight text">configure do
  # setting one option
  set :option, 'value'

  # setting multiple options
  set :a =&gt; 1, :b =&gt; 2

  # same as `set :option, true`
  enable :option

  # same as `set :option, false`
  disable :option

  # you can also have dynamic settings with blocks
  set(:css_dir) { File.join(views, 'css') }
end
</pre>
<p>(RACK_ENV environment )  <code>:production</code></p>
<pre class="highlight text">configure :production do
  ...
end
</pre>
<p><code>:production</code>  <code>:test</code></p>
<pre class="highlight text">configure :production, :test do
  ...
end
</pre>
<p><code>settings</code> :</p>
<pre class="highlight text">configure do
  set :foo, 'bar'
end

get '/' do
  settings.foo? # =&gt; true
  settings.foo  # =&gt; 'bar'
  ...
end
</pre>
<dl>
    <dt>absolute_redirects</dt>
    <dd>
        <p>
            Sinatra Sinatra
            RFC 2616 (HTTP 1.1), 

        <p>
            
             <tt>url</tt>   URL
            <tt>false</tt> 

        <p>
            
    </dd>

    <dt>add_charsets</dt>
    <dd>
        <p>
             <tt>content_type</tt>  
        </p>

        <p>
            :
            <tt>settings.add_charsets << "application/foobar"</tt>
        </p>
    </dd>

    <dt>app_file</dt>
    <dd>
         viewspublic
    </dd>

    <dt>bind</dt>
    <dd>
        IP  (: 0.0.0.0) 
    </dd>

    <dt>default_encoding</dt>
    <dd>
         ( <tt>"utf-8"</tt>)
    </dd>

    <dt>dump_errors</dt>
    <dd>
        log
    </dd>

    <dt>environment</dt>
    <dd>
         <tt>ENV['RACK_ENV']</tt>  <tt>"development"</tt> 
    </dd>

    <dt>logging</dt>
    <dd>
        logger
    </dd>

    <dt>lock</dt>
    <dd>
        <p>
             
        </p>

        <p>
             
        </p>
    </dd>

    <dt>method_override</dt>
    <dd>
         <tt>_method</tt>   put/delete 
    </dd>

    <dt>port</dt>
    <dd>
        
    </dd>

    <dt>prefixed_redirects</dt>
    <dd>
         <tt>request.script_name</tt> 
         <tt>redirect '/foo'</tt> 
        <tt>redirect to('/foo')</tt>
    </dd>

    <dt>public_folder</dt>
    <dd>
        public
    </dd>

    <dt>reload_templates</dt>
    <dd>
         development mode Ruby 1.8.6
         Rubybug
    </dd>

    <dt>root</dt>
    <dd>
        
    </dd>

    <dt>raise_errors</dt>
    <dd>
        
    </dd>

    <dt>run</dt>
    <dd>
        Sinatraweb rackup
    </dd>

    <dt>running</dt>
    <dd>
         
    </dd>

    <dt>server</dt>
    <dd>
          [thin, mongrel, webrick],
         
    </dd>

    <dt>sessions</dt>
    <dd>
        cookiesesson
    </dd>

    <dt>show_exceptions</dt>
    <dd>
        stack trace
    </dd>

    <dt>static</dt>
    <dd>
        Sinatra  
        
    </dd>

    <dt>views</dt>
    <dd>
        views 
    </dd>
</dl>

<p><code>haml</code>, <code>erb</code>, <code>halt</code></p>

<p><code>Sinatra::NotFound</code> 
404<code>not_found</code> </p>
<pre class="highlight text">not_found do
  'This is nowhere to be found'
end
</pre>
<p><code>error</code> 
<code>sinatra.error</code> Rack </p>
<pre class="highlight text">error do
  'Sorry there was a nasty error - ' + env['sinatra.error'].name
end
</pre><pre class="highlight text">error MyCustomError do
  'So what happened was...' + env['sinatra.error'].message
end
</pre><pre class="highlight text">get '/' do
  raise MyCustomError, 'something bad'
end
</pre><pre class="highlight text">So what happened was... something bad
</pre><pre class="highlight text">error 403 do
  'Access forbidden'
end

get '/secret' do
  403
end
</pre><pre class="highlight text">error 400..510 do
  'Boom'
end
</pre>
<p>developmentSinatra <code>not_found</code>  <code>error</code></p>

<a name='Rack'></a>
<h2>Rack</h2>

<p>Sinatra  <a href="http://rack.rubyforge.org/">Rack</a>, Ruby
web
Rack
 / HTTP/ </p>

<p>Sinatra Rack  <code>use</code> </p>
<pre class="highlight text">require 'sinatra'
require 'my_custom_middleware'

use Rack::Lint
use MyCustomMiddleware

get '/hello' do
  'Hello World'
end
</pre>
<p><code>use</code> 
<a href="http://rack.rubyforge.org/doc/classes/Rack/Builder.html">Rack::Builder</a>
DSL(rack)<code>use</code> 
/ </p>
<pre class="highlight text">use Rack::Auth::Basic do |username, password|
  username == 'admin' &amp;&amp; password == 'secret'
end
</pre>
<p>Rack
URLsession Sinatra
 <code>use</code> </p>

<p>SinatraRack
<a href="http://gitrdoc.com/brynary/rack-test">Rack::Test</a> </p>
<pre class="highlight text">require 'my_sinatra_app'
require 'test/unit'
require 'rack/test'

class MyAppTest &lt; Test::Unit::TestCase
  include Rack::Test::Methods

  def app
    Sinatra::Application
  end

  def test_my_default
    get '/'
    assert_equal 'Hello World!', last_response.body
  end

  def test_with_params
    get '/meet', :name =&gt; 'Frank'
    assert_equal 'Hello Frank!', last_response.body
  end

  def test_with_rack_env
    get '/', {}, 'HTTP_USER_AGENT' =&gt; 'Songbird'
    assert_equal &quot;You're using Songbird!&quot;, last_response.body
  end
end
</pre>
<p>:  Sinatra::Test  Sinatra::TestHarness   0.9.2</p>

<a name='Sinatra::Base%20-'></a>
<h2>Sinatra::Base -</h2>

<p>RackRails
metal
SinatraDSLObject
 (,  ./public 
./views   Sinatra::Base</p>
<pre class="highlight text">require 'sinatra/base'

class MyApp &lt; Sinatra::Base
  set :sessions, true
  set :foo, 'bar'

  get '/' do
    'Hello world!'
  end
end
</pre>
<p>Sinatra::Base DSL 
Sinatra::Base</p>

<ul>
<li><p><code>sinatra/base</code>  <code>sinatra</code>;
Sinatra DSL  </p></li>
<li><p>Sinatra::Base</p></li>
</ul>

<p><code>+Sinatra::Base+</code> </p>

<p><a href="http://sinatra.github.com/configuration.html"></a></p>

<a name='vs.'></a>
<h3>vs.</h3>

<p>:</p>

<ul>
<li><p>RubySinatra</p></li>
<li><p>Object<br>
library/gem</p></li>
</ul>

<p>settings :</p>
<pre class="highlight text">Setting             Classic                 Modular

app_file            file loading sinatra    nil
run                 $0 == app_file          false
logging             true                    false
method_override     true                    false
inline_templates    true                    false
</pre>
<p><code>run!</code>:</p>
<pre class="highlight text"># my_app.rb
require 'sinatra/base'

class MyApp &lt; Sinatra::Base
  # ... app code here ...

  # start the server if ruby file executed directly
  run! if app_file == $0
end
</pre>
<p>:</p>
<pre class="highlight text">ruby my_app.rb
</pre>
<p><code>config.ru</code>Rack:</p>
<pre class="highlight text"># config.ru
require './my_app'
run MyApp
</pre>
<p>:</p>
<pre class="highlight text">rackup -p 4567
</pre>
<a name='config.ru'></a>
<h3>config.ru</h3>

<p>:</p>
<pre class="highlight text"># app.rb
require 'sinatra'

get '/' do
  'Hello world!'
end
</pre>
<p><code>config.ru</code>:</p>
<pre class="highlight text">require './app'
run Sinatra::Application
</pre>
<a name='config.ru?'></a>
<h3>config.ru?</h3>

<p><code>config.ru</code>:</p>

<ul>
<li><p>Rack  (Passenger, Unicorn, Heroku, ).</p></li>
<li><p><code>Sinatra::Base</code>.</p></li>
<li><p>Sinatra</p></li>
</ul>

<p><strong><code>config.ru</code>
  <code>config.ru</code>.</strong></p>

<a name='Sinatra'></a>
<h3>Sinatra</h3>

<p>SinatraRackSinatra
Rack
SinatraRack
(Rails/Ramaze/Camping/)</p>
<pre class="highlight text">require 'sinatra/base'

class LoginScreen &lt; Sinatra::Base
  enable :sessions

  get('/login') { haml :login }

  post('/login') do
    if params[:name] = 'admin' and params[:password] = 'admin'
      session['user_name'] = params[:name]
    else
      redirect '/login'
    end
  end
end

class MyApp &lt; Sinatra::Base
  # 
  use LoginScreen

  before do
    unless session['user_name']
      halt &quot;Access denied, please &lt;a href='/login'&gt;login&lt;/a&gt;.&quot;
    end
  end

  get('/') { &quot;Hello #{session['user_name']}.&quot; }
end
</pre>
<a name='/'></a>
<h3>/</h3>

<p>SinatraSinatra::Base
DSL(<code>require &#39;sinatra&#39;</code>)
Sinatra::Application
 `get`  `before`
`request`  `session`, </p>

<p>`set` </p>
<pre class="highlight text">class MyApp &lt; Sinatra::Base
  # 
  set :foo, 42
  foo # =&gt; 42

  get '/foo' do
    # 
  end
end
</pre>
<ul>
<li></li>
<li></li>
<li><p>`helpers` </p></li>
<li><p>`set`/</p></li>
<li><p>(<code>configure { |c| ... }</code>)</p></li>
<li><p>`settings`</p></li>
</ul>

<a name='/'></a>
<h3>/</h3>

<p>`request`  `session`  `erb` 
`haml``settings`</p>
<pre class="highlight text">class MyApp &lt; Sinatra::Base
  # !
  get '/define_route/:name' do
    #  '/define_route/:name' 
    @value = 42

    settings.get(&quot;/#{params[:name]}&quot;) do
      #  &quot;/#{params[:name]}&quot; 
      @value # =&gt; nil ()
    end

    &quot;Route defined!&quot;
  end
end
</pre>
<ul>
<li><p>get/head/post/put/delete </p></li>
<li><p>/ </p></li>
<li></li>
<li><p>/</p></li>
</ul>

<p>100%, :</p>

<p>/( `self`)</p>

<p><code>Sinatra::Delegator.delegate :method_name</code></p>

<ul>
<li><p><code>require &quot;sinatra&quot;</code></p></li>
<li><p>`Sinatra::Delegator` mixin</p></li>
</ul>

<p>: <a href="http://github.com/sinatra/sinatra/blob/ceac46f0bc129a6e994a06100aa854f606fe5992/lib/sinatra/base.rb#L1128">Sinatra::Delegator
mixin</a></p>

<p><a href="http://github.com/sinatra/sinatra/blob/ceac46f0bc129a6e994a06100aa854f606fe5992/lib/sinatra/main.rb#L28"></a></p>

<p>Sinatra </p>
<pre class="highlight text">ruby myapp.rb [-h] [-x] [-e ENVIRONMENT] [-p PORT] [-o HOST] [-s HANDLER]



-h # help
-p #  ( 4567)
-o #  ( 0.0.0.0)
-e #  ( development)
-s #  rack / ( thin)
-x #  ( off)
</pre>
<p>Ruby 1.8.7, 1.9.2, JRuby  Rubinius Sinatra</p>

<p>Ruby:</p>

<dl>
    <dt>Ruby 1.8.6</dt>
    <dd>
        1.8.6Sinatra Sinatra
        1.3.0 RDoc 
        CoffeScriptRuby
        1.8.6Hash
        1.1.1Sinatra
        Rack1.1.x
        Rack \>= 1.21.8.6
    </dd>

    <dt>Ruby 1.8.7</dt>
    <dd>
        1.8.7   1.9.2
         JRuby  Rubinius.
    </dd>

    <dt>Ruby 1.9.2</dt>
    <dd>
        1.9.2  Radius  Markaby 1.9
        1.9.2p0,  segmentation faults.
    </dd>

    <dt>Rubinius</dt>
    <dd>
        Rubinius  (Rubinius \>= 1.2.2) Textile
    </dd>

    <dt>JRuby</dt>
    <dd>
        JRuby  (JRuby \>= 1.5.6) 
        JRubyJRuby rack   Thin web
        JRuby
    </dd>
</dl>

<p>Ruby</p>

<p>Ruby   Sinatra:</p>

<ul>
<li><p>JRuby  Rubinius </p></li>
<li><p>MacRuby</p></li>
<li><p>Maglev</p></li>
<li><p>IronRuby</p></li>
<li><p>Ruby 1.9.0 and 1.9.1</p></li>
</ul>

<p>SinatraRuby</p>

<p>Sinatra  master</p>
<pre class="highlight text">cd myapp
git clone git://github.com/sinatra/sinatra.git
ruby -Isinatra/lib myapp.rb
</pre>
<p>gems</p>
<pre class="highlight text">gem install sinatra --pre
</pre>
<a name='Bundler'></a>
<h3>Bundler</h3>

<p>Sinatra
<a href="http://gembundler.com/">Bundler</a> </p>

<p>bundler:</p>
<pre class="highlight text">gem install bundler
</pre>
<p><code>Gemfile</code>:</p>
<pre class="highlight text">source :rubygems
gem 'sinatra', :git =&gt; &quot;git://github.com/sinatra/sinatra.git&quot;

# 
gem 'haml'                    # haml
gem 'activerecord', '~&gt; 3.0'  #  ActiveRecord 3.x
</pre>
<p>Sinatra
(Rack and Tilt)  Bundler</p>

<p>:</p>
<pre class="highlight text">bundle exec ruby myapp.rb
</pre>
<p><code>sinatra/lib</code><br>
<code>$LOAD_PATH</code>:</p>
<pre class="highlight text">cd myapp
git clone git://github.com/sinatra/sinatra.git
ruby -Isinatra/lib myapp.rb
</pre>
<p>Sinatra :</p>
<pre class="highlight text">cd myapp/sinatra
git pull
</pre>
<p>gem :</p>
<pre class="highlight text">git clone git://github.com/sinatra/sinatra.git
cd sinatra
rake sinatra.gemspec
rake install
</pre>
<p>root gems</p>
<pre class="highlight text">sudo rake install
</pre>
<ul>
<li><p><a href="http://www.sinatrarb.com/"></a> - </p></li>
<li><p><a href="http://www.sinatrarb.com/contributing"></a> - bug
 patch?</p></li>
<li><p><a href="http://github.com/sinatra/sinatra/issues"></a></p></li>
<li><p><a href="http://twitter.com/sinatra">Twitter</a></p></li>
<li><p><a href="http://groups.google.com/group/sinatrarb/topics"></a></p></li>
<li><p>[IRC: #sinatra](irc://chat.freenode.net/#sinatra) on
<a href="http://freenode.net">freenode.net</a></p></li>
</ul>
