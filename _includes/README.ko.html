<div class='toc'>
	<ol class='level-1'>
		<li><a href='#(Routes)'>(Routes)</a></li>
		<ol class='level-2'>
			<li><a href='#(Conditions)'>(Conditions)</a></li>
			<li><a href='#(Return%20Values)'>(Return Values)</a></li>
			<li><a href='#(Custom%20Route%20Matchers)'>(Custom Route Matchers)</a></li>
		</ol>
		<li><a href='#(Static%20Files)'>(Static Files)</a></li>
		<li><a href='#/%20(Views%20/%20Templates)'>/ (Views / Templates)</a></li>
		<ol class='level-2'>
			<li><a href='#(Available%20Template%20Languages)'>(Available Template Languages)</a></li>
			<li><a href='#Haml'>Haml</a></li>
			<li><a href='#Erb'>Erb</a></li>
			<li><a href='#Builder'>Builder</a></li>
			<li><a href='#Nokogiri'>Nokogiri</a></li>
			<li><a href='#Sass'>Sass</a></li>
			<li><a href='#SCSS'>SCSS</a></li>
			<li><a href='#Less'>Less</a></li>
			<li><a href='#Liquid'>Liquid</a></li>
			<li><a href='#Markdown'>Markdown</a></li>
			<li><a href='#Textile'>Textile</a></li>
			<li><a href='#RDoc'>RDoc</a></li>
			<li><a href='#Radius'>Radius</a></li>
			<li><a href='#Markaby'>Markaby</a></li>
			<li><a href='#RABL'>RABL</a></li>
			<li><a href='#Slim'>Slim</a></li>
			<li><a href='#Creole'>Creole</a></li>
			<li><a href='#CoffeeScript'>CoffeeScript</a></li>
			<li><a href='#Yajl'>Yajl</a></li>
			<li><a href='#(Embedded)'>(Embedded)</a></li>
			<li><a href='#(Named%20Templates)'>(Named Templates)</a></li>
		</ol>
		<li><a href='#(Filters)'>(Filters)</a></li>
		<li><a href='#(Helpers)'>(Helpers)</a></li>
		<ol class='level-2'>
			<li><a href='#(Sessions)'>(Sessions)</a></li>
			<li><a href='#(Halting)'>(Halting)</a></li>
			<li><a href='#(Passing)'>(Passing)</a></li>
			<li><a href='#(Triggering%20Another%20Route)'>(Triggering Another Route)</a></li>
			<li><a href='#,'>,</a></li>
			<li><a href='#(Streaming%20Responses)'>(Streaming Responses)</a></li>
			<li><a href='#(Logging)'>(Logging)</a></li>
			<li><a href='#(Mime%20Types)'>(Mime Types)</a></li>
			<li><a href='#URL'>URL</a></li>
			<li><a href='#(Browser%20Redirect)'>(Browser Redirect)</a></li>
			<li><a href='#(Cache%20Control)'>(Cache Control)</a></li>
			<li><a href='#(Sending%20Files)'>(Sending Files)</a></li>
			<li><a href='#(Accessing%20the%20Request%20Object)'>(Accessing the Request Object)</a></li>
			<li><a href='#(Attachments)'>(Attachments)</a></li>
		</ol>
		<li><a href='#(Configuration)'>(Configuration)</a></li>
		<ol class='level-2'>
			<li><a href='#(Configuring%20attack%20protection)'>(Configuring attack protection)</a></li>
			<li><a href='#(Available%20Settings)'>(Available Settings)</a></li>
		</ol>
		<li><a href='#(Environments)'>(Environments)</a></li>
		<li><a href='#(Error%20Handling)'>(Error Handling)</a></li>
		<ol class='level-2'>
			<li><a href='#(Not%20Found)'>(Not Found)</a></li>
			<li><a href='#(Error)'>(Error)</a></li>
		</ol>
		<li><a href='#Rack%20(Rack%20Middleware)'>Rack (Rack Middleware)</a></li>
		<li><a href='#(Testing)'>(Testing)</a></li>
		<li><a href='#Sinatra::Base%20-%20(Middleware),%20(Libraries),%20%20%20(Modular%20Apps)'>Sinatra::Base - (Middleware), (Libraries),   (Modular Apps)</a></li>
		<ol class='level-2'>
			<li><a href='#(Modular)%20vs.%20%20(Classic%20Style)'>(Modular) vs.  (Classic Style)</a></li>
			<li><a href='#(Modular%20Application)'>(Modular Application)</a></li>
			<li><a href='#config.ru'>config.ru</a></li>
			<li><a href='#config.ru%20?'>config.ru ?</a></li>
			<li><a href='#Sinatra'>Sinatra</a></li>
			<li><a href='#(Dynamic%20Application%20Creation)'>(Dynamic Application Creation)</a></li>
		</ol>
		<li><a href='#(Scopes)%20(Binding)'>(Scopes) (Binding)</a></li>
		<ol class='level-2'>
			<li><a href='#/'>/</a></li>
			<li><a href='#/'>/</a></li>
			<li><a href='#(Delegation%20Scope)'>(Delegation Scope)</a></li>
		</ol>
		<li><a href='#(Command%20Line)'>(Command Line)</a></li>
		<li><a href='#(Requirement)'>(Requirement)</a></li>
		<li><a href='#(The%20Bleeding%20Edge)'>(The Bleeding Edge)</a></li>
		<ol class='level-2'>
			<li><a href='#Bundler'>Bundler</a></li>
			<li><a href='#(Roll%20Your%20Own)'>(Roll Your Own)</a></li>
			<li><a href='#(Install%20Globally)'>(Install Globally)</a></li>
		</ol>
		<li><a href='#(Versioning)'>(Versioning)</a></li>
		<li><a href='#(Further%20Reading)'>(Further Reading)</a></li>
	</ol>
</div>


<p><em>:         .</em></p>

<p>Sinatra             <a href="http://en.wikipedia.org/wiki/Domain-specific_language">DSL</a>:</p>

<pre><code class="ruby"># myapp.rb
require &#39;sinatra&#39;

get &#39;/&#39; do
  &#39;Hello world!&#39;
end
</code></pre>

<pre><code>:
</code></pre>

<pre><code class="ruby">gem install sinatra
ruby myapp.rb
</code></pre>

<p>: http://localhost:4567</p>

<p><code>gem install thin</code>   ,   Sinatra thin .</p>

<a name='(Routes)'></a>
<h2>(Routes)</h2>

<p>Sinatra, (route) URL-    HTTP .
   :</p>

<pre><code class="ruby">get &#39;/&#39; do
  ..  (show) ..
end

post &#39;/&#39; do
  ..  (create) ..
end

put &#39;/&#39; do
  ..  (replace) ..
end

patch &#39;/&#39; do
  ..  (modify) ..
end

delete &#39;/&#39; do
  ..  (annihilate) ..
end

options &#39;/&#39; do
  ..  (appease) ..
end
</code></pre>

<pre><code>     .

  , `params`    :
</code></pre>

<pre><code class="ruby">get &#39;/hello/:name&#39; do
  # &quot;GET /hello/foo&quot;  &quot;GET /hello/bar&quot; 
  # params[:name] &#39;foo&#39;  &#39;bar&#39;
  &quot;Hello #{params[:name]}!&quot;
end
</code></pre>

<pre><code>     :
</code></pre>

<pre><code class="ruby">get &#39;/hello/:name&#39; do |n|
  &quot;Hello #{n}!&quot;
end
</code></pre>

<p>(splat,  )   ,   <code>params[:splat]</code>    :</p>

<pre><code class="ruby">get &#39;/say/*/to/*&#39; do
  # /say/hello/to/world 
  params[:splat] # =&gt; [&quot;hello&quot;, &quot;world&quot;]
end

get &#39;/download/*.*&#39; do
  # /download/path/to/file.xml 
  params[:splat] # =&gt; [&quot;path/to/file&quot;, &quot;xml&quot;]
end
</code></pre>

<p>:</p>

<pre><code class="ruby">get &#39;/download/*.*&#39; do |path, ext|
  [path, ext] # =&gt; [&quot;path/to/file&quot;, &quot;xml&quot;]
end
</code></pre>

<p>:</p>

<pre><code class="ruby">get %r{/hello/([\w]+)} do
  &quot;Hello, #{params[:captures].first}!&quot;
end
</code></pre>

<p>:</p>

<pre><code class="ruby">get %r{/hello/([\w]+)} do |c|
  &quot;Hello, #{c}!&quot;
end
</code></pre>

<p>(optional)    :</p>

<pre><code class="ruby">get &#39;/posts.?:format?&#39; do
  # &quot;GET /posts&quot;  &quot;GET /posts.json&quot;, &quot;GET /posts.xml&quot;     
end
</code></pre>

<p>,    (path traversal attack protection,  )  , 
       .</p>

<a name='(Conditions)'></a>
<h3>(Conditions)</h3>

<pre><code>(user agent)       :
</code></pre>

<pre><code class="ruby">get &#39;/foo&#39;, :agent =&gt; /Songbird (\d\.\d)[\d\/]*?/ do
  &quot;Songbird  #{params[:agent][0]} !&quot;
end

get &#39;/foo&#39; do
  # songbird    
end
</code></pre>

<pre><code>`host_name` `provides` :
</code></pre>

<pre><code class="ruby">get &#39;/&#39;, :host_name =&gt; /^admin\./ do
  &quot;Admin Area, Access denied!&quot;
end

get &#39;/&#39;, :provides =&gt; &#39;html&#39; do
  haml :index
end

get &#39;/&#39;, :provides =&gt; [&#39;rss&#39;, &#39;atom&#39;, &#39;xml&#39;] do
  builder :feed
end
</code></pre>

<pre><code> :
</code></pre>

<pre><code class="ruby">set(:probability) { |value| condition { rand &lt;= value } }

get &#39;/win_a_car&#39;, :probability =&gt; 0.1 do
  &quot; !&quot;
end

get &#39;/win_a_car&#39; do
  &quot; .&quot;
end
</code></pre>

<pre><code>(splat) :
</code></pre>

<pre><code class="ruby">set(:auth) do |*roles|   # &lt;-  
  condition do
    unless logged_in? &amp;&amp; roles.any? {|role| current_user.in_role? role }
      redirect &quot;/login/&quot;, 303
    end
  end
end

get &quot;/my/account/&quot;, :auth =&gt; [:user, :admin] do
  &quot;  &quot;
end

get &quot;/only/admin/&quot;, :auth =&gt; :admin do
  &quot;  !&quot;
end
</code></pre>

<a name='(Return%20Values)'></a>
<h3>(Return Values)</h3>

<p>HTTP     ,  Rack     .
 ,      ,   .</p>

<p>Rack , Rack    HTTP        :</p>

<ul>
<li>   : <code>[ (Fixnum),  (Hash),   (#each )]</code></li>
<li>   : <code>[ (Fixnum),   (#each )]</code></li>
<li><code>#each</code><br></li>
<li><p>Fixnum</p>

<p>,  , (streaming)     :</p></li>
</ul>

<pre><code class="ruby">class Stream
  def each
100.times { |i| yield &quot;#{i}\n&quot; }
  end
end

get(&#39;/&#39;) { Stream.new }
</code></pre>

<pre><code>`stream`  ( )        .
</code></pre>

<a name='(Custom%20Route%20Matchers)'></a>
<h3>(Custom Route Matchers)</h3>

<p>, Sinatra          .
,   .   (matcher)    :</p>

<pre><code class="ruby">class AllButPattern
  Match = Struct.new(:captures)

  def initialize(except)
    @except   = except
    @captures = Match.new([])
  end

  def match(str)
    @captures unless @except === str
  end
end

def all_but(pattern)
  AllButPattern.new(pattern)
end

get all_but(&quot;/index&quot;) do
  # ...
end
</code></pre>

<pre><code>   .     :
</code></pre>

<pre><code class="ruby">get // do
  pass if request.path_info == &quot;/index&quot;
  # ...
end
</code></pre>

<p>(negative look ahead)   :</p>

<pre><code class="ruby">get %r{^(?!/index$)} do
  # ...
end
</code></pre>

<a name='(Static%20Files)'></a>
<h2>(Static Files)</h2>

<p><code>./public</code> .
    <code>:public_folder</code>   :</p>

<pre><code class="ruby">set :public_folder, File.dirname(__FILE__) + &#39;/static&#39;
</code></pre>

<p>public  URL    .
<code>./public/css/style.css</code>  <code>http://example.com/css/style.css</code>    .</p>

<p><code>Cache-Control</code>    <code>:static_cache_control</code> ( )  .</p>

<a name='/%20(Views%20/%20Templates)'></a>
<h2>/ (Views / Templates)</h2>

<pre><code>    .
.
</code></pre>

<pre><code class="ruby">get &#39;/&#39; do
  erb :index
end
</code></pre>

<p><code>views/index.erb</code> .</p>

<pre><code>    :
</code></pre>

<pre><code class="ruby">get &#39;/&#39; do
  code = &quot;&lt;%= Time.now %&gt;&quot;
  erb code
end
</code></pre>

<pre><code>  :
</code></pre>

<pre><code class="ruby">get &#39;/&#39; do
  erb :index, :layout =&gt; :post
end
</code></pre>

<p><code>views/post.erb</code>   <code>views/index.erb</code> .
( <code>views/layout.erb</code>,     ).</p>

<p>Sinatra        :</p>

<pre><code class="ruby">get &#39;/&#39; do
  haml :index, :format =&gt; :html5
end
</code></pre>

<pre><code>  :
</code></pre>

<pre><code class="ruby">set :haml, :format =&gt; :html5

get &#39;/&#39; do
  haml :index
end
</code></pre>

<p>render    <code>set</code>     .</p>

<p>:</p>

<dl>
  <dt>locals</dt>
  <dd>  local .    .
: <tt>erb "<%= foo %>", :locals => {:foo => "bar"}</tt>
  </dd>

  <dt>default_encoding</dt>
  <dd>    .  <tt>settings.default_encoding</tt>.</dd>

  <dt>views</dt>
  <dd>   .  <tt>settings.views</tt>.</dd>

  <dt>layout</dt>
  <dd>   (<tt>true</tt>  <tt>false</tt>),     , 
  . : <tt>erb :index, :layout => !request.xhr?</tt>
  </dd>

  <dt>content_type</dt>
  <dd>  Content-Type,    .</dd>

  <dt>scope</dt>
  <dd>  .   .
   ,        .</dd>

  <dt>layout_engine</dt>
  <dd>
    .      .
   . : <tt>set :rdoc, :layout_engine => :erb</tt>
  </dd>
</dl>

<p><code>./views</code>    .      :</p>

<pre><code class="ruby">set :views, settings.root + &#39;/templates&#39;
</code></pre>

<pre><code>       ,
 (  `:&#39;subdir/template&#39;` ). 
</code></pre>

<p>,             .</p>

<a name='(Available%20Template%20Languages)'></a>
<h3>(Available Template Languages)</h3>

<pre><code> .    ( -thread-safe  ),
</code></pre>

<p>require   :</p>

<pre><code class="ruby">require &#39;rdiscount&#39; # or require &#39;bluecloth&#39;
get(&#39;/&#39;) { markdown :index }
</code></pre>

<a name='Haml'></a>
<h3>Haml</h3>

<table>
  <tr>
<td></td>
<td><a href="http://haml.info/">haml</a></td>
  </tr>
  <tr>
<td> </td>
<td><tt>.haml</tt></td>
  </tr>
  <tr>
<td></td>
<td><tt>haml :index, :format => :html5</tt></td>
  </tr>
</table>

<a name='Erb'></a>
<h3>Erb</h3>

<table>
  <tr>
<td></td>
<td><a href="http://www.kuwata-lab.com/erubis/">erubis</a>  erb (  )</td>
  </tr>
  <tr>
<td> </td>
<td><tt>.erb</tt>, <tt>.rhtml</tt>  <tt>.erubis</tt> (Erubis )</td>
  </tr>
  <tr>
<td></td>
<td><tt>erb :index</tt></td>
  </tr>
</table>

<a name='Builder'></a>
<h3>Builder</h3>

<table>
  <tr>
<td></td>
<td><a href="http://builder.rubyforge.org/">builder</a></td>
  </tr>
  <tr>
<td> </td>
<td><tt>.builder</tt></td>
  </tr>
  <tr>
<td>Example</td>
<td><tt>builder { |xml| xml.em "hi" }</tt></td>
  </tr>
</table>

<p>( ).</p>

<a name='Nokogiri'></a>
<h3>Nokogiri</h3>

<table>
  <tr>
<td></td>
<td><a href="http://nokogiri.org/">nokogiri</a></td>
  </tr>
  <tr>
<td> </td>
<td><tt>.nokogiri</tt></td>
  </tr>
  <tr>
<td></td>
<td><tt>nokogiri { |xml| xml.em "hi" }</tt></td>
  </tr>
</table>

<p>( ).</p>

<a name='Sass'></a>
<h3>Sass</h3>

<table>
  <tr>
<td></td>
<td><a href="http://sass-lang.com/">sass</a></td>
  </tr>
  <tr>
<td> </td>
<td><tt>.sass</tt></td>
  </tr>
  <tr>
<td></td>
<td><tt>sass :stylesheet, :style => :expanded</tt></td>
  </tr>
</table>

<a name='SCSS'></a>
<h3>SCSS</h3>

<table>
  <tr>
<td></td>
<td><a href="http://sass-lang.com/">sass</a></td>
  </tr>
  <tr>
<td> </td>
<td><tt>.scss</tt></td>
  </tr>
  <tr>
<td></td>
<td><tt>scss :stylesheet, :style => :expanded</tt></td>
  </tr>
</table>

<a name='Less'></a>
<h3>Less</h3>

<table>
  <tr>
<td></td>
<td><a href="http://www.lesscss.org/">less</a></td>
  </tr>
  <tr>
<td> </td>
<td><tt>.less</tt></td>
  </tr>
  <tr>
<td></td>
<td><tt>less :stylesheet</tt></td>
  </tr>
</table>

<a name='Liquid'></a>
<h3>Liquid</h3>

<table>
  <tr>
<td></td>
<td><a href="http://www.liquidmarkup.org/">liquid</a></td>
  </tr>
  <tr>
<td> </td>
<td><tt>.liquid</tt></td>
  </tr>
  <tr>
<td></td>
<td><tt>liquid :index, :locals => { :key => 'value' }</tt></td>
  </tr>
</table>

<p>Liquid   (<code>yield</code> )    ,    locals  .</p>

<a name='Markdown'></a>
<h3>Markdown</h3>

<table>
  <tr>
    <td></td>
    <td>
      <a href="https://github.com/rtomayko/rdiscount">rdiscount</a>,
      <a href="https://github.com/vmg/redcarpet">redcarpet</a>,
      <a href="http://deveiate.org/projects/BlueCloth">bluecloth</a>,
      <a href="http://kramdown.rubyforge.org/">kramdown</a> **
      <a href="http://maruku.rubyforge.org/">maruku</a>
    </td>
  </tr>
  <tr>
    <td> </td>
    <td><tt>.markdown</tt>, <tt>.mkd</tt>,  <tt>.md</tt></td>
  </tr>
  <tr>
    <td></td>
    <td><tt>markdown :index, :layout_engine => :erb</tt></td>
  </tr>
</table>

<pre><code> locals  . 
    :
</code></pre>

<pre><code class="ruby">erb :overview, :locals =&gt; { :text =&gt; markdown(:introduction) }
</code></pre>

<pre><code>`markdown`    :
</code></pre>

<pre><code class="ruby">%h1  Haml!
%p= markdown(:greetings)
</code></pre>

<p>Markdown     , Markdown     .
, <code>:layout_engine</code>         .</p>

<a name='Textile'></a>
<h3>Textile</h3>

<table>
  <tr>
<td></td>
<td><a href="http://redcloth.org/">RedCloth</a></td>
  </tr>
  <tr>
<td> </td>
<td><tt>.textile</tt></td>
  </tr>
  <tr>
<td></td>
<td><tt>textile :index, :layout_engine => :erb</tt></td>
  </tr>
</table>

<p>Textile   locals   .
        :</p>

<pre><code class="ruby">erb :overview, :locals =&gt; { :text =&gt; textile(:introduction) }
</code></pre>

<pre><code>`textile`    :
</code></pre>

<pre><code class="ruby">%h1  Haml!
%p= textile(:greetings)
</code></pre>

<p>Textile     , Textile     .
, <code>:layout_engine</code>         .</p>

<a name='RDoc'></a>
<h3>RDoc</h3>

<table>
  <tr>
<td></td>
<td><a href="http://rdoc.rubyforge.org/">rdoc</a></td>
  </tr>
  <tr>
<td> </td>
<td><tt>.rdoc</tt></td>
  </tr>
  <tr>
<td></td>
<td><tt>rdoc :README, :layout_engine => :erb</tt></td>
  </tr>
</table>

<p>rdoc   locals   .
        :</p>

<pre><code class="ruby">erb :overview, :locals =&gt; { :text =&gt; rdoc(:introduction) }
</code></pre>

<pre><code>`rdoc`    :
</code></pre>

<pre><code class="ruby">%h1 Hello From Haml!
%p= rdoc(:greetings)
</code></pre>

<p>RDoc     , RDoc     .
, <code>:layout_engine</code>         .</p>

<a name='Radius'></a>
<h3>Radius</h3>

<table>
  <tr>
<td></td>
<td><a href="http://radius.rubyforge.org/">radius</a></td>
  </tr>
  <tr>
<td> </td>
<td><tt>.radius</tt></td>
  </tr>
  <tr>
<td></td>
<td><tt>radius :index, :locals => { :key => 'value' }</tt></td>
  </tr>
</table>

<p>Radius       ,    locals   .</p>

<a name='Markaby'></a>
<h3>Markaby</h3>

<table>
  <tr>
<td></td>
<td><a href="http://markaby.github.com/">markaby</a></td>
  </tr>
  <tr>
<td></td>
<td><tt>.mab</tt></td>
  </tr>
  <tr>
<td></td>
<td><tt>markaby { h1 "Welcome!" }</tt></td>
  </tr>
</table>

<pre><code> ( ).
</code></pre>

<a name='RABL'></a>
<h3>RABL</h3>

<table>
  <tr>
<td></td>
<td><a href="https://github.com/nesquena/rabl">rabl</a></td>
  </tr>
  <tr>
<td> </td>
<td><tt>.rabl</tt></td>
  </tr>
  <tr>
<td></td>
<td><tt>rabl :index</tt></td>
  </tr>
</table>

<a name='Slim'></a>
<h3>Slim</h3>

<table>
  <tr>
<td></td>
<td><a href="http://slim-lang.com/">slim</a></td>
  </tr>
  <tr>
<td> </td>
<td><tt>.slim</tt></td>
  </tr>
  <tr>
<td></td>
<td><tt>slim :index</tt></td>
  </tr>
</table>

<a name='Creole'></a>
<h3>Creole</h3>

<table>
  <tr>
<td></td>
<td><a href="https://github.com/minad/creole">creole</a></td>
  </tr>
  <tr>
<td> </td>
<td><tt>.creole</tt></td>
  </tr>
  <tr>
<td></td>
<td><tt>creole :wiki, :layout_engine => :erb</tt></td>
  </tr>
</table>

<p>creole      locals   .
        .</p>

<pre><code class="ruby">erb :overview, :locals =&gt; { :text =&gt; creole(:introduction) }
</code></pre>

<pre><code>`creole`    :
</code></pre>

<pre><code class="ruby">%h1 Hello From Haml!
%p= creole(:greetings)
</code></pre>

<p>Creole     , Creole     .
, <code>:layout_engine</code>         .</p>

<a name='CoffeeScript'></a>
<h3>CoffeeScript</h3>

<table>
  <tr>
<td></td>
<td><a href="https://github.com/josh/ruby-coffee-script">coffee-script</a>
   <a href="https://github.com/sstephenson/execjs/blob/master/README.md#readme"> </a>
</td>
  </tr>
  <tr>
<td> </td>
<td><tt>.coffee</tt></td>
  </tr>
  <tr>
<td></td>
<td><tt>coffee :index</tt></td>
  </tr>
</table>

<a name='Yajl'></a>
<h3>Yajl</h3>

<table>
  <tr>
<td></td>
<td><a href="https://github.com/brianmario/yajl-ruby">yajl-ruby</a></td>
  </tr>
  <tr>
<td> </td>
<td><tt>.yajl</tt></td>
  </tr>
  <tr>
<td></td>
<td><tt>yajl :index, :locals => { :key => 'qux' }, :callback => 'present', :variable => 'resource' </tt></td>
  </tr>
</table>

<p>The template source is evaluated as a Ruby string, and the resulting json variable is converted #to<em>json.
    (evaluate),  json  #to</em>json .</p>

<pre><code class="ruby">json = { :foo =&gt; &#39;bar&#39; }
json[:baz] = key
</code></pre>

<p><code>:callback</code> <code>:variable</code>    (decorate)   .</p>

<pre><code class="ruby">var resource = {&quot;foo&quot;:&quot;bar&quot;,&quot;baz&quot;:&quot;qux&quot;}; present(resource);
</code></pre>

<a name='(Embedded)'></a>
<h3>(Embedded)</h3>

<pre><code class="ruby">get &#39;/&#39; do
  haml &#39;%div.title Hello World&#39;
end
</code></pre>

<p>.</p>

<p>Templates are evaluated within the same context as route handlers. Instance
variables set in route handlers are directly accessible by templates:
    (context) .
       : </p>

<pre><code class="ruby">get &#39;/:id&#39; do
  @foo = Foo.find(params[:id])
  haml &#39;%h1= @foo.name&#39;
end
</code></pre>

<p>,     : </p>

<pre><code class="ruby">get &#39;/:id&#39; do
  foo = Foo.find(params[:id])
  haml &#39;%h1= bar.name&#39;, :locals =&gt; { :bar =&gt; foo }
end
</code></pre>

<p>This is typically used when rendering templates as partials from within
other templates.
       (partial)   .</p>

<pre><code>  :
</code></pre>

<pre><code class="ruby">require &#39;sinatra&#39;

get &#39;/&#39; do
  haml :index
end

__END__

@@ layout
%html
= yield

@@ index
%div.title Hello world.
</code></pre>

<p>: require sinatra        .
       <code>enable :inline_templates</code>  .</p>

<a name='(Named%20Templates)'></a>
<h3>(Named Templates)</h3>

<p>(top-level) <code>template</code>    :</p>

<pre><code class="ruby">template :layout do
  &quot;%html\n  =yield\n&quot;
end

template :index do
  &#39;%div.title Hello World!&#39;
end

get &#39;/&#39; do
  haml :index
end
</code></pre>

<p>&quot;layout&quot;   ,      .
  <code>:layout =&gt; false</code><br>
 <code>set :haml, :layout =&gt; false</code>     :</p>

<pre><code class="ruby">get &#39;/&#39; do
  haml :index, :layout =&gt; !request.xhr?
end
</code></pre>

<pre><code>  , `Tilt.register`  .
</code></pre>

<p>, <code>tt</code>   Textile   ,    :</p>

<pre><code class="ruby">Tilt.register :tt, Tilt[:textile]
</code></pre>

<p>, Tilt   ,     :</p>

<pre><code class="ruby">Tilt.register :myat, MyAwesomeTemplateEngine

helpers do
  def myat(*args) render(:myat, *args) end
end

get &#39;/&#39; do
  myat :index
end
</code></pre>

<p><code>./views/index.myat</code>  . 
Tilt     https://github.com/rtomayko/tilt .</p>

<a name='(Filters)'></a>
<h2>(Filters)</h2>

<p>(before filter)            .
        :</p>

<pre><code class="ruby">before do
  @note = &#39;Hi!&#39;
  request.path_info = &#39;/foo/bar/baz&#39;
end

get &#39;/foo/*&#39; do
  @note #=&gt; &#39;Hi!&#39;
  params[:splat] #=&gt; &#39;bar/baz&#39;
end
</code></pre>

<p>(after filter)             .
         :</p>

<pre><code class="ruby">after do
  puts response.status
end
</code></pre>

<p>:   <code>body</code>       , body   ,       .</p>

<pre><code> ,           .
</code></pre>

<pre><code class="ruby">before &#39;/protected/*&#39; do
  authenticate!
end

after &#39;/create/:slug&#39; do |slug|
  session[:last_slug] = slug
end
</code></pre>

<p>,    :</p>

<pre><code class="ruby">before :agent =&gt; /Songbird/ do
  # ...
end

after &#39;/blog/*&#39;, :host_name =&gt; &#39;example.com&#39; do
  # ...
end
</code></pre>

<a name='(Helpers)'></a>
<h2>(Helpers)</h2>

<ul>
<li><code>helpers</code>           :</li>
</ul>

<pre><code class="ruby">helpers do
  def bar(name)
    &quot;#{name}bar&quot;
  end
end

get &#39;/:name&#39; do
  bar(params[:name])
end
</code></pre>

<p>,        :</p>

<pre><code class="ruby">module FooUtils
  def foo(name) &quot;#{name}foo&quot; end
end

module BarUtils
  def bar(name) &quot;#{name}bar&quot; end
end

helpers FooUtils, BarUtils
</code></pre>

<pre><code> (include)    .
</code></pre>

<a name='(Sessions)'></a>
<h3>(Sessions)</h3>

<pre><code>  . 
</code></pre>

<p>,    session    :</p>

<pre><code class="ruby">enable :sessions

get &#39;/&#39; do
  &quot;value = &quot; &lt;&lt; session[:value].inspect
end

get &#39;/:value&#39; do
  session[:value] = params[:value]
end
</code></pre>

<p><code>enable :sessions</code>       .
       ( ,       ).
      (Rack session middleware)    :
  , <code>enable :sessions</code>  **, 
        :</p>

<pre><code class="ruby">use Rack::Session::Pool, :expire_after =&gt; 2592000

get &#39;/&#39; do
  &quot;value = &quot; &lt;&lt; session[:value].inspect
end

get &#39;/:value&#39; do
  session[:value] = params[:value]
end
</code></pre>

<p>,      (secret) (sign). 
Sinatra     .
,          ,
           :</p>

<pre><code class="ruby">set :session_secret, &#39;super secret&#39;
</code></pre>

<pre><code>, `sessions`        :
</code></pre>

<pre><code class="ruby">set :sessions, :domain =&gt; &#39;foo.com&#39;
</code></pre>

<a name='(Halting)'></a>
<h3>(Halting)</h3>

<pre><code>   :
</code></pre>

<pre><code class="ruby">halt
</code></pre>

<pre><code> :
</code></pre>

<pre><code class="ruby">halt 410
</code></pre>

<pre><code>:
</code></pre>

<pre><code class="ruby">halt &#39;this will be the body&#39;
</code></pre>

<p>:</p>

<pre><code class="ruby">halt 401, &#39;go away!&#39;
</code></pre>

<pre><code>  :
</code></pre>

<pre><code class="ruby">halt 402, {&#39;Content-Type&#39; =&gt; &#39;text/plain&#39;}, &#39;revenge&#39;
</code></pre>

<p><code>halt</code>    :</p>

<pre><code class="ruby">halt erb(:error)
</code></pre>

<a name='(Passing)'></a>
<h3>(Passing)</h3>

<p><code>pass</code>         :</p>

<pre><code class="ruby">get &#39;/guess/:who&#39; do
  pass unless params[:who] == &#39;Frank&#39;
  &#39;You got me!&#39;
end

get &#39;/guess/*&#39; do
  &#39;You missed!&#39;
end
</code></pre>

<pre><code>        .
, 404 .
</code></pre>

<a name='(Triggering%20Another%20Route)'></a>
<h3>(Triggering Another Route)</h3>

<p><code>pass</code> ,         .
   +<code>call</code>+  :</p>

<pre><code class="ruby">get &#39;/foo&#39; do
  status, headers, body = call env.merge(&quot;PATH_INFO&quot; =&gt; &#39;/bar&#39;)
  [status, headers, body.map(&amp;:upcase)]
end

get &#39;/bar&#39; do
&quot;bar&quot;
end
</code></pre>

<p>, <code>&quot;bar&quot;</code>   <code>/foo</code> <code>/bar</code><br>
       .</p>

<pre><code>       , 
</code></pre>

<p><code>call</code>  <code>call!</code>  .</p>

<p><code>call</code>     Rack   .</p>

<a name=','></a>
<h3>,</h3>

<pre><code> (status code)  (response body)      . ,            .
</code></pre>

<p><code>body</code>    .
 ,          :</p>

<pre><code class="ruby">get &#39;/foo&#39; do
  body &quot;bar&quot;
end

after do
  puts body
end
</code></pre>

<p><code>body</code>    ,   (Rack)    .
(       , &quot; &quot; ).</p>

<p>,     :</p>

<pre><code class="ruby">get &#39;/foo&#39; do
  status 418
  headers \
&quot;Allow&quot;   =&gt; &quot;BREW, POST, GET, PROPFIND, WHEN&quot;,
&quot;Refresh&quot; =&gt; &quot;Refresh: 20; http://www.ietf.org/rfc/rfc2324.txt&quot;
  body &quot;I&#39;m a tea pot!&quot;
end
</code></pre>

<p><code>body</code>, <code>header</code> <code>status</code>           .</p>

<a name='(Streaming%20Responses)'></a>
<h3>(Streaming Responses)</h3>

<pre><code>         .
</code></pre>

<p>,          .
 (wrapper)   <code>stream</code>   :</p>

<pre><code class="ruby">get &#39;/&#39; do
  stream do |out|
out &lt;&lt; &quot;It&#39;s gonna be legen -\n&quot;
sleep 0.5
out &lt;&lt; &quot; (wait for it) \n&quot;
sleep 1
out &lt;&lt; &quot;- dary!\n&quot;
  end
end
</code></pre>

<p>API 
<a href="http://dev.w3.org/html5/eventsource/">  Server Sent Events</a>     ,
<a href="http://en.wikipedia.org/wiki/WebSocket">WebSockets</a>     .</p>

<p>(throughtput)     .</p>

<p>,         .
 ,  WEBRick        .
    ,  <code>stream</code>         .
 Shotgun  . </p>

<p><code>keep_open</code>  ,   <code>close</code>   ,
           .
  Thin Rainbow     .
     :</p>

<pre><code class="ruby">set :server, :thin
connections = []

get &#39;/&#39; do
  #    
  stream(:keep_open) { |out| connections &lt;&lt; out }
end

post &#39;/&#39; do
  #    
  connections.each { |out| out &lt;&lt; params[:message] &lt;&lt; &quot;\n&quot; }
  &quot;message sent&quot;
end
</code></pre>

<a name='(Logging)'></a>
<h3>(Logging)</h3>

<p>In the request scope, the <code>logger</code> helper exposes a <code>Logger</code> instance:
 (request scope) , <code>Logger</code>  <code>logger</code>    : </p>

<pre><code class="ruby">get &#39;/&#39; do
  logger.info &quot;loading data&quot;
  # ...
end
</code></pre>

<p>Rack      .
  ,   (dummy)   ,
         .</p>

<p><code>Sinatra::Application</code>    .
 <code>Sinatra::Base</code>      :</p>

<pre><code class="ruby">class MyApp &lt; Sinatra::Base
  configure :production, :development do
enable :logging
  end
end
</code></pre>

<pre><code> , `logging`  `nil`  .
</code></pre>

<p>,   <code>logger</code> <code>nil</code>   .
       .
Sinatra <code>env[&#39;rack.logger&#39;]</code>    .</p>

<a name='(Mime%20Types)'></a>
<h3>(Mime Types)</h3>

<p><code>send_file</code>     Sinatra       .
  <code>mime_type</code>     :</p>

<pre><code class="ruby">configure do
  mime_type :foo, &#39;text/foo&#39;
end
</code></pre>

<p><code>content_type</code>     :</p>

<pre><code class="ruby">get &#39;/&#39; do
  content_type :foo
  &quot;foo foo foo&quot;
end
</code></pre>

<a name='URL'></a>
<h3>URL</h3>

<p>URL  <code>url</code>    .   Haml:</p>

<pre><code class="ruby">%a{:href =&gt; url(&#39;/foo&#39;)} foo
</code></pre>

<p>(reverse proxies) Rack ,  , .</p>

<p>This method is also aliased to <code>to</code> (see below for an example).
  <code>to</code>     (  ).</p>

<a name='(Browser%20Redirect)'></a>
<h3>(Browser Redirect)</h3>

<p><code>redirect</code>        :</p>

<pre><code class="ruby">get &#39;/foo&#39; do
  redirect to(&#39;/bar&#39;)
end
</code></pre>

<p><code>halt</code>    :</p>

<pre><code class="ruby">redirect to(&#39;/bar&#39;), 303
redirect &#39;http://google.com&#39;, &#39;wrong place, buddy&#39;
</code></pre>

<p><code>redirect back</code>           :</p>

<pre><code class="ruby">get &#39;/foo&#39; do
  &quot;&lt;a href=&#39;/bar&#39;&gt;do something&lt;/a&gt;&quot;
end

get &#39;/bar&#39; do
  do_something
  redirect back
end
</code></pre>

<p>,  :</p>

<pre><code class="ruby">redirect to(&#39;/bar?sum=42&#39;)
</code></pre>

<p>:</p>

<pre><code class="ruby">enable :sessions

get &#39;/foo&#39; do
  session[:secret] = &#39;foo&#39;
  redirect to(&#39;/bar&#39;)
end

get &#39;/bar&#39; do
  session[:secret]
end
</code></pre>

<a name='(Cache%20Control)'></a>
<h3>(Cache Control)</h3>

<pre><code> HTTP  . 
</code></pre>

<p>Cache-Control       :</p>

<pre><code class="ruby">get &#39;/&#39; do
  cache_control :public
  &quot;cache it!&quot;
end
</code></pre>

<p>:    :</p>

<pre><code class="ruby">before do
  cache_control :public, :must_revalidate, :max_age =&gt; 60
end
</code></pre>

<p><code>expires</code>      ,
<code>Cache-Control</code>   :</p>

<pre><code class="ruby">before do
  expires 500, :public, :must_revalidate
end
</code></pre>

<p>, <code>etag</code>  <code>last_modified</code>    .
   **     ,
            (flush)  :</p>

<pre><code class="ruby">get &#39;/article/:id&#39; do
  @article = Article.find params[:id]
  last_modified @article.updated_at
  etag @article.sha1
  erb :article
end
</code></pre>

<p><a href="http://en.wikipedia.org/wiki/HTTP_ETag#Strong_and_weak_validation"> ETag</a>   :</p>

<pre><code class="ruby">etag @article.sha1, :weak
</code></pre>

<pre><code> ,     .
(reverse-proxy)    ,
</code></pre>

<p><a href="https://github.com/rtomayko/rack-cache">rack-cache</a> :</p>

<pre><code class="ruby">require &quot;rack/cache&quot;
require &quot;sinatra&quot;

use Rack::Cache

get &#39;/&#39; do
  cache_control :public, :max_age =&gt; 36000
  sleep 5
  &quot;hello&quot;
end
</code></pre>

<p><code>Cache-Control</code>    <code>:static_cache_control</code> ( ) :</p>

<p>RFC 2616  If-Match  If-None-Match  <code>*</code>    (resource)         .
Sinatra (get )  (put )       , 
  (  post  )    .
  <code>:new_resource</code>     :</p>

<pre><code class="ruby">get &#39;/create&#39; do
  etag &#39;&#39;, :new_resource =&gt; true
  Article.create
  erb :new_article
end
</code></pre>

<p>ETag  , <code>:kind</code> :</p>

<pre><code class="ruby">etag &#39;&#39;, :new_resource =&gt; true, :kind =&gt; :weak
</code></pre>

<a name='(Sending%20Files)'></a>
<h3>(Sending Files)</h3>

<p>, <code>send_file</code>    :</p>

<pre><code class="ruby">get &#39;/&#39; do
  send_file &#39;foo.png&#39;
end
</code></pre>

<pre><code> :
</code></pre>

<pre><code class="ruby">send_file &#39;foo.png&#39;, :type =&gt; :jpg
</code></pre>

<p>:</p>

<dl>
  <dt>filename</dt>
  <dd> .   .</dd>

  <dt>last_modified</dt>
  <dd>Last-Modified .   mtime.</dd>

  <dt>type</dt>
  <dd>  .    .</dd>

  <dt>disposition</dt>
  <dd>Content-Disposition .  : <tt>nil</tt> (),
<tt>:attachment</tt>  <tt>:inline</tt></dd>

  <dt>length</dt>
  <dd>Content-Length,   .</dd>

  <dt>status</dt>
  <dd>  .       .</dd>
</dl>

<p>Rack   , Ruby        .
     , Sinatra   (range request)  .</p>

<a name='(Accessing%20the%20Request%20Object)'></a>
<h3>(Accessing the Request Object)</h3>

<pre><code>(, ,  ) `request`    : 
</code></pre>

<pre><code class="ruby"># http://example.com/example    
get &#39;/foo&#39; do
  t = %w[text/css text/html application/javascript]
  request.accept              # [&#39;text/html&#39;, &#39;*/*&#39;]
  request.accept? &#39;text/xml&#39;  # true
  request.preferred_type(t)   # &#39;text/html&#39;
  request.body                #     ( )
  request.scheme              # &quot;http&quot;
  request.script_name         # &quot;/example&quot;
  request.path_info           # &quot;/foo&quot;
  request.port                # 80
  request.request_method      # &quot;GET&quot;
  request.query_string        # &quot;&quot;
  request.content_length      # request.body 
  request.media_type          # request.body  
  request.host                # &quot;example.com&quot;
  request.get?                # true (     )
  request.form_data?          # false
  request[&quot;SOME_HEADER&quot;]      # SOME_HEADER  
  request.referrer            #    &#39;/&#39;
  request.user_agent          #   (:agent  )
  request.cookies             #   
  request.xhr?                #  ajax ?
  request.url                 # &quot;http://example.com/example/foo&quot;
  request.path                # &quot;/example/foo&quot;
  request.ip                  #  IP 
  request.secure?             # false (ssl   true)
  request.forwarded?          # true (    )
  request.env                 # Rack   (raw) env 
end
</code></pre>

<p>, <code>script_name</code>  <code>path_info</code>      :</p>

<pre><code class="ruby">before { request.path_info = &quot;/&quot; }

get &quot;/&quot; do
  &quot;all requests end up here&quot;
end
</code></pre>

<p><code>request.body</code> IO  StringIO :</p>

<pre><code class="ruby">post &quot;/api&quot; do
  request.body.rewind  #    
  data = JSON.parse request.body.read
  &quot;Hello #{data[&#39;name&#39;]}!&quot;
end
</code></pre>

<a name='(Attachments)'></a>
<h3>(Attachments)</h3>

<p><code>attachment</code><br>
     :</p>

<pre><code class="ruby">get &#39;/&#39; do
  attachment
  &quot;store it!&quot;
end
</code></pre>

<pre><code> :
</code></pre>

<pre><code class="ruby">get &#39;/&#39; do
  attachment &quot;info.txt&quot;
  &quot;store it!&quot;
end
</code></pre>

<p>Sinatra <code>time_for_</code>   ,     Time  .
<code>DateTime</code>  <code>Date</code>     :</p>

<pre><code class="ruby">get &#39;/&#39; do
  pass if Time.now &gt; time_for(&#39;Dec 23, 2012&#39;)
  &quot;still time&quot;
end
</code></pre>

<p><code>expires</code>  <code>last_modified</code>   .
   <code>time_for</code><br>
      :</p>

<pre><code class="ruby">helpers do
  def time_for(value)
    case value
    when :yesterday then Time.now - 24*60*60
    when :tomorrow  then Time.now + 24*60*60
    else super
    end
  end
end

get &#39;/&#39; do
  last_modified :yesterday
  expires :tomorrow
  &quot;hello&quot;
end
</code></pre>

<p><code>find_template</code>     :</p>

<pre><code class="ruby">find_template settings.views, &#39;foo&#39;, Tilt[:haml] do |file|
  puts &quot;could be #{file}&quot;
end
</code></pre>

<p>This is not really useful. But it is useful that you can actually override this
method to hook in your own lookup mechanism. For instance, if you want to be
able to use more than one view directory:
   .          .
 ,      :</p>

<pre><code class="ruby">set :views, [&#39;views&#39;, &#39;templates&#39;]

helpers do
  def find_template(views, name, engine, &amp;block)
    Array(views).each { |v| super(v, name, engine, &amp;block) }
  end
end
</code></pre>

<pre><code>   :
</code></pre>

<pre><code class="ruby">set :views, :sass =&gt; &#39;views/sass&#39;, :haml =&gt; &#39;templates&#39;, :default =&gt; &#39;views&#39;

helpers do
  def find_template(views, name, engine, &amp;block)
    _, folder = views.detect { |k,v| engine == Tilt[k] }
    folder ||= views[:default]
    super(folder, name, engine, &amp;block)
  end
end
</code></pre>

<p>(extension)      !</p>

<p><code>find_template</code>       .
        .
    , <code>render</code>    <code>break</code>   .
,  ( )       .
       .</p>

<a name='(Configuration)'></a>
<h2>(Configuration)</h2>

<p>,  ,  :</p>

<pre><code class="ruby">configure do
  #   
  set :option, &#39;value&#39;

  #   
  set :a =&gt; 1, :b =&gt; 2

  # `set :option, true` 
  enable :option

  # `set :option, false` 
  disable :option

  #      
  set(:css_dir) { File.join(views, &#39;css&#39;) }
end
</code></pre>

<p>(RACK_ENV  ) <code>:production</code>  :</p>

<pre><code class="ruby">configure :production do
  ...
end
</code></pre>

<p><code>:production</code>  <code>:test</code>  :</p>

<pre><code class="ruby">configure :production, :test do
  ...
end
</code></pre>

<p><code>settings</code>   :</p>

<pre><code class="ruby">configure do
  set :foo, &#39;bar&#39;
end

get &#39;/&#39; do
  settings.foo? # =&gt; true
  settings.foo  # =&gt; &#39;bar&#39;
  ...
end
</code></pre>

<a name='(Configuring%20attack%20protection)'></a>
<h3>(Configuring attack protection)</h3>

<p>Sinatra <a href="https://github.com/rkh/rack-protection#readme">Rack::Protection</a><br>
,     . 
     (    ):</p>

<pre><code class="ruby">disable :protection
</code></pre>

<p>,   <code>protection</code>  :</p>

<pre><code class="ruby">set :protection, :except =&gt; :path_traversal
</code></pre>

<p>,   :</p>

<pre><code class="ruby">set :protection, :except =&gt; [:path_traversal, :session_hijacking]
</code></pre>

<a name='(Available%20Settings)'></a>
<h3>(Available Settings)</h3>

<dl>
  <dt>absolute_redirects</dt>
  <dd>
     , Sinatra    ,
      Sinatra       
    RFC 2616(HTTP 1.1)  .

              .
    <tt>rul</tt> ,     <tt>false</tt>  ,
      URL   .

    .
  </dd>

  <dt>add_charsets</dt>
  <dd>
    <tt>content_type</tt>      (mime) .

          :

    <tt>settings.add_charsets << "application/foobar"</tt>
  </dd>

  <dt>app_file<dt>
  <dd>   .   ,  public ,  
     .</dd>

  <dt>bind<dt>
  <dd> IP (: 0.0.0.0).
    (built-in)  .</dd>

  <dt>default_encoding</dt>
  <dd>   
   ( <tt>"utf-8"</tt>).</dd>

  <dt>dump_errors</dt>
  <dd>  .</dd>

  <dt>environment</dt>
  <dd> ,  <tt>ENV['RACK_ENV']</tt>      "development".</dd>

  <dt>logging</dt>
  <dd>(logger) .</dd>

  <dt>lock</dt>
  <dd>   (lock) . Ruby      .

     (thread-safe)   .
    .</dd>

  <dt>method_override</dt>
  <dd>put/delete    put/delete  
   <tt>_method</tt>  .</dd>

  <dt>port</dt>
  <dd> .   .</dd>

  <dt>prefixed_redirects</dt>
  <dd>    <tt>request.script_name</tt>
    .   <tt>redirect '/foo'</tt> <tt>redirect to('/foo')</tt>
    .  .</dd>

  <dt>protection</dt>
  <dd>     .    .</dd>

  <dt>public_folder</dt>
  <dd>public    .
   static     ( <tt>static</tt>).
      <tt>app_file</tt> .</dd>

  <dt>reload_templates</dt>
  <dd>   (reload)  .
     .</dd>

  <dt>root</dt>
  <dd>   . 
     <tt>app_file</tt>  .</dd>

  <dt>raise_errors</dt>
  <dd> ( ).
    <tt>environment</tt> <tt>"test"</tt>  ,   .</dd>

  <dt>run</dt>
  <dd>, Sinatra   .
   rackup        .</dd>

  <dt>running</dt>
  <dd>   ?
       !</dd>

  <dt>server</dt>
  <dd>
          .
     ['thin', 'mongrel', 'webrick']   .
  </dd>
  <dt>sessions</dt>
  <dd><tt>Rack::Session::Cookie</tt>     .
      ' ' .</dd>

  <dt>show_exceptions</dt>
  <dd>      .
    <tt>environment</tt> <tt>"development"</tt>  ,  .
  </dd>

  <dt>static</dt>
  <dd>Sinatra (static)    .
          .
     .
      ,   .</dd>

  <dt>static_cache_control</dt>
  <dd>Sinatra    ,  <tt>Cache-Control</tt>    .
   <tt>cache_control</tt>  .
    .
          :
   <tt>set :static_cache_control, [:public, :max_age => 300]</tt>
  </dd>

  <dt>threaded</dt>
  <dd><tt>true</tt> , Thin    <tt>EventMachine.defer</tt>  . </dd>

  <dt>views</dt>
  <dd>  .    <tt>app_file</tt> .</dd>
</dl>

<a name='(Environments)'></a>
<h2>(Environments)</h2>

<p><code>RACK_ENV</code>      .  &quot;development&quot;.
 ,     .
 <code>not_found</code>  <code>error</code><br>
      .
<code>&quot;production&quot;</code> <code>&quot;test&quot;</code>    .</p>

<p><code>-e</code>  :</p>

<pre><code class="ruby">ruby my_app.rb -e [ENVIRONMENT]
</code></pre>

<pre><code>    `development?`, `test?`  `production?` 
</code></pre>

<p>.</p>

<a name='(Error%20Handling)'></a>
<h2>(Error Handling)</h2>

<pre><code>    . 
</code></pre>

<p>,        .   <code>haml</code>,
<code>erb</code>, <code>halt</code>, .</p>

<a name='(Not%20Found)'></a>
<h3>(Not Found)</h3>

<p><code>Sinatra::NotFound</code>       404,
<code>not_found</code>  :</p>

<pre><code class="ruby">not_found do
  &#39;    .&#39;
end
</code></pre>

<a name='(Error)'></a>
<h3>(Error)</h3>

<p><code>error</code>         .
  Rack  <code>sinatra.error</code>   :</p>

<pre><code class="ruby">error do
  &#39;   - &#39; + env[&#39;sinatra.error&#39;].name
end
</code></pre>

<p>:</p>

<pre><code class="ruby">error MyCustomError do
  &#39;  ...&#39; + env[&#39;sinatra.error&#39;].message
end
</code></pre>

<p>,   :</p>

<pre><code class="ruby">get &#39;/&#39; do
  raise MyCustomError, &#39; &#39;
end
</code></pre>

<p>:</p>

<pre><code class="ruby">  ...  
</code></pre>

<p>,        :</p>

<pre><code class="ruby">error 403 do
  &#39; &#39;
end

get &#39;/secret&#39; do
  403
end
</code></pre>

<p>Or a range:</p>

<pre><code class="ruby">error 400..510 do
  &#39;&#39;
end
</code></pre>

<p>Sinatra<br>
 <code>not_found</code>  <code>error</code>  .</p>

<a name='Rack%20(Rack%20Middleware)'></a>
<h2>Rack (Rack Middleware)</h2>

<p>Sinatra <a href="http://rack.rubyforge.org/">Rack</a>  ,
Rack       .
Rack<br>
&quot;(middleware)&quot;  ,<br>
 HTTP / / 
     (component).</p>

<p>Sinatra  <code>use</code>   Rack        :</p>

<pre><code class="ruby">require &#39;sinatra&#39;
require &#39;my_custom_middleware&#39;

use Rack::Lint
use MyCustomMiddleware

get &#39;/hello&#39; do
  &#39;Hello World&#39;
end
</code></pre>

<p><code>use</code>  <a href="http://rack.rubyforge.org/doc/classes/Rack/Builder.html%5D">Rack::Builder</a> DSL
(rackup    )   .
 , <code>use</code>      /  :</p>

<pre><code class="ruby">use Rack::Auth::Basic do |username, password|
  username == &#39;admin&#39; &amp;&amp; password == &#39;secret&#39;
end
</code></pre>

<p>Rack , , URL , ,         .
Sinatra         ,
   <code>use</code>     .</p>

<p><a href="https://github.com/rack/rack/tree/master/lib/rack">rack</a>,
<a href="https://github.com/rack/rack-contrib#readme">rack-contrib</a>,
<a href="http://coderack.org/">CodeRack</a> 
<a href="https://github.com/rack/rack/wiki/List-of-Middleware">Rack wiki</a>
   .</p>

<a name='(Testing)'></a>
<h2>(Testing)</h2>

<p>Sinatra  Rack          .
<a href="http://rdoc.info/github/brynary/rack-test/master/frames">Rack::Test</a> :</p>

<pre><code class="ruby">require &#39;my_sinatra_app&#39;
require &#39;test/unit&#39;
require &#39;rack/test&#39;

class MyAppTest &lt; Test::Unit::TestCase
  include Rack::Test::Methods

  def app
    Sinatra::Application
  end

  def test_my_default
    get &#39;/&#39;
    assert_equal &#39;Hello World!&#39;, last_response.body
  end

  def test_with_params
    get &#39;/meet&#39;, :name =&gt; &#39;Frank&#39;
    assert_equal &#39;Hello Frank!&#39;, last_response.body
  end

  def test_with_rack_env
    get &#39;/&#39;, {}, &#39;HTTP_USER_AGENT&#39; =&gt; &#39;Songbird&#39;
    assert_equal &quot;You&#39;re using Songbird!&quot;, last_response.body
  end
end
</code></pre>

<a name='Sinatra::Base%20-%20(Middleware),%20(Libraries),%20%20%20(Modular%20Apps)'></a>
<h2>Sinatra::Base - (Middleware), (Libraries),   (Modular Apps)</h2>

<pre><code> (micro-app)   ,
</code></pre>

<p>Rack , Rails (metal)      ,<br>
Sinatra (extension)         .
     (,<br>
<code>./public</code>  <code>./views</code> , ,    ).
  <code>Sinatra::Base</code>  :</p>

<pre><code class="ruby">require &#39;sinatra/base&#39;

class MyApp &lt; Sinatra::Base
  set :sessions, true
  set :foo, &#39;bar&#39;

  get &#39;/&#39; do
    &#39;Hello world!&#39;
  end
end
</code></pre>

<p><code>Sinatra::Base</code>     DSL    .
       <code>Sinatra::Base</code>   :</p>

<ul>
<li> <code>sinatra</code>  <code>sinatra/base</code> require ,<br>
Sinatra DSL     .</li>
<li> ,  , ,   <code>Sinatra::Base</code>   .</li>
</ul>

<p><code>Sinatra::Base</code> (blank slate).
       .
      <a href="http://sinatra.github.com/configuration.html">Options and Configuration</a>  .</p>

<a name='(Modular)%20vs.%20%20(Classic%20Style)'></a>
<h3>(Modular) vs.  (Classic Style)</h3>

<p>,     .
  ,     .</p>

<p>Sinatra     .
    ,   .
       .</p>

<pre><code> ,      :
</code></pre>

<table>
  <tr>
    <th>Setting</th>
    <th>Classic</th>
    <th>Modular</th>
  </tr>
  <tr>
    <td>app_file</td>
    <td>sinatra  </td>
    <td>Sinatra::Base  </td>
  </tr>
  <tr>
    <td>run</td>
    <td>$0 == app_file</td>
    <td>false</td>
  </tr>
  <tr>
    <td>logging</td>
    <td> true</td>
    <td>false</td>
  </tr>
  <tr>
    <td>method_override</td>
    <td>true</td>
    <td>false</td>
  </tr>
  <tr>
    <td>inline_templates</td>
    <td>true</td>
    <td>false</td>
  </tr>
  <tr>
    <td>static</td>
    <td>true</td>
    <td>false</td>
  </tr>
</table>

<a name='(Modular%20Application)'></a>
<h3>(Modular Application)</h3>

<pre><code>   , 
</code></pre>

<p><code>run!</code> :</p>

<pre><code class="ruby"># my_app.rb
require &#39;sinatra/base&#39;

class MyApp &lt; Sinatra::Base
  # ...     ...

  #       
  run! if app_file == $0
end
</code></pre>

<p>:</p>

<pre><code class="ruby">ruby my_app.rb
</code></pre>

<p><code>config.ru</code>  ,    Rack    :</p>

<pre><code class="ruby"># config.ru
require &#39;./my_app&#39;
run MyApp
</code></pre>

<p>:</p>

<pre><code class="ruby">rackup -p 4567
</code></pre>

<a name='config.ru'></a>
<h3>config.ru</h3>

<pre><code>:
</code></pre>

<pre><code class="ruby"># app.rb
require &#39;sinatra&#39;

get &#39;/&#39; do
  &#39;Hello world!&#39;
end
</code></pre>

<p><code>config.ru</code>   :</p>

<pre><code class="ruby">require &#39;./app&#39;
run Sinatra::Application
</code></pre>

<a name='config.ru%20?'></a>
<h3>config.ru ?</h3>

<p>Good signs you probably want to use a <code>config.ru</code>:
 <code>config.ru</code>   :</p>

<ul>
<li> Rack (Passenger, Unicorn, Heroku, ...)   .</li>
<li>  <code>Sinatra::Base</code>    .</li>
<li>Sinatra (endpoint) ,     .</li>
</ul>

<p>**    <code>config.ru</code>   ,
 <code>config.ru</code>        .**</p>

<a name='Sinatra'></a>
<h3>Sinatra</h3>

<p>Sinatra  Rack      ,
 Sinatra    Rack      .
   Sinatra    , 
 Rack   (Rails/Ramaze/Camping/...) :</p>

<pre><code class="ruby">require &#39;sinatra/base&#39;

class LoginScreen &lt; Sinatra::Base
  enable :sessions

  get(&#39;/login&#39;) { haml :login }

  post(&#39;/login&#39;) do
if params[:name] == &#39;admin&#39; &amp;&amp; params[:password] == &#39;admin&#39;
  session[&#39;user_name&#39;] = params[:name]
else
  redirect &#39;/login&#39;
end
  end
end

class MyApp &lt; Sinatra::Base
  #     
  use LoginScreen

  before do
unless session[&#39;user_name&#39;]
  halt &quot; , &lt;a href=&#39;/login&#39;&gt;&lt;/a&gt; .&quot;
end
  end

  get(&#39;/&#39;) { &quot;Hello #{session[&#39;user_name&#39;]}.&quot; }
end
</code></pre>

<a name='(Dynamic%20Application%20Creation)'></a>
<h3>(Dynamic Application Creation)</h3>

<pre><code>         ,
</code></pre>

<p><code>Sinatra.new</code>  :</p>

<pre><code class="ruby">require &#39;sinatra/base&#39;
my_app = Sinatra.new { get(&#39;/&#39;) { &quot;hi&quot; } }
my_app.run!
</code></pre>

<pre><code> :
</code></pre>

<pre><code class="ruby"># config.ru
require &#39;sinatra/base&#39;

controller = Sinatra.new do
  enable :logging
  helpers MyHelpers
end

map(&#39;/a&#39;) do
  run Sinatra.new(controller) { get(&#39;/&#39;) { &#39;a&#39; } }
end

map(&#39;/b&#39;) do
  run Sinatra.new(controller) { get(&#39;/&#39;) { &#39;b&#39; } }
end
</code></pre>

<p>Sintra      Sinatra    .</p>

<p>Sinatra       :</p>

<pre><code class="ruby">require &#39;sinatra/base&#39;

use Sinatra do
  get(&#39;/&#39;) { ... }
end

run RailsProject::Application
</code></pre>

<a name='(Scopes)%20(Binding)'></a>
<h2>(Scopes) (Binding)</h2>

<pre><code>      .
</code></pre>

<a name='/'></a>
<h3>/</h3>

<p>Sinatra  <code>Sinatra::Base</code>  .
  DSL (<code>require &#39;sinatra&#39;</code>) ,
  <code>Sinatra::Application</code>,<br>
  .   <code>get</code>  <code>before</code>   ,
<code>request</code>  <code>session</code>    .<br>
    .</p>

<p><code>set</code>     :</p>

<pre><code class="ruby">class MyApp &lt; Sinatra::Base
  # ,    !
  set :foo, 42
  foo # =&gt; 42

  get &#39;/foo&#39; do
# ,         !
  end
end
</code></pre>

<pre><code>  :
</code></pre>

<ul>
<li><br></li>
<li><br></li>
<li><code>helpers</code><br></li>
<li><code>set</code>   Procs/blocks</li>
<li><p><code>Sinatra.new</code>  </p>

<p>()     :</p></li>
<li><p>configure    (<code>configure { |c| ... }</code>)</p></li>
<li><p><code>settings</code></p></li>
</ul>

<a name='/'></a>
<h3>/</h3>

<p>,            .
    <code>request</code>  <code>session</code><br>
<code>erb</code>  <code>haml</code>      .
     <code>settings</code>    :</p>

<pre><code class="ruby">class MyApp &lt; Sinatra::Base
  # ,    !
  get &#39;/define_route/:name&#39; do
# &#39;/define_route/:name&#39;  
@value = 42

settings.get(&quot;/#{params[:name]}&quot;) do
  # &quot;/#{params[:name]}&quot;  
  @value # =&gt; nil (  )
end

&quot; !&quot;
  end
end
</code></pre>

<pre><code>   :
</code></pre>

<ul>
<li>get/head/post/put/delete/options </li>
<li>before/after </li>
<li>(helper) </li>
<li>/</li>
</ul>

<a name='(Delegation%20Scope)'></a>
<h3>(Delegation Scope)</h3>

<p>(delegation scope)     (forward).
, 100%    ,      .
  (delegation)<br>
   /   (: <code>self</code> ).
<code>Sinatra::Delegator.delegate :method_name</code>       .</p>

<pre><code>   :
</code></pre>

<ul>
<li> , <code>require &quot;sinatra&quot;</code><br></li>
<li><p><code>Sinatra::Delegator</code>   </p>

<p>: 
<a href="https://github.com/sinatra/sinatra/blob/ca06364/lib/sinatra/base.rb#L1609-1633">Sinatra::Delegator </a>
<a href="https://github.com/sinatra/sinatra/blob/ca06364/lib/sinatra/main.rb#L28-30">   </a>.</p></li>
</ul>

<a name='(Command%20Line)'></a>
<h2>(Command Line)</h2>

<p>Sinatra     :</p>

<pre><code class="ruby">ruby myapp.rb [-h] [-x] [-e ENVIRONMENT] [-p PORT] [-o HOST] [-s HANDLER]
</code></pre>

<p>:</p>

<pre><code>-h # 
-p #   ( 4567)
-o #   ( 0.0.0.0)
-e #   ( development)
-s # rack /  ( thin)
-x # mutex   ( off)
</code></pre>

<a name='(Requirement)'></a>
<h2>(Requirement)</h2>

<pre><code>:
</code></pre>

<dl>
  <dt> Ruby 1.8.7 </dt>
  <dd>1.8.7  ,     , 
1.9.2   JRuby Rubinius   .
1.8.7   Sinatra 2.0 Ruby 2.0    .
 ,    .
<b>Ruby 1.8.6   .</b>
 1.8.6  , Sinatra 1.2 .
Sinatra 1.4.0         .

</dd>
  <dt> Ruby 1.9.2 </dt>
  <dd>1.9.2   . Radius Maraby  1.9   .
1.9.2p0, Sinatra         .
Ruby 1.9.4/2.0     ,
 1.9    Ruby       .

</dd>
  <dt> Ruby 1.9.3 </dt>
  <dd>1.9.3  .   
       ( p0). 
  1.9.3       .

</dd>
  <dt> Rubinius </dt>
  <dd>Rubinius   (Rubinius >= 1.2.4),       .
  2.0    .

</dd>
  <dt> JRuby </dt>
  <dd>JRuby   (JRuby >= 1.6.5).        ,
 JRuby  , JRuby rack   .
Thin   JRuby   .
JRuby C     , RDiscount, Redcarpet  RedCloth 
  .
</dd>
</dl>

<pre><code>  .
</code></pre>

<p>Sinatra      :</p>

<ul>
<li>JRuby Rubinius<br></li>
<li>Ruby Enterprise Edition</li>
<li>MacRuby, Maglev, IronRuby</li>
<li><p>Ruby 1.9.0  1.9.1 (      )</p>

<p>,       .</p>

<p>CI ruby-head (  2.0.0)  1.9.4   ,
    . 
1.9.4p0 2.0.0p0  .</p></li>
</ul>

<p>Sinatra        .</p>

<p>Cardinal, SmallRuby, BlueRuby  1.8.7<br>
Sinatra    .</p>

<a name='(The%20Bleeding%20Edge)'></a>
<h2>(The Bleeding Edge)</h2>

<p>Sinatra     , 
      ,    .</p>

<p>(prerelease)   ,     </p>

<pre><code class="ruby">gem install sinatra --pre
</code></pre>

<a name='Bundler'></a>
<h3>Bundler</h3>

<p>Sinatra  , 
<a href="http://gembundler.com/">Bundler</a>   .</p>

<p>,    bundler :</p>

<pre><code class="ruby">gem install bundler
</code></pre>

<p>,  , <code>Gemfile</code>  :</p>

<pre><code class="ruby">source :rubygems
gem &#39;sinatra&#39;, :git =&gt; &quot;git://github.com/sinatra/sinatra.git&quot;

#  
gem &#39;haml&#39;#  , haml 
gem &#39;activerecord&#39;, &#39;~&gt; 3.0&#39;  #  ActiveRecord 3.x  
</code></pre>

<pre><code>   .
</code></pre>

<p>, Sinatra     (Rack Tilt) 
Bundler    .</p>

<pre><code>   :
</code></pre>

<pre><code class="ruby">bundle exec ruby myapp.rb
</code></pre>

<a name='(Roll%20Your%20Own)'></a>
<h3>(Roll Your Own)</h3>

<p>(clone)   <code>$LOAD_PATH</code> <code>sinatra/lib</code><br>
  :</p>

<pre><code class="ruby">cd myapp
git clone git://github.com/sinatra/sinatra.git
ruby -Isinatra/lib myapp.rb
</code></pre>

<p>Sinatra  :</p>

<pre><code class="ruby">cd myapp/sinatra
git pull
</code></pre>

<a name='(Install%20Globally)'></a>
<h3>(Install Globally)</h3>

<pre><code>:
</code></pre>

<pre><code class="ruby">git clone git://github.com/sinatra/sinatra.git
cd sinatra
rake sinatra.gemspec
rake install
</code></pre>

<p>,      </p>

<pre><code class="ruby">sudo rake install
</code></pre>

<a name='(Versioning)'></a>
<h2>(Versioning)</h2>

<p>Sinatra <a href="http://semver.org/"> Semantic Versioning</a> .
SemVer  SemVerTag   .</p>

<a name='(Further%20Reading)'></a>
<h2>(Further Reading)</h2>

<ul>
<li><a href="http://www.sinatrarb.com/"> </a> -  , ,     .</li>
<li><a href="http://www.sinatrarb.com/contributing"></a> -  ?  ?  ?</li>
<li><a href="http://github.com/sinatra/sinatra/issues"> </a></li>
<li><a href="http://twitter.com/sinatra"></a></li>
<li><a href="http://groups.google.com/group/sinatrarb/topics">Mailing List</a></li>
<li>[IRC: #sinatra](irc://chat.freenode.net/#sinatra) http://freenode.net </li>
<li><a href="http://sinatra-book.gittr.com">Sinatra Book</a> Cookbook </li>
<li><a href="http://recipes.sinatrarb.com/">Sinatra Recipes</a><br></li>
<li>http://rubydoc.info  <a href="http://rubydoc.info/gems/sinatra"> </a>
<a href="http://rubydoc.info/github/sinatra/sinatra">current HEAD</a>  API </li>
<li><a href="http://travis-ci.org/sinatra/sinatra">CI server</a></li>
</ul>
