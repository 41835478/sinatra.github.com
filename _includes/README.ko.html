<div class='toc'>
	<ol class='level-1'>
		<li><a href='#(Routes)'>(Routes)</a></li>
		<ol class='level-2'>
			<li><a href='#(Conditions)'>(Conditions)</a></li>
			<li><a href='#(Return%20Values)'>(Return Values)</a></li>
			<li><a href='#(Custom%20Route%20Matchers)'>(Custom Route Matchers)</a></li>
		</ol>
		<li><a href='#(Static%20Files)'>(Static Files)</a></li>
		<li><a href='#/%20(Views%20/%20Templates)'>/ (Views / Templates)</a></li>
		<ol class='level-2'>
			<li><a href='#(Available%20Template%20Languages)'>(Available Template Languages)</a></li>
			<li><a href='#Haml'>Haml</a></li>
			<li><a href='#Erb'>Erb</a></li>
			<li><a href='#Builder'>Builder</a></li>
			<li><a href='#Nokogiri'>Nokogiri</a></li>
			<li><a href='#Sass'>Sass</a></li>
			<li><a href='#SCSS'>SCSS</a></li>
			<li><a href='#Less'>Less</a></li>
			<li><a href='#Liquid'>Liquid</a></li>
			<li><a href='#Markdown'>Markdown</a></li>
			<li><a href='#Textile'>Textile</a></li>
			<li><a href='#RDoc'>RDoc</a></li>
			<li><a href='#Radius'>Radius</a></li>
			<li><a href='#Markaby'>Markaby</a></li>
			<li><a href='#RABL'>RABL</a></li>
			<li><a href='#Slim'>Slim</a></li>
			<li><a href='#Creole'>Creole</a></li>
			<li><a href='#CoffeeScript'>CoffeeScript</a></li>
			<li><a href='#Yajl'>Yajl</a></li>
			<li><a href='#(Embedded)'>(Embedded)</a></li>
			<li><a href='#(Named%20Templates)'>(Named Templates)</a></li>
		</ol>
		<li><a href='#(Filters)'>(Filters)</a></li>
		<li><a href='#(Helpers)'>(Helpers)</a></li>
		<ol class='level-2'>
			<li><a href='#(Sessions)'>(Sessions)</a></li>
			<li><a href='#(Halting)'>(Halting)</a></li>
			<li><a href='#(Passing)'>(Passing)</a></li>
			<li><a href='#(Triggering%20Another%20Route)'>(Triggering Another Route)</a></li>
			<li><a href='#,'>,</a></li>
			<li><a href='#(Streaming%20Responses)'>(Streaming Responses)</a></li>
			<li><a href='#(Logging)'>(Logging)</a></li>
			<li><a href='#(Mime%20Types)'>(Mime Types)</a></li>
			<li><a href='#URL'>URL</a></li>
			<li><a href='#(Browser%20Redirect)'>(Browser Redirect)</a></li>
			<li><a href='#(Cache%20Control)'>(Cache Control)</a></li>
			<li><a href='#(Sending%20Files)'>(Sending Files)</a></li>
			<li><a href='#(Accessing%20the%20Request%20Object)'>(Accessing the Request Object)</a></li>
			<li><a href='#(Attachments)'>(Attachments)</a></li>
		</ol>
		<li><a href='#(Configuration)'>(Configuration)</a></li>
		<ol class='level-2'>
			<li><a href='#(Configuring%20attack%20protection)'>(Configuring attack protection)</a></li>
			<li><a href='#(Available%20Settings)'>(Available Settings)</a></li>
		</ol>
		<li><a href='#(Environments)'>(Environments)</a></li>
		<li><a href='#(Error%20Handling)'>(Error Handling)</a></li>
		<ol class='level-2'>
			<li><a href='#(Not%20Found)'>(Not Found)</a></li>
			<li><a href='#(Error)'>(Error)</a></li>
		</ol>
		<li><a href='#Rack%20(Rack%20Middleware)'>Rack (Rack Middleware)</a></li>
		<li><a href='#(Testing)'>(Testing)</a></li>
		<li><a href='#Sinatra::Base%20-%20(Middleware),%20(Libraries),%20%20%20(Modular%20Apps)'>Sinatra::Base - (Middleware), (Libraries),   (Modular Apps)</a></li>
		<ol class='level-2'>
			<li><a href='#(Modular)%20vs.%20%20(Classic%20Style)'>(Modular) vs.  (Classic Style)</a></li>
			<li><a href='#(Modular%20Application)'>(Modular Application)</a></li>
			<li><a href='#config.ru'>config.ru</a></li>
			<li><a href='#config.ru%20?'>config.ru ?</a></li>
			<li><a href='#Sinatra'>Sinatra</a></li>
			<li><a href='#(Dynamic%20Application%20Creation)'>(Dynamic Application Creation)</a></li>
		</ol>
		<li><a href='#(Scopes)%20(Binding)'>(Scopes) (Binding)</a></li>
		<ol class='level-2'>
			<li><a href='#/'>/</a></li>
			<li><a href='#/'>/</a></li>
			<li><a href='#(Delegation%20Scope)'>(Delegation Scope)</a></li>
		</ol>
		<li><a href='#(Command%20Line)'>(Command Line)</a></li>
		<li><a href='#(Requirement)'>(Requirement)</a></li>
		<li><a href='#(The%20Bleeding%20Edge)'>(The Bleeding Edge)</a></li>
		<ol class='level-2'>
			<li><a href='#Bundler'>Bundler</a></li>
			<li><a href='#(Roll%20Your%20Own)'>(Roll Your Own)</a></li>
			<li><a href='#(Install%20Globally)'>(Install Globally)</a></li>
		</ol>
		<li><a href='#(Versioning)'>(Versioning)</a></li>
		<li><a href='#(Further%20Reading)'>(Further Reading)</a></li>
	</ol>
</div>


<p><em>:         .</em></p>

<p>Sinatra             <a href="http://en.wikipedia.org/wiki/Domain-specific_language">DSL</a>:</p>
<pre class="highlight ruby"><span class="c1"># myapp.rb</span>
<span class="nb">require</span> <span class="s1">'sinatra'</span>

<span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="s1">'Hello world!'</span>
<span class="k">end</span>
</pre><pre class="highlight text">:
</pre><pre class="highlight ruby"><span class="n">gem</span> <span class="n">install</span> <span class="n">sinatra</span>
<span class="n">ruby</span> <span class="n">myapp</span><span class="nf">.rb</span>
</pre>
<p>: http://localhost:4567</p>

<p><code>gem install thin</code>   ,   Sinatra thin .</p>

<a name='(Routes)'></a>
<h2>(Routes)</h2>

<p>Sinatra, (route) URL-    HTTP .
   :</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="nf">..</span>  <span class="p">(</span><span class="n">show</span><span class="p">)</span> <span class="nf">..</span>
<span class="k">end</span>

<span class="n">post</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="nf">..</span>  <span class="p">(</span><span class="n">create</span><span class="p">)</span> <span class="nf">..</span>
<span class="k">end</span>

<span class="n">put</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="nf">..</span>  <span class="p">(</span><span class="n">replace</span><span class="p">)</span> <span class="nf">..</span>
<span class="k">end</span>

<span class="n">patch</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="nf">..</span>  <span class="p">(</span><span class="n">modify</span><span class="p">)</span> <span class="nf">..</span>
<span class="k">end</span>

<span class="n">delete</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="nf">..</span>  <span class="p">(</span><span class="n">annihilate</span><span class="p">)</span> <span class="nf">..</span>
<span class="k">end</span>

<span class="n">options</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="nf">..</span>  <span class="p">(</span><span class="n">appease</span><span class="p">)</span> <span class="nf">..</span>
<span class="k">end</span>
</pre><pre class="highlight text">     .

  , `params`    :
</pre><pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/hello/:name'</span> <span class="k">do</span>
  <span class="c1"># &quot;GET /hello/foo&quot;  &quot;GET /hello/bar&quot; </span>
  <span class="c1"># params[:name] 'foo'  'bar'</span>
  <span class="s2">&quot;Hello </span><span class="si">#{</span><span class="n">params</span><span class="o">[</span><span class="ss">:name</span><span class="o">]</span><span class="si">}</span><span class="s2">!&quot;</span>
<span class="k">end</span>
</pre><pre class="highlight text">     :
</pre><pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/hello/:name'</span> <span class="k">do</span> <span class="o">|</span><span class="n">n</span><span class="o">|</span>
  <span class="s2">&quot;Hello </span><span class="si">#{</span><span class="n">n</span><span class="si">}</span><span class="s2">!&quot;</span>
<span class="k">end</span>
</pre>
<p>(splat,  )   ,   <code>params[:splat]</code>    :</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/say/*/to/*'</span> <span class="k">do</span>
  <span class="c1"># /say/hello/to/world </span>
  <span class="n">params</span><span class="o">[</span><span class="ss">:splat</span><span class="o">]</span> <span class="c1"># =&gt; [&quot;hello&quot;, &quot;world&quot;]</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/download/*.*'</span> <span class="k">do</span>
  <span class="c1"># /download/path/to/file.xml </span>
  <span class="n">params</span><span class="o">[</span><span class="ss">:splat</span><span class="o">]</span> <span class="c1"># =&gt; [&quot;path/to/file&quot;, &quot;xml&quot;]</span>
<span class="k">end</span>
</pre>
<p>:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/download/*.*'</span> <span class="k">do</span> <span class="o">|</span><span class="n">path</span><span class="p">,</span> <span class="n">ext</span><span class="o">|</span>
  <span class="o">[</span><span class="n">path</span><span class="p">,</span> <span class="n">ext</span><span class="o">]</span> <span class="c1"># =&gt; [&quot;path/to/file&quot;, &quot;xml&quot;]</span>
<span class="k">end</span>
</pre>
<p>:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="sr">%r{/hello/([</span><span class="se">\w</span><span class="sr">]+)}</span> <span class="k">do</span>
  <span class="s2">&quot;Hello, </span><span class="si">#{</span><span class="n">params</span><span class="o">[</span><span class="ss">:captures</span><span class="o">]</span><span class="nf">.first</span><span class="si">}</span><span class="s2">!&quot;</span>
<span class="k">end</span>
</pre>
<p>:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="sr">%r{/hello/([</span><span class="se">\w</span><span class="sr">]+)}</span> <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span>
  <span class="s2">&quot;Hello, </span><span class="si">#{</span><span class="n">c</span><span class="si">}</span><span class="s2">!&quot;</span>
<span class="k">end</span>
</pre>
<p>(optional)    :</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/posts.?:format?'</span> <span class="k">do</span>
  <span class="c1"># &quot;GET /posts&quot;  &quot;GET /posts.json&quot;, &quot;GET /posts.xml&quot;     </span>
<span class="k">end</span>
</pre>
<p>,    (path traversal attack protection,  )  , 
       .</p>

<a name='(Conditions)'></a>
<h3>(Conditions)</h3>
<pre class="highlight text">(user agent)       :
</pre><pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/foo'</span><span class="p">,</span> <span class="ss">:agent</span> <span class="o">=&gt;</span> <span class="sr">/Songbird (\d\.\d)[\d\/]*?/</span> <span class="k">do</span>
  <span class="s2">&quot;Songbird  </span><span class="si">#{</span><span class="n">params</span><span class="o">[</span><span class="ss">:agent</span><span class="o">][</span><span class="mi">0</span><span class="o">]</span><span class="si">}</span><span class="s2"> !&quot;</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/foo'</span> <span class="k">do</span>
  <span class="c1"># songbird    </span>
<span class="k">end</span>
</pre><pre class="highlight text">`host_name` `provides` :
</pre><pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/'</span><span class="p">,</span> <span class="ss">:host_name</span> <span class="o">=&gt;</span> <span class="sr">/^admin\./</span> <span class="k">do</span>
  <span class="s2">&quot;Admin Area, Access denied!&quot;</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/'</span><span class="p">,</span> <span class="ss">:provides</span> <span class="o">=&gt;</span> <span class="s1">'html'</span> <span class="k">do</span>
  <span class="n">haml</span> <span class="ss">:index</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/'</span><span class="p">,</span> <span class="ss">:provides</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="s1">'rss'</span><span class="p">,</span> <span class="s1">'atom'</span><span class="p">,</span> <span class="s1">'xml'</span><span class="o">]</span> <span class="k">do</span>
  <span class="n">builder</span> <span class="ss">:feed</span>
<span class="k">end</span>
</pre><pre class="highlight text"> :
</pre><pre class="highlight ruby"><span class="n">set</span><span class="p">(</span><span class="ss">:probability</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">value</span><span class="o">|</span> <span class="n">condition</span> <span class="p">{</span> <span class="nb">rand</span> <span class="o">&lt;=</span> <span class="n">value</span> <span class="p">}</span> <span class="p">}</span>

<span class="n">get</span> <span class="s1">'/win_a_car'</span><span class="p">,</span> <span class="ss">:probability</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="o">.</span><span class="mi">1</span> <span class="k">do</span>
  <span class="s2">&quot; !&quot;</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/win_a_car'</span> <span class="k">do</span>
  <span class="s2">&quot; .&quot;</span>
<span class="k">end</span>
</pre><pre class="highlight text">(splat) :
</pre><pre class="highlight ruby"><span class="n">set</span><span class="p">(</span><span class="ss">:auth</span><span class="p">)</span> <span class="k">do</span> <span class="o">|*</span><span class="n">roles</span><span class="o">|</span>   <span class="c1"># &lt;-  </span>
  <span class="n">condition</span> <span class="k">do</span>
    <span class="k">unless</span> <span class="n">logged_in?</span> <span class="o">&amp;&amp;</span> <span class="n">roles</span><span class="nf">.any?</span> <span class="p">{</span><span class="o">|</span><span class="n">role</span><span class="o">|</span> <span class="n">current_user</span><span class="nf">.in_role?</span> <span class="n">role</span> <span class="p">}</span>
      <span class="n">redirect</span> <span class="s2">&quot;/login/&quot;</span><span class="p">,</span> <span class="mi">303</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s2">&quot;/my/account/&quot;</span><span class="p">,</span> <span class="ss">:auth</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:user</span><span class="p">,</span> <span class="ss">:admin</span><span class="o">]</span> <span class="k">do</span>
  <span class="s2">&quot;  &quot;</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s2">&quot;/only/admin/&quot;</span><span class="p">,</span> <span class="ss">:auth</span> <span class="o">=&gt;</span> <span class="ss">:admin</span> <span class="k">do</span>
  <span class="s2">&quot;  !&quot;</span>
<span class="k">end</span>
</pre>
<a name='(Return%20Values)'></a>
<h3>(Return Values)</h3>

<p>HTTP     ,  Rack     .
 ,      ,   .</p>

<p>Rack , Rack    HTTP        :</p>

<ul>
<li>   : <code>[ (Fixnum),  (Hash),   (#each )]</code></li>
<li>   : <code>[ (Fixnum),   (#each )]</code></li>
<li><code>#each</code><br></li>
<li><p>Fixnum</p>

<p>,  , (streaming)     :</p></li>
</ul>
<pre class="highlight ruby"><span class="k">class</span> <span class="nc">Stream</span>
  <span class="k">def</span> <span class="nf">each</span>
<span class="mi">100</span><span class="nf">.times</span> <span class="p">{</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span> <span class="k">yield</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">i</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)</span> <span class="p">{</span> <span class="no">Stream</span><span class="nf">.new</span> <span class="p">}</span>
</pre><pre class="highlight text">`stream`  ( )        .
</pre>
<a name='(Custom%20Route%20Matchers)'></a>
<h3>(Custom Route Matchers)</h3>

<p>, Sinatra          .
,   .   (matcher)    :</p>
<pre class="highlight ruby"><span class="k">class</span> <span class="nc">AllButPattern</span>
  <span class="nc">Match</span> <span class="o">=</span> <span class="no">Struct</span><span class="nf">.new</span><span class="p">(</span><span class="ss">:captures</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">except</span><span class="p">)</span>
    <span class="vi">@except</span>   <span class="o">=</span> <span class="n">except</span>
    <span class="vi">@captures</span> <span class="o">=</span> <span class="no">Match</span><span class="nf">.new</span><span class="p">(</span><span class="o">[]</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">match</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
    <span class="vi">@captures</span> <span class="k">unless</span> <span class="vi">@except</span> <span class="o">===</span> <span class="n">str</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">all_but</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
  <span class="no">AllButPattern</span><span class="nf">.new</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">get</span> <span class="n">all_but</span><span class="p">(</span><span class="s2">&quot;/index&quot;</span><span class="p">)</span> <span class="k">do</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</pre><pre class="highlight text">   .     :
</pre><pre class="highlight ruby"><span class="n">get</span> <span class="sr">//</span> <span class="k">do</span>
  <span class="n">pass</span> <span class="k">if</span> <span class="n">request</span><span class="nf">.path_info</span> <span class="o">==</span> <span class="s2">&quot;/index&quot;</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</pre>
<p>(negative look ahead)   :</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="sr">%r{^(?!/index$)}</span> <span class="k">do</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</pre>
<a name='(Static%20Files)'></a>
<h2>(Static Files)</h2>

<p><code>./public</code> .
    <code>:public_folder</code>   :</p>
<pre class="highlight ruby"><span class="n">set</span> <span class="ss">:public_folder</span><span class="p">,</span> <span class="no">File</span><span class="nf">.dirname</span><span class="p">(</span><span class="kp">__FILE__</span><span class="p">)</span> <span class="o">+</span> <span class="s1">'/static'</span>
</pre>
<p>public  URL    .
<code>./public/css/style.css</code>  <code>http://example.com/css/style.css</code>    .</p>

<p><code>Cache-Control</code>    <code>:static_cache_control</code> ( )  .</p>

<a name='/%20(Views%20/%20Templates)'></a>
<h2>/ (Views / Templates)</h2>
<pre class="highlight text">    .
.
</pre><pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">erb</span> <span class="ss">:index</span>
<span class="k">end</span>
</pre>
<p><code>views/index.erb</code> .</p>
<pre class="highlight text">    :
</pre><pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">code</span> <span class="o">=</span> <span class="s2">&quot;&lt;%= Time.now %&gt;&quot;</span>
  <span class="n">erb</span> <span class="n">code</span>
<span class="k">end</span>
</pre><pre class="highlight text">  :
</pre><pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">erb</span> <span class="ss">:index</span><span class="p">,</span> <span class="ss">:layout</span> <span class="o">=&gt;</span> <span class="ss">:post</span>
<span class="k">end</span>
</pre>
<p><code>views/post.erb</code>   <code>views/index.erb</code> .
( <code>views/layout.erb</code>,     ).</p>

<p>Sinatra        :</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">haml</span> <span class="ss">:index</span><span class="p">,</span> <span class="ss">:format</span> <span class="o">=&gt;</span> <span class="ss">:html5</span>
<span class="k">end</span>
</pre><pre class="highlight text">  :
</pre><pre class="highlight ruby"><span class="n">set</span> <span class="ss">:haml</span><span class="p">,</span> <span class="ss">:format</span> <span class="o">=&gt;</span> <span class="ss">:html5</span>

<span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">haml</span> <span class="ss">:index</span>
<span class="k">end</span>
</pre>
<p>render    <code>set</code>     .</p>

<p>:</p>

<dl>
  <dt>locals</dt>
  <dd>  local .    .
: <tt>erb "<%= foo %>", :locals => {:foo => "bar"}</tt>
  </dd>

  <dt>default_encoding</dt>
  <dd>    .  <tt>settings.default_encoding</tt>.</dd>

  <dt>views</dt>
  <dd>   .  <tt>settings.views</tt>.</dd>

  <dt>layout</dt>
  <dd>   (<tt>true</tt>  <tt>false</tt>),     , 
  . : <tt>erb :index, :layout => !request.xhr?</tt>
  </dd>

  <dt>content_type</dt>
  <dd>  Content-Type,    .</dd>

  <dt>scope</dt>
  <dd>  .   .
   ,        .</dd>

  <dt>layout_engine</dt>
  <dd>
    .      .
   . : <tt>set :rdoc, :layout_engine => :erb</tt>
  </dd>
</dl>

<p><code>./views</code>    .      :</p>
<pre class="highlight ruby"><span class="n">set</span> <span class="ss">:views</span><span class="p">,</span> <span class="n">settings</span><span class="nf">.root</span> <span class="o">+</span> <span class="s1">'/templates'</span>
</pre><pre class="highlight text">       ,
 (  `:'subdir/template'` ). 
</pre>
<p>,             .</p>

<a name='(Available%20Template%20Languages)'></a>
<h3>(Available Template Languages)</h3>
<pre class="highlight text"> .    ( -thread-safe  ),
</pre>
<p>require   :</p>
<pre class="highlight ruby"><span class="nb">require</span> <span class="s1">'rdiscount'</span> <span class="c1"># or require 'bluecloth'</span>
<span class="n">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)</span> <span class="p">{</span> <span class="n">markdown</span> <span class="ss">:index</span> <span class="p">}</span>
</pre>
<a name='Haml'></a>
<h3>Haml</h3>

<table>
  <tr>
<td></td>
<td><a href="http://haml.info/">haml</a></td>
  </tr>
  <tr>
<td> </td>
<td><tt>.haml</tt></td>
  </tr>
  <tr>
<td></td>
<td><tt>haml :index, :format => :html5</tt></td>
  </tr>
</table>

<a name='Erb'></a>
<h3>Erb</h3>

<table>
  <tr>
<td></td>
<td><a href="http://www.kuwata-lab.com/erubis/">erubis</a>  erb (  )</td>
  </tr>
  <tr>
<td> </td>
<td><tt>.erb</tt>, <tt>.rhtml</tt>  <tt>.erubis</tt> (Erubis )</td>
  </tr>
  <tr>
<td></td>
<td><tt>erb :index</tt></td>
  </tr>
</table>

<a name='Builder'></a>
<h3>Builder</h3>

<table>
  <tr>
<td></td>
<td><a href="http://builder.rubyforge.org/">builder</a></td>
  </tr>
  <tr>
<td> </td>
<td><tt>.builder</tt></td>
  </tr>
  <tr>
<td>Example</td>
<td><tt>builder { |xml| xml.em "hi" }</tt></td>
  </tr>
</table>

<p>( ).</p>

<a name='Nokogiri'></a>
<h3>Nokogiri</h3>

<table>
  <tr>
<td></td>
<td><a href="http://nokogiri.org/">nokogiri</a></td>
  </tr>
  <tr>
<td> </td>
<td><tt>.nokogiri</tt></td>
  </tr>
  <tr>
<td></td>
<td><tt>nokogiri { |xml| xml.em "hi" }</tt></td>
  </tr>
</table>

<p>( ).</p>

<a name='Sass'></a>
<h3>Sass</h3>

<table>
  <tr>
<td></td>
<td><a href="http://sass-lang.com/">sass</a></td>
  </tr>
  <tr>
<td> </td>
<td><tt>.sass</tt></td>
  </tr>
  <tr>
<td></td>
<td><tt>sass :stylesheet, :style => :expanded</tt></td>
  </tr>
</table>

<a name='SCSS'></a>
<h3>SCSS</h3>

<table>
  <tr>
<td></td>
<td><a href="http://sass-lang.com/">sass</a></td>
  </tr>
  <tr>
<td> </td>
<td><tt>.scss</tt></td>
  </tr>
  <tr>
<td></td>
<td><tt>scss :stylesheet, :style => :expanded</tt></td>
  </tr>
</table>

<a name='Less'></a>
<h3>Less</h3>

<table>
  <tr>
<td></td>
<td><a href="http://www.lesscss.org/">less</a></td>
  </tr>
  <tr>
<td> </td>
<td><tt>.less</tt></td>
  </tr>
  <tr>
<td></td>
<td><tt>less :stylesheet</tt></td>
  </tr>
</table>

<a name='Liquid'></a>
<h3>Liquid</h3>

<table>
  <tr>
<td></td>
<td><a href="http://www.liquidmarkup.org/">liquid</a></td>
  </tr>
  <tr>
<td> </td>
<td><tt>.liquid</tt></td>
  </tr>
  <tr>
<td></td>
<td><tt>liquid :index, :locals => { :key => 'value' }</tt></td>
  </tr>
</table>

<p>Liquid   (<code>yield</code> )    ,    locals  .</p>

<a name='Markdown'></a>
<h3>Markdown</h3>

<table>
  <tr>
    <td></td>
    <td>
      <a href="https://github.com/rtomayko/rdiscount">rdiscount</a>,
      <a href="https://github.com/vmg/redcarpet">redcarpet</a>,
      <a href="http://deveiate.org/projects/BlueCloth">bluecloth</a>,
      <a href="http://kramdown.rubyforge.org/">kramdown</a> **
      <a href="http://maruku.rubyforge.org/">maruku</a>
    </td>
  </tr>
  <tr>
    <td> </td>
    <td><tt>.markdown</tt>, <tt>.mkd</tt>,  <tt>.md</tt></td>
  </tr>
  <tr>
    <td></td>
    <td><tt>markdown :index, :layout_engine => :erb</tt></td>
  </tr>
</table>
<pre class="highlight text"> locals  . 
    :
</pre><pre class="highlight ruby"><span class="n">erb</span> <span class="ss">:overview</span><span class="p">,</span> <span class="ss">:locals</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:text</span> <span class="o">=&gt;</span> <span class="n">markdown</span><span class="p">(</span><span class="ss">:introduction</span><span class="p">)</span> <span class="p">}</span>
</pre><pre class="highlight text">`markdown`    :
</pre><pre class="highlight ruby"><span class="o">%</span><span class="n">h1</span>  <span class="no">Haml</span><span class="o">!</span>
<span class="o">%</span><span class="nb">p</span><span class="o">=</span> <span class="n">markdown</span><span class="p">(</span><span class="ss">:greetings</span><span class="p">)</span>
</pre>
<p>Markdown     , Markdown     .
, <code>:layout_engine</code>         .</p>

<a name='Textile'></a>
<h3>Textile</h3>

<table>
  <tr>
<td></td>
<td><a href="http://redcloth.org/">RedCloth</a></td>
  </tr>
  <tr>
<td> </td>
<td><tt>.textile</tt></td>
  </tr>
  <tr>
<td></td>
<td><tt>textile :index, :layout_engine => :erb</tt></td>
  </tr>
</table>

<p>Textile   locals   .
        :</p>
<pre class="highlight ruby"><span class="n">erb</span> <span class="ss">:overview</span><span class="p">,</span> <span class="ss">:locals</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:text</span> <span class="o">=&gt;</span> <span class="n">textile</span><span class="p">(</span><span class="ss">:introduction</span><span class="p">)</span> <span class="p">}</span>
</pre><pre class="highlight text">`textile`    :
</pre><pre class="highlight ruby"><span class="o">%</span><span class="n">h1</span>  <span class="no">Haml</span><span class="o">!</span>
<span class="o">%</span><span class="nb">p</span><span class="o">=</span> <span class="n">textile</span><span class="p">(</span><span class="ss">:greetings</span><span class="p">)</span>
</pre>
<p>Textile     , Textile     .
, <code>:layout_engine</code>         .</p>

<a name='RDoc'></a>
<h3>RDoc</h3>

<table>
  <tr>
<td></td>
<td><a href="http://rdoc.rubyforge.org/">rdoc</a></td>
  </tr>
  <tr>
<td> </td>
<td><tt>.rdoc</tt></td>
  </tr>
  <tr>
<td></td>
<td><tt>rdoc :README, :layout_engine => :erb</tt></td>
  </tr>
</table>

<p>rdoc   locals   .
        :</p>
<pre class="highlight ruby"><span class="n">erb</span> <span class="ss">:overview</span><span class="p">,</span> <span class="ss">:locals</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:text</span> <span class="o">=&gt;</span> <span class="n">rdoc</span><span class="p">(</span><span class="ss">:introduction</span><span class="p">)</span> <span class="p">}</span>
</pre><pre class="highlight text">`rdoc`    :
</pre><pre class="highlight ruby"><span class="o">%</span><span class="n">h1</span> <span class="no">Hello</span> <span class="no">From</span> <span class="no">Haml</span><span class="o">!</span>
<span class="o">%</span><span class="nb">p</span><span class="o">=</span> <span class="n">rdoc</span><span class="p">(</span><span class="ss">:greetings</span><span class="p">)</span>
</pre>
<p>RDoc     , RDoc     .
, <code>:layout_engine</code>         .</p>

<a name='Radius'></a>
<h3>Radius</h3>

<table>
  <tr>
<td></td>
<td><a href="http://radius.rubyforge.org/">radius</a></td>
  </tr>
  <tr>
<td> </td>
<td><tt>.radius</tt></td>
  </tr>
  <tr>
<td></td>
<td><tt>radius :index, :locals => { :key => 'value' }</tt></td>
  </tr>
</table>

<p>Radius       ,    locals   .</p>

<a name='Markaby'></a>
<h3>Markaby</h3>

<table>
  <tr>
<td></td>
<td><a href="http://markaby.github.com/">markaby</a></td>
  </tr>
  <tr>
<td></td>
<td><tt>.mab</tt></td>
  </tr>
  <tr>
<td></td>
<td><tt>markaby { h1 "Welcome!" }</tt></td>
  </tr>
</table>
<pre class="highlight text"> ( ).
</pre>
<a name='RABL'></a>
<h3>RABL</h3>

<table>
  <tr>
<td></td>
<td><a href="https://github.com/nesquena/rabl">rabl</a></td>
  </tr>
  <tr>
<td> </td>
<td><tt>.rabl</tt></td>
  </tr>
  <tr>
<td></td>
<td><tt>rabl :index</tt></td>
  </tr>
</table>

<a name='Slim'></a>
<h3>Slim</h3>

<table>
  <tr>
<td></td>
<td><a href="http://slim-lang.com/">slim</a></td>
  </tr>
  <tr>
<td> </td>
<td><tt>.slim</tt></td>
  </tr>
  <tr>
<td></td>
<td><tt>slim :index</tt></td>
  </tr>
</table>

<a name='Creole'></a>
<h3>Creole</h3>

<table>
  <tr>
<td></td>
<td><a href="https://github.com/minad/creole">creole</a></td>
  </tr>
  <tr>
<td> </td>
<td><tt>.creole</tt></td>
  </tr>
  <tr>
<td></td>
<td><tt>creole :wiki, :layout_engine => :erb</tt></td>
  </tr>
</table>

<p>creole      locals   .
        .</p>
<pre class="highlight ruby"><span class="n">erb</span> <span class="ss">:overview</span><span class="p">,</span> <span class="ss">:locals</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:text</span> <span class="o">=&gt;</span> <span class="n">creole</span><span class="p">(</span><span class="ss">:introduction</span><span class="p">)</span> <span class="p">}</span>
</pre><pre class="highlight text">`creole`    :
</pre><pre class="highlight ruby"><span class="o">%</span><span class="n">h1</span> <span class="no">Hello</span> <span class="no">From</span> <span class="no">Haml</span><span class="o">!</span>
<span class="o">%</span><span class="nb">p</span><span class="o">=</span> <span class="n">creole</span><span class="p">(</span><span class="ss">:greetings</span><span class="p">)</span>
</pre>
<p>Creole     , Creole     .
, <code>:layout_engine</code>         .</p>

<a name='CoffeeScript'></a>
<h3>CoffeeScript</h3>

<table>
  <tr>
<td></td>
<td><a href="https://github.com/josh/ruby-coffee-script">coffee-script</a>
   <a href="https://github.com/sstephenson/execjs/blob/master/README.md#readme"> </a>
</td>
  </tr>
  <tr>
<td> </td>
<td><tt>.coffee</tt></td>
  </tr>
  <tr>
<td></td>
<td><tt>coffee :index</tt></td>
  </tr>
</table>

<a name='Yajl'></a>
<h3>Yajl</h3>

<table>
  <tr>
<td></td>
<td><a href="https://github.com/brianmario/yajl-ruby">yajl-ruby</a></td>
  </tr>
  <tr>
<td> </td>
<td><tt>.yajl</tt></td>
  </tr>
  <tr>
<td></td>
<td><tt>yajl :index, :locals => { :key => 'qux' }, :callback => 'present', :variable => 'resource' </tt></td>
  </tr>
</table>

<p>The template source is evaluated as a Ruby string, and the resulting json variable is converted #to<em>json.
    (evaluate),  json  #to</em>json .</p>
<pre class="highlight ruby"><span class="n">json</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">:foo</span> <span class="o">=&gt;</span> <span class="s1">'bar'</span> <span class="p">}</span>
<span class="n">json</span><span class="o">[</span><span class="ss">:baz</span><span class="o">]</span> <span class="o">=</span> <span class="n">key</span>
</pre>
<p><code>:callback</code> <code>:variable</code>    (decorate)   .</p>
<pre class="highlight ruby"><span class="n">var</span> <span class="n">resource</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;foo&quot;</span><span class="ss">:&quot;bar&quot;</span><span class="p">,</span><span class="s2">&quot;baz&quot;</span><span class="ss">:&quot;qux&quot;</span><span class="p">};</span> <span class="n">present</span><span class="p">(</span><span class="n">resource</span><span class="p">);</span>
</pre>
<a name='(Embedded)'></a>
<h3>(Embedded)</h3>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">haml</span> <span class="s1">'%div.title Hello World'</span>
<span class="k">end</span>
</pre>
<p>.</p>

<p>Templates are evaluated within the same context as route handlers. Instance
variables set in route handlers are directly accessible by templates:
    (context) .
       : </p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/:id'</span> <span class="k">do</span>
  <span class="vi">@foo</span> <span class="o">=</span> <span class="no">Foo</span><span class="nf">.find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
  <span class="n">haml</span> <span class="s1">'%h1= @foo.name'</span>
<span class="k">end</span>
</pre>
<p>,     : </p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/:id'</span> <span class="k">do</span>
  <span class="n">foo</span> <span class="o">=</span> <span class="no">Foo</span><span class="nf">.find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
  <span class="n">haml</span> <span class="s1">'%h1= bar.name'</span><span class="p">,</span> <span class="ss">:locals</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:bar</span> <span class="o">=&gt;</span> <span class="n">foo</span> <span class="p">}</span>
<span class="k">end</span>
</pre>
<p>This is typically used when rendering templates as partials from within
other templates.
       (partial)   .</p>
<pre class="highlight text">  :
</pre><pre class="highlight ruby"><span class="nb">require</span> <span class="s1">'sinatra'</span>

<span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">haml</span> <span class="ss">:index</span>
<span class="k">end</span>

<span class="cp">__END__

@@ layout
%html
= yield

@@ index
%div.title Hello world.
</span></pre>
<p>: require sinatra        .
       <code>enable :inline_templates</code>  .</p>

<a name='(Named%20Templates)'></a>
<h3>(Named Templates)</h3>

<p>(top-level) <code>template</code>    :</p>
<pre class="highlight ruby"><span class="n">template</span> <span class="ss">:layout</span> <span class="k">do</span>
  <span class="s2">&quot;%html</span><span class="se">\n</span><span class="s2">  =yield</span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="k">end</span>

<span class="n">template</span> <span class="ss">:index</span> <span class="k">do</span>
  <span class="s1">'%div.title Hello World!'</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">haml</span> <span class="ss">:index</span>
<span class="k">end</span>
</pre>
<p>&quot;layout&quot;   ,      .
  <code>:layout =&gt; false</code><br>
 <code>set :haml, :layout =&gt; false</code>     :</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">haml</span> <span class="ss">:index</span><span class="p">,</span> <span class="ss">:layout</span> <span class="o">=&gt;</span> <span class="o">!</span><span class="n">request</span><span class="nf">.xhr?</span>
<span class="k">end</span>
</pre><pre class="highlight text">  , `Tilt.register`  .
</pre>
<p>, <code>tt</code>   Textile   ,    :</p>
<pre class="highlight ruby"><span class="no">Tilt</span><span class="nf">.register</span> <span class="ss">:tt</span><span class="p">,</span> <span class="no">Tilt</span><span class="o">[</span><span class="ss">:textile</span><span class="o">]</span>
</pre>
<p>, Tilt   ,     :</p>
<pre class="highlight ruby"><span class="no">Tilt</span><span class="nf">.register</span> <span class="ss">:myat</span><span class="p">,</span> <span class="no">MyAwesomeTemplateEngine</span>

<span class="n">helpers</span> <span class="k">do</span>
  <span class="k">def</span> <span class="nf">myat</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span> <span class="n">render</span><span class="p">(</span><span class="ss">:myat</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span> <span class="k">end</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">myat</span> <span class="ss">:index</span>
<span class="k">end</span>
</pre>
<p><code>./views/index.myat</code>  . 
Tilt     https://github.com/rtomayko/tilt .</p>

<a name='(Filters)'></a>
<h2>(Filters)</h2>

<p>(before filter)            .
        :</p>
<pre class="highlight ruby"><span class="n">before</span> <span class="k">do</span>
  <span class="vi">@note</span> <span class="o">=</span> <span class="s1">'Hi!'</span>
  <span class="n">request</span><span class="nf">.path_info</span> <span class="o">=</span> <span class="s1">'/foo/bar/baz'</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/foo/*'</span> <span class="k">do</span>
  <span class="vi">@note</span> <span class="c1">#=&gt; 'Hi!'</span>
  <span class="n">params</span><span class="o">[</span><span class="ss">:splat</span><span class="o">]</span> <span class="c1">#=&gt; 'bar/baz'</span>
<span class="k">end</span>
</pre>
<p>(after filter)             .
         :</p>
<pre class="highlight ruby"><span class="n">after</span> <span class="k">do</span>
  <span class="nb">puts</span> <span class="n">response</span><span class="nf">.status</span>
<span class="k">end</span>
</pre>
<p>:   <code>body</code>       , body   ,       .</p>
<pre class="highlight text"> ,           .
</pre><pre class="highlight ruby"><span class="n">before</span> <span class="s1">'/protected/*'</span> <span class="k">do</span>
  <span class="n">authenticate!</span>
<span class="k">end</span>

<span class="n">after</span> <span class="s1">'/create/:slug'</span> <span class="k">do</span> <span class="o">|</span><span class="n">slug</span><span class="o">|</span>
  <span class="n">session</span><span class="o">[</span><span class="ss">:last_slug</span><span class="o">]</span> <span class="o">=</span> <span class="n">slug</span>
<span class="k">end</span>
</pre>
<p>,    :</p>
<pre class="highlight ruby"><span class="n">before</span> <span class="ss">:agent</span> <span class="o">=&gt;</span> <span class="sr">/Songbird/</span> <span class="k">do</span>
  <span class="c1"># ...</span>
<span class="k">end</span>

<span class="n">after</span> <span class="s1">'/blog/*'</span><span class="p">,</span> <span class="ss">:host_name</span> <span class="o">=&gt;</span> <span class="s1">'example.com'</span> <span class="k">do</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</pre>
<a name='(Helpers)'></a>
<h2>(Helpers)</h2>

<ul>
<li><code>helpers</code>           :</li>
</ul>
<pre class="highlight ruby"><span class="n">helpers</span> <span class="k">do</span>
  <span class="k">def</span> <span class="nf">bar</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
    <span class="s2">&quot;</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">bar&quot;</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/:name'</span> <span class="k">do</span>
  <span class="n">bar</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:name</span><span class="o">]</span><span class="p">)</span>
<span class="k">end</span>
</pre>
<p>,        :</p>
<pre class="highlight ruby"><span class="k">module</span> <span class="nn">FooUtils</span>
  <span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">foo&quot;</span> <span class="k">end</span>
<span class="k">end</span>

<span class="k">module</span> <span class="nn">BarUtils</span>
  <span class="k">def</span> <span class="nf">bar</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">bar&quot;</span> <span class="k">end</span>
<span class="k">end</span>

<span class="n">helpers</span> <span class="no">FooUtils</span><span class="p">,</span> <span class="no">BarUtils</span>
</pre><pre class="highlight text"> (include)    .
</pre>
<a name='(Sessions)'></a>
<h3>(Sessions)</h3>
<pre class="highlight text">  . 
</pre>
<p>,    session    :</p>
<pre class="highlight ruby"><span class="n">enable</span> <span class="ss">:sessions</span>

<span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="s2">&quot;value = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">session</span><span class="o">[</span><span class="ss">:value</span><span class="o">]</span><span class="nf">.inspect</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/:value'</span> <span class="k">do</span>
  <span class="n">session</span><span class="o">[</span><span class="ss">:value</span><span class="o">]</span> <span class="o">=</span> <span class="n">params</span><span class="o">[</span><span class="ss">:value</span><span class="o">]</span>
<span class="k">end</span>
</pre>
<p><code>enable :sessions</code>       .
       ( ,       ).
      (Rack session middleware)    :
  , <code>enable :sessions</code>  **, 
        :</p>
<pre class="highlight ruby"><span class="n">use</span> <span class="no">Rack</span><span class="o">::</span><span class="no">Session</span><span class="o">::</span><span class="no">Pool</span><span class="p">,</span> <span class="ss">:expire_after</span> <span class="o">=&gt;</span> <span class="mi">2592000</span>

<span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="s2">&quot;value = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">session</span><span class="o">[</span><span class="ss">:value</span><span class="o">]</span><span class="nf">.inspect</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/:value'</span> <span class="k">do</span>
  <span class="n">session</span><span class="o">[</span><span class="ss">:value</span><span class="o">]</span> <span class="o">=</span> <span class="n">params</span><span class="o">[</span><span class="ss">:value</span><span class="o">]</span>
<span class="k">end</span>
</pre>
<p>,      (secret) (sign). 
Sinatra     .
,          ,
           :</p>
<pre class="highlight ruby"><span class="n">set</span> <span class="ss">:session_secret</span><span class="p">,</span> <span class="s1">'super secret'</span>
</pre><pre class="highlight text">, `sessions`        :
</pre><pre class="highlight ruby"><span class="n">set</span> <span class="ss">:sessions</span><span class="p">,</span> <span class="ss">:domain</span> <span class="o">=&gt;</span> <span class="s1">'foo.com'</span>
</pre>
<a name='(Halting)'></a>
<h3>(Halting)</h3>
<pre class="highlight text">   :
</pre><pre class="highlight ruby"><span class="n">halt</span>
</pre><pre class="highlight text"> :
</pre><pre class="highlight ruby"><span class="n">halt</span> <span class="mi">410</span>
</pre><pre class="highlight text">:
</pre><pre class="highlight ruby"><span class="n">halt</span> <span class="s1">'this will be the body'</span>
</pre>
<p>:</p>
<pre class="highlight ruby"><span class="n">halt</span> <span class="mi">401</span><span class="p">,</span> <span class="s1">'go away!'</span>
</pre><pre class="highlight text">  :
</pre><pre class="highlight ruby"><span class="n">halt</span> <span class="mi">402</span><span class="p">,</span> <span class="p">{</span><span class="s1">'Content-Type'</span> <span class="o">=&gt;</span> <span class="s1">'text/plain'</span><span class="p">},</span> <span class="s1">'revenge'</span>
</pre>
<p><code>halt</code>    :</p>
<pre class="highlight ruby"><span class="n">halt</span> <span class="n">erb</span><span class="p">(</span><span class="ss">:error</span><span class="p">)</span>
</pre>
<a name='(Passing)'></a>
<h3>(Passing)</h3>

<p><code>pass</code>         :</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/guess/:who'</span> <span class="k">do</span>
  <span class="n">pass</span> <span class="k">unless</span> <span class="n">params</span><span class="o">[</span><span class="ss">:who</span><span class="o">]</span> <span class="o">==</span> <span class="s1">'Frank'</span>
  <span class="s1">'You got me!'</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/guess/*'</span> <span class="k">do</span>
  <span class="s1">'You missed!'</span>
<span class="k">end</span>
</pre><pre class="highlight text">        .
, 404 .
</pre>
<a name='(Triggering%20Another%20Route)'></a>
<h3>(Triggering Another Route)</h3>

<p><code>pass</code> ,         .
   +<code>call</code>+  :</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/foo'</span> <span class="k">do</span>
  <span class="n">status</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">body</span> <span class="o">=</span> <span class="n">call</span> <span class="n">env</span><span class="nf">.merge</span><span class="p">(</span><span class="s2">&quot;PATH_INFO&quot;</span> <span class="o">=&gt;</span> <span class="s1">'/bar'</span><span class="p">)</span>
  <span class="o">[</span><span class="n">status</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">body</span><span class="nf">.map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:upcase</span><span class="p">)</span><span class="o">]</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/bar'</span> <span class="k">do</span>
<span class="s2">&quot;bar&quot;</span>
<span class="k">end</span>
</pre>
<p>, <code>&quot;bar&quot;</code>   <code>/foo</code> <code>/bar</code><br>
       .</p>
<pre class="highlight text">       , 
</pre>
<p><code>call</code>  <code>call!</code>  .</p>

<p><code>call</code>     Rack   .</p>

<a name=','></a>
<h3>,</h3>
<pre class="highlight text"> (status code)  (response body)      . ,            .
</pre>
<p><code>body</code>    .
 ,          :</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/foo'</span> <span class="k">do</span>
  <span class="n">body</span> <span class="s2">&quot;bar&quot;</span>
<span class="k">end</span>

<span class="n">after</span> <span class="k">do</span>
  <span class="nb">puts</span> <span class="n">body</span>
<span class="k">end</span>
</pre>
<p><code>body</code>    ,   (Rack)    .
(       , &quot; &quot; ).</p>

<p>,     :</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/foo'</span> <span class="k">do</span>
  <span class="n">status</span> <span class="mi">418</span>
  <span class="n">headers</span> <span class="p">\</span>
<span class="s2">&quot;Allow&quot;</span>   <span class="o">=&gt;</span> <span class="s2">&quot;BREW, POST, GET, PROPFIND, WHEN&quot;</span><span class="p">,</span>
<span class="s2">&quot;Refresh&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Refresh: 20; http://www.ietf.org/rfc/rfc2324.txt&quot;</span>
  <span class="n">body</span> <span class="s2">&quot;I'm a tea pot!&quot;</span>
<span class="k">end</span>
</pre>
<p><code>body</code>, <code>header</code> <code>status</code>           .</p>

<a name='(Streaming%20Responses)'></a>
<h3>(Streaming Responses)</h3>
<pre class="highlight text">         .
</pre>
<p>,          .
 (wrapper)   <code>stream</code>   :</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">stream</span> <span class="k">do</span> <span class="o">|</span><span class="n">out</span><span class="o">|</span>
<span class="n">out</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;It's gonna be legen -</span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="nb">sleep</span> <span class="mi">0</span><span class="o">.</span><span class="mi">5</span>
<span class="n">out</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot; (wait for it) </span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="nb">sleep</span> <span class="mi">1</span>
<span class="n">out</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;- dary!</span><span class="se">\n</span><span class="s2">&quot;</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre>
<p>API 
<a href="http://dev.w3.org/html5/eventsource/">  Server Sent Events</a>     ,
<a href="http://en.wikipedia.org/wiki/WebSocket">WebSockets</a>     .</p>

<p>(throughtput)     .</p>

<p>,         .
 ,  WEBRick        .
    ,  <code>stream</code>         .
 Shotgun  . </p>

<p><code>keep_open</code>  ,   <code>close</code>   ,
           .
  Thin Rainbow     .
     :</p>
<pre class="highlight ruby"><span class="n">set</span> <span class="ss">:server</span><span class="p">,</span> <span class="ss">:thin</span>
<span class="n">connections</span> <span class="o">=</span> <span class="o">[]</span>

<span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="c1">#    </span>
  <span class="n">stream</span><span class="p">(</span><span class="ss">:keep_open</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">out</span><span class="o">|</span> <span class="n">connections</span> <span class="o">&lt;&lt;</span> <span class="n">out</span> <span class="p">}</span>
<span class="k">end</span>

<span class="n">post</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="c1">#    </span>
  <span class="n">connections</span><span class="nf">.each</span> <span class="p">{</span> <span class="o">|</span><span class="n">out</span><span class="o">|</span> <span class="n">out</span> <span class="o">&lt;&lt;</span> <span class="n">params</span><span class="o">[</span><span class="ss">:message</span><span class="o">]</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="p">}</span>
  <span class="s2">&quot;message sent&quot;</span>
<span class="k">end</span>
</pre>
<a name='(Logging)'></a>
<h3>(Logging)</h3>

<p>In the request scope, the <code>logger</code> helper exposes a <code>Logger</code> instance:
 (request scope) , <code>Logger</code>  <code>logger</code>    : </p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">logger</span><span class="nf">.info</span> <span class="s2">&quot;loading data&quot;</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</pre>
<p>Rack      .
  ,   (dummy)   ,
         .</p>

<p><code>Sinatra::Application</code>    .
 <code>Sinatra::Base</code>      :</p>
<pre class="highlight ruby"><span class="k">class</span> <span class="nc">MyApp</span> <span class="o">&lt;</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">configure</span> <span class="ss">:production</span><span class="p">,</span> <span class="ss">:development</span> <span class="k">do</span>
<span class="n">enable</span> <span class="ss">:logging</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre><pre class="highlight text"> , `logging`  `nil`  .
</pre>
<p>,   <code>logger</code> <code>nil</code>   .
       .
Sinatra <code>env[&#39;rack.logger&#39;]</code>    .</p>

<a name='(Mime%20Types)'></a>
<h3>(Mime Types)</h3>

<p><code>send_file</code>     Sinatra       .
  <code>mime_type</code>     :</p>
<pre class="highlight ruby"><span class="n">configure</span> <span class="k">do</span>
  <span class="n">mime_type</span> <span class="ss">:foo</span><span class="p">,</span> <span class="s1">'text/foo'</span>
<span class="k">end</span>
</pre>
<p><code>content_type</code>     :</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">content_type</span> <span class="ss">:foo</span>
  <span class="s2">&quot;foo foo foo&quot;</span>
<span class="k">end</span>
</pre>
<a name='URL'></a>
<h3>URL</h3>

<p>URL  <code>url</code>    .   Haml:</p>
<pre class="highlight ruby"><span class="o">%</span><span class="n">a</span><span class="p">{</span><span class="ss">:href</span> <span class="o">=&gt;</span> <span class="n">url</span><span class="p">(</span><span class="s1">'/foo'</span><span class="p">)}</span> <span class="n">foo</span>
</pre>
<p>(reverse proxies) Rack ,  , .</p>

<p>This method is also aliased to <code>to</code> (see below for an example).
  <code>to</code>     (  ).</p>

<a name='(Browser%20Redirect)'></a>
<h3>(Browser Redirect)</h3>

<p><code>redirect</code>        :</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/foo'</span> <span class="k">do</span>
  <span class="n">redirect</span> <span class="n">to</span><span class="p">(</span><span class="s1">'/bar'</span><span class="p">)</span>
<span class="k">end</span>
</pre>
<p><code>halt</code>    :</p>
<pre class="highlight ruby"><span class="n">redirect</span> <span class="n">to</span><span class="p">(</span><span class="s1">'/bar'</span><span class="p">),</span> <span class="mi">303</span>
<span class="n">redirect</span> <span class="s1">'http://google.com'</span><span class="p">,</span> <span class="s1">'wrong place, buddy'</span>
</pre>
<p><code>redirect back</code>           :</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/foo'</span> <span class="k">do</span>
  <span class="s2">&quot;&lt;a href='/bar'&gt;do something&lt;/a&gt;&quot;</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/bar'</span> <span class="k">do</span>
  <span class="n">do_something</span>
  <span class="n">redirect</span> <span class="n">back</span>
<span class="k">end</span>
</pre>
<p>,  :</p>
<pre class="highlight ruby"><span class="n">redirect</span> <span class="n">to</span><span class="p">(</span><span class="s1">'/bar?sum=42'</span><span class="p">)</span>
</pre>
<p>:</p>
<pre class="highlight ruby"><span class="n">enable</span> <span class="ss">:sessions</span>

<span class="n">get</span> <span class="s1">'/foo'</span> <span class="k">do</span>
  <span class="n">session</span><span class="o">[</span><span class="ss">:secret</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'foo'</span>
  <span class="n">redirect</span> <span class="n">to</span><span class="p">(</span><span class="s1">'/bar'</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/bar'</span> <span class="k">do</span>
  <span class="n">session</span><span class="o">[</span><span class="ss">:secret</span><span class="o">]</span>
<span class="k">end</span>
</pre>
<a name='(Cache%20Control)'></a>
<h3>(Cache Control)</h3>
<pre class="highlight text"> HTTP  . 
</pre>
<p>Cache-Control       :</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">cache_control</span> <span class="ss">:public</span>
  <span class="s2">&quot;cache it!&quot;</span>
<span class="k">end</span>
</pre>
<p>:    :</p>
<pre class="highlight ruby"><span class="n">before</span> <span class="k">do</span>
  <span class="n">cache_control</span> <span class="ss">:public</span><span class="p">,</span> <span class="ss">:must_revalidate</span><span class="p">,</span> <span class="ss">:max_age</span> <span class="o">=&gt;</span> <span class="mi">60</span>
<span class="k">end</span>
</pre>
<p><code>expires</code>      ,
<code>Cache-Control</code>   :</p>
<pre class="highlight ruby"><span class="n">before</span> <span class="k">do</span>
  <span class="n">expires</span> <span class="mi">500</span><span class="p">,</span> <span class="ss">:public</span><span class="p">,</span> <span class="ss">:must_revalidate</span>
<span class="k">end</span>
</pre>
<p>, <code>etag</code>  <code>last_modified</code>    .
   **     ,
            (flush)  :</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/article/:id'</span> <span class="k">do</span>
  <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="nf">.find</span> <span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span>
  <span class="n">last_modified</span> <span class="vi">@article</span><span class="nf">.updated_at</span>
  <span class="n">etag</span> <span class="vi">@article</span><span class="nf">.sha1</span>
  <span class="n">erb</span> <span class="ss">:article</span>
<span class="k">end</span>
</pre>
<p><a href="http://en.wikipedia.org/wiki/HTTP_ETag#Strong_and_weak_validation"> ETag</a>   :</p>
<pre class="highlight ruby"><span class="n">etag</span> <span class="vi">@article</span><span class="nf">.sha1</span><span class="p">,</span> <span class="ss">:weak</span>
</pre><pre class="highlight text"> ,     .
(reverse-proxy)    ,
</pre>
<p><a href="https://github.com/rtomayko/rack-cache">rack-cache</a> :</p>
<pre class="highlight ruby"><span class="nb">require</span> <span class="s2">&quot;rack/cache&quot;</span>
<span class="nb">require</span> <span class="s2">&quot;sinatra&quot;</span>

<span class="n">use</span> <span class="no">Rack</span><span class="o">::</span><span class="no">Cache</span>

<span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">cache_control</span> <span class="ss">:public</span><span class="p">,</span> <span class="ss">:max_age</span> <span class="o">=&gt;</span> <span class="mi">36000</span>
  <span class="nb">sleep</span> <span class="mi">5</span>
  <span class="s2">&quot;hello&quot;</span>
<span class="k">end</span>
</pre>
<p><code>Cache-Control</code>    <code>:static_cache_control</code> ( ) :</p>

<p>RFC 2616  If-Match  If-None-Match  <code>*</code>    (resource)         .
Sinatra (get )  (put )       , 
  (  post  )    .
  <code>:new_resource</code>     :</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/create'</span> <span class="k">do</span>
  <span class="n">etag</span> <span class="s1">''</span><span class="p">,</span> <span class="ss">:new_resource</span> <span class="o">=&gt;</span> <span class="kp">true</span>
  <span class="no">Article</span><span class="nf">.create</span>
  <span class="n">erb</span> <span class="ss">:new_article</span>
<span class="k">end</span>
</pre>
<p>ETag  , <code>:kind</code> :</p>
<pre class="highlight ruby"><span class="n">etag</span> <span class="s1">''</span><span class="p">,</span> <span class="ss">:new_resource</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:kind</span> <span class="o">=&gt;</span> <span class="ss">:weak</span>
</pre>
<a name='(Sending%20Files)'></a>
<h3>(Sending Files)</h3>

<p>, <code>send_file</code>    :</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">send_file</span> <span class="s1">'foo.png'</span>
<span class="k">end</span>
</pre><pre class="highlight text"> :
</pre><pre class="highlight ruby"><span class="n">send_file</span> <span class="s1">'foo.png'</span><span class="p">,</span> <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="ss">:jpg</span>
</pre>
<p>:</p>

<dl>
  <dt>filename</dt>
  <dd> .   .</dd>

  <dt>last_modified</dt>
  <dd>Last-Modified .   mtime.</dd>

  <dt>type</dt>
  <dd>  .    .</dd>

  <dt>disposition</dt>
  <dd>Content-Disposition .  : <tt>nil</tt> (),
<tt>:attachment</tt>  <tt>:inline</tt></dd>

  <dt>length</dt>
  <dd>Content-Length,   .</dd>

  <dt>status</dt>
  <dd>  .       .</dd>
</dl>

<p>Rack   , Ruby        .
     , Sinatra   (range request)  .</p>

<a name='(Accessing%20the%20Request%20Object)'></a>
<h3>(Accessing the Request Object)</h3>
<pre class="highlight text">(, ,  ) `request`    : 
</pre><pre class="highlight ruby"><span class="c1"># http://example.com/example    </span>
<span class="n">get</span> <span class="s1">'/foo'</span> <span class="k">do</span>
  <span class="n">t</span> <span class="o">=</span> <span class="sx">%w[text/css text/html application/javascript]</span>
  <span class="n">request</span><span class="nf">.accept</span>              <span class="c1"># ['text/html', '*/*']</span>
  <span class="n">request</span><span class="nf">.accept?</span> <span class="s1">'text/xml'</span>  <span class="c1"># true</span>
  <span class="n">request</span><span class="nf">.preferred_type</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>   <span class="c1"># 'text/html'</span>
  <span class="n">request</span><span class="nf">.body</span>                <span class="c1">#     ( )</span>
  <span class="n">request</span><span class="nf">.scheme</span>              <span class="c1"># &quot;http&quot;</span>
  <span class="n">request</span><span class="nf">.script_name</span>         <span class="c1"># &quot;/example&quot;</span>
  <span class="n">request</span><span class="nf">.path_info</span>           <span class="c1"># &quot;/foo&quot;</span>
  <span class="n">request</span><span class="nf">.port</span>                <span class="c1"># 80</span>
  <span class="n">request</span><span class="nf">.request_method</span>      <span class="c1"># &quot;GET&quot;</span>
  <span class="n">request</span><span class="nf">.query_string</span>        <span class="c1"># &quot;&quot;</span>
  <span class="n">request</span><span class="nf">.content_length</span>      <span class="c1"># request.body </span>
  <span class="n">request</span><span class="nf">.media_type</span>          <span class="c1"># request.body  </span>
  <span class="n">request</span><span class="nf">.host</span>                <span class="c1"># &quot;example.com&quot;</span>
  <span class="n">request</span><span class="nf">.get?</span>                <span class="c1"># true (     )</span>
  <span class="n">request</span><span class="nf">.form_data?</span>          <span class="c1"># false</span>
  <span class="n">request</span><span class="o">[</span><span class="s2">&quot;SOME_HEADER&quot;</span><span class="o">]</span>      <span class="c1"># SOME_HEADER  </span>
  <span class="n">request</span><span class="nf">.referrer</span>            <span class="c1">#    '/'</span>
  <span class="n">request</span><span class="nf">.user_agent</span>          <span class="c1">#   (:agent  )</span>
  <span class="n">request</span><span class="nf">.cookies</span>             <span class="c1">#   </span>
  <span class="n">request</span><span class="nf">.xhr?</span>                <span class="c1">#  ajax ?</span>
  <span class="n">request</span><span class="nf">.url</span>                 <span class="c1"># &quot;http://example.com/example/foo&quot;</span>
  <span class="n">request</span><span class="nf">.path</span>                <span class="c1"># &quot;/example/foo&quot;</span>
  <span class="n">request</span><span class="nf">.ip</span>                  <span class="c1">#  IP </span>
  <span class="n">request</span><span class="nf">.secure?</span>             <span class="c1"># false (ssl   true)</span>
  <span class="n">request</span><span class="nf">.forwarded?</span>          <span class="c1"># true (    )</span>
  <span class="n">request</span><span class="nf">.env</span>                 <span class="c1"># Rack   (raw) env </span>
<span class="k">end</span>
</pre>
<p>, <code>script_name</code>  <code>path_info</code>      :</p>
<pre class="highlight ruby"><span class="n">before</span> <span class="p">{</span> <span class="n">request</span><span class="nf">.path_info</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span> <span class="p">}</span>

<span class="n">get</span> <span class="s2">&quot;/&quot;</span> <span class="k">do</span>
  <span class="s2">&quot;all requests end up here&quot;</span>
<span class="k">end</span>
</pre>
<p><code>request.body</code> IO  StringIO :</p>
<pre class="highlight ruby"><span class="n">post</span> <span class="s2">&quot;/api&quot;</span> <span class="k">do</span>
  <span class="n">request</span><span class="nf">.body.rewind</span>  <span class="c1">#    </span>
  <span class="n">data</span> <span class="o">=</span> <span class="no">JSON</span><span class="nf">.parse</span> <span class="n">request</span><span class="nf">.body.read</span>
  <span class="s2">&quot;Hello </span><span class="si">#{</span><span class="n">data</span><span class="o">[</span><span class="s1">'name'</span><span class="o">]</span><span class="si">}</span><span class="s2">!&quot;</span>
<span class="k">end</span>
</pre>
<a name='(Attachments)'></a>
<h3>(Attachments)</h3>

<p><code>attachment</code><br>
     :</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">attachment</span>
  <span class="s2">&quot;store it!&quot;</span>
<span class="k">end</span>
</pre><pre class="highlight text"> :
</pre><pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">attachment</span> <span class="s2">&quot;info.txt&quot;</span>
  <span class="s2">&quot;store it!&quot;</span>
<span class="k">end</span>
</pre>
<p>Sinatra <code>time_for_</code>   ,     Time  .
<code>DateTime</code>  <code>Date</code>     :</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">pass</span> <span class="k">if</span> <span class="no">Time</span><span class="nf">.now</span> <span class="o">&gt;</span> <span class="n">time_for</span><span class="p">(</span><span class="s1">'Dec 23, 2012'</span><span class="p">)</span>
  <span class="s2">&quot;still time&quot;</span>
<span class="k">end</span>
</pre>
<p><code>expires</code>  <code>last_modified</code>   .
   <code>time_for</code><br>
      :</p>
<pre class="highlight ruby"><span class="n">helpers</span> <span class="k">do</span>
  <span class="k">def</span> <span class="nf">time_for</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">case</span> <span class="n">value</span>
    <span class="k">when</span> <span class="ss">:yesterday</span> <span class="k">then</span> <span class="no">Time</span><span class="nf">.now</span> <span class="o">-</span> <span class="mi">24</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span>
    <span class="k">when</span> <span class="ss">:tomorrow</span>  <span class="k">then</span> <span class="no">Time</span><span class="nf">.now</span> <span class="o">+</span> <span class="mi">24</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span>
    <span class="k">else</span> <span class="k">super</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">last_modified</span> <span class="ss">:yesterday</span>
  <span class="n">expires</span> <span class="ss">:tomorrow</span>
  <span class="s2">&quot;hello&quot;</span>
<span class="k">end</span>
</pre>
<p><code>find_template</code>     :</p>
<pre class="highlight ruby"><span class="n">find_template</span> <span class="n">settings</span><span class="nf">.views</span><span class="p">,</span> <span class="s1">'foo'</span><span class="p">,</span> <span class="no">Tilt</span><span class="o">[</span><span class="ss">:haml</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">file</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="s2">&quot;could be </span><span class="si">#{</span><span class="n">file</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="k">end</span>
</pre>
<p>This is not really useful. But it is useful that you can actually override this
method to hook in your own lookup mechanism. For instance, if you want to be
able to use more than one view directory:
   .          .
 ,      :</p>
<pre class="highlight ruby"><span class="n">set</span> <span class="ss">:views</span><span class="p">,</span> <span class="o">[</span><span class="s1">'views'</span><span class="p">,</span> <span class="s1">'templates'</span><span class="o">]</span>

<span class="n">helpers</span> <span class="k">do</span>
  <span class="k">def</span> <span class="nf">find_template</span><span class="p">(</span><span class="n">views</span><span class="p">,</span> <span class="nb">name</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
    <span class="nb">Array</span><span class="p">(</span><span class="n">views</span><span class="p">)</span><span class="nf">.each</span> <span class="p">{</span> <span class="o">|</span><span class="n">v</span><span class="o">|</span> <span class="k">super</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">name</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">)</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre><pre class="highlight text">   :
</pre><pre class="highlight ruby"><span class="n">set</span> <span class="ss">:views</span><span class="p">,</span> <span class="ss">:sass</span> <span class="o">=&gt;</span> <span class="s1">'views/sass'</span><span class="p">,</span> <span class="ss">:haml</span> <span class="o">=&gt;</span> <span class="s1">'templates'</span><span class="p">,</span> <span class="ss">:default</span> <span class="o">=&gt;</span> <span class="s1">'views'</span>

<span class="n">helpers</span> <span class="k">do</span>
  <span class="k">def</span> <span class="nf">find_template</span><span class="p">(</span><span class="n">views</span><span class="p">,</span> <span class="nb">name</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">folder</span> <span class="o">=</span> <span class="n">views</span><span class="nf">.detect</span> <span class="p">{</span> <span class="o">|</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="o">|</span> <span class="n">engine</span> <span class="o">==</span> <span class="no">Tilt</span><span class="o">[</span><span class="n">k</span><span class="o">]</span> <span class="p">}</span>
    <span class="n">folder</span> <span class="o">||=</span> <span class="n">views</span><span class="o">[</span><span class="ss">:default</span><span class="o">]</span>
    <span class="k">super</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="nb">name</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre>
<p>(extension)      !</p>

<p><code>find_template</code>       .
        .
    , <code>render</code>    <code>break</code>   .
,  ( )       .
       .</p>

<a name='(Configuration)'></a>
<h2>(Configuration)</h2>

<p>,  ,  :</p>
<pre class="highlight ruby"><span class="n">configure</span> <span class="k">do</span>
  <span class="c1">#   </span>
  <span class="n">set</span> <span class="ss">:option</span><span class="p">,</span> <span class="s1">'value'</span>

  <span class="c1">#   </span>
  <span class="n">set</span> <span class="ss">:a</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="ss">:b</span> <span class="o">=&gt;</span> <span class="mi">2</span>

  <span class="c1"># `set :option, true` </span>
  <span class="n">enable</span> <span class="ss">:option</span>

  <span class="c1"># `set :option, false` </span>
  <span class="n">disable</span> <span class="ss">:option</span>

  <span class="c1">#      </span>
  <span class="n">set</span><span class="p">(</span><span class="ss">:css_dir</span><span class="p">)</span> <span class="p">{</span> <span class="no">File</span><span class="nf">.join</span><span class="p">(</span><span class="n">views</span><span class="p">,</span> <span class="s1">'css'</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>
</pre>
<p>(RACK_ENV  ) <code>:production</code>  :</p>
<pre class="highlight ruby"><span class="n">configure</span> <span class="ss">:production</span> <span class="k">do</span>
  <span class="nf">..</span><span class="o">.</span>
<span class="k">end</span>
</pre>
<p><code>:production</code>  <code>:test</code>  :</p>
<pre class="highlight ruby"><span class="n">configure</span> <span class="ss">:production</span><span class="p">,</span> <span class="ss">:test</span> <span class="k">do</span>
  <span class="nf">..</span><span class="o">.</span>
<span class="k">end</span>
</pre>
<p><code>settings</code>   :</p>
<pre class="highlight ruby"><span class="n">configure</span> <span class="k">do</span>
  <span class="n">set</span> <span class="ss">:foo</span><span class="p">,</span> <span class="s1">'bar'</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">settings</span><span class="nf">.foo?</span> <span class="c1"># =&gt; true</span>
  <span class="n">settings</span><span class="nf">.foo</span>  <span class="c1"># =&gt; 'bar'</span>
  <span class="nf">..</span><span class="o">.</span>
<span class="k">end</span>
</pre>
<a name='(Configuring%20attack%20protection)'></a>
<h3>(Configuring attack protection)</h3>

<p>Sinatra <a href="https://github.com/rkh/rack-protection#readme">Rack::Protection</a><br>
,     . 
     (    ):</p>
<pre class="highlight ruby"><span class="n">disable</span> <span class="ss">:protection</span>
</pre>
<p>,   <code>protection</code>  :</p>
<pre class="highlight ruby"><span class="n">set</span> <span class="ss">:protection</span><span class="p">,</span> <span class="ss">:except</span> <span class="o">=&gt;</span> <span class="ss">:path_traversal</span>
</pre>
<p>,   :</p>
<pre class="highlight ruby"><span class="n">set</span> <span class="ss">:protection</span><span class="p">,</span> <span class="ss">:except</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:path_traversal</span><span class="p">,</span> <span class="ss">:session_hijacking</span><span class="o">]</span>
</pre>
<a name='(Available%20Settings)'></a>
<h3>(Available Settings)</h3>

<dl>
  <dt>absolute_redirects</dt>
  <dd>
     , Sinatra    ,
      Sinatra       
    RFC 2616(HTTP 1.1)  .

              .
    <tt>rul</tt> ,     <tt>false</tt>  ,
      URL   .

    .
  </dd>

  <dt>add_charsets</dt>
  <dd>
    <tt>content_type</tt>      (mime) .

          :

    <tt>settings.add_charsets << "application/foobar"</tt>
  </dd>

  <dt>app_file<dt>
  <dd>   .   ,  public ,  
     .</dd>

  <dt>bind<dt>
  <dd> IP (: 0.0.0.0).
    (built-in)  .</dd>

  <dt>default_encoding</dt>
  <dd>   
   ( <tt>"utf-8"</tt>).</dd>

  <dt>dump_errors</dt>
  <dd>  .</dd>

  <dt>environment</dt>
  <dd> ,  <tt>ENV['RACK_ENV']</tt>      "development".</dd>

  <dt>logging</dt>
  <dd>(logger) .</dd>

  <dt>lock</dt>
  <dd>   (lock) . Ruby      .

     (thread-safe)   .
    .</dd>

  <dt>method_override</dt>
  <dd>put/delete    put/delete  
   <tt>_method</tt>  .</dd>

  <dt>port</dt>
  <dd> .   .</dd>

  <dt>prefixed_redirects</dt>
  <dd>    <tt>request.script_name</tt>
    .   <tt>redirect '/foo'</tt> <tt>redirect to('/foo')</tt>
    .  .</dd>

  <dt>protection</dt>
  <dd>     .    .</dd>

  <dt>public_folder</dt>
  <dd>public    .
   static     ( <tt>static</tt>).
      <tt>app_file</tt> .</dd>

  <dt>reload_templates</dt>
  <dd>   (reload)  .
     .</dd>

  <dt>root</dt>
  <dd>   . 
     <tt>app_file</tt>  .</dd>

  <dt>raise_errors</dt>
  <dd> ( ).
    <tt>environment</tt> <tt>"test"</tt>  ,   .</dd>

  <dt>run</dt>
  <dd>, Sinatra   .
   rackup        .</dd>

  <dt>running</dt>
  <dd>   ?
       !</dd>

  <dt>server</dt>
  <dd>
          .
     ['thin', 'mongrel', 'webrick']   .
  </dd>
  <dt>sessions</dt>
  <dd><tt>Rack::Session::Cookie</tt>     .
      ' ' .</dd>

  <dt>show_exceptions</dt>
  <dd>      .
    <tt>environment</tt> <tt>"development"</tt>  ,  .
  </dd>

  <dt>static</dt>
  <dd>Sinatra (static)    .
          .
     .
      ,   .</dd>

  <dt>static_cache_control</dt>
  <dd>Sinatra    ,  <tt>Cache-Control</tt>    .
   <tt>cache_control</tt>  .
    .
          :
   <tt>set :static_cache_control, [:public, :max_age => 300]</tt>
  </dd>

  <dt>threaded</dt>
  <dd><tt>true</tt> , Thin    <tt>EventMachine.defer</tt>  . </dd>

  <dt>views</dt>
  <dd>  .    <tt>app_file</tt> .</dd>
</dl>

<a name='(Environments)'></a>
<h2>(Environments)</h2>

<p><code>RACK_ENV</code>      .  &quot;development&quot;.
 ,     .
 <code>not_found</code>  <code>error</code><br>
      .
<code>&quot;production&quot;</code> <code>&quot;test&quot;</code>    .</p>

<p><code>-e</code>  :</p>
<pre class="highlight ruby"><span class="n">ruby</span> <span class="n">my_app</span><span class="nf">.rb</span> <span class="o">-</span><span class="n">e</span> <span class="o">[</span><span class="no">ENVIRONMENT</span><span class="o">]</span>
</pre><pre class="highlight text">    `development?`, `test?`  `production?` 
</pre>
<p>.</p>

<a name='(Error%20Handling)'></a>
<h2>(Error Handling)</h2>
<pre class="highlight text">    . 
</pre>
<p>,        .   <code>haml</code>,
<code>erb</code>, <code>halt</code>, .</p>

<a name='(Not%20Found)'></a>
<h3>(Not Found)</h3>

<p><code>Sinatra::NotFound</code>       404,
<code>not_found</code>  :</p>
<pre class="highlight ruby"><span class="n">not_found</span> <span class="k">do</span>
  <span class="s1">'    .'</span>
<span class="k">end</span>
</pre>
<a name='(Error)'></a>
<h3>(Error)</h3>

<p><code>error</code>         .
  Rack  <code>sinatra.error</code>   :</p>
<pre class="highlight ruby"><span class="n">error</span> <span class="k">do</span>
  <span class="s1">'   - '</span> <span class="o">+</span> <span class="n">env</span><span class="o">[</span><span class="s1">'sinatra.error'</span><span class="o">]</span><span class="nf">.name</span>
<span class="k">end</span>
</pre>
<p>:</p>
<pre class="highlight ruby"><span class="n">error</span> <span class="no">MyCustomError</span> <span class="k">do</span>
  <span class="s1">'  ...'</span> <span class="o">+</span> <span class="n">env</span><span class="o">[</span><span class="s1">'sinatra.error'</span><span class="o">]</span><span class="nf">.message</span>
<span class="k">end</span>
</pre>
<p>,   :</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="k">raise</span> <span class="no">MyCustomError</span><span class="p">,</span> <span class="s1">' '</span>
<span class="k">end</span>
</pre>
<p>:</p>
<pre class="highlight ruby">  <span class="nf">..</span><span class="o">.</span>  
</pre>
<p>,        :</p>
<pre class="highlight ruby"><span class="n">error</span> <span class="mi">403</span> <span class="k">do</span>
  <span class="s1">' '</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/secret'</span> <span class="k">do</span>
  <span class="mi">403</span>
<span class="k">end</span>
</pre>
<p>Or a range:</p>
<pre class="highlight ruby"><span class="n">error</span> <span class="mi">400</span><span class="nf">..</span><span class="mi">510</span> <span class="k">do</span>
  <span class="s1">''</span>
<span class="k">end</span>
</pre>
<p>Sinatra<br>
 <code>not_found</code>  <code>error</code>  .</p>

<a name='Rack%20(Rack%20Middleware)'></a>
<h2>Rack (Rack Middleware)</h2>

<p>Sinatra <a href="http://rack.rubyforge.org/">Rack</a>  ,
Rack       .
Rack<br>
&quot;(middleware)&quot;  ,<br>
 HTTP / / 
     (component).</p>

<p>Sinatra  <code>use</code>   Rack        :</p>
<pre class="highlight ruby"><span class="nb">require</span> <span class="s1">'sinatra'</span>
<span class="nb">require</span> <span class="s1">'my_custom_middleware'</span>

<span class="n">use</span> <span class="no">Rack</span><span class="o">::</span><span class="no">Lint</span>
<span class="n">use</span> <span class="no">MyCustomMiddleware</span>

<span class="n">get</span> <span class="s1">'/hello'</span> <span class="k">do</span>
  <span class="s1">'Hello World'</span>
<span class="k">end</span>
</pre>
<p><code>use</code>  <a href="http://rack.rubyforge.org/doc/classes/Rack/Builder.html%5D">Rack::Builder</a> DSL
(rackup    )   .
 , <code>use</code>      /  :</p>
<pre class="highlight ruby"><span class="n">use</span> <span class="no">Rack</span><span class="o">::</span><span class="no">Auth</span><span class="o">::</span><span class="no">Basic</span> <span class="k">do</span> <span class="o">|</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="o">|</span>
  <span class="n">username</span> <span class="o">==</span> <span class="s1">'admin'</span> <span class="o">&amp;&amp;</span> <span class="n">password</span> <span class="o">==</span> <span class="s1">'secret'</span>
<span class="k">end</span>
</pre>
<p>Rack , , URL , ,         .
Sinatra         ,
   <code>use</code>     .</p>

<p><a href="https://github.com/rack/rack/tree/master/lib/rack">rack</a>,
<a href="https://github.com/rack/rack-contrib#readme">rack-contrib</a>,
<a href="http://coderack.org/">CodeRack</a> 
<a href="https://github.com/rack/rack/wiki/List-of-Middleware">Rack wiki</a>
   .</p>

<a name='(Testing)'></a>
<h2>(Testing)</h2>

<p>Sinatra  Rack          .
<a href="http://rdoc.info/github/brynary/rack-test/master/frames">Rack::Test</a> :</p>
<pre class="highlight ruby"><span class="nb">require</span> <span class="s1">'my_sinatra_app'</span>
<span class="nb">require</span> <span class="s1">'test/unit'</span>
<span class="nb">require</span> <span class="s1">'rack/test'</span>

<span class="k">class</span> <span class="nc">MyAppTest</span> <span class="o">&lt;</span> <span class="no">Test</span><span class="o">::</span><span class="no">Unit</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="kp">include</span> <span class="no">Rack</span><span class="o">::</span><span class="no">Test</span><span class="o">::</span><span class="no">Methods</span>

  <span class="k">def</span> <span class="nf">app</span>
    <span class="no">Sinatra</span><span class="o">::</span><span class="no">Application</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">test_my_default</span>
    <span class="n">get</span> <span class="s1">'/'</span>
    <span class="n">assert_equal</span> <span class="s1">'Hello World!'</span><span class="p">,</span> <span class="n">last_response</span><span class="nf">.body</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">test_with_params</span>
    <span class="n">get</span> <span class="s1">'/meet'</span><span class="p">,</span> <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">'Frank'</span>
    <span class="n">assert_equal</span> <span class="s1">'Hello Frank!'</span><span class="p">,</span> <span class="n">last_response</span><span class="nf">.body</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">test_with_rack_env</span>
    <span class="n">get</span> <span class="s1">'/'</span><span class="p">,</span> <span class="p">{},</span> <span class="s1">'HTTP_USER_AGENT'</span> <span class="o">=&gt;</span> <span class="s1">'Songbird'</span>
    <span class="n">assert_equal</span> <span class="s2">&quot;You're using Songbird!&quot;</span><span class="p">,</span> <span class="n">last_response</span><span class="nf">.body</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre>
<a name='Sinatra::Base%20-%20(Middleware),%20(Libraries),%20%20%20(Modular%20Apps)'></a>
<h2>Sinatra::Base - (Middleware), (Libraries),   (Modular Apps)</h2>
<pre class="highlight text"> (micro-app)   ,
</pre>
<p>Rack , Rails (metal)      ,<br>
Sinatra (extension)         .
     (,<br>
<code>./public</code>  <code>./views</code> , ,    ).
  <code>Sinatra::Base</code>  :</p>
<pre class="highlight ruby"><span class="nb">require</span> <span class="s1">'sinatra/base'</span>

<span class="k">class</span> <span class="nc">MyApp</span> <span class="o">&lt;</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">set</span> <span class="ss">:sessions</span><span class="p">,</span> <span class="kp">true</span>
  <span class="n">set</span> <span class="ss">:foo</span><span class="p">,</span> <span class="s1">'bar'</span>

  <span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
    <span class="s1">'Hello world!'</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre>
<p><code>Sinatra::Base</code>     DSL    .
       <code>Sinatra::Base</code>   :</p>

<ul>
<li> <code>sinatra</code>  <code>sinatra/base</code> require ,<br>
Sinatra DSL     .</li>
<li> ,  , ,   <code>Sinatra::Base</code>   .</li>
</ul>

<p><code>Sinatra::Base</code> (blank slate).
       .
      <a href="http://sinatra.github.com/configuration.html">Options and Configuration</a>  .</p>

<a name='(Modular)%20vs.%20%20(Classic%20Style)'></a>
<h3>(Modular) vs.  (Classic Style)</h3>

<p>,     .
  ,     .</p>

<p>Sinatra     .
    ,   .
       .</p>
<pre class="highlight text"> ,      :
</pre>
<table>
  <tr>
    <th>Setting</th>
    <th>Classic</th>
    <th>Modular</th>
  </tr>
  <tr>
    <td>app_file</td>
    <td>sinatra  </td>
    <td>Sinatra::Base  </td>
  </tr>
  <tr>
    <td>run</td>
    <td>$0 == app_file</td>
    <td>false</td>
  </tr>
  <tr>
    <td>logging</td>
    <td> true</td>
    <td>false</td>
  </tr>
  <tr>
    <td>method_override</td>
    <td>true</td>
    <td>false</td>
  </tr>
  <tr>
    <td>inline_templates</td>
    <td>true</td>
    <td>false</td>
  </tr>
  <tr>
    <td>static</td>
    <td>true</td>
    <td>false</td>
  </tr>
</table>

<a name='(Modular%20Application)'></a>
<h3>(Modular Application)</h3>
<pre class="highlight text">   , 
</pre>
<p><code>run!</code> :</p>
<pre class="highlight ruby"><span class="c1"># my_app.rb</span>
<span class="nb">require</span> <span class="s1">'sinatra/base'</span>

<span class="k">class</span> <span class="nc">MyApp</span> <span class="o">&lt;</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Base</span>
  <span class="c1"># ...     ...</span>

  <span class="c1">#       </span>
  <span class="n">run!</span> <span class="k">if</span> <span class="n">app_file</span> <span class="o">==</span> <span class="vg">$0</span>
<span class="k">end</span>
</pre>
<p>:</p>
<pre class="highlight ruby"><span class="n">ruby</span> <span class="n">my_app</span><span class="nf">.rb</span>
</pre>
<p><code>config.ru</code>  ,    Rack    :</p>
<pre class="highlight ruby"><span class="c1"># config.ru</span>
<span class="nb">require</span> <span class="s1">'./my_app'</span>
<span class="n">run</span> <span class="no">MyApp</span>
</pre>
<p>:</p>
<pre class="highlight ruby"><span class="n">rackup</span> <span class="o">-</span><span class="nb">p</span> <span class="mi">4567</span>
</pre>
<a name='config.ru'></a>
<h3>config.ru</h3>
<pre class="highlight text">:
</pre><pre class="highlight ruby"><span class="c1"># app.rb</span>
<span class="nb">require</span> <span class="s1">'sinatra'</span>

<span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="s1">'Hello world!'</span>
<span class="k">end</span>
</pre>
<p><code>config.ru</code>   :</p>
<pre class="highlight ruby"><span class="nb">require</span> <span class="s1">'./app'</span>
<span class="n">run</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Application</span>
</pre>
<a name='config.ru%20?'></a>
<h3>config.ru ?</h3>

<p>Good signs you probably want to use a <code>config.ru</code>:
 <code>config.ru</code>   :</p>

<ul>
<li> Rack (Passenger, Unicorn, Heroku, ...)   .</li>
<li>  <code>Sinatra::Base</code>    .</li>
<li>Sinatra (endpoint) ,     .</li>
</ul>

<p>**    <code>config.ru</code>   ,
 <code>config.ru</code>        .**</p>

<a name='Sinatra'></a>
<h3>Sinatra</h3>

<p>Sinatra  Rack      ,
 Sinatra    Rack      .
   Sinatra    , 
 Rack   (Rails/Ramaze/Camping/...) :</p>
<pre class="highlight ruby"><span class="nb">require</span> <span class="s1">'sinatra/base'</span>

<span class="k">class</span> <span class="nc">LoginScreen</span> <span class="o">&lt;</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">enable</span> <span class="ss">:sessions</span>

  <span class="n">get</span><span class="p">(</span><span class="s1">'/login'</span><span class="p">)</span> <span class="p">{</span> <span class="n">haml</span> <span class="ss">:login</span> <span class="p">}</span>

  <span class="n">post</span><span class="p">(</span><span class="s1">'/login'</span><span class="p">)</span> <span class="k">do</span>
<span class="k">if</span> <span class="n">params</span><span class="o">[</span><span class="ss">:name</span><span class="o">]</span> <span class="o">==</span> <span class="s1">'admin'</span> <span class="o">&amp;&amp;</span> <span class="n">params</span><span class="o">[</span><span class="ss">:password</span><span class="o">]</span> <span class="o">==</span> <span class="s1">'admin'</span>
  <span class="n">session</span><span class="o">[</span><span class="s1">'user_name'</span><span class="o">]</span> <span class="o">=</span> <span class="n">params</span><span class="o">[</span><span class="ss">:name</span><span class="o">]</span>
<span class="k">else</span>
  <span class="n">redirect</span> <span class="s1">'/login'</span>
<span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">MyApp</span> <span class="o">&lt;</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Base</span>
  <span class="c1">#     </span>
  <span class="n">use</span> <span class="no">LoginScreen</span>

  <span class="n">before</span> <span class="k">do</span>
<span class="k">unless</span> <span class="n">session</span><span class="o">[</span><span class="s1">'user_name'</span><span class="o">]</span>
  <span class="n">halt</span> <span class="s2">&quot; , &lt;a href='/login'&gt;&lt;/a&gt; .&quot;</span>
<span class="k">end</span>
  <span class="k">end</span>

  <span class="n">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)</span> <span class="p">{</span> <span class="s2">&quot;Hello </span><span class="si">#{</span><span class="n">session</span><span class="o">[</span><span class="s1">'user_name'</span><span class="o">]</span><span class="si">}</span><span class="s2">.&quot;</span> <span class="p">}</span>
<span class="k">end</span>
</pre>
<a name='(Dynamic%20Application%20Creation)'></a>
<h3>(Dynamic Application Creation)</h3>
<pre class="highlight text">         ,
</pre>
<p><code>Sinatra.new</code>  :</p>
<pre class="highlight ruby"><span class="nb">require</span> <span class="s1">'sinatra/base'</span>
<span class="n">my_app</span> <span class="o">=</span> <span class="no">Sinatra</span><span class="nf">.new</span> <span class="p">{</span> <span class="n">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)</span> <span class="p">{</span> <span class="s2">&quot;hi&quot;</span> <span class="p">}</span> <span class="p">}</span>
<span class="n">my_app</span><span class="nf">.run!</span>
</pre><pre class="highlight text"> :
</pre><pre class="highlight ruby"><span class="c1"># config.ru</span>
<span class="nb">require</span> <span class="s1">'sinatra/base'</span>

<span class="n">controller</span> <span class="o">=</span> <span class="no">Sinatra</span><span class="nf">.new</span> <span class="k">do</span>
  <span class="n">enable</span> <span class="ss">:logging</span>
  <span class="n">helpers</span> <span class="no">MyHelpers</span>
<span class="k">end</span>

<span class="n">map</span><span class="p">(</span><span class="s1">'/a'</span><span class="p">)</span> <span class="k">do</span>
  <span class="n">run</span> <span class="no">Sinatra</span><span class="nf">.new</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span> <span class="p">{</span> <span class="n">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)</span> <span class="p">{</span> <span class="s1">'a'</span> <span class="p">}</span> <span class="p">}</span>
<span class="k">end</span>

<span class="n">map</span><span class="p">(</span><span class="s1">'/b'</span><span class="p">)</span> <span class="k">do</span>
  <span class="n">run</span> <span class="no">Sinatra</span><span class="nf">.new</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span> <span class="p">{</span> <span class="n">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)</span> <span class="p">{</span> <span class="s1">'b'</span> <span class="p">}</span> <span class="p">}</span>
<span class="k">end</span>
</pre>
<p>Sintra      Sinatra    .</p>

<p>Sinatra       :</p>
<pre class="highlight ruby"><span class="nb">require</span> <span class="s1">'sinatra/base'</span>

<span class="n">use</span> <span class="no">Sinatra</span> <span class="k">do</span>
  <span class="n">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)</span> <span class="p">{</span> <span class="nf">..</span><span class="o">.</span> <span class="p">}</span>
<span class="k">end</span>

<span class="n">run</span> <span class="no">RailsProject</span><span class="o">::</span><span class="no">Application</span>
</pre>
<a name='(Scopes)%20(Binding)'></a>
<h2>(Scopes) (Binding)</h2>
<pre class="highlight text">      .
</pre>
<a name='/'></a>
<h3>/</h3>

<p>Sinatra  <code>Sinatra::Base</code>  .
  DSL (<code>require &#39;sinatra&#39;</code>) ,
  <code>Sinatra::Application</code>,<br>
  .   <code>get</code>  <code>before</code>   ,
<code>request</code>  <code>session</code>    .<br>
    .</p>

<p><code>set</code>     :</p>
<pre class="highlight ruby"><span class="k">class</span> <span class="nc">MyApp</span> <span class="o">&lt;</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Base</span>
  <span class="c1"># ,    !</span>
  <span class="n">set</span> <span class="ss">:foo</span><span class="p">,</span> <span class="mi">42</span>
  <span class="n">foo</span> <span class="c1"># =&gt; 42</span>

  <span class="n">get</span> <span class="s1">'/foo'</span> <span class="k">do</span>
<span class="c1"># ,         !</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre><pre class="highlight text">  :
</pre>
<ul>
<li><br></li>
<li><br></li>
<li><code>helpers</code><br></li>
<li><code>set</code>   Procs/blocks</li>
<li><p><code>Sinatra.new</code>  </p>

<p>()     :</p></li>
<li><p>configure    (<code>configure { |c| ... }</code>)</p></li>
<li><p><code>settings</code></p></li>
</ul>

<a name='/'></a>
<h3>/</h3>

<p>,            .
    <code>request</code>  <code>session</code><br>
<code>erb</code>  <code>haml</code>      .
     <code>settings</code>    :</p>
<pre class="highlight ruby"><span class="k">class</span> <span class="nc">MyApp</span> <span class="o">&lt;</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Base</span>
  <span class="c1"># ,    !</span>
  <span class="n">get</span> <span class="s1">'/define_route/:name'</span> <span class="k">do</span>
<span class="c1"># '/define_route/:name'  </span>
<span class="vi">@value</span> <span class="o">=</span> <span class="mi">42</span>

<span class="n">settings</span><span class="nf">.get</span><span class="p">(</span><span class="s2">&quot;/</span><span class="si">#{</span><span class="n">params</span><span class="o">[</span><span class="ss">:name</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">do</span>
  <span class="c1"># &quot;/#{params[:name]}&quot;  </span>
  <span class="vi">@value</span> <span class="c1"># =&gt; nil (  )</span>
<span class="k">end</span>

<span class="s2">&quot; !&quot;</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre><pre class="highlight text">   :
</pre>
<ul>
<li>get/head/post/put/delete/options </li>
<li>before/after </li>
<li>(helper) </li>
<li>/</li>
</ul>

<a name='(Delegation%20Scope)'></a>
<h3>(Delegation Scope)</h3>

<p>(delegation scope)     (forward).
, 100%    ,      .
  (delegation)<br>
   /   (: <code>self</code> ).
<code>Sinatra::Delegator.delegate :method_name</code>       .</p>
<pre class="highlight text">   :
</pre>
<ul>
<li> , <code>require &quot;sinatra&quot;</code><br></li>
<li><p><code>Sinatra::Delegator</code>   </p>

<p>: 
<a href="https://github.com/sinatra/sinatra/blob/ca06364/lib/sinatra/base.rb#L1609-1633">Sinatra::Delegator </a>
<a href="https://github.com/sinatra/sinatra/blob/ca06364/lib/sinatra/main.rb#L28-30">   </a>.</p></li>
</ul>

<a name='(Command%20Line)'></a>
<h2>(Command Line)</h2>

<p>Sinatra     :</p>
<pre class="highlight ruby"><span class="n">ruby</span> <span class="n">myapp</span><span class="nf">.rb</span> <span class="o">[-</span><span class="n">h</span><span class="o">]</span> <span class="o">[-</span><span class="n">x</span><span class="o">]</span> <span class="o">[-</span><span class="n">e</span> <span class="no">ENVIRONMENT</span><span class="o">]</span> <span class="o">[-</span><span class="nb">p</span> <span class="no">PORT</span><span class="o">]</span> <span class="o">[-</span><span class="n">o</span> <span class="no">HOST</span><span class="o">]</span> <span class="o">[-</span><span class="n">s</span> <span class="no">HANDLER</span><span class="o">]</span>
</pre>
<p>:</p>
<pre class="highlight text">-h # 
-p #   ( 4567)
-o #   ( 0.0.0.0)
-e #   ( development)
-s # rack /  ( thin)
-x # mutex   ( off)
</pre>
<a name='(Requirement)'></a>
<h2>(Requirement)</h2>
<pre class="highlight text">:
</pre>
<dl>
  <dt> Ruby 1.8.7 </dt>
  <dd>1.8.7  ,     , 
1.9.2   JRuby Rubinius   .
1.8.7   Sinatra 2.0 Ruby 2.0    .
 ,    .
<b>Ruby 1.8.6   .</b>
 1.8.6  , Sinatra 1.2 .
Sinatra 1.4.0         .

</dd>
  <dt> Ruby 1.9.2 </dt>
  <dd>1.9.2   . Radius Maraby  1.9   .
1.9.2p0, Sinatra         .
Ruby 1.9.4/2.0     ,
 1.9    Ruby       .

</dd>
  <dt> Ruby 1.9.3 </dt>
  <dd>1.9.3  .   
       ( p0). 
  1.9.3       .

</dd>
  <dt> Rubinius </dt>
  <dd>Rubinius   (Rubinius >= 1.2.4),       .
  2.0    .

</dd>
  <dt> JRuby </dt>
  <dd>JRuby   (JRuby >= 1.6.5).        ,
 JRuby  , JRuby rack   .
Thin   JRuby   .
JRuby C     , RDiscount, Redcarpet  RedCloth 
  .
</dd>
</dl>
<pre class="highlight text">  .
</pre>
<p>Sinatra      :</p>

<ul>
<li>JRuby Rubinius<br></li>
<li>Ruby Enterprise Edition</li>
<li>MacRuby, Maglev, IronRuby</li>
<li><p>Ruby 1.9.0  1.9.1 (      )</p>

<p>,       .</p>

<p>CI ruby-head (  2.0.0)  1.9.4   ,
    . 
1.9.4p0 2.0.0p0  .</p></li>
</ul>

<p>Sinatra        .</p>

<p>Cardinal, SmallRuby, BlueRuby  1.8.7<br>
Sinatra    .</p>

<a name='(The%20Bleeding%20Edge)'></a>
<h2>(The Bleeding Edge)</h2>

<p>Sinatra     , 
      ,    .</p>

<p>(prerelease)   ,     </p>
<pre class="highlight ruby"><span class="n">gem</span> <span class="n">install</span> <span class="n">sinatra</span> <span class="o">--</span><span class="n">pre</span>
</pre>
<a name='Bundler'></a>
<h3>Bundler</h3>

<p>Sinatra  , 
<a href="http://gembundler.com/">Bundler</a>   .</p>

<p>,    bundler :</p>
<pre class="highlight ruby"><span class="n">gem</span> <span class="n">install</span> <span class="n">bundler</span>
</pre>
<p>,  , <code>Gemfile</code>  :</p>
<pre class="highlight ruby"><span class="n">source</span> <span class="ss">:rubygems</span>
<span class="n">gem</span> <span class="s1">'sinatra'</span><span class="p">,</span> <span class="ss">:git</span> <span class="o">=&gt;</span> <span class="s2">&quot;git://github.com/sinatra/sinatra.git&quot;</span>

<span class="c1">#  </span>
<span class="n">gem</span> <span class="s1">'haml'</span><span class="c1">#  , haml </span>
<span class="n">gem</span> <span class="s1">'activerecord'</span><span class="p">,</span> <span class="s1">'~&gt; 3.0'</span>  <span class="c1">#  ActiveRecord 3.x  </span>
</pre><pre class="highlight text">   .
</pre>
<p>, Sinatra     (Rack Tilt) 
Bundler    .</p>
<pre class="highlight text">   :
</pre><pre class="highlight ruby"><span class="n">bundle</span> <span class="nb">exec</span> <span class="n">ruby</span> <span class="n">myapp</span><span class="nf">.rb</span>
</pre>
<a name='(Roll%20Your%20Own)'></a>
<h3>(Roll Your Own)</h3>

<p>(clone)   <code>$LOAD_PATH</code> <code>sinatra/lib</code><br>
  :</p>
<pre class="highlight ruby"><span class="n">cd</span> <span class="n">myapp</span>
<span class="n">git</span> <span class="nb">clone</span> <span class="n">git</span><span class="ss">:/</span><span class="o">/</span><span class="n">github</span><span class="nf">.com</span><span class="sr">/sinatra/sin</span><span class="n">atra</span><span class="nf">.git</span>
<span class="n">ruby</span> <span class="o">-</span><span class="no">Isinatra</span><span class="o">/</span><span class="n">lib</span> <span class="n">myapp</span><span class="nf">.rb</span>
</pre>
<p>Sinatra  :</p>
<pre class="highlight ruby"><span class="n">cd</span> <span class="n">myapp</span><span class="o">/</span><span class="n">sinatra</span>
<span class="n">git</span> <span class="n">pull</span>
</pre>
<a name='(Install%20Globally)'></a>
<h3>(Install Globally)</h3>
<pre class="highlight text">:
</pre><pre class="highlight ruby"><span class="n">git</span> <span class="nb">clone</span> <span class="n">git</span><span class="ss">:/</span><span class="o">/</span><span class="n">github</span><span class="nf">.com</span><span class="sr">/sinatra/sin</span><span class="n">atra</span><span class="nf">.git</span>
<span class="n">cd</span> <span class="n">sinatra</span>
<span class="n">rake</span> <span class="n">sinatra</span><span class="nf">.gemspec</span>
<span class="n">rake</span> <span class="n">install</span>
</pre>
<p>,      </p>
<pre class="highlight ruby"><span class="n">sudo</span> <span class="n">rake</span> <span class="n">install</span>
</pre>
<a name='(Versioning)'></a>
<h2>(Versioning)</h2>

<p>Sinatra <a href="http://semver.org/"> Semantic Versioning</a> .
SemVer  SemVerTag   .</p>

<a name='(Further%20Reading)'></a>
<h2>(Further Reading)</h2>

<ul>
<li><a href="http://www.sinatrarb.com/"> </a> -  , ,     .</li>
<li><a href="http://www.sinatrarb.com/contributing"></a> -  ?  ?  ?</li>
<li><a href="http://github.com/sinatra/sinatra/issues"> </a></li>
<li><a href="http://twitter.com/sinatra"></a></li>
<li><a href="http://groups.google.com/group/sinatrarb/topics">Mailing List</a></li>
<li>[IRC: #sinatra](irc://chat.freenode.net/#sinatra) http://freenode.net </li>
<li><a href="http://sinatra-book.gittr.com">Sinatra Book</a> Cookbook </li>
<li><a href="http://recipes.sinatrarb.com/">Sinatra Recipes</a><br></li>
<li>http://rubydoc.info  <a href="http://rubydoc.info/gems/sinatra"> </a>
<a href="http://rubydoc.info/github/sinatra/sinatra">current HEAD</a>  API </li>
<li><a href="http://travis-ci.org/sinatra/sinatra">CI server</a></li>
</ul>
