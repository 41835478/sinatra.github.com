<div class='toc'>
	<ol class='level-1'>
		<li><a href='#Rotas'>Rotas</a></li>
		<li><a href='#Arquivos%20estticos'>Arquivos estticos</a></li>
		<li><a href='#Views%20/%20Templates'>Views / Templates</a></li>
		<ol class='level-2'>
			<li><a href='#Haml%20Templates'>Haml Templates</a></li>
			<li><a href='#Erb%20Templates'>Erb Templates</a></li>
			<li><a href='#Erubis'>Erubis</a></li>
			<li><a href='#Builder%20Templates'>Builder Templates</a></li>
			<li><a href='#Sass%20Templates'>Sass Templates</a></li>
			<li><a href='#Less%20Templates'>Less Templates</a></li>
			<li><a href='#Templates%20Inline'>Templates Inline</a></li>
			<li><a href='#Acedendo%20a%20Variveis%20nos%20Templates'>Acedendo a Variveis nos Templates</a></li>
			<li><a href='#Templates%20Inline'>Templates Inline</a></li>
			<li><a href='#Templates%20nomeados'>Templates nomeados</a></li>
		</ol>
		<li><a href='#Helpers'>Helpers</a></li>
		<li><a href='#Filtros'>Filtros</a></li>
		<li><a href='#Halting'>Halting</a></li>
		<li><a href='#Passing'>Passing</a></li>
		<li><a href='#Configurao'>Configurao</a></li>
		<li><a href='#Lidar%20com%20Erros'>Lidar com Erros</a></li>
		<ol class='level-2'>
			<li><a href='#No%20Encontrado'>No Encontrado</a></li>
			<li><a href='#Erro'>Erro</a></li>
		</ol>
		<li><a href='#Mime%20Types'>Mime Types</a></li>
		<li><a href='#Middleware%20Rack'>Middleware Rack</a></li>
		<li><a href='#Testando'>Testando</a></li>
		<li><a href='#Sinatra::Base%20-%20Middleware,%20Bibliotecas%20e%20aplicativos%20modulares'>Sinatra::Base - Middleware, Bibliotecas e aplicativos modulares</a></li>
		<li><a href='#Linha%20de%20Comandos'>Linha de Comandos</a></li>
		<li><a href='#A%20ltima%20verso'>A ltima verso</a></li>
		<li><a href='#Mais'>Mais</a></li>
	</ol>
</div>


<p><em>Ateno: Este documento  apenas uma traduo da verso em ingls e
pode estar desatualizado.</em></p>

<p>Sinatra  uma
<a href="http://pt.wikipedia.org/wiki/Linguagem_de_domnio_especfico">DSL</a> para
criar rapidamente aplicaes web em Ruby com o mnimo de esforo:</p>
<pre class="highlight ruby"><span class="c1"># minhaapp.rb</span>
<span class="nb">require</span> <span class="s1">'rubygems'</span>
<span class="nb">require</span> <span class="s1">'sinatra'</span>
<span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="s1">'Ol Mundo!'</span>
<span class="k">end</span>
</pre>
<p>Instale a gem e execute com:</p>
<pre class="highlight shell">sudo gem install sinatra
ruby minhaapp.rb
</pre>
<p>Aceda em: <a href="http://localhost:4567">localhost:4567</a></p>

<a name='Rotas'></a>
<h2>Rotas</h2>

<p>No Sinatra, uma rota  um metodo HTTP associado a uma URL correspondente
padro. Cada rota  associada a um bloco:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="nf">..</span> <span class="n">mostrar</span> <span class="n">algo</span> <span class="nf">..</span>
<span class="k">end</span>

<span class="n">post</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="nf">..</span> <span class="n">criar</span> <span class="n">algo</span> <span class="nf">..</span>
<span class="k">end</span>

<span class="n">put</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="nf">..</span> <span class="n">atualizar</span> <span class="n">algo</span> <span class="nf">..</span>
<span class="k">end</span>

<span class="n">delete</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="nf">..</span> <span class="n">apagar</span> <span class="n">algo</span> <span class="nf">..</span>
<span class="k">end</span>
</pre>
<p>Rotas so encontradas na ordem em que so definidas. A primeira rota que
 encontrada invoca o pedido.</p>

<p>Padres de rota podem incluir parmetros nomeados, acessveis atravs da
hash <code>params</code>:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/ola/:nome'</span> <span class="k">do</span>
  <span class="c1"># corresponde a &quot;GET /ola/foo&quot; e &quot;GET /ola/bar&quot;</span>
  <span class="c1"># params[:nome]  'foo' ou 'bar'</span>
  <span class="s2">&quot;Ol </span><span class="si">#{</span><span class="n">params</span><span class="o">[</span><span class="ss">:nome</span><span class="o">]</span><span class="si">}</span><span class="s2">!&quot;</span>
<span class="k">end</span>
</pre>
<p>Pode tambm aceder a parmetros nomeados atravs do bloco de parmetros:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/ola/:nome'</span> <span class="k">do</span> <span class="o">|</span><span class="n">n</span><span class="o">|</span>
  <span class="s2">&quot;Ol </span><span class="si">#{</span><span class="n">n</span><span class="si">}</span><span class="s2">!&quot;</span>
<span class="k">end</span>
</pre>
<p>Padres de rota podem tambm incluir parmetros splat (asteriscos),
acessveis atravs do array <code>params[:splat]</code>.</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/diga/*/ao/*'</span> <span class="k">do</span>
  <span class="c1"># corresponde a /diga/ola/ao/mundo</span>
  <span class="n">params</span><span class="o">[</span><span class="ss">:splat</span><span class="o">]</span> <span class="c1"># =&gt; [&quot;ola&quot;, &quot;mundo&quot;]</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/download/*.*'</span> <span class="k">do</span>
  <span class="c1"># corresponde a /download/pasta/do/arquivo.xml</span>
  <span class="n">params</span><span class="o">[</span><span class="ss">:splat</span><span class="o">]</span> <span class="c1"># =&gt; [&quot;pasta/do/arquivo&quot;, &quot;xml&quot;]</span>
<span class="k">end</span>
</pre>
<p>Rotas correspondem-se com expresses regulares:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="sr">%r{/ola/([</span><span class="se">\w</span><span class="sr">]+)}</span> <span class="k">do</span>
  <span class="s2">&quot;Ol, </span><span class="si">#{</span><span class="n">params</span><span class="o">[</span><span class="ss">:captures</span><span class="o">]</span><span class="nf">.first</span><span class="si">}</span><span class="s2">!&quot;</span>
<span class="k">end</span>
</pre>
<p>Ou com um bloco de parmetro:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="sr">%r{/ola/([</span><span class="se">\w</span><span class="sr">]+)}</span> <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span>
  <span class="s2">&quot;Ol, </span><span class="si">#{</span><span class="n">c</span><span class="si">}</span><span class="s2">!&quot;</span>
<span class="k">end</span>
</pre>
<p>Rotas podem incluir uma variedade de condies correspondentes, por
exemplo, o agente usurio:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/foo'</span><span class="p">,</span> <span class="ss">:agent</span> <span class="o">=&gt;</span> <span class="sr">/Songbird (\d\.\d)[\d\/]*?/</span> <span class="k">do</span>
  <span class="s2">&quot;Voc est a utilizar a verso </span><span class="si">#{</span><span class="n">params</span><span class="o">[</span><span class="ss">:agent</span><span class="o">][</span><span class="mi">0</span><span class="o">]</span><span class="si">}</span><span class="s2"> do Songbird.&quot;</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/foo'</span> <span class="k">do</span>
  <span class="c1"># Corresponde a um navegador no Songbird</span>
<span class="k">end</span>
</pre>
<a name='Arquivos%20estticos'></a>
<h2>Arquivos estticos</h2>

<p>Arquivos estticos so disponibilizados a partir do directrio
<code>./public</code>. Voc pode especificar um local diferente atravs da opo
<code>:public_folder</code></p>
<pre class="highlight ruby"><span class="n">set</span> <span class="ss">:public_folder</span><span class="p">,</span> <span class="no">File</span><span class="nf">.dirname</span><span class="p">(</span><span class="kp">__FILE__</span><span class="p">)</span> <span class="o">+</span> <span class="s1">'/estatico'</span>
</pre>
<p>Note que o nome do directrio pblico no  incluido no URL. Um arquivo
<code>./public/css/style.css</code>  disponibilizado como
<code>http://example.com/css/style.css</code>.</p>

<a name='Views%20/%20Templates'></a>
<h2>Views / Templates</h2>

<p>Templates presumem-se estar localizados sob o directrio <code>./views</code>. Para
utilizar um directrio de views diferente:</p>
<pre class="highlight ruby"><span class="n">set</span> <span class="ss">:views</span><span class="p">,</span> <span class="no">File</span><span class="nf">.dirname</span><span class="p">(</span><span class="kp">__FILE__</span><span class="p">)</span> <span class="o">+</span> <span class="s1">'/modelo'</span>
</pre>
<p>Uma coisa importante a ser lembrada  que voc sempre tem as referncias
dos templates como smbolos, mesmo se eles estiverem num sub-directrio
(nesse caso utilize <code>:&#39;subdir/template&#39;</code>). Mtodos de renderizao iro
processar qualquer string passada directamente para elas.</p>

<a name='Haml%20Templates'></a>
<h3>Haml Templates</h3>

<p>A gem/biblioteca haml  necessria para renderizar templates HAML:</p>
<pre class="highlight ruby"><span class="c1">#  necessrio requerir 'haml' na aplicao.</span>
<span class="nb">require</span> <span class="s1">'haml'</span>

<span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">haml</span> <span class="ss">:index</span>
<span class="k">end</span>
</pre>
<p>Renderiza <code>./views/index.haml</code>.</p>

<p><a href="http://haml.info/docs/yardoc/file.HAML_REFERENCE.html#options">Opes
Haml</a>
podem ser definidas globalmente atravs das configuraes do sinatra,
veja <a href="http://www.sinatrarb.com/configuration.html">Opes e
Configuraes</a>, e substitua
em uma requisio individual.</p>
<pre class="highlight ruby"><span class="n">set</span> <span class="ss">:haml</span><span class="p">,</span> <span class="p">{</span><span class="ss">:format</span> <span class="o">=&gt;</span> <span class="ss">:html5</span> <span class="p">}</span> <span class="c1"># o formato padro do Haml  :xhtml</span>

<span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">haml</span> <span class="ss">:index</span><span class="p">,</span> <span class="ss">:haml_options</span> <span class="o">=&gt;</span> <span class="p">{</span><span class="ss">:format</span> <span class="o">=&gt;</span> <span class="ss">:html4</span> <span class="p">}</span> <span class="c1"># substituido</span>
<span class="k">end</span>
</pre>
<a name='Erb%20Templates'></a>
<h3>Erb Templates</h3>
<pre class="highlight ruby"><span class="c1">#  necessrio requerir 'erb' na aplicao.</span>
<span class="nb">require</span> <span class="s1">'erb'</span>

<span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">erb</span> <span class="ss">:index</span>
<span class="k">end</span>
</pre>
<p>Renderiza <code>./views/index.erb</code></p>

<a name='Erubis'></a>
<h3>Erubis</h3>

<p>A gem/biblioteca erubis  necessria para renderizar templates erubis:</p>
<pre class="highlight ruby"><span class="c1">#  necessrio requerir 'erubis' na aplicao.</span>
<span class="nb">require</span> <span class="s1">'erubis'</span>

<span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">erubis</span> <span class="ss">:index</span>
<span class="k">end</span>
</pre>
<p>Renderiza <code>./views/index.erubis</code></p>

<a name='Builder%20Templates'></a>
<h3>Builder Templates</h3>

<p>A gem/biblioteca builder  necessria para renderizar templates builder:</p>
<pre class="highlight ruby"><span class="c1">#  necessrio requerir 'builder' na aplicao.</span>
<span class="nb">require</span> <span class="s1">'builder'</span>

<span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">content_type</span> <span class="s1">'application/xml'</span><span class="p">,</span> <span class="ss">:charset</span> <span class="o">=&gt;</span> <span class="s1">'utf-8'</span>
  <span class="n">builder</span> <span class="ss">:index</span>
<span class="k">end</span>
</pre>
<p>Renderiza <code>./views/index.builder</code>.</p>

<a name='Sass%20Templates'></a>
<h3>Sass Templates</h3>

<p>A gem/biblioteca sass  necessria para renderizar templates sass:</p>
<pre class="highlight ruby"><span class="c1">#  necessrio requerir 'haml' ou 'sass' na aplicao.</span>
<span class="nb">require</span> <span class="s1">'sass'</span>

<span class="n">get</span> <span class="s1">'/stylesheet.css'</span> <span class="k">do</span>
  <span class="n">content_type</span> <span class="s1">'text/css'</span><span class="p">,</span> <span class="ss">:charset</span> <span class="o">=&gt;</span> <span class="s1">'utf-8'</span>
  <span class="n">sass</span> <span class="ss">:stylesheet</span>
<span class="k">end</span>
</pre>
<p>Renderiza <code>./views/stylesheet.sass</code>.</p>

<p><a href="http://sass-lang.com/docs/yardoc/file.SASS_REFERENCE.html#options">Opes
Sass</a>
podem ser definidas globalmente atravs das configuraes do sinatra,
veja <a href="http://www.sinatrarb.com/configuration.html">Opes e
Configuraes</a>, e substitua
em uma requisio individual.</p>
<pre class="highlight ruby"><span class="n">set</span> <span class="ss">:sass</span><span class="p">,</span> <span class="p">{</span><span class="ss">:style</span> <span class="o">=&gt;</span> <span class="ss">:compact</span> <span class="p">}</span> <span class="c1"># o estilo padro do Sass  :nested</span>

<span class="n">get</span> <span class="s1">'/stylesheet.css'</span> <span class="k">do</span>
  <span class="n">content_type</span> <span class="s1">'text/css'</span><span class="p">,</span> <span class="ss">:charset</span> <span class="o">=&gt;</span> <span class="s1">'utf-8'</span>
  <span class="n">sass</span> <span class="ss">:stylesheet</span><span class="p">,</span> <span class="ss">:style</span> <span class="o">=&gt;</span> <span class="ss">:expanded</span> <span class="c1"># substituido</span>
<span class="k">end</span>
</pre>
<a name='Less%20Templates'></a>
<h3>Less Templates</h3>

<p>A gem/biblioteca less  necessria para renderizar templates Less:</p>
<pre class="highlight ruby"><span class="c1">#  necessrio requerir 'less' na aplicao.</span>
<span class="nb">require</span> <span class="s1">'less'</span>

<span class="n">get</span> <span class="s1">'/stylesheet.css'</span> <span class="k">do</span>
  <span class="n">content_type</span> <span class="s1">'text/css'</span><span class="p">,</span> <span class="ss">:charset</span> <span class="o">=&gt;</span> <span class="s1">'utf-8'</span>
  <span class="n">less</span> <span class="ss">:stylesheet</span>
<span class="k">end</span>
</pre>
<p>Renderiza <code>./views/stylesheet.less</code>.</p>

<a name='Templates%20Inline'></a>
<h3>Templates Inline</h3>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">haml</span> <span class="s1">'%div.title Ol Mundo'</span>
<span class="k">end</span>
</pre>
<p>Renderiza a string, em uma linha, no template.</p>

<a name='Acedendo%20a%20Variveis%20nos%20Templates'></a>
<h3>Acedendo a Variveis nos Templates</h3>

<p>Templates so avaliados dentro do mesmo contexto que os manipuladores de
rota. Variveis de instncia definidas em rotas manipuladas so
directamente acedidas por templates:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/:id'</span> <span class="k">do</span>
  <span class="vi">@foo</span> <span class="o">=</span> <span class="no">Foo</span><span class="nf">.find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
  <span class="n">haml</span> <span class="s1">'%h1= @foo.nome'</span>
<span class="k">end</span>
</pre>
<p>Ou, especifique um hash explcito para variveis locais:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/:id'</span> <span class="k">do</span>
  <span class="n">foo</span> <span class="o">=</span> <span class="no">Foo</span><span class="nf">.find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
  <span class="n">haml</span> <span class="s1">'%h1= foo.nome'</span><span class="p">,</span> <span class="ss">:locals</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:foo</span> <span class="o">=&gt;</span> <span class="n">foo</span> <span class="p">}</span>
<span class="k">end</span>
</pre>
<p>Isso  tipicamente utilizado quando renderizamos templates parciais
(partials) dentro de outros templates.</p>

<a name='Templates%20Inline'></a>
<h3>Templates Inline</h3>

<p>Templates podem ser definidos no final do arquivo fonte(.rb):</p>
<pre class="highlight ruby"><span class="nb">require</span> <span class="s1">'rubygems'</span>
<span class="nb">require</span> <span class="s1">'sinatra'</span>

<span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">haml</span> <span class="ss">:index</span>
<span class="k">end</span>

<span class="cp">__END__

@@ layout
%html
  = yield

@@ index
%div.title Ol Mundo!!!!!
</span></pre>
<p>NOTA: Templates inline definidos no arquivo fonte so automaticamente
carregados pelo sinatra. Digite `enable :inline_templates` se tem
templates inline no outro arquivo fonte.</p>

<a name='Templates%20nomeados'></a>
<h3>Templates nomeados</h3>

<p>Templates tambm podem ser definidos utilizando o mtodo top-level
<code>template</code>:</p>
<pre class="highlight ruby"><span class="n">template</span> <span class="ss">:layout</span> <span class="k">do</span>
  <span class="s2">&quot;%html</span><span class="se">\n</span><span class="s2">  =yield</span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="k">end</span>

<span class="n">template</span> <span class="ss">:index</span> <span class="k">do</span>
  <span class="s1">'%div.title Ol Mundo!'</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">haml</span> <span class="ss">:index</span>
<span class="k">end</span>
</pre>
<p>Se existir um template com nome layout, ele ser utilizado sempre que
um template for renderizado. Pode desactivar layouts usando
<code>:layout =&gt; false</code>.</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">haml</span> <span class="ss">:index</span><span class="p">,</span> <span class="ss">:layout</span> <span class="o">=&gt;</span> <span class="o">!</span><span class="n">request</span><span class="nf">.xhr?</span>
<span class="k">end</span>
</pre>
<a name='Helpers'></a>
<h2>Helpers</h2>

<p>Use o mtodo de alto nvel <code>helpers</code> para definir mtodos auxiliares
para utilizar em manipuladores de rotas e modelos:</p>
<pre class="highlight ruby"><span class="n">helpers</span> <span class="k">do</span>
  <span class="k">def</span> <span class="nf">bar</span><span class="p">(</span><span class="n">nome</span><span class="p">)</span>
    <span class="s2">&quot;</span><span class="si">#{</span><span class="n">nome</span><span class="si">}</span><span class="s2">bar&quot;</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/:nome'</span> <span class="k">do</span>
  <span class="n">bar</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:nome</span><span class="o">]</span><span class="p">)</span>
<span class="k">end</span>
</pre>
<a name='Filtros'></a>
<h2>Filtros</h2>

<p>Filtros Before so avaliados antes de cada requisio dentro do contexto
da requisio e podem modificar a requisio e a reposta. Variveis de
instncia definidas nos filtros so acedidas atravs de rotas e
templates:</p>
<pre class="highlight ruby"><span class="n">before</span> <span class="k">do</span>
  <span class="vi">@nota</span> <span class="o">=</span> <span class="s1">'Ol!'</span>
  <span class="n">request</span><span class="nf">.path_info</span> <span class="o">=</span> <span class="s1">'/foo/bar/baz'</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/foo/*'</span> <span class="k">do</span>
  <span class="vi">@nota</span> <span class="c1">#=&gt; 'Ol!'</span>
  <span class="n">params</span><span class="o">[</span><span class="ss">:splat</span><span class="o">]</span> <span class="c1">#=&gt; 'bar/baz'</span>
<span class="k">end</span>
</pre>
<p>Filtros After so avaliados aps cada requisio dentro do contexto da
requisio e tambm podem modificar o pedido e a resposta. Variveis de
instncia definidas nos filtros before e rotas so acedidas atravs dos
filtros after:</p>
<pre class="highlight ruby"><span class="n">after</span> <span class="k">do</span>
  <span class="nb">puts</span> <span class="n">response</span><span class="nf">.status</span>
<span class="k">end</span>
</pre>
<p>Filtros opcionalmente tm um padro, fazendo com que sejam avaliados
somente se o caminho do pedido coincidir com esse padro:</p>
<pre class="highlight ruby"><span class="n">before</span> <span class="s1">'/protected/*'</span> <span class="k">do</span>
  <span class="n">autenticar!</span>
<span class="k">end</span>

<span class="n">after</span> <span class="s1">'/create/:slug'</span> <span class="k">do</span> <span class="o">|</span><span class="n">slug</span><span class="o">|</span>
  <span class="n">session</span><span class="o">[</span><span class="ss">:last_slug</span><span class="o">]</span> <span class="o">=</span> <span class="n">slug</span>
<span class="k">end</span>
</pre>
<a name='Halting'></a>
<h2>Halting</h2>

<p>Para parar imediatamente uma requisio dentro de um filtro ou rota
utilize:</p>
<pre class="highlight ruby"><span class="n">halt</span>
</pre>
<p>Pode tambm especificar o status ao parar</p>
<pre class="highlight ruby"><span class="n">halt</span> <span class="mi">410</span>
</pre>
<p>Ou com um corpo de texto</p>
<pre class="highlight ruby"><span class="n">halt</span> <span class="s1">'isto ser o corpo de texto'</span>
</pre>
<p>Ou tambm</p>
<pre class="highlight ruby"><span class="n">halt</span> <span class="mi">401</span><span class="p">,</span> <span class="s1">'vamos embora!'</span>
</pre>
<p>Com cabealhos</p>
<pre class="highlight ruby"><span class="n">halt</span> <span class="mi">402</span><span class="p">,</span> <span class="p">{</span><span class="s1">'Content-Type'</span> <span class="o">=&gt;</span> <span class="s1">'text/plain'</span><span class="p">},</span> <span class="s1">'revanche'</span>
</pre>
<a name='Passing'></a>
<h2>Passing</h2>

<p>Dentro de uma rota, pode passar para a prxima rota correspondente
usando <code>pass</code>:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/adivinhar/:quem'</span> <span class="k">do</span>
  <span class="n">pass</span> <span class="k">unless</span> <span class="n">params</span><span class="o">[</span><span class="ss">:quem</span><span class="o">]</span> <span class="o">==</span> <span class="s1">'Frank'</span>
  <span class="s1">'Apanhaste-me!'</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/adivinhar/*'</span> <span class="k">do</span>
  <span class="s1">'Falhaste!'</span>
<span class="k">end</span>
</pre>
<p>O bloqueio da rota  imediatamente encerrado e o controle continua com a
prxima rota de parmetro. Se o parmetro da rota no for encontrado, um
404  retornado.</p>

<a name='Configurao'></a>
<h2>Configurao</h2>

<p>Correndo uma vez, na inicializao, em qualquer ambiente:</p>
<pre class="highlight ruby"><span class="n">configure</span> <span class="k">do</span>
  <span class="nf">..</span><span class="o">.</span>
<span class="k">end</span>
</pre>
<p>Correndo somente quando o ambiente (<code>RACK_ENV</code> environment varivel) 
definido para <code>:production</code>:</p>
<pre class="highlight ruby"><span class="n">configure</span> <span class="ss">:production</span> <span class="k">do</span>
  <span class="nf">..</span><span class="o">.</span>
<span class="k">end</span>
</pre>
<p>Correndo quando o ambiente  definido para <code>:production</code> ou <code>:test</code>:</p>
<pre class="highlight ruby"><span class="n">configure</span> <span class="ss">:production</span><span class="p">,</span> <span class="ss">:test</span> <span class="k">do</span>
  <span class="nf">..</span><span class="o">.</span>
<span class="k">end</span>
</pre>
<a name='Lidar%20com%20Erros'></a>
<h2>Lidar com Erros</h2>

<p>Lida-se com erros no mesmo contexto das rotas e filtros before, o que
signifca que <code>haml</code>, <code>erb</code>, etc, esto disponveis.</p>

<a name='No%20Encontrado'></a>
<h3>No Encontrado</h3>

<p>Quando um <code>Sinatra::NotFound</code> exception  levantado, ou o cdigo de
status da reposta  404, o manipulador <code>not_found</code>  invocado:</p>
<pre class="highlight ruby"><span class="n">not_found</span> <span class="k">do</span>
  <span class="s1">'Isto est longe de ser encontrado'</span>
<span class="k">end</span>
</pre>
<a name='Erro'></a>
<h3>Erro</h3>

<p>O manipulador <code>error</code>  invocado sempre que uma exceo  lanada a
partir de um bloco de rota ou um filtro. O objecto da exceo pode ser
obtido a partir da varivel Rack <code>sinatra.error</code>:</p>
<pre class="highlight ruby"><span class="n">error</span> <span class="k">do</span>
  <span class="s1">'Peo desculpa, houve um erro desagradvel - '</span> <span class="o">+</span> <span class="n">env</span><span class="o">[</span><span class="s1">'sinatra.error'</span><span class="o">]</span><span class="nf">.name</span>
<span class="k">end</span>
</pre>
<p>Erros personalizados:</p>
<pre class="highlight ruby"><span class="n">error</span> <span class="no">MeuErroPersonalizado</span> <span class="k">do</span>
  <span class="s1">'O que aconteceu foi...'</span> <span class="o">+</span> <span class="n">env</span><span class="o">[</span><span class="s1">'sinatra.error'</span><span class="o">]</span><span class="nf">.message</span>
<span class="k">end</span>
</pre>
<p>Ento, se isso acontecer:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="k">raise</span> <span class="no">MeuErroPersonalizado</span><span class="p">,</span> <span class="s1">'alguma coisa desagradvel'</span>
<span class="k">end</span>
</pre>
<p>O resultado ser:</p>
<pre class="highlight text">O que aconteceu foi...alguma coisa desagradvel
</pre>
<p>Alternativamente, pode definir um manipulador de erro para um cdigo de
status:</p>
<pre class="highlight ruby"><span class="n">error</span> <span class="mi">403</span> <span class="k">do</span>
  <span class="s1">'Accesso negado'</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/secreto'</span> <span class="k">do</span>
  <span class="mi">403</span>
<span class="k">end</span>
</pre>
<p>Ou um range (alcance):</p>
<pre class="highlight ruby"><span class="n">error</span> <span class="mi">400</span><span class="nf">..</span><span class="mi">510</span> <span class="k">do</span>
  <span class="s1">'Boom'</span>
<span class="k">end</span>
</pre>
<p>O Sinatra define os manipuladores especiais <code>not_found</code> e <code>error</code> quando
corre no ambiente de desenvolvimento.</p>

<a name='Mime%20Types'></a>
<h2>Mime Types</h2>

<p>Quando utilizamos <code>send_file</code> ou arquivos estticos pode ter mime types
Sinatra no entendidos. Use <code>mime_type</code> para os registar por extenso de
arquivos:</p>
<pre class="highlight ruby"><span class="n">mime_type</span> <span class="ss">:foo</span><span class="p">,</span> <span class="s1">'text/foo'</span>
</pre>
<p>Pode tambm utilizar isto com o helper <code>content_type</code>:</p>
<pre class="highlight ruby"><span class="n">content_type</span> <span class="ss">:foo</span>
</pre>
<a name='Middleware%20Rack'></a>
<h2>Middleware Rack</h2>

<p>O Sinatra corre no <a href="http://rack.rubyforge.org/">Rack</a>, uma interface
padro mnima para frameworks web em Ruby. Uma das capacidades mais
interessantes do Rack, para desenvolver aplicaes,  o suporte de
middleware  componentes que residem entre o servidor e a aplicao,
monitorizando e/ou manipulando o pedido/resposta (request/response) HTTP
para providenciar varios tipos de funcionalidades comuns.</p>

<p>O Sinatra torna a construo de pipelines do middleware Rack fcil a um
nvel superior utilizando o mtodo <code>use</code>:</p>
<pre class="highlight ruby"><span class="nb">require</span> <span class="s1">'sinatra'</span>
<span class="nb">require</span> <span class="s1">'meu_middleware_personalizado'</span>

<span class="n">use</span> <span class="no">Rack</span><span class="o">::</span><span class="no">Lint</span>
<span class="n">use</span> <span class="no">MeuMiddlewarePersonalizado</span>

<span class="n">get</span> <span class="s1">'/ola'</span> <span class="k">do</span>
  <span class="s1">'Ol mundo'</span>
<span class="k">end</span>
</pre>
<p>A semntica de <code>use</code>  idntica aquela definida para a DSL
<a href="http://rack.rubyforge.org/doc/classes/Rack/Builder.html">Rack::Builder</a>
(mais frequentemente utilizada para arquivos rackup). Por exemplo, o
mtodo <code>use</code> aceita mltiplos argumentos/variveis, bem como blocos:</p>
<pre class="highlight ruby"><span class="n">use</span> <span class="no">Rack</span><span class="o">::</span><span class="no">Auth</span><span class="o">::</span><span class="no">Basic</span> <span class="k">do</span> <span class="o">|</span><span class="n">utilizador</span><span class="p">,</span> <span class="n">senha</span><span class="o">|</span>
  <span class="n">utilizador</span> <span class="o">==</span> <span class="s1">'admin'</span> <span class="o">&amp;&amp;</span> <span class="n">senha</span> <span class="o">==</span> <span class="s1">'secreto'</span>
<span class="k">end</span>
</pre>
<p>O Rack  distribuido com uma variedade de middleware padres para logs,
debugs, rotas de URL, autenticao, e manipuladores de sesso.Sinatra
utiliza muitos desses componentes automaticamente dependendo da
configurao, por isso, tipicamente nao  necessrio utilizar <code>use</code>
explicitamente.</p>

<a name='Testando'></a>
<h2>Testando</h2>

<p>Testes no Sinatra podem ser escritos utilizando qualquer biblioteca ou
framework de teste baseados no Rack.
<a href="http://gitrdoc.com/brynary/rack-test">Rack::Test</a>  recomendado:</p>
<pre class="highlight ruby"><span class="nb">require</span> <span class="s1">'minha_aplicacao_sinatra'</span>
<span class="nb">require</span> <span class="s1">'rack/test'</span>

<span class="k">class</span> <span class="nc">MinhaAplicacaoTeste</span> <span class="o">&lt;</span> <span class="no">Test</span><span class="o">::</span><span class="no">Unit</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="kp">include</span> <span class="no">Rack</span><span class="o">::</span><span class="no">Test</span><span class="o">::</span><span class="no">Methods</span>

  <span class="k">def</span> <span class="nf">app</span>
    <span class="no">Sinatra</span><span class="o">::</span><span class="no">Application</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">meu_test_default</span>
    <span class="n">get</span> <span class="s1">'/'</span>
    <span class="n">assert_equal</span> <span class="s1">'Ola Mundo!'</span><span class="p">,</span> <span class="n">last_response</span><span class="nf">.body</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">teste_com_parametros</span>
    <span class="n">get</span> <span class="s1">'/atender'</span><span class="p">,</span> <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">'Frank'</span>
    <span class="n">assert_equal</span> <span class="s1">'Ol Frank!'</span><span class="p">,</span> <span class="n">last_response</span><span class="nf">.bodymeet</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">test_com_ambiente_rack</span>
    <span class="n">get</span> <span class="s1">'/'</span><span class="p">,</span> <span class="p">{},</span> <span class="s1">'HTTP_USER_AGENT'</span> <span class="o">=&gt;</span> <span class="s1">'Songbird'</span>
    <span class="n">assert_equal</span> <span class="s2">&quot;Voc est utilizando o Songbird!&quot;</span><span class="p">,</span> <span class="n">last_response</span><span class="nf">.body</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre>
<p>NOTA: Os mdulos de classe embutidos <code>Sinatra::Test</code> e
<code>Sinatra::TestHarness</code> so depreciados na verso 0.9.2.</p>

<a name='Sinatra::Base%20-%20Middleware,%20Bibliotecas%20e%20aplicativos%20modulares'></a>
<h2>Sinatra::Base - Middleware, Bibliotecas e aplicativos modulares</h2>

<p>Definir sua aplicao a um nvel superior de trabalho funciona bem para
micro aplicativos, mas tem considerveis incovenientes na construo de
componentes reutilizveis como um middleware Rack, metal Rails,
bibliotecas simples como um componente de servidor, ou mesmo extenses
Sinatra. A DSL de nvel superior polui o espao do objeto e assume um
estilo de configurao de micro aplicativos (exemplo: um simples arquivo
de aplicao, directrios <code>./public</code> e <code>./views</code>, logs, pgina de detalhes
de excepo, etc.).  onde o Sinatra::Base entra em jogo:</p>
<pre class="highlight ruby"><span class="nb">require</span> <span class="s1">'sinatra/base'</span>

<span class="k">class</span> <span class="nc">MinhaApp</span> <span class="o">&lt;</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">set</span> <span class="ss">:sessions</span><span class="p">,</span> <span class="kp">true</span>
  <span class="n">set</span> <span class="ss">:foo</span><span class="p">,</span> <span class="s1">'bar'</span>

  <span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
    <span class="s1">'Ol mundo!'</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre>
<p>A classe MinhaApp  um componente Rack independente que pode utilizar
como um middleware Rack, uma aplicao Rack, ou metal Rails. Pode
utilizar ou executar esta classe com um arquivo rackup <code>config.ru</code>;
ou, controlar um componente de servidor fornecendo como biblioteca:</p>
<pre class="highlight ruby"><span class="no">MinhaApp</span><span class="nf">.run!</span> <span class="ss">:host</span> <span class="o">=&gt;</span> <span class="s1">'localhost'</span><span class="p">,</span> <span class="ss">:port</span> <span class="o">=&gt;</span> <span class="mi">9090</span>
</pre>
<p>Os mtodos disponveis para subclasses <code>Sinatra::Base</code> so exatamente como
aqueles disponveis via a DSL de nvel superior. Aplicaes de nvel
mais alto podem ser convertidas para componentes <code>Sinatra::Base</code> com duas
modificaes:</p>

<ul>
<li><p>Seu arquivo deve requerer <code>sinatra/base</code> ao invs de <code>sinatra</code>;
outra coisa, todos os mtodos DSL do Sinatra so importados para o
espao principal.</p></li>
<li><p>Coloque as rotas da sua aplicao, manipuladores de erro, filtros e
opes na subclasse de um <code>Sinatra::Base</code>.</p></li>
</ul>

<p><code>Sinatra::Base</code>  um quadro branco. Muitas opes so desactivadas por
padro, incluindo o servidor embutido. Veja <a href="http://sinatra.github.com/configuration.html">Opes e
Configuraes</a> para
detalhes de opes disponveis e seus comportamentos.</p>

<p>SIDEBAR: A DSL de alto nvel do Sinatra  implementada utilizando um simples
sistema de delegao. A classe <code>Sinatra::Application</code>  uma subclasse especial
da <code>Sinatra::Base</code>  recebe todos os <code>:get</code>, <code>:put</code>, <code>:post</code>, <code>:delete</code>,
<code>:before</code>, <code>:error</code>, <code>:not_found</code>, <code>:configure</code>, e <code>:set</code> messages enviados
para o alto nvel. D voc mesmo uma vista de olhos ao cdigo: aqui est o
<a href="http://github.com/sinatra/sinatra/blob/ceac46f0bc129a6e994a06100aa854f606fe5992/lib/sinatra/base.rb#L1128">Sinatra::Delegator
mixin</a>
sendo <a href="http://github.com/sinatra/sinatra/blob/ceac46f0bc129a6e994a06100aa854f606fe5992/lib/sinatra/main.rb#L28">incluido dentro de um espao
principal</a></p>

<a name='Linha%20de%20Comandos'></a>
<h2>Linha de Comandos</h2>

<p>As aplicaes Sinatra podem ser executadas directamente:</p>
<pre class="highlight shell">ruby minhaapp.rb <span class="o">[</span>-h] <span class="o">[</span>-x] <span class="o">[</span>-e AMBIENTE] <span class="o">[</span>-p PORTA] <span class="o">[</span>-o HOST] <span class="o">[</span>-s SERVIDOR]
</pre>
<p>As opes so:</p>
<pre class="highlight text">-h # ajuda
-p # define a porta (padro  4567)
-o # define o host (padro  0.0.0.0)
-e # define o ambiente (padro  development)
-s # especifica o servidor/manipulador rack (padro  thin)
-x # activa o bloqueio (padro  desligado)
</pre>
<a name='A%20ltima%20verso'></a>
<h2>A ltima verso</h2>

<p>Se gostaria de utilizar o cdigo da ltima verso do Sinatra, crie um
clone local e execute sua aplicao com o directrio <code>sinatra/lib</code> no
<code>LOAD_PATH</code>:</p>
<pre class="highlight shell"><span class="nb">cd </span>minhaapp
git clone git://github.com/sinatra/sinatra.git
ruby -I sinatra/lib minhaapp.rb
</pre>
<p>Alternativamente, pode adicionar o directrio do <code>sinatra/lib</code> no
<code>LOAD_PATH</code> do seu aplicativo:</p>
<pre class="highlight ruby"><span class="vg">$LOAD_PATH</span><span class="nf">.unshift</span> <span class="no">File</span><span class="nf">.dirname</span><span class="p">(</span><span class="kp">__FILE__</span><span class="p">)</span> <span class="o">+</span> <span class="s1">'/sinatra/lib'</span>
<span class="nb">require</span> <span class="s1">'rubygems'</span>
<span class="nb">require</span> <span class="s1">'sinatra'</span>

<span class="n">get</span> <span class="s1">'/sobre'</span> <span class="k">do</span>
  <span class="s2">&quot;Estou correndo a verso&quot;</span> <span class="o">+</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">VERSION</span>
<span class="k">end</span>
</pre>
<p>Para actualizar o cdigo do Sinatra no futuro:</p>
<pre class="highlight shell"><span class="nb">cd </span>meuprojeto/sinatra
git pull
</pre>
<a name='Mais'></a>
<h2>Mais</h2>

<ul>
<li><p><a href="http://www.sinatrarb.com/">Website do Projeto</a> - Documentao
adicional, novidades e links para outros recursos.</p></li>
<li><p><a href="http://www.sinatrarb.com/contributing">Contribuir</a> - Encontrou um
bug? Precisa de ajuda? Tem um patch?</p></li>
<li><p><a href="http://github.com/sinatra/sinatra/issues">Acompanhar Questes</a></p></li>
<li><p><a href="http://twitter.com/sinatra">Twitter</a></p></li>
<li><p><a href="http://groups.google.com/group/sinatrarb/topics">Lista de Email</a></p></li>
<li><p>[IRC: #sinatra](irc://chat.freenode.net/#sinatra) em
<a href="http://freenode.net">freenode.net</a></p></li>
</ul>
