<div class='toc'>
	<ol class='level-1'>
		<li><a href='#Rutas'>Rutas</a></li>
		<li><a href='#Condiciones'>Condiciones</a></li>
		<ol class='level-2'>
			<li><a href='#Valores%20de%20Retorno'>Valores de Retorno</a></li>
			<li><a href='#Comparadores%20de%20Rutas%20Personalizados'>Comparadores de Rutas Personalizados</a></li>
			<li><a href='#Archivos%20Estticos'>Archivos Estticos</a></li>
			<li><a href='#Vistas%20/%20Plantillas'>Vistas / Plantillas</a></li>
			<li><a href='#Lenguajes%20de%20Plantillas%20Disponibles'>Lenguajes de Plantillas Disponibles</a></li>
			<li><a href='#Plantillas%20Haml'>Plantillas Haml</a></li>
			<li><a href='#Plantillas%20Erb'>Plantillas Erb</a></li>
			<li><a href='#Plantillas%20Builder'>Plantillas Builder</a></li>
			<li><a href='#Plantillas%20Nokogiri'>Plantillas Nokogiri</a></li>
			<li><a href='#Plantillas%20Sass'>Plantillas Sass</a></li>
			<li><a href='#Plantillas%20SCSS'>Plantillas SCSS</a></li>
			<li><a href='#Plantillas%20Less'>Plantillas Less</a></li>
			<li><a href='#Plantillas%20Liquid'>Plantillas Liquid</a></li>
			<li><a href='#Plantillas%20Markdown'>Plantillas Markdown</a></li>
			<li><a href='#Plantillas%20Textile'>Plantillas Textile</a></li>
			<li><a href='#Plantillas%20RDoc'>Plantillas RDoc</a></li>
			<li><a href='#Plantillas%20Radius'>Plantillas Radius</a></li>
			<li><a href='#Plantillas%20Markaby'>Plantillas Markaby</a></li>
			<li><a href='#Plantillas%20RABL'>Plantillas RABL</a></li>
			<li><a href='#Plantillas%20Slim'>Plantillas Slim</a></li>
			<li><a href='#Plantillas%20Creole'>Plantillas Creole</a></li>
			<li><a href='#Plantillas%20CoffeeScript'>Plantillas CoffeeScript</a></li>
			<li><a href='#Plantillas%20Stylus'>Plantillas Stylus</a></li>
			<li><a href='#Plantillas%20Yajl'>Plantillas Yajl</a></li>
			<li><a href='#Plantillas%20WLang'>Plantillas WLang</a></li>
			<li><a href='#Plantillas%20Embebidas'>Plantillas Embebidas</a></li>
			<li><a href='#Accediendo%20a%20Variables%20en%20Plantillas'>Accediendo a Variables en Plantillas</a></li>
			<li><a href='#Plantillas%20Inline'>Plantillas Inline</a></li>
			<li><a href='#Plantillas%20Nombradas'>Plantillas Nombradas</a></li>
			<li><a href='#Asociando%20Extensiones%20de%20Archivo'>Asociando Extensiones de Archivo</a></li>
			<li><a href='#Agregando%20Tu%20Propio%20Motor%20de%20Renderizado'>Agregando Tu Propio Motor de Renderizado</a></li>
		</ol>
		<li><a href='#Filtros'>Filtros</a></li>
		<li><a href='#Ayudantes'>Ayudantes</a></li>
		<ol class='level-2'>
			<li><a href='#Usando%20Sesiones'>Usando Sesiones</a></li>
			<li><a href='#Interrupcin'>Interrupcin</a></li>
			<li><a href='#Paso'>Paso</a></li>
			<li><a href='#Ejecutando%20Otra%20Ruta'>Ejecutando Otra Ruta</a></li>
			<li><a href='#Asignando%20el%20Cdigo%20de%20Estado,%20los%20Encabezados%20y%20el%20Cuerpo%20de%20una%20Respuesta'>Asignando el Cdigo de Estado, los Encabezados y el Cuerpo de una Respuesta</a></li>
			<li><a href='#Streaming%20De%20Respuestas'>Streaming De Respuestas</a></li>
			<li><a href='#Log%20(Registro)'>Log (Registro)</a></li>
			<li><a href='#Tipos%20Mime'>Tipos Mime</a></li>
			<li><a href='#Generando%20URLs'>Generando URLs</a></li>
			<li><a href='#Redireccin%20del%20Navegador'>Redireccin del Navegador</a></li>
			<li><a href='#Cache%20Control'>Cache Control</a></li>
			<li><a href='#Enviando%20Archivos'>Enviando Archivos</a></li>
			<li><a href='#Accediendo%20al%20objeto%20de%20la%20peticin'>Accediendo al objeto de la peticin</a></li>
			<li><a href='#Archivos%20Adjuntos'>Archivos Adjuntos</a></li>
			<li><a href='#Fecha%20y%20Hora'>Fecha y Hora</a></li>
			<li><a href='#Buscando%20los%20Archivos%20de%20las%20Plantillas'>Buscando los Archivos de las Plantillas</a></li>
		</ol>
		<li><a href='#Configuracin'>Configuracin</a></li>
		<ol class='level-2'>
			<li><a href='#Configurando%20la%20Proteccin%20de%20Ataques'>Configurando la Proteccin de Ataques</a></li>
			<li><a href='#Configuraciones%20Disponibles'>Configuraciones Disponibles</a></li>
		</ol>
		<li><a href='#Entornos'>Entornos</a></li>
		<li><a href='#Manejo%20de%20Errores'>Manejo de Errores</a></li>
		<ol class='level-2'>
			<li><a href='#No%20encontrado%20%3Cem%3E(Not%20Found)%3C/em%3E'>No encontrado <em>(Not Found)</em></a></li>
			<li><a href='#Error'>Error</a></li>
		</ol>
		<li><a href='#Rack%20Middleware'>Rack Middleware</a></li>
		<li><a href='#Pruebas'>Pruebas</a></li>
		<li><a href='#Sinatra::Base%20-%20Middleware,%20Libreras,%20y%20Aplicaciones%20Modulares'>Sinatra::Base - Middleware, Libreras, y Aplicaciones Modulares</a></li>
		<ol class='level-2'>
			<li><a href='#Estilo%20Modular%20vs.%20Clsico'>Estilo Modular vs. Clsico</a></li>
			<li><a href='#Sirviendo%20una%20Aplicacin%20Modular'>Sirviendo una Aplicacin Modular</a></li>
			<li><a href='#Usando%20una%20Aplicacin%20Clsica%20con%20un%20Archivo%20config.ru'>Usando una Aplicacin Clsica con un Archivo config.ru</a></li>
			<li><a href='#Cundo%20Usar%20config.ru?'>Cundo Usar config.ru?</a></li>
			<li><a href='#Utilizando%20Sinatra%20como%20Middleware'>Utilizando Sinatra como Middleware</a></li>
			<li><a href='#Creacin%20Dinmica%20de%20Aplicaciones'>Creacin Dinmica de Aplicaciones</a></li>
		</ol>
		<li><a href='#mbitos%20y%20Ligaduras'>mbitos y Ligaduras</a></li>
		<ol class='level-2'>
			<li><a href='#mbito%20de%20Aplicacin/Clase'>mbito de Aplicacin/Clase</a></li>
			<li><a href='#mbito%20de%20Peticin/Instancia'>mbito de Peticin/Instancia</a></li>
			<li><a href='#mbito%20de%20Delegacin'>mbito de Delegacin</a></li>
		</ol>
		<li><a href='#Lnea%20de%20Comandos'>Lnea de Comandos</a></li>
		<li><a href='#Versiones%20de%20Ruby%20Soportadas'>Versiones de Ruby Soportadas</a></li>
		<li><a href='#A%20la%20Vanguardia'>A la Vanguardia</a></li>
		<ol class='level-2'>
			<li><a href='#Con%20Bundler'>Con Bundler</a></li>
			<li><a href='#Con%20Git'>Con Git</a></li>
			<li><a href='#Instalacin%20Global'>Instalacin Global</a></li>
		</ol>
		<li><a href='#Versionado'>Versionado</a></li>
		<li><a href='#Lecturas%20Recomendadas'>Lecturas Recomendadas</a></li>
	</ol>
</div>


<p><em>Atencin: Este documento es una traduccin de la versin en ingls y puede estar desactualizado.</em></p>

<p>Sinatra es un
<a href="http://es.wikipedia.org/wiki/Lenguaje_especfico_del_dominio">DSL</a> para
crear aplicaciones web rpidamente en Ruby con un mnimo esfuerzo:</p>
<pre class="highlight ruby"><span class="c1"># miapp.rb</span>
<span class="nb">require</span> <span class="s1">'sinatra'</span>

<span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="s1">'Hola mundo!'</span>
<span class="k">end</span>
</pre>
<p>Instal la gem y ejecut la aplicacin con:</p>
<pre class="highlight shell">gem install sinatra
ruby miapp.rb
</pre>
<p>Pods verla en: http://localhost:4567</p>

<p>Es recomendable adems ejecutar <code>gem install thin</code>, ya que Sinatra lo va
a utilizar cuando est disponible.</p>

<a name='Rutas'></a>
<h2>Rutas</h2>

<p>En Sinatra, una ruta est compuesta por un mtodo HTTP y un patrn de una URL.
Cada ruta se asocia con un bloque:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="nf">..</span> <span class="n">mostrar</span> <span class="n">algo</span> <span class="nf">..</span>
<span class="k">end</span>

<span class="n">post</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="nf">..</span> <span class="n">crear</span> <span class="n">algo</span> <span class="nf">..</span>
<span class="k">end</span>

<span class="n">put</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="nf">..</span> <span class="n">reemplazar</span> <span class="n">algo</span> <span class="nf">..</span>
<span class="k">end</span>

<span class="n">patch</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="nf">..</span> <span class="n">modificar</span> <span class="n">algo</span> <span class="nf">..</span>
<span class="k">end</span>

<span class="n">delete</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="nf">..</span> <span class="n">aniquilar</span> <span class="n">algo</span> <span class="nf">..</span>
<span class="k">end</span>

<span class="n">options</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="nf">..</span> <span class="n">informar</span> <span class="n">algo</span> <span class="nf">..</span>
<span class="k">end</span>
</pre>
<p>Las rutas son comparadas en el orden en el que son definidas. La primer ruta
que coincide con la peticin es invocada.</p>

<p>Los patrones de las rutas pueden incluir parmetros nombrados, accesibles a
travs de el hash <code>params</code>:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/hola/:nombre'</span> <span class="k">do</span>
  <span class="c1"># coincide con &quot;GET /hola/foo&quot; y &quot;GET /hola/bar&quot;</span>
  <span class="c1"># params[:nombre] es 'foo' o 'bar'</span>
  <span class="s2">&quot;Hola </span><span class="si">#{</span><span class="n">params</span><span class="o">[</span><span class="ss">:nombre</span><span class="o">]</span><span class="si">}</span><span class="s2">!&quot;</span>
<span class="k">end</span>
</pre>
<p>Tambin pods acceder a los parmetros nombrados usando parmetros de bloque:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/hola/:nombre'</span> <span class="k">do</span> <span class="o">|</span><span class="n">n</span><span class="o">|</span>
  <span class="s2">&quot;Hola </span><span class="si">#{</span><span class="n">n</span><span class="si">}</span><span class="s2">!&quot;</span>
<span class="k">end</span>
</pre>
<p>Los patrones de ruta tambin pueden incluir parmetros splat (o wildcard),
accesibles a travs del arreglo <code>params[:splat]</code>:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/decir/*/al/*'</span> <span class="k">do</span>
  <span class="c1"># coincide con /decir/hola/al/mundo</span>
  <span class="n">params</span><span class="o">[</span><span class="ss">:splat</span><span class="o">]</span> <span class="c1"># =&gt; [&quot;hola&quot;, &quot;mundo&quot;]</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/descargar/*.*'</span> <span class="k">do</span>
  <span class="c1"># coincide con /descargar/path/al/archivo.xml</span>
  <span class="n">params</span><span class="o">[</span><span class="ss">:splat</span><span class="o">]</span> <span class="c1"># =&gt; [&quot;path/al/archivo&quot;, &quot;xml&quot;]</span>
<span class="k">end</span>
</pre>
<p>O, con parmetros de bloque:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/descargar/*.*'</span> <span class="k">do</span> <span class="o">|</span><span class="n">path</span><span class="p">,</span> <span class="n">ext</span><span class="o">|</span>
  <span class="o">[</span><span class="n">path</span><span class="p">,</span> <span class="n">ext</span><span class="o">]</span> <span class="c1"># =&gt; [&quot;path/al/archivo&quot;, &quot;xml&quot;]</span>
<span class="k">end</span>
</pre>
<p>Rutas con Expresiones Regulares:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="sr">%r{/hola/([</span><span class="se">\w</span><span class="sr">]+)}</span> <span class="k">do</span>
  <span class="s2">&quot;Hola, </span><span class="si">#{</span><span class="n">params</span><span class="o">[</span><span class="ss">:captures</span><span class="o">]</span><span class="nf">.first</span><span class="si">}</span><span class="s2">!&quot;</span>
<span class="k">end</span>
</pre>
<p>O con un parmetro de bloque:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="sr">%r{/hola/([</span><span class="se">\w</span><span class="sr">]+)}</span> <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span>
  <span class="s2">&quot;Hola, </span><span class="si">#{</span><span class="n">c</span><span class="si">}</span><span class="s2">!&quot;</span>
<span class="k">end</span>
</pre>
<p>Los patrones de ruta pueden contener parmetros opcionales:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/posts.?:formato?'</span> <span class="k">do</span>
  <span class="c1"># coincide con &quot;GET /posts&quot; y adems admite cualquier extensin, por</span>
  <span class="c1"># ejemplo, &quot;GET /posts.json&quot;, &quot;GET /posts.xml&quot;, etc.</span>
<span class="k">end</span>
</pre>
<p>A propsito, a menos que desactivs la proteccin para el ataque <em>path
traversal</em> (ver ms abajo), el path de la peticin puede ser modificado
antes de que se compare con los de tus rutas.</p>

<a name='Condiciones'></a>
<h2>Condiciones</h2>

<p>Las rutas pueden incluir una variedad de condiciones de seleccin, como por
ejemplo el user agent:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/foo'</span><span class="p">,</span> <span class="ss">:agent</span> <span class="o">=&gt;</span> <span class="sr">/Songbird (\d\.\d)[\d\/]*?/</span> <span class="k">do</span>
  <span class="s2">&quot;Ests usando la versin de Songbird </span><span class="si">#{</span><span class="n">params</span><span class="o">[</span><span class="ss">:agent</span><span class="o">][</span><span class="mi">0</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/foo'</span> <span class="k">do</span>
  <span class="c1"># Coincide con browsers que no sean songbird</span>
<span class="k">end</span>
</pre>
<p>Otras condiciones disponibles son <code>host_name</code> y <code>provides</code>:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/'</span><span class="p">,</span> <span class="ss">:host_name</span> <span class="o">=&gt;</span> <span class="sr">/^admin\./</span> <span class="k">do</span>
  <span class="s2">&quot;rea de Administracin, Acceso denegado!&quot;</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/'</span><span class="p">,</span> <span class="ss">:provides</span> <span class="o">=&gt;</span> <span class="s1">'html'</span> <span class="k">do</span>
  <span class="n">haml</span> <span class="ss">:index</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/'</span><span class="p">,</span> <span class="ss">:provides</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="s1">'rss'</span><span class="p">,</span> <span class="s1">'atom'</span><span class="p">,</span> <span class="s1">'xml'</span><span class="o">]</span> <span class="k">do</span>
  <span class="n">builder</span> <span class="ss">:feed</span>
<span class="k">end</span>
</pre>
<p>Pods definir tus propias condiciones fcilmente:</p>
<pre class="highlight ruby"><span class="n">set</span><span class="p">(</span><span class="ss">:probabilidad</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">valor</span><span class="o">|</span> <span class="n">condition</span> <span class="p">{</span> <span class="nb">rand</span> <span class="o">&lt;=</span> <span class="n">valor</span> <span class="p">}</span> <span class="p">}</span>

<span class="n">get</span> <span class="s1">'/gana_un_auto'</span><span class="p">,</span> <span class="ss">:probabilidad</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="o">.</span><span class="mi">1</span> <span class="k">do</span>
  <span class="s2">&quot;Ganaste!&quot;</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/gana_un_auto'</span> <span class="k">do</span>
  <span class="s2">&quot;Lo siento, perdiste.&quot;</span>
<span class="k">end</span>
</pre>
<p>Si tu condicin acepta ms de un argumento, pods pasarle un arreglo. Al
definir la condicin puede resultarte conveniente utilizar el operador splat en
la lista de parmetros:</p>
<pre class="highlight ruby"><span class="n">set</span><span class="p">(</span><span class="ss">:autorizar</span><span class="p">)</span> <span class="k">do</span> <span class="o">|*</span><span class="n">roles</span><span class="o">|</span>   <span class="c1"># &lt;- mir el splat</span>
  <span class="n">condition</span> <span class="k">do</span>
    <span class="k">unless</span> <span class="n">sesion_iniciada?</span> <span class="o">&amp;&amp;</span> <span class="n">roles</span><span class="nf">.any?</span> <span class="p">{</span><span class="o">|</span><span class="n">rol</span><span class="o">|</span> <span class="n">usuario_actual</span><span class="nf">.tiene_rol?</span> <span class="n">rol</span> <span class="p">}</span>
      <span class="n">redirect</span> <span class="s2">&quot;/iniciar_sesion/&quot;</span><span class="p">,</span> <span class="mi">303</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s2">&quot;/mi/cuenta/&quot;</span><span class="p">,</span> <span class="ss">:autorizar</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:usuario</span><span class="p">,</span> <span class="ss">:administrador</span><span class="o">]</span> <span class="k">do</span>
  <span class="s2">&quot;Detalles de mi cuenta&quot;</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s2">&quot;/solo/administradores/&quot;</span><span class="p">,</span> <span class="ss">:autorizar</span> <span class="o">=&gt;</span> <span class="ss">:administrador</span> <span class="k">do</span>
  <span class="s2">&quot;nicamente para administradores!&quot;</span>
<span class="k">end</span>
</pre>
<a name='Valores%20de%20Retorno'></a>
<h3>Valores de Retorno</h3>

<p>El valor de retorno de un bloque de ruta determina al menos el cuerpo de la
respuesta que se le pasa al cliente HTTP o al siguiente middleware en la pila
de Rack. Lo ms comn es que sea un string, como en los ejemplos anteriores.
Sin embargo, otros valor tambin son aceptados.</p>

<p>Pods devolver cualquier objeto que sea una respuesta Rack vlida, un objeto
que represente el cuerpo de una respuesta Rack o un cdigo de estado HTTP:</p>

<ul>
<li>Un arreglo con tres elementos: <code>[estado (Fixnum), cabeceras (Hash), cuerpo de
la respuesta (responde a #each)]</code></li>
<li>Un arreglo con dos elementos: <code>[estado (Fixnum), cuerpo de la respuesta
(responde a #each)]</code></li>
<li>Un objeto que responde a <code>#each</code> y que le pasa nicamente strings al bloque
dado</li>
<li>Un Fixnum representando el cdigo de estado</li>
</ul>

<p>De esa manera podemos, por ejemplo, implementar fcilmente un streaming:</p>
<pre class="highlight ruby"><span class="k">class</span> <span class="nc">Stream</span>
  <span class="k">def</span> <span class="nf">each</span>
    <span class="mi">100</span><span class="nf">.times</span> <span class="p">{</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span> <span class="k">yield</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">i</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)</span> <span class="p">{</span> <span class="no">Stream</span><span class="nf">.new</span> <span class="p">}</span>
</pre>
<a name='Comparadores%20de%20Rutas%20Personalizados'></a>
<h3>Comparadores de Rutas Personalizados</h3>

<p>Como se mostr anteriormente, Sinatra permite utilizar Strings y expresiones
regulares para definir las rutas. Sin embargo, la cosa no termina ah. Pods
definir tus propios comparadores muy fcilmente:</p>
<pre class="highlight ruby"><span class="k">class</span> <span class="nc">PattronCualquieraMenos</span>
  <span class="nc">Match</span> <span class="o">=</span> <span class="no">Struct</span><span class="nf">.new</span><span class="p">(</span><span class="ss">:captures</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">excepto</span><span class="p">)</span>
    <span class="vi">@excepto</span>  <span class="o">=</span> <span class="n">excepto</span>
    <span class="vi">@capturas</span> <span class="o">=</span> <span class="no">Match</span><span class="nf">.new</span><span class="p">(</span><span class="o">[]</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">match</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
    <span class="vi">@capturas</span> <span class="k">unless</span> <span class="vi">@excepto</span> <span class="o">===</span> <span class="n">str</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">cualquiera_menos</span><span class="p">(</span><span class="n">patron</span><span class="p">)</span>
  <span class="no">PatronCualquieraMenos</span><span class="nf">.new</span><span class="p">(</span><span class="n">patron</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">get</span> <span class="n">cualquiera_menos</span><span class="p">(</span><span class="s2">&quot;/index&quot;</span><span class="p">)</span> <span class="k">do</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</pre>
<p>Ten en cuenta que el ejemplo anterior es un poco rebuscado. Un resultado
similar puede conseguirse ms sencillamente:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="sr">//</span> <span class="k">do</span>
  <span class="n">pass</span> <span class="k">if</span> <span class="n">request</span><span class="nf">.path_info</span> <span class="o">==</span> <span class="s2">&quot;/index&quot;</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</pre>
<p>O, usando un lookahead negativo:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="sr">%r{^(?!/index$)}</span> <span class="k">do</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</pre>
<a name='Archivos%20Estticos'></a>
<h3>Archivos Estticos</h3>

<p>Los archivos estticos son servidos desde el directorio pblico
<code>./public</code>. Pods especificar una ubicacin diferente ajustando la
opcin <code>:public_folder</code>:</p>
<pre class="highlight ruby"><span class="n">set</span> <span class="ss">:public_folder</span><span class="p">,</span> <span class="no">File</span><span class="nf">.dirname</span><span class="p">(</span><span class="kp">__FILE__</span><span class="p">)</span> <span class="o">+</span> <span class="s1">'/estaticos'</span>
</pre>
<p>Not que el nombre del directorio pblico no est incluido en la URL. Por
ejemplo, el archivo <code>./public/css/style.css</code> se accede a travs de
<code>http://ejemplo.com/css/style.css</code>.</p>

<p>Us la configuracin <code>:static_cache_control</code> para agregar el encabezado
<code>Cache-Control</code> (ver la seccin de configuracin para ms detalles).</p>

<a name='Vistas%20/%20Plantillas'></a>
<h3>Vistas / Plantillas</h3>

<p>Cada lenguaje de plantilla se expone a travs de un mtodo de renderizado que
lleva su nombre. Estos mtodos simplemente devuelven un string:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">erb</span> <span class="ss">:index</span>
<span class="k">end</span>
</pre>
<p>Renderiza <code>views/index.erb</code>.</p>

<p>En lugar del nombre de la plantilla pods proporcionar directamente el
contenido de la misma:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">codigo</span> <span class="o">=</span> <span class="s2">&quot;&lt;%= Time.now %&gt;&quot;</span>
  <span class="n">erb</span> <span class="n">codigo</span>
<span class="k">end</span>
</pre>
<p>Los mtodos de renderizado, aceptan adems un segundo argumento, el hash de
opciones:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">erb</span> <span class="ss">:index</span><span class="p">,</span> <span class="ss">:layout</span> <span class="o">=&gt;</span> <span class="ss">:post</span>
<span class="k">end</span>
</pre>
<p>Renderiza <code>views/index.erb</code> embebido en <code>views/post.erb</code> (por
defecto, la plantilla <code>:index</code> es embebida en <code>views/layout.erb</code> siempre y
cuando este ltimo archivo exista).</p>

<p>Cualquier opcin que Sinatra no entienda le ser pasada al motor de renderizado
de la plantilla:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">haml</span> <span class="ss">:index</span><span class="p">,</span> <span class="ss">:format</span> <span class="o">=&gt;</span> <span class="ss">:html5</span>
<span class="k">end</span>
</pre>
<p>Adems pods definir las opciones para un lenguaje de plantillas de forma
general:</p>
<pre class="highlight ruby"><span class="n">set</span> <span class="ss">:haml</span><span class="p">,</span> <span class="ss">:format</span> <span class="o">=&gt;</span> <span class="ss">:html5</span>

<span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">haml</span> <span class="ss">:index</span>
<span class="k">end</span>
</pre>
<p>Las opciones pasadas al mtodo de renderizado tienen precedencia sobre las
definidas mediante <code>set</code>.</p>

<p>Opciones disponibles:</p>

<dl>

  <dt>locals</dt>
  <dd>
    Lista de variables locales pasadas al documento. Resultan muy tiles cuando
    se combinan con parciales.
    Ejemplo: <tt>erb "<%= foo %>", :locals => {:foo => "bar"}</tt>
  </dd>

  <dt>default_encoding</dt>
  <dd>
    Encoding utilizado cuando el de un string es dudoso. Por defecto toma el
    valor de <tt>settings.default_encoding</tt>.
  </dd>

  <dt>views</dt>
  <dd>
    Directorio desde donde se cargan las vistas. Por defecto toma el valor de
    <tt>settings.views</tt>.
  </dd>

  <dt>layout</dt>
  <dd>
    Si es <tt>true</tt> o <tt>false</tt> indica que se debe usar, o n, un layout,
    respectivamente. Tambin puede ser un smbolo que especifique qu plantilla
    usar. Ejemplo: <tt>erb :index, :layout => !request.xhr?</tt>
  </dd>

  <dt>content_type</dt>
  <dd>
    Content-Type que produce la plantilla. El valor por defecto depende de cada
    lenguaje de plantillas.
  </dd>

  <dt>scope</dt>
  <dd>
    mbito en el que se renderiza la plantilla. Por defecto utiliza la instancia
    de la aplicacin. Ten en cuenta que si cambis esta opcin las variables de
    instancia y los helpers van a dejar de estar disponibles.
  </dd>

  <dt>layout_engine</dt>
  <dd>
    Motor de renderizado de plantillas que usa para el layout. Resulta
    conveniente para lenguajes que no soportan layouts. Por defecto toma el valor
    del motor usado para renderizar la plantilla.
    Ejemplo: <tt>set :rdoc, :layout_engine => :erb</tt>
  </dd>

  <dd>
    Se asume que las plantillas estn ubicadas directamente bajo el directorio
    <tt>./views</tt>. Para usar un directorio de vistas diferente:
    <tt>set :views, settings.root + '/plantillas'</tt>
  </dd>

  <dd>
    Es importante acordarse que siempre tens que referenciar a las plantillas con
    smbolos, incluso cuando se encuentran en un subdirectorio (en este caso
    tens que usar: <tt>'subdir/plantilla'</tt>). Tens que usar un smbolo porque los
    mtodos de renderizacin van a renderizar directamente cualquier string que se
    les pase como argumento.
  </dd>
</dl>

<a name='Lenguajes%20de%20Plantillas%20Disponibles'></a>
<h3>Lenguajes de Plantillas Disponibles</h3>

<p>Algunos lenguajes tienen varias implementaciones. Para especificar que
implementacin usar (y para ser thread-safe), deberas requerirla antes de
usarla:</p>
<pre class="highlight ruby"><span class="nb">require</span> <span class="s1">'rdiscount'</span> <span class="c1"># o require 'bluecloth'</span>
<span class="n">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)</span> <span class="p">{</span> <span class="n">markdown</span> <span class="ss">:index</span> <span class="p">}</span>
</pre>
<a name='Plantillas%20Haml'></a>
<h3>Plantillas Haml</h3>

<table>
  <tr>
    <td>Dependencias</td>
    <td><a href="http://haml.info/" title="haml">haml</a></td>
  </tr>
  <tr>
    <td>Expresiones de Archivo</td>
    <td><tt>.haml</tt></td>
  </tr>
  <tr>
    <td>Ejemplo</td>
    <td><tt>haml :index, :format => :html5</tt></td>
  </tr>
</table>

<a name='Plantillas%20Erb'></a>
<h3>Plantillas Erb</h3>

<table>
  <tr>
    <td>Dependencias</td>
    <td>
      <a href="http://www.kuwata-lab.com/erubis/" title="erubis">erubis</a>
      o erb (incluida en Ruby)
    </td>
  </tr>
  <tr>
    <td>Extensiones de Archivo</td>
    <td><tt>.erb</tt>, <tt>.rhtml</tt> o <tt>.erubis</tt> (solamente con Erubis)</td>
  </tr>
  <tr>
    <td>Ejemplo</td>
    <td><tt>erb :index</tt></td>
  </tr>
</table>

<a name='Plantillas%20Builder'></a>
<h3>Plantillas Builder</h3>

<table>
  <tr>
    <td>Dependencias</td>
    <td>
      <a href="http://builder.rubyforge.org/" title="builder">builder</a>
    </td>
  </tr>
  <tr>
    <td>Extensiones de Archivo</td>
    <td><tt>.builder</tt></td>
  </tr>
  <tr>
    <td>Ejemplo</td>
    <td><tt>builder { |xml| xml.em "hola" }</tt></td>
  </tr>
</table>

<p>Adems, acepta un bloque con la definicin de la plantilla (ver el ejemplo).</p>

<a name='Plantillas%20Nokogiri'></a>
<h3>Plantillas Nokogiri</h3>

<table>
  <tr>
    <td>Dependencias</td>
    <td><a href="http://nokogiri.org/" title="nokogiri">nokogiri</a></td>
  </tr>
  <tr>
    <td>Extensiones de Archivo</td>
    <td><tt>.nokogiri</tt></td>
  </tr>
  <tr>
    <td>Ejemplo</td>
    <td><tt>nokogiri { |xml| xml.em "hola" }</tt></td>
  </tr>
</table>

<p>Adems, acepta un bloque con la definicin de la plantilla (ver el ejemplo).</p>

<a name='Plantillas%20Sass'></a>
<h3>Plantillas Sass</h3>

<table>
  <tr>
    <td>Dependencias</td>
    <td><a href="http://sass-lang.com/" title="sass">sass</a></td>
  </tr>
  <tr>
    <td>Extensiones de Archivo</td>
    <td><tt>.sass</tt></td>
  </tr>
  <tr>
    <td>Ejemplo</td>
    <td><tt>sass :stylesheet, :style => :expanded</tt></td>
  </tr>
</table>

<a name='Plantillas%20SCSS'></a>
<h3>Plantillas SCSS</h3>

<table>
  <tr>
    <td>Dependencias</td>
    <td><a href="http://sass-lang.com/" title="sass">sass</a></td>
  </tr>
  <tr>
    <td>Extensiones de Archivo</td>
    <td><tt>.scss</tt></td>
  </tr>
  <tr>
    <td>Ejemplo</td>
    <td><tt>scss :stylesheet, :style => :expanded</tt></td>
  </tr>
</table>

<a name='Plantillas%20Less'></a>
<h3>Plantillas Less</h3>

<table>
  <tr>
    <td>Dependencias</td>
    <td><a href="http://www.lesscss.org/" title="less">less</a></td>
  </tr>
  <tr>
    <td>Extensiones de Archivo</td>
    <td><tt>.less</tt></td>
  </tr>
  <tr>
    <td>Ejemplo</td>
    <td><tt>less :stylesheet</tt></td>
  </tr>
</table>

<a name='Plantillas%20Liquid'></a>
<h3>Plantillas Liquid</h3>

<table>
  <tr>
    <td>Dependencias</td>
    <td><a href="http://www.liquidmarkup.org/" title="liquid">liquid</a></td>
  </tr>
  <tr>
    <td>Extensiones de Archivo</td>
    <td><tt>.liquid</tt></td>
  </tr>
  <tr>
    <td>Ejemplo</td>
    <td><tt>liquid :index, :locals => { :clave => 'valor' }</tt></td>
  </tr>
</table>

<p>Como no vas a poder llamar a mtodos de Ruby (excepto por <code>yield</code>) desde una
plantilla Liquid, casi siempre vas a querer pasarle locales.</p>

<a name='Plantillas%20Markdown'></a>
<h3>Plantillas Markdown</h3>

<table>
  <tr>
    <td>Dependencias</td>
    <td>
      <a href="https://github.com/rtomayko/rdiscount" title="RDiscount">RDiscount</a>,
      <a href="https://github.com/vmg/redcarpet" title="RedCarpet">RedCarpet</a>,
      <a href="http://deveiate.org/projects/BlueCloth" title="BlueCloth">BlueCloth</a>,
      <a href="http://kramdown.rubyforge.org/" title="kramdown">kramdown</a> o
      <a href="http://maruku.rubyforge.org/" title="maruku">maruku</a>
    </td>
  </tr>
  <tr>
    <td>Extensiones de Archivo</td>
    <td><tt>.markdown</tt>, <tt>.mkd</tt> y <tt>.md</tt></td>
  </tr>
  <tr>
    <td>Ejemplo</td>
    <td><tt>markdown :index, :layout_engine => :erb</tt></td>
  </tr>
</table>

<p>No es posible llamar mtodos desde markdown, ni pasarle locales. Por lo tanto,
generalmente vas a usarlo en combinacin con otro motor de renderizado:</p>
<pre class="highlight ruby"><span class="n">erb</span> <span class="ss">:resumen</span><span class="p">,</span> <span class="ss">:locals</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:texto</span> <span class="o">=&gt;</span> <span class="n">markdown</span><span class="p">(</span><span class="ss">:introduccion</span><span class="p">)</span> <span class="p">}</span>
</pre>
<p>Ten en cuenta que tambin pods llamar al mtodo <code>markdown</code> desde otras
plantillas:</p>
<pre class="highlight ruby"><span class="o">%</span><span class="n">h1</span> <span class="no">Hola</span> <span class="no">Desde</span> <span class="no">Haml</span><span class="o">!</span>
<span class="o">%</span><span class="nb">p</span><span class="o">=</span> <span class="n">markdown</span><span class="p">(</span><span class="ss">:saludos</span><span class="p">)</span>
</pre>
<p>Como no pods utilizar Ruby desde Markdown, no pods usar layouts escritos en
Markdown. De todos modos, es posible usar un motor de renderizado para el
layout distinto al de la plantilla pasando la opcin <code>:layout_engine</code>.</p>

<a name='Plantillas%20Textile'></a>
<h3>Plantillas Textile</h3>

<table>
  <tr>
    <td>Dependencias</td>
    <td><a href="http://redcloth.org/" title="RedCloth">RedCloth</a></td>
  </tr>
  <tr>
    <td>Extensiones de Archivo</td>
    <td><tt>.textile</tt></td>
  </tr>
  <tr>
    <td>Ejemplo</td>
    <td><tt>textile :index, :layout_engine => :erb</tt></td>
  </tr>
</table>

<p>No es posible llamar mtodos desde textile, ni pasarle locales. Por lo tanto,
generalmente vas a usarlo en combinacin con otro motor de renderizado:</p>
<pre class="highlight ruby"><span class="n">erb</span> <span class="ss">:resumen</span><span class="p">,</span> <span class="ss">:locals</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:texto</span> <span class="o">=&gt;</span> <span class="n">textile</span><span class="p">(</span><span class="ss">:introduccion</span><span class="p">)</span> <span class="p">}</span>
</pre>
<p>Ten en cuenta que tambin pods llamar al mtodo <code>textile</code> desde otras
plantillas:</p>
<pre class="highlight ruby"><span class="o">%</span><span class="n">h1</span> <span class="no">Hola</span> <span class="no">Desde</span> <span class="no">Haml</span><span class="o">!</span>
<span class="o">%</span><span class="nb">p</span><span class="o">=</span> <span class="n">textile</span><span class="p">(</span><span class="ss">:saludos</span><span class="p">)</span>
</pre>
<p>Como no pods utilizar Ruby desde Textile, no pods usar layouts escritos en
Textile. De todos modos, es posible usar un motor de renderizado para el
layout distinto al de la plantilla pasando la opcin <code>:layout_engine</code>.</p>

<a name='Plantillas%20RDoc'></a>
<h3>Plantillas RDoc</h3>

<table>
  <tr>
    <td>Dependencias</td>
    <td><a href="http://rdoc.rubyforge.org/" title="RDoc">RDoc</a></td>
  </tr>
  <tr>
    <td>Extensiones de Archivo</td>
    <td><tt>.rdoc</tt></td>
  </tr>
  <tr>
    <td>Ejemplo</td>
    <td><tt>rdoc :README, :layout_engine => :erb</tt></td>
  </tr>
</table>

<p>No es posible llamar mtodos desde rdoc, ni pasarle locales. Por lo tanto,
generalmente vas a usarlo en combinacin con otro motor de renderizado:</p>
<pre class="highlight ruby"><span class="n">erb</span> <span class="ss">:resumen</span><span class="p">,</span> <span class="ss">:locals</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:texto</span> <span class="o">=&gt;</span> <span class="n">rdoc</span><span class="p">(</span><span class="ss">:introduccion</span><span class="p">)</span> <span class="p">}</span>
</pre>
<p>Ten en cuenta que tambin pods llamar al mtodo <code>rdoc</code> desde otras
plantillas:</p>
<pre class="highlight ruby"><span class="o">%</span><span class="n">h1</span> <span class="no">Hola</span> <span class="no">Desde</span> <span class="no">Haml</span><span class="o">!</span>
<span class="o">%</span><span class="nb">p</span><span class="o">=</span> <span class="n">rdoc</span><span class="p">(</span><span class="ss">:saludos</span><span class="p">)</span>
</pre>
<p>Como no pods utilizar Ruby desde RDoc, no pods usar layouts escritos en RDoc.
De todos modos, es posible usar un motor de renderizado para el layout distinto
al de la plantilla pasando la opcin <code>:layout_engine</code>.</p>

<a name='Plantillas%20Radius'></a>
<h3>Plantillas Radius</h3>

<table>
  <tr>
    <td>Dependencias</td>
    <td><a href="http://radius.rubyforge.org/" title="Radius">Radius</a></td>
  </tr>
  <tr>
    <td>Extensiones de Archivo</td>
    <td><tt>.radius</tt></td>
  </tr>
  <tr>
    <td>Ejemplo</td>
    <td><tt>radius :index, :locals => { :clave => 'valor' }</tt></td>
  </tr>
</table>

<p>Como no vas a poder llamar a mtodos de Ruby (excepto por <code>yield</code>) desde una
plantilla Radius, casi siempre vas a querer pasarle locales.</p>

<a name='Plantillas%20Markaby'></a>
<h3>Plantillas Markaby</h3>

<table>
  <tr>
    <td>Dependencias</td>
    <td><a href="http://markaby.github.com/" title="Markaby">Markaby</a></td>
  </tr>
  <tr>
    <td>Extensiones de Archivo</td>
    <td><tt>.mab</tt></td>
  </tr>
  <tr>
    <td>Ejemplo</td>
    <td><tt>markaby { h1 "Bienvenido!" }</tt></td>
  </tr>
</table>

<p>Adems, acepta un bloque con la definicin de la plantilla (ver el ejemplo).</p>

<a name='Plantillas%20RABL'></a>
<h3>Plantillas RABL</h3>

<table>
  <tr>
    <td>Dependencias</td>
    <td><a href="https://github.com/nesquena/rabl" title="Rabl">Rabl</a></td>
  </tr>
  <tr>
    <td>Extensiones de Archivo</td>
    <td><tt>.rabl</tt></td>
  </tr>
  <tr>
    <td>Ejemplo</td>
    <td><tt>rabl :index</tt></td>
  </tr>
</table>

<a name='Plantillas%20Slim'></a>
<h3>Plantillas Slim</h3>

<table>
  <tr>
    <td>Dependencias</td>
    <td><a href="http://slim-lang.com/" title="Slim Lang">Slim Lang</a></td>
  </tr>
  <tr>
    <td>Extensiones de Archivo</td>
    <td><tt>.slim</tt></td>
  </tr>
  <tr>
    <td>Ejemplo</td>
    <td><tt>slim :index</tt></td>
  </tr>
</table>

<a name='Plantillas%20Creole'></a>
<h3>Plantillas Creole</h3>

<table>
  <tr>
    <td>Dependencias</td>
    <td><a href="https://github.com/minad/creole" title="Creole">Creole</a></td>
  </tr>
  <tr>
    <td>Extensiones de Archivo</td>
    <td><tt>.creole</tt></td>
  </tr>
  <tr>
    <td>Ejemplo</td>
    <td><tt>creole :wiki, :layout_engine => :erb</tt></td>
  </tr>
</table>

<p>No es posible llamar mtodos desde creole, ni pasarle locales. Por lo tanto,
generalmente vas a usarlo en combinacin con otro motor de renderizado:</p>
<pre class="highlight ruby"><span class="n">erb</span> <span class="ss">:resumen</span><span class="p">,</span> <span class="ss">:locals</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:texto</span> <span class="o">=&gt;</span> <span class="n">cerole</span><span class="p">(</span><span class="ss">:introduccion</span><span class="p">)</span> <span class="p">}</span>
</pre>
<p>Ten en cuenta que tambin pods llamar al mtodo <code>creole</code> desde otras
plantillas:</p>
<pre class="highlight ruby"><span class="o">%</span><span class="n">h1</span> <span class="no">Hola</span> <span class="no">Desde</span> <span class="no">Haml</span><span class="o">!</span>
<span class="o">%</span><span class="nb">p</span><span class="o">=</span> <span class="n">creole</span><span class="p">(</span><span class="ss">:saludos</span><span class="p">)</span>
</pre>
<p>Como no pods utilizar Ruby desde Creole, no pods usar layouts escritos en
Creloe. De todos modos, es posible usar un motor de renderizado para el layout
distinto al de la plantilla pasando la opcin <code>:layout_engine</code>.</p>

<a name='Plantillas%20CoffeeScript'></a>
<h3>Plantillas CoffeeScript</h3>

<table>
  <tr>
    <td>Dependencias</td>
    <td>
      <a href="https://github.com/josh/ruby-coffee-script" title="Ruby CoffeeScript">
        CoffeeScript
      </a> y un
      <a href="https://github.com/sstephenson/execjs/blob/master/README.md#readme" title="ExecJS">
        mecanismo para ejecutar javascript
      </a>
    </td>
  </tr>
  <tr>
    <td>Extensiones de Archivo</td>
    <td><tt>.coffee</tt></td>
  </tr>
  <tr>
    <td>Ejemplo</td>
    <td><tt>coffee :index</tt></td>
  </tr>
</table>

<a name='Plantillas%20Stylus'></a>
<h3>Plantillas Stylus</h3>

<table>
  <tr>
    <td>Dependencias</td>
    <td>
      <a href="https://github.com/lucasmazza/ruby-stylus" title="Ruby Stylus">
        Stylus
      </a> y un
      <a href="https://github.com/sstephenson/execjs/blob/master/README.md#readme" title="ExecJS">
        mecanismo para ejecutar javascript
      </a>
    </td>
  </tr>
  <tr>
    <td>Extensiones de Archivo</td>
    <td><tt>.styl</tt></td>
  </tr>
  <tr>
    <td>Ejemplo</td>
    <td><tt>stylus :index</tt></td>
  </tr>
</table>

<a name='Plantillas%20Yajl'></a>
<h3>Plantillas Yajl</h3>

<table>
  <tr>
    <td>Dependencias</td>
    <td><a href="https://github.com/brianmario/yajl-ruby" title="yajl-ruby">yajl-ruby</a></td>
  </tr>
  <tr>
    <td>Extensiones de Archivo</td>
    <td><tt>.yajl</tt></td>
  </tr>
  <tr>
    <td>Ejemplo</td>
    <td>
      <tt>
        yajl :index,
             :locals => { :key => 'qux' },
             :callback => 'present',
             :variable => 'resource'
      </tt>
    </td>
  </tr>
</table>

<p>El contenido de La plantilla se evala como cdigo Ruby, y la variable <code>json</code> es convertida a JSON mediante <code>#to_json</code>.</p>
<pre class="highlight ruby"><span class="n">json</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">:foo</span> <span class="o">=&gt;</span> <span class="s1">'bar'</span> <span class="p">}</span>
<span class="n">json</span><span class="o">[</span><span class="ss">:baz</span><span class="o">]</span> <span class="o">=</span> <span class="n">key</span>
</pre>
<p>Las opciones <code>:callback</code> y <code>:variable</code> se pueden utilizar para decorar el objeto renderizado:</p>
<pre class="highlight ruby"><span class="n">var</span> <span class="n">resource</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;foo&quot;</span><span class="ss">:&quot;bar&quot;</span><span class="p">,</span><span class="s2">&quot;baz&quot;</span><span class="ss">:&quot;qux&quot;</span><span class="p">};</span> <span class="n">present</span><span class="p">(</span><span class="n">resource</span><span class="p">);</span>
</pre>
<a name='Plantillas%20WLang'></a>
<h3>Plantillas WLang</h3>

<table>
  <tr>
    <td>Dependencias</td>
    <td><a href="https://github.com/blambeau/wlang/" title="wlang">wlang</a></td>
  </tr>
  <tr>
    <td>Extensiones de Archivo</td>
    <td><tt>.wlang</tt></td>
  </tr>
  <tr>
    <td>Ejemplo</td>
    <td><tt>wlang :index, :locals => { :clave => 'valor' }</tt></td>
  </tr>
</table>

<p>Como no vas a poder llamar a mtodos de Ruby (excepto por <code>yield</code>) desde una
plantilla WLang, casi siempre vas a querer pasarle locales.</p>

<a name='Plantillas%20Embebidas'></a>
<h3>Plantillas Embebidas</h3>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">haml</span> <span class="s1">'%div.titulo Hola Mundo'</span>
<span class="k">end</span>
</pre>
<p>Renderiza el template embebido en el string.</p>

<a name='Accediendo%20a%20Variables%20en%20Plantillas'></a>
<h3>Accediendo a Variables en Plantillas</h3>

<p>Las plantillas son evaluadas dentro del mismo contexto que los manejadores de
ruta. Las variables de instancia asignadas en los manejadores de ruta son
accesibles directamente por las plantillas:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/:id'</span> <span class="k">do</span>
  <span class="vi">@foo</span> <span class="o">=</span> <span class="no">Foo</span><span class="nf">.find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
  <span class="n">haml</span> <span class="s1">'%h1= @foo.nombre'</span>
<span class="k">end</span>
</pre>
<p>O es posible especificar un Hash de variables locales explcitamente:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/:id'</span> <span class="k">do</span>
  <span class="n">foo</span> <span class="o">=</span> <span class="no">Foo</span><span class="nf">.find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
  <span class="n">haml</span> <span class="s1">'%h1= bar.nombre'</span><span class="p">,</span> <span class="ss">:locals</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:bar</span> <span class="o">=&gt;</span> <span class="n">foo</span> <span class="p">}</span>
<span class="k">end</span>
</pre>
<p>Esto es usado tpicamente cuando se renderizan plantillas como parciales desde
adentro de otras plantillas.</p>

<a name='Plantillas%20Inline'></a>
<h3>Plantillas Inline</h3>

<p>Las plantillas pueden ser definidas al final del archivo fuente:</p>
<pre class="highlight ruby"><span class="nb">require</span> <span class="s1">'rubygems'</span>
<span class="nb">require</span> <span class="s1">'sinatra'</span>

<span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">haml</span> <span class="ss">:index</span>
<span class="k">end</span>

<span class="cp">__END__

@@ layout
%html
  = yield

@@ index
%div.titulo Hola mundo!!!!!
</span></pre>
<p>NOTA: nicamente las plantillas inline definidas en el archivo fuente que
requiere sinatra son cargadas automticamente. Llam <code>enable
:inline_templates</code> explcitamente si tens plantillas inline en otros
archivos fuente.</p>

<a name='Plantillas%20Nombradas'></a>
<h3>Plantillas Nombradas</h3>

<p>Las plantillas tambin pueden ser definidas usando el mtodo top-level
<code>template</code>:</p>
<pre class="highlight ruby"><span class="n">template</span> <span class="ss">:layout</span> <span class="k">do</span>
  <span class="s2">&quot;%html</span><span class="se">\n</span><span class="s2">  =yield</span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="k">end</span>

<span class="n">template</span> <span class="ss">:index</span> <span class="k">do</span>
  <span class="s1">'%div.titulo Hola Mundo!'</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">haml</span> <span class="ss">:index</span>
<span class="k">end</span>
</pre>
<p>Si existe una plantilla con el nombre &quot;layout&quot;, va a ser usada cada vez que
una plantilla es renderizada. Pods desactivar los layouts individualmente
pasando <code>:layout =&gt; false</code> o globalmente con
<code>set :haml, :layout =&gt; false</code>:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">haml</span> <span class="ss">:index</span><span class="p">,</span> <span class="ss">:layout</span> <span class="o">=&gt;</span> <span class="o">!</span><span class="n">request</span><span class="nf">.xhr?</span>
<span class="k">end</span>
</pre>
<a name='Asociando%20Extensiones%20de%20Archivo'></a>
<h3>Asociando Extensiones de Archivo</h3>

<p>Para asociar una extensin de archivo con un motor de renderizado, us
<code>Tilt.register</code>. Por ejemplo, si quers usar la extensin <code>tt</code> para
las plantillas Textile, pods hacer lo siguiente:</p>
<pre class="highlight ruby"><span class="no">Tilt</span><span class="nf">.register</span> <span class="ss">:tt</span><span class="p">,</span> <span class="no">Tilt</span><span class="o">[</span><span class="ss">:textile</span><span class="o">]</span>
</pre>
<a name='Agregando%20Tu%20Propio%20Motor%20de%20Renderizado'></a>
<h3>Agregando Tu Propio Motor de Renderizado</h3>

<p>Primero, registr tu motor con Tilt, y despus, cre tu mtodo de renderizado:</p>
<pre class="highlight ruby"><span class="no">Tilt</span><span class="nf">.register</span> <span class="ss">:mipg</span><span class="p">,</span> <span class="no">MiMotorParaPlantillaGenial</span>

<span class="n">helpers</span> <span class="k">do</span>
  <span class="k">def</span> <span class="nf">mypg</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span> <span class="n">render</span><span class="p">(</span><span class="ss">:mypg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span> <span class="k">end</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">mypg</span> <span class="ss">:index</span>
<span class="k">end</span>
</pre>
<p>Renderiza <code>./views/index.mypg</code>. Mir https://github.com/rtomayko/tilt
para aprender ms de Tilt.</p>

<a name='Filtros'></a>
<h2>Filtros</h2>

<p>Los filtros <code>before</code> son evaluados antes de cada peticin dentro del mismo
contexto que las rutas. Pueden modificar la peticin y la respuesta. Las
variables de instancia asignadas en los filtros son accesibles por las rutas y
las plantillas:</p>
<pre class="highlight ruby"><span class="n">before</span> <span class="k">do</span>
  <span class="vi">@nota</span> <span class="o">=</span> <span class="s1">'Hey!'</span>
  <span class="n">request</span><span class="nf">.path_info</span> <span class="o">=</span> <span class="s1">'/foo/bar/baz'</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/foo/*'</span> <span class="k">do</span>
  <span class="vi">@nota</span> <span class="c1">#=&gt; 'Hey!'</span>
  <span class="n">params</span><span class="o">[</span><span class="ss">:splat</span><span class="o">]</span> <span class="c1">#=&gt; 'bar/baz'</span>
<span class="k">end</span>
</pre>
<p>Los filtros <code>after</code> son evaluados despus de cada peticin dentro del mismo
contexto y tambin pueden modificar la peticin y la respuesta. Las variables
de instancia asignadas en los filtros <code>before</code> y en las rutas son accesibles por
los filtros <code>after</code>:</p>
<pre class="highlight ruby"><span class="n">after</span> <span class="k">do</span>
  <span class="nb">puts</span> <span class="n">response</span><span class="nf">.status</span>
<span class="k">end</span>
</pre>
<p>Nota: A menos que uss el mtodo <code>body</code> en lugar de simplemente devolver un
string desde una ruta, el cuerpo de la respuesta no va a estar disponible en
un filtro after, debido a que todava no se ha generado.</p>

<p>Los filtros aceptan un patrn opcional, que cuando est presente causa que los
mismos sean evaluados nicamente si el path de la peticin coincide con ese
patrn:</p>
<pre class="highlight ruby"><span class="n">before</span> <span class="s1">'/protegido/*'</span> <span class="k">do</span>
  <span class="n">autenticar!</span>
<span class="k">end</span>

<span class="n">after</span> <span class="s1">'/crear/:slug'</span> <span class="k">do</span> <span class="o">|</span><span class="n">slug</span><span class="o">|</span>
  <span class="n">session</span><span class="o">[</span><span class="ss">:ultimo_slug</span><span class="o">]</span> <span class="o">=</span> <span class="n">slug</span>
<span class="k">end</span>
</pre>
<p>Al igual que las rutas, los filtros tambin pueden aceptar condiciones:</p>
<pre class="highlight ruby"><span class="n">before</span> <span class="ss">:agent</span> <span class="o">=&gt;</span> <span class="sr">/Songbird/</span> <span class="k">do</span>
  <span class="c1"># ...</span>
<span class="k">end</span>

<span class="n">after</span> <span class="s1">'/blog/*'</span><span class="p">,</span> <span class="ss">:host_name</span> <span class="o">=&gt;</span> <span class="s1">'ejemplo.com'</span> <span class="k">do</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</pre>
<a name='Ayudantes'></a>
<h2>Ayudantes</h2>

<p>Us el mtodo top-level <em>helpers</em> para definir mtodos ayudantes que
pueden ser utilizados dentro de los manejadores de rutas y las plantillas:</p>
<pre class="highlight ruby"><span class="n">helpers</span> <span class="k">do</span>
  <span class="k">def</span> <span class="nf">bar</span><span class="p">(</span><span class="n">nombre</span><span class="p">)</span>
    <span class="s2">&quot;</span><span class="si">#{</span><span class="n">nombre</span><span class="si">}</span><span class="s2">bar&quot;</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/:nombre'</span> <span class="k">do</span>
  <span class="n">bar</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:nombre</span><span class="o">]</span><span class="p">)</span>
<span class="k">end</span>
</pre>
<p>Por cuestiones organizativas, puede resultar conveniente organizar los mtodos
ayudantes en distintos mdulos:</p>
<pre class="highlight ruby"><span class="k">module</span> <span class="nn">FooUtils</span>
  <span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">nombre</span><span class="p">)</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">nombre</span><span class="si">}</span><span class="s2">foo&quot;</span> <span class="k">end</span>
<span class="k">end</span>

<span class="k">module</span> <span class="nn">BarUtils</span>
  <span class="k">def</span> <span class="nf">bar</span><span class="p">(</span><span class="n">nombre</span><span class="p">)</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">nombre</span><span class="si">}</span><span class="s2">bar&quot;</span> <span class="k">end</span>
<span class="k">end</span>

<span class="n">helpers</span> <span class="no">FooUtils</span><span class="p">,</span> <span class="no">BarUtils</span>
</pre>
<p>El efecto de utilizar <em>helpers</em> de esta manera es el mismo que resulta de
incluir los mdulos en la clase de la aplicacin.</p>

<a name='Usando%20Sesiones'></a>
<h3>Usando Sesiones</h3>

<p>Una sesin es usada para mantener el estado a travs de distintas peticiones.
Cuando estn activadas, tens un hash de sesin para cada sesin de usuario:</p>
<pre class="highlight ruby"><span class="n">enable</span> <span class="ss">:sessions</span>

<span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="s2">&quot;valor = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">session</span><span class="o">[</span><span class="ss">:valor</span><span class="o">]</span><span class="nf">.inspect</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/:valor'</span> <span class="k">do</span>
  <span class="n">session</span><span class="o">[</span><span class="ss">:valor</span><span class="o">]</span> <span class="o">=</span> <span class="n">params</span><span class="o">[</span><span class="ss">:valor</span><span class="o">]</span>
<span class="k">end</span>
</pre>
<p>Ten en cuenta que <code>enable :sessions</code> guarda todos los datos en una
cookie, lo que no es siempre deseable (guardar muchos datos va a incrementar
tu trfico, por citar un ejemplo). Pods usar cualquier middleware Rack para
manejar sesiones, de la misma manera que usaras cualquier otro middleware,
pero con la salvedad de que <em>no</em> tens que llamar a <code>enable :sessions</code>:</p>
<pre class="highlight ruby"><span class="n">use</span> <span class="no">Rack</span><span class="o">::</span><span class="no">Session</span><span class="o">::</span><span class="no">Pool</span><span class="p">,</span> <span class="ss">:expire_after</span> <span class="o">=&gt;</span> <span class="mi">2592000</span>

<span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="s2">&quot;valor = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">session</span><span class="o">[</span><span class="ss">:valor</span><span class="o">]</span><span class="nf">.inspect</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/:valor'</span> <span class="k">do</span>
  <span class="n">session</span><span class="o">[</span><span class="ss">:valor</span><span class="o">]</span> <span class="o">=</span> <span class="n">params</span><span class="o">[</span><span class="ss">:valor</span><span class="o">]</span>
<span class="k">end</span>
</pre>
<p>Para incrementar la seguridad, los datos de la sesin almacenados en
la cookie son firmados con un secreto de sesin. Este secreto, es
generado aleatoriamente por Sinatra. De cualquier manera, hay que
tener en cuenta que cada vez que inicies la aplicacin se va a generar
uno nuevo. As, si quers que todas las instancias de tu aplicacin
compartan un nico secreto, tens que definirlo vos:</p>
<pre class="highlight ruby"><span class="n">set</span> <span class="ss">:session_secret</span><span class="p">,</span> <span class="s1">'super secreto'</span>
</pre>
<p>Si necesits una configuracin ms especfica, <code>sessions</code> acepta un
Hash con opciones:</p>
<pre class="highlight ruby"><span class="n">set</span> <span class="ss">:sessions</span><span class="p">,</span> <span class="ss">:domain</span> <span class="o">=&gt;</span> <span class="s1">'foo.com'</span>
</pre>
<a name='Interrupcin'></a>
<h3>Interrupcin</h3>

<p>Para detener inmediatamente una peticin dentro de un filtro o una ruta us:</p>
<pre class="highlight ruby"><span class="n">halt</span>
</pre>
<p>Tambin pods especificar el estado:</p>
<pre class="highlight ruby"><span class="n">halt</span> <span class="mi">410</span>
</pre>
<p>O el cuerpo:</p>
<pre class="highlight ruby"><span class="n">halt</span> <span class="s1">'esto va a ser el cuerpo'</span>
</pre>
<p>O los dos:</p>
<pre class="highlight ruby"><span class="n">halt</span> <span class="mi">401</span><span class="p">,</span> <span class="s1">'sal de ac!'</span>
</pre>
<p>Con cabeceras:</p>
<pre class="highlight ruby"><span class="n">halt</span> <span class="mi">402</span><span class="p">,</span> <span class="p">{</span> <span class="s1">'Content-Type'</span> <span class="o">=&gt;</span> <span class="s1">'text/plain'</span> <span class="p">},</span> <span class="s1">'venganza'</span>
</pre>
<p>Obviamente, es posible utilizar <code>halt</code> con una plantilla:</p>
<pre class="highlight ruby"><span class="n">halt</span> <span class="n">erb</span><span class="p">(</span><span class="ss">:error</span><span class="p">)</span>
</pre>
<a name='Paso'></a>
<h3>Paso</h3>

<p>Una ruta puede pasarle el procesamiento a la siguiente ruta que coincida con
la peticin usando <code>pass</code>:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/adivina/:quien'</span> <span class="k">do</span>
  <span class="n">pass</span> <span class="k">unless</span> <span class="n">params</span><span class="o">[</span><span class="ss">:quien</span><span class="o">]</span> <span class="o">==</span> <span class="s1">'Franco'</span>
  <span class="s1">'Adivinaste!'</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/adivina/*'</span> <span class="k">do</span>
  <span class="s1">'Erraste!'</span>
<span class="k">end</span>
</pre>
<p>Se sale inmediatamente del bloque de la ruta y se le pasa el control a la
siguiente ruta que coincida. Si no coincide ninguna ruta, se devuelve un 404.</p>

<a name='Ejecutando%20Otra%20Ruta'></a>
<h3>Ejecutando Otra Ruta</h3>

<p>Cuando quers obtener el resultado de la llamada a una ruta, <code>pass</code> no te va a
servir. Para lograr esto, pods usar <code>call</code>:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/foo'</span> <span class="k">do</span>
  <span class="n">status</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">body</span> <span class="o">=</span> <span class="n">call</span> <span class="n">env</span><span class="nf">.merge</span><span class="p">(</span><span class="s2">&quot;PATH_INFO&quot;</span> <span class="o">=&gt;</span> <span class="s1">'/bar'</span><span class="p">)</span>
  <span class="o">[</span><span class="n">status</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">body</span><span class="nf">.map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:upcase</span><span class="p">)</span><span class="o">]</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/bar'</span> <span class="k">do</span>
  <span class="s2">&quot;bar&quot;</span>
<span class="k">end</span>
</pre>
<p>Not que en el ejemplo anterior, es conveniente mover <code>&quot;bar&quot;</code> a un
helper, y llamarlo desde <code>/foo</code> y <code>/bar</code>. As, vas a simplificar
las pruebas y a mejorar el rendimiento.</p>

<p>Si quers que la peticin se enve a la misma instancia de la aplicacin en
lugar de a otra, us <code>call!</code> en lugar de <code>call</code>.</p>

<p>En la especificacin de Rack pods encontrar ms informacin sobre
<code>call</code>.</p>

<a name='Asignando%20el%20Cdigo%20de%20Estado,%20los%20Encabezados%20y%20el%20Cuerpo%20de%20una%20Respuesta'></a>
<h3>Asignando el Cdigo de Estado, los Encabezados y el Cuerpo de una Respuesta</h3>

<p>Es posible, y se recomienda, asignar el cdigo de estado y el cuerpo de una
respuesta con el valor de retorno de una ruta. De cualquier manera, en varios
escenarios, puede que sea conveniente asignar el cuerpo en un punto arbitrario
del flujo de ejecucin con el mtodo <code>body</code>. A partir de ah, pods usar ese
mismo mtodo para acceder al cuerpo de la respuesta:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/foo'</span> <span class="k">do</span>
  <span class="n">body</span> <span class="s2">&quot;bar&quot;</span>
<span class="k">end</span>

<span class="n">after</span> <span class="k">do</span>
  <span class="nb">puts</span> <span class="n">body</span>
<span class="k">end</span>
</pre>
<p>Tambin es posible pasarle un bloque a <code>body</code>, que ser ejecutado por el Rack
handler (pods usar esto para implementar streaming, mir &quot;Valores de retorno&quot;).</p>

<p>De manera similar, tambin pods asignar el cdigo de estado y encabezados:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/foo'</span> <span class="k">do</span>
  <span class="n">status</span> <span class="mi">418</span>
  <span class="n">headers</span> <span class="p">\</span>
    <span class="s2">&quot;Allow&quot;</span>   <span class="o">=&gt;</span> <span class="s2">&quot;BREW, POST, GET, PROPFIND, WHEN&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Refresh&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Refresh: 20; http://www.ietf.org/rfc/rfc2324.txt&quot;</span>
  <span class="n">body</span> <span class="s2">&quot;I'm a tea pot!&quot;</span>
<span class="k">end</span>
</pre>
<p>Tambin, al igual que <code>body</code>, tanto <code>status</code> como <code>headers</code> pueden utilizarse
para obtener sus valores cuando no se les pasa argumentos.</p>

<a name='Streaming%20De%20Respuestas'></a>
<h3>Streaming De Respuestas</h3>

<p>A veces vas a querer empezar a enviar la respuesta a pesar de que todava no
terminaste de generar su cuerpo. Tambin es posible que, en algunos casos,
quieras seguir enviando informacin hasta que el cliente cierre la conexin.
Cuando esto ocurra, el <code>stream</code> helper te va a ser de gran ayuda:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">stream</span> <span class="k">do</span> <span class="o">|</span><span class="n">out</span><span class="o">|</span>
    <span class="n">out</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;Esto va a ser legen -</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="nb">sleep</span> <span class="mi">0</span><span class="o">.</span><span class="mi">5</span>
    <span class="n">out</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot; (esperalo) </span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="nb">sleep</span> <span class="mi">1</span>
    <span class="n">out</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;- dario!</span><span class="se">\n</span><span class="s2">&quot;</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre>
<p>Pods implementar APIs de streaming,
<a href="http://dev.w3.org/html5/eventsource/">Server-Sent Events</a> y puede ser usado
como base para <a href="http://es.wikipedia.org/wiki/WebSockets">WebSockets</a>. Tambin
puede ser usado para incrementar el throughput si solo una parte del contenido
depende de un recurso lento.</p>

<p>Hay que tener en cuenta que el comportamiento del streaming, especialmente el
nmero de peticiones concurrentes, depende del servidor web utilizado para
servir la aplicacin. Puede que algunos servidores, como es el caso de
WEBRick, no soporten streaming directamente, as el cuerpo de la respuesta ser
enviado completamente de una vez cuando el bloque pasado a <code>stream</code> finalice su
ejecucin. Si ests usando Shotgun, el streaming no va a funcionar.</p>

<p>Cuando se pasa <code>keep_open</code> como parmetro, no se va a enviar el mensaje
<code>close</code> al objeto de stream. Queda en vos cerrarlo en el punto de ejecucin
que quieras. Nuevamente, hay que tener en cuenta que este comportamiento es
posible solo en servidores que soporten eventos, como Thin o Rainbows. El
resto de los servidores van a cerrar el stream de todos modos:</p>
<pre class="highlight ruby"><span class="n">set</span> <span class="ss">:server</span><span class="p">,</span> <span class="ss">:thin</span>
<span class="n">conexiones</span> <span class="o">=</span> <span class="o">[]</span>

<span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="c1"># mantenemos abierto el stream</span>
  <span class="n">stream</span><span class="p">(</span><span class="ss">:keep_open</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">salida</span><span class="o">|</span> <span class="n">conexiones</span> <span class="o">&lt;&lt;</span> <span class="n">salida</span> <span class="p">}</span>
<span class="k">end</span>

<span class="n">post</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="c1"># escribimos a todos los streams abiertos</span>
  <span class="n">conexiones</span><span class="nf">.each</span> <span class="p">{</span> <span class="o">|</span><span class="n">salida</span><span class="o">|</span> <span class="n">salida</span> <span class="o">&lt;&lt;</span> <span class="n">params</span><span class="o">[</span><span class="ss">:mensaje</span><span class="o">]</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="p">}</span>
  <span class="s2">&quot;mensaje enviado&quot;</span>
<span class="k">end</span>
</pre>
<a name='Log%20(Registro)'></a>
<h3>Log (Registro)</h3>

<p>En el mbito de la peticin, el helper <code>logger</code> (registrador) expone
una instancia de <code>Logger</code>:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">logger</span><span class="nf">.info</span> <span class="s2">&quot;cargando datos&quot;</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</pre>
<p>Este logger tiene en cuenta la configuracin de logueo de tu Rack
handler. Si el logueo est desactivado, este mtodo va a devolver un
objeto que se comporta como un logger pero que en realidad no hace
nada. As, no vas a tener que preocuparte por esta situacin.</p>

<p>Ten en cuenta que el logueo est habilitado por defecto nicamente
para <code>Sinatra::Application</code>. Si heredaste de
<code>Sinatra::Base</code>, probablemente quieras habilitarlo manualmente:</p>
<pre class="highlight ruby"><span class="k">class</span> <span class="nc">MiApp</span> <span class="o">&lt;</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">configure</span> <span class="ss">:production</span><span class="p">,</span> <span class="ss">:development</span> <span class="k">do</span>
    <span class="n">enable</span> <span class="ss">:logging</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre>
<p>Para evitar que se inicialice cualquier middleware de logging, configur
<code>logging</code> a <code>nil</code>. Ten en cuenta que, cuando hagas esto, <code>logger</code> va a
devolver <code>nil</code>. Un caso comn es cuando quers usar tu propio logger. Sinatra
va a usar lo que encuentre en <code>env[&#39;rack.logger&#39;]</code>.</p>

<a name='Tipos%20Mime'></a>
<h3>Tipos Mime</h3>

<p>Cuando uss <code>send_file</code> o archivos estticos tal vez tengas tipos mime
que Sinatra no entiende. Us <code>mime_type</code> para registrarlos a travs de la
extensin de archivo:</p>
<pre class="highlight ruby"><span class="n">configure</span> <span class="k">do</span>
  <span class="n">mime_type</span> <span class="ss">:foo</span><span class="p">,</span> <span class="s1">'text/foo'</span>
<span class="k">end</span>
</pre>
<p>Tambin lo pods usar con el ayudante <code>content_type</code>:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">content_type</span> <span class="ss">:foo</span>
  <span class="s2">&quot;foo foo foo&quot;</span>
<span class="k">end</span>
</pre>
<a name='Generando%20URLs'></a>
<h3>Generando URLs</h3>

<p>Para generar URLs deberas usar el mtodo <code>url</code>. Por ejemplo, en Haml:</p>
<pre class="highlight ruby"><span class="o">%</span><span class="n">a</span><span class="p">{</span><span class="ss">:href</span> <span class="o">=&gt;</span> <span class="n">url</span><span class="p">(</span><span class="s1">'/foo'</span><span class="p">)}</span> <span class="n">foo</span>
</pre>
<p>Tiene en cuenta proxies inversos y encaminadores de Rack, si estn presentes.</p>

<p>Este mtodo tambin puede invocarse mediante su alias <code>to</code>  (mir un ejemplo
a continuacin).</p>

<a name='Redireccin%20del%20Navegador'></a>
<h3>Redireccin del Navegador</h3>

<p>Pods redireccionar al navegador con el mtodo <code>redirect</code>:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/foo'</span> <span class="k">do</span>
  <span class="n">redirect</span> <span class="n">to</span><span class="p">(</span><span class="s1">'/bar'</span><span class="p">)</span>
<span class="k">end</span>
</pre>
<p>Cualquier parmetro adicional se utiliza de la misma manera que los argumentos
pasados a <code>halt</code>:</p>
<pre class="highlight ruby"><span class="n">redirect</span> <span class="n">to</span><span class="p">(</span><span class="s1">'/bar'</span><span class="p">),</span> <span class="mi">303</span>
<span class="n">redirect</span> <span class="s1">'http://google.com'</span><span class="p">,</span> <span class="s1">'te confundiste de lugar, compaero'</span>
</pre>
<p>Tambin pods redireccionar fcilmente de vuelta hacia la pgina desde donde
vino el usuario con <code>redirect back</code>:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/foo'</span> <span class="k">do</span>
  <span class="s2">&quot;&lt;a href='/bar'&gt;hacer algo&lt;/a&gt;&quot;</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/bar'</span> <span class="k">do</span>
  <span class="n">hacer_algo</span>
  <span class="n">redirect</span> <span class="n">back</span>
<span class="k">end</span>
</pre>
<p>Para pasar argumentos con una redireccin, pods agregarlos a la cadena de
bsqueda:</p>
<pre class="highlight ruby"><span class="n">redirect</span> <span class="n">to</span><span class="p">(</span><span class="s1">'/bar?suma=42'</span><span class="p">)</span>
</pre>
<p>O usar una sesin:</p>
<pre class="highlight ruby"><span class="n">enable</span> <span class="ss">:sessions</span>

<span class="n">get</span> <span class="s1">'/foo'</span> <span class="k">do</span>
  <span class="n">session</span><span class="o">[</span><span class="ss">:secreto</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'foo'</span>
  <span class="n">redirect</span> <span class="n">to</span><span class="p">(</span><span class="s1">'/bar'</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/bar'</span> <span class="k">do</span>
  <span class="n">session</span><span class="o">[</span><span class="ss">:secreto</span><span class="o">]</span>
<span class="k">end</span>
</pre>
<a name='Cache%20Control'></a>
<h3>Cache Control</h3>

<p>Asignar tus encabezados correctamente es el cimiento para realizar un cacheo
HTTP correcto.</p>

<p>Pods asignar el encabezado Cache-Control fcilmente:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">cache_control</span> <span class="ss">:public</span>
  <span class="s2">&quot;cachealo!&quot;</span>
<span class="k">end</span>
</pre>
<p>Pro tip: configurar el cacheo en un filtro <code>before</code>:</p>
<pre class="highlight ruby"><span class="n">before</span> <span class="k">do</span>
  <span class="n">cache_control</span> <span class="ss">:public</span><span class="p">,</span> <span class="ss">:must_revalidate</span><span class="p">,</span> <span class="ss">:max_age</span> <span class="o">=&gt;</span> <span class="mi">60</span>
<span class="k">end</span>
</pre>
<p>Si ests usando el helper <code>expires</code> para definir el encabezado correspondiente,
<code>Cache-Control</code> se va a definir automticamente:</p>
<pre class="highlight ruby"><span class="n">before</span> <span class="k">do</span>
  <span class="n">expires</span> <span class="mi">500</span><span class="p">,</span> <span class="ss">:public</span><span class="p">,</span> <span class="ss">:must_revalidate</span>
<span class="k">end</span>
</pre>
<p>Para usar cachs adecuadamente, deberas considerar usar <code>etag</code> o
<code>last_modified</code>. Es recomendable que llames a estos helpers <em>antes</em> de hacer
cualquier trabajo pesado, ya que van a enviar la respuesta inmediatamente si
el cliente ya tiene la versin actual en su cach:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/articulo/:id'</span> <span class="k">do</span>
  <span class="vi">@articulo</span> <span class="o">=</span> <span class="no">Articulo</span><span class="nf">.find</span> <span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span>
  <span class="n">last_modified</span> <span class="vi">@articulo</span><span class="nf">.updated_at</span>
  <span class="n">etag</span> <span class="vi">@articulo</span><span class="nf">.sha1</span>
  <span class="n">erb</span> <span class="ss">:articulo</span>
<span class="k">end</span>
</pre>
<p>Tambin es posible usar una
<a href="http://en.wikipedia.org/wiki/HTTP_ETag#Strong_and_weak_validation">weak ETag</a>:</p>
<pre class="highlight ruby"><span class="n">etag</span> <span class="vi">@articulo</span><span class="nf">.sha1</span><span class="p">,</span> <span class="ss">:weak</span>
</pre>
<p>Estos helpers no van a cachear nada por vos, sino que van a facilitar la
informacin necesaria para poder hacerlo. Si ests buscando soluciones rpidas
de cacheo con proxys inversos, mir
<a href="https://github.com/rtomayko/rack-cache">rack-cache</a>:</p>
<pre class="highlight ruby"><span class="nb">require</span> <span class="s2">&quot;rack/cache&quot;</span>
<span class="nb">require</span> <span class="s2">&quot;sinatra&quot;</span>

<span class="n">use</span> <span class="no">Rack</span><span class="o">::</span><span class="no">Cache</span>

<span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">cache_control</span> <span class="ss">:public</span><span class="p">,</span> <span class="ss">:max_age</span> <span class="o">=&gt;</span> <span class="mi">36000</span>
  <span class="nb">sleep</span> <span class="mi">5</span>
  <span class="s2">&quot;hola&quot;</span>
<span class="k">end</span>
</pre>
<p>Us la configuracin <code>:static_cache_control</code> para agregar el encabezado
<code>Cache-Control</code> a archivos estticos (ver la seccin de configuracin
para ms detalles).</p>

<p>De acuerdo con la RFC 2616 tu aplicacin debera comportarse diferente si a las
cabeceras If-Match o If-None-Match se le asigna el valor <code>*</code> cuando el
recurso solicitado ya existe. Sinatra asume para peticiones seguras (como get)
e idempotentes (como put) que el recurso existe, mientras que para el resto
(como post), que no. Podes cambiar este comportamiento con la opcin
<code>:new_resource</code>:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/crear'</span> <span class="k">do</span>
  <span class="n">etag</span> <span class="s1">''</span><span class="p">,</span> <span class="ss">:new_resource</span> <span class="o">=&gt;</span> <span class="kp">true</span>
  <span class="no">Articulo</span><span class="nf">.create</span>
  <span class="n">erb</span> <span class="ss">:nuevo_articulo</span>
<span class="k">end</span>
</pre>
<p>Si quers seguir usando una weak ETag, indicalo con la opcin <code>:kind</code>:</p>
<pre class="highlight ruby"><span class="n">etag</span> <span class="s1">''</span><span class="p">,</span> <span class="ss">:new_resource</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:kind</span> <span class="o">=&gt;</span> <span class="ss">:weak</span>
</pre>
<a name='Enviando%20Archivos'></a>
<h3>Enviando Archivos</h3>

<p>Para enviar archivos, pods usar el mtodo <code>send_file</code>:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">send_file</span> <span class="s1">'foo.png'</span>
<span class="k">end</span>
</pre>
<p>Adems acepta un par de opciones:</p>
<pre class="highlight ruby"><span class="n">send_file</span> <span class="s1">'foo.png'</span><span class="p">,</span> <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="ss">:jpg</span>
</pre>
<p>Estas opciones son:</p>

<p>[filename]
  nombre del archivo devuelto, por defecto es el nombre real del archivo.</p>

<p>[last_modified]
  valor para el encabezado Last-Modified, por defecto toma el mtime del archivo.</p>

<p>[type]
  el content type que se va a utilizar, si no est presente se intenta adivinar
  a partir de la extensin del archivo.</p>

<p>[disposition]
  se utiliza para el encabezado Content-Disposition, y puede tomar alguno de los
  siguientes valores: <code>nil</code> (por defecto), <code>:attachment</code> e
  <code>:inline</code></p>

<p>[length]
  encabezado Content-Length, por defecto toma el tamao del archivo.</p>

<p>[status]
  cdigo de estado devuelto. Resulta til al enviar un archivo esttico como una
  pgina de error.</p>

<p>Si el Rack handler lo soporta, se intentar no transmitir directamente desde el
proceso de Ruby. Si uss este mtodo, Sinatra se va a encargar automticamente
peticiones de rango.</p>

<a name='Accediendo%20al%20objeto%20de%20la%20peticin'></a>
<h3>Accediendo al objeto de la peticin</h3>

<p>El objeto de la peticin entrante puede ser accedido desde el nivel de la
peticin (filtros, rutas y manejadores de errores) a travs del mtodo
<code>request</code>:</p>
<pre class="highlight ruby"><span class="c1"># app corriendo en http://ejemplo.com/ejemplo</span>
<span class="n">get</span> <span class="s1">'/foo'</span> <span class="k">do</span>
  <span class="n">t</span> <span class="o">=</span> <span class="sx">%w[text/css text/html application/javascript]</span>
  <span class="n">request</span><span class="nf">.accept</span>              <span class="c1"># ['text/html', '*/*']</span>
  <span class="n">request</span><span class="nf">.accept?</span> <span class="s1">'text/xml'</span>  <span class="c1"># true</span>
  <span class="n">request</span><span class="nf">.preferred_type</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>   <span class="c1"># 'text/html'</span>
  <span class="n">request</span><span class="nf">.body</span>                <span class="c1"># cuerpo de la peticin enviado por el cliente (ver ms abajo)</span>
  <span class="n">request</span><span class="nf">.scheme</span>              <span class="c1"># &quot;http&quot;</span>
  <span class="n">request</span><span class="nf">.script_name</span>         <span class="c1"># &quot;/ejemplo&quot;</span>
  <span class="n">request</span><span class="nf">.path_info</span>           <span class="c1"># &quot;/foo&quot;</span>
  <span class="n">request</span><span class="nf">.port</span>                <span class="c1"># 80</span>
  <span class="n">request</span><span class="nf">.request_method</span>      <span class="c1"># &quot;GET&quot;</span>
  <span class="n">request</span><span class="nf">.query_string</span>        <span class="c1"># &quot;&quot;</span>
  <span class="n">request</span><span class="nf">.content_length</span>      <span class="c1"># longitud de request.body</span>
  <span class="n">request</span><span class="nf">.media_type</span>          <span class="c1"># tipo de medio de request.body</span>
  <span class="n">request</span><span class="nf">.host</span>                <span class="c1"># &quot;ejemplo.com&quot;</span>
  <span class="n">request</span><span class="nf">.get?</span>                <span class="c1"># true (hay mtodos anlogos para los otros verbos)</span>
  <span class="n">request</span><span class="nf">.form_data?</span>          <span class="c1"># false</span>
  <span class="n">request</span><span class="o">[</span><span class="s2">&quot;UNA_CABECERA&quot;</span><span class="o">]</span>     <span class="c1"># valor de la cabecera UNA_CABECERA</span>
  <span class="n">request</span><span class="nf">.referrer</span>            <span class="c1"># la referencia del cliente o '/'</span>
  <span class="n">request</span><span class="nf">.user_agent</span>          <span class="c1"># user agent (usado por la condicin :agent)</span>
  <span class="n">request</span><span class="nf">.cookies</span>             <span class="c1"># hash de las cookies del browser</span>
  <span class="n">request</span><span class="nf">.xhr?</span>                <span class="c1"># es una peticin ajax?</span>
  <span class="n">request</span><span class="nf">.url</span>                 <span class="c1"># &quot;http://ejemplo.com/ejemplo/foo&quot;</span>
  <span class="n">request</span><span class="nf">.path</span>                <span class="c1"># &quot;/ejemplo/foo&quot;</span>
  <span class="n">request</span><span class="nf">.ip</span>                  <span class="c1"># direccin IP del cliente</span>
  <span class="n">request</span><span class="nf">.secure?</span>             <span class="c1"># false (sera true sobre ssl)</span>
  <span class="n">request</span><span class="nf">.forwarded?</span>          <span class="c1"># true (si se est corriendo atrs de un proxy inverso)</span>
  <span class="n">requuest</span><span class="nf">.env</span>                <span class="c1"># hash de entorno directamente entregado por Rack</span>
<span class="k">end</span>
</pre>
<p>Algunas opciones, como <code>script_name</code> o <code>path_info</code> pueden
tambin ser escritas:</p>
<pre class="highlight ruby"><span class="n">before</span> <span class="p">{</span> <span class="n">request</span><span class="nf">.path_info</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span> <span class="p">}</span>

<span class="n">get</span> <span class="s2">&quot;/&quot;</span> <span class="k">do</span>
  <span class="s2">&quot;todas las peticiones llegan ac&quot;</span>
<span class="k">end</span>
</pre>
<p>El objeto <code>request.body</code> es una instancia de IO o StringIO:</p>
<pre class="highlight ruby"><span class="n">post</span> <span class="s2">&quot;/api&quot;</span> <span class="k">do</span>
  <span class="n">request</span><span class="nf">.body.rewind</span>  <span class="c1"># en caso de que alguien ya lo haya ledo</span>
  <span class="n">datos</span> <span class="o">=</span> <span class="no">JSON</span><span class="nf">.parse</span> <span class="n">request</span><span class="nf">.body.read</span>
  <span class="s2">&quot;Hola </span><span class="si">#{</span><span class="n">datos</span><span class="o">[</span><span class="s1">'nombre'</span><span class="o">]</span><span class="si">}</span><span class="s2">!&quot;</span>
<span class="k">end</span>
</pre>
<a name='Archivos%20Adjuntos'></a>
<h3>Archivos Adjuntos</h3>

<p>Pods usar el mtodo helper <code>attachment</code> para indicarle al navegador que
almacene la respuesta en el disco en lugar de mostrarla en pantalla:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">attachment</span>
  <span class="s2">&quot;guardalo!&quot;</span>
<span class="k">end</span>
</pre>
<p>Tambin pods pasarle un nombre de archivo:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">attachment</span> <span class="s2">&quot;info.txt&quot;</span>
  <span class="s2">&quot;guardalo!&quot;</span>
<span class="k">end</span>
</pre>
<a name='Fecha%20y%20Hora'></a>
<h3>Fecha y Hora</h3>

<p>Sinatra pone a tu disposicin el helper <code>time_for</code>, que genera un objeto <code>Time</code>
a partir del valor que recibe como argumento. Este valor puede ser un
<code>String</code>, pero tambin es capaz de convertir objetos <code>DateTime</code>, <code>Date</code> y de
otras clases similares:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">pass</span> <span class="k">if</span> <span class="no">Time</span><span class="nf">.now</span> <span class="o">&gt;</span> <span class="n">time_for</span><span class="p">(</span><span class="s1">'Dec 23, 2012'</span><span class="p">)</span>
  <span class="s2">&quot;todava hay tiempo&quot;</span>
<span class="k">end</span>
</pre>
<p>Este mtodo es usado internamente por mtodos como <code>expires</code> y <code>last_modified</code>,
entre otros. Por lo tanto, es posible extender el comportamiento de estos
mtodos sobreescribiendo <code>time_for</code> en tu aplicacin:</p>
<pre class="highlight ruby"><span class="n">helpers</span> <span class="k">do</span>
  <span class="k">def</span> <span class="nf">time_for</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">case</span> <span class="n">value</span>
    <span class="k">when</span> <span class="ss">:ayer</span> <span class="k">then</span> <span class="no">Time</span><span class="nf">.now</span> <span class="o">-</span> <span class="mi">24</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span>
    <span class="k">when</span> <span class="ss">:maana</span> <span class="k">then</span> <span class="no">Time</span><span class="nf">.now</span> <span class="o">+</span> <span class="mi">24</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span>
    <span class="k">else</span> <span class="k">super</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">last_modified</span> <span class="ss">:ayer</span>
  <span class="n">expires</span> <span class="ss">:maana</span>
  <span class="s2">&quot;hola&quot;</span>
<span class="k">end</span>
</pre>
<a name='Buscando%20los%20Archivos%20de%20las%20Plantillas'></a>
<h3>Buscando los Archivos de las Plantillas</h3>

<p>El helper <code>find_template</code> se utiliza para encontrar los archivos de las
plantillas que se van a renderizar:</p>
<pre class="highlight ruby"><span class="n">find_template</span> <span class="n">settings</span><span class="nf">.views</span><span class="p">,</span> <span class="s1">'foo'</span><span class="p">,</span> <span class="no">Tilt</span><span class="o">[</span><span class="ss">:haml</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">archivo</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="s2">&quot;podra ser </span><span class="si">#{</span><span class="n">archivo</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="k">end</span>
</pre>
<p>Si bien esto no es muy til, lo interesante es que pods sobreescribir este
mtodo, y as enganchar tu propio mecanismo de bsqueda. Por ejemplo, para
poder utilizar ms de un directorio de vistas:</p>
<pre class="highlight ruby"><span class="n">set</span> <span class="ss">:views</span><span class="p">,</span> <span class="o">[</span><span class="s1">'vistas'</span><span class="p">,</span> <span class="s1">'plantillas'</span><span class="o">]</span>

<span class="n">helpers</span> <span class="k">do</span>
  <span class="k">def</span> <span class="nf">find_template</span><span class="p">(</span><span class="n">views</span><span class="p">,</span> <span class="nb">name</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
    <span class="nb">Array</span><span class="p">(</span><span class="n">views</span><span class="p">)</span><span class="nf">.each</span> <span class="p">{</span> <span class="o">|</span><span class="n">v</span><span class="o">|</span> <span class="k">super</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">name</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">)</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre>
<p>Otro ejemplo consiste en usar directorios diferentes para los distintos motores
de renderizado:</p>
<pre class="highlight ruby"><span class="n">set</span> <span class="ss">:views</span><span class="p">,</span> <span class="ss">:sass</span> <span class="o">=&gt;</span> <span class="s1">'vistas/sass'</span><span class="p">,</span> <span class="ss">:haml</span> <span class="o">=&gt;</span> <span class="s1">'plantillas'</span><span class="p">,</span> <span class="ss">:defecto</span> <span class="o">=&gt;</span> <span class="s1">'vistas'</span>

<span class="n">helpers</span> <span class="k">do</span>
  <span class="k">def</span> <span class="nf">find_template</span><span class="p">(</span><span class="n">views</span><span class="p">,</span> <span class="nb">name</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">folder</span> <span class="o">=</span> <span class="n">views</span><span class="nf">.detect</span> <span class="p">{</span> <span class="o">|</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="o">|</span> <span class="n">engine</span> <span class="o">==</span> <span class="no">Tilt</span><span class="o">[</span><span class="n">k</span><span class="o">]</span> <span class="p">}</span>
    <span class="n">folder</span> <span class="o">||=</span> <span class="n">views</span><span class="o">[</span><span class="ss">:defecto</span><span class="o">]</span>
    <span class="k">super</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="nb">name</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre>
<p>Es muy fcil convertir estos ejemplos en una extensin y compartirla!.</p>

<p>Not que <code>find_template</code> no verifica si un archivo existe realmente, sino
que llama al bloque que recibe para cada path posible. Esto no representa un
problema de rendimiento debido a que <code>render</code> va a usar <code>break</code> ni bien
encuentre un archivo que exista. Adems, las ubicaciones de las plantillas (y
su contenido) se cachean cuando no ests en el modo de desarrollo. Es bueno
tener en cuenta lo anteiror si escribs un mtodo medio loco.</p>

<a name='Configuracin'></a>
<h2>Configuracin</h2>

<p>Ejecutar una vez, en el inicio, en cualquier entorno:</p>
<pre class="highlight ruby"><span class="n">configure</span> <span class="k">do</span>
  <span class="c1"># asignando una opcin</span>
  <span class="n">set</span> <span class="ss">:opcion</span><span class="p">,</span> <span class="s1">'valor'</span>

  <span class="c1"># asignando varias opciones</span>
  <span class="n">set</span> <span class="ss">:a</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="ss">:b</span> <span class="o">=&gt;</span> <span class="mi">2</span>

  <span class="c1"># atajo para `set :opcion, true`</span>
  <span class="n">enable</span> <span class="ss">:opcion</span>

  <span class="c1"># atajo para `set :opcion, false`</span>
  <span class="n">disable</span> <span class="ss">:opcion</span>

  <span class="c1"># tambin pods tener configuraciones dinmicas usando bloques</span>
  <span class="n">set</span><span class="p">(</span><span class="ss">:css_dir</span><span class="p">)</span> <span class="p">{</span> <span class="no">File</span><span class="nf">.join</span><span class="p">(</span><span class="n">views</span><span class="p">,</span> <span class="s1">'css'</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>
</pre>
<p>Ejecutar nicamente cuando el entorno (la variable de entorno RACK_ENV) es
<code>:production</code>:</p>
<pre class="highlight ruby"><span class="n">configure</span> <span class="ss">:production</span> <span class="k">do</span>
  <span class="nf">..</span><span class="o">.</span>
<span class="k">end</span>
</pre>
<p>Ejecutar cuando el entorno es <code>:production</code> o <code>:test</code>:</p>
<pre class="highlight ruby"><span class="n">configure</span> <span class="ss">:production</span><span class="p">,</span> <span class="ss">:test</span> <span class="k">do</span>
  <span class="nf">..</span><span class="o">.</span>
<span class="k">end</span>
</pre>
<p>Pods acceder a estas opciones utilizando el mtodo <code>settings</code>:</p>
<pre class="highlight ruby"><span class="n">configure</span> <span class="k">do</span>
  <span class="n">set</span> <span class="ss">:foo</span><span class="p">,</span> <span class="s1">'bar'</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="n">settings</span><span class="nf">.foo?</span> <span class="c1"># =&gt; true</span>
  <span class="n">settings</span><span class="nf">.foo</span>  <span class="c1"># =&gt; 'bar'</span>
  <span class="nf">..</span><span class="o">.</span>
<span class="k">end</span>
</pre>
<a name='Configurando%20la%20Proteccin%20de%20Ataques'></a>
<h3>Configurando la Proteccin de Ataques</h3>

<p>Sinatra usa <a href="https://github.com/rkh/rack-protection#readme">Rack::Protection</a>
para defender a tu aplicacin de los ataques ms comunes. Si por algn motivo,
quers desactivar esta funcionalidad, pods hacerlo como se indica a
continuacin (ten en cuenta que tu aplicacin va a quedar expuesta a un
montn de vulnerabilidades bien conocidas):</p>
<pre class="highlight ruby"><span class="n">disable</span> <span class="ss">:protection</span>
</pre>
<p>Tambin es posible desactivar una nica capa de defensa:</p>
<pre class="highlight ruby"><span class="n">set</span> <span class="ss">:protection</span><span class="p">,</span> <span class="ss">:except</span> <span class="o">=&gt;</span> <span class="ss">:path_traversal</span>
</pre>
<p>O varias:</p>
<pre class="highlight ruby"><span class="n">set</span> <span class="ss">:protection</span><span class="p">,</span> <span class="ss">:except</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:path_traversal</span><span class="p">,</span> <span class="ss">:session_hijacking</span><span class="o">]</span>
</pre>
<a name='Configuraciones%20Disponibles'></a>
<h3>Configuraciones Disponibles</h3>

<dl>
  <dt>absolute_redirects</dt>
  <dd>
    Si est deshabilitada, Sinatra va a permitir
    redirecciones relativas, sin embargo, como consecuencia
    de esto, va a dejar de cumplir con el RFC 2616 (HTTP
    1.1), que solamente permite redirecciones absolutas.

    Activalo si tu apliacin est corriendo atrs de un proxy
    inverso que no se ha configurado adecuadamente. Not que
    el helper <tt>url</tt> va a seguir produciendo URLs absolutas, a
    menos que le pass <tt>false</tt> como segundo parmetro.

    Deshabilitada por defecto.
  </dd>

  <dt>add_charsets</dt>
  <dd>
    Tipos mime a los que el helper <tt>content_type</tt> les
    aade automticamente el charset.

    En general, no deberas asignar directamente esta opcin,
    sino aadirle los charsets que quieras:
    <tt>settings.add_charsets &lt;&lt; "application/foobar"</tt>
  </dd>

  <dt>app_file</dt>
  <dd>
    Path del archivo principal de la aplicacin, se utiliza
    para detectar la raz del proyecto, el directorio de las
    vistas y el pblico, as como las plantillas inline.
  </dd>

  <dt>bind</dt>
  <dd>
    Direccin IP que utilizar el servidor integrado (por
    defecto: 0.0.0.0).
  </dd>

  <dt>default_encoding</dt>
  <dd>
    Encoding utilizado cuando el mismo se desconoce (por
    defecto <tt>"utf-8"</tt>).
  </dd>

  <dt>dump_errors</dt>
  <dd>
    Mostrar errores en el log.
  </dd>

  <dt>environment</dt>
  <dd>
    Entorno actual, por defecto toma el valor de
    <tt>ENV['RACK_ENV']</tt>, o <tt>"development"</tt> si no
    est disponible.
  </dd>

  <dt>logging</dt>
  <dd>
    Define si se utiliza el logger.
  </dd>

  <dt>lock</dt>
  <dd>
    Coloca un lock alrededor de cada peticin, procesando
    solamente una por proceso.

    Habilit esta opcin si tu aplicacin no es thread-safe.
    Se encuentra deshabilitada por defecto.
  </dd>

  <dt>method_override</dt>
  <dd>
    Utiliza el parmetro <tt>_method</tt> para permtir
    formularios put/delete en navegadores que no los
    soportan.
  </dd>

  <dt>port</dt>
  <dd>
    Puerto en el que escuchar el servidor integrado.
  </dd>

  <dt>prefixed_redirects</dt>
  <dd>
    Define si inserta <tt>request.script_name</tt> en las
    redirecciones cuando no se proporciona un path absoluto.
    De esta manera, cuando est habilitada,
    <tt>redirect '/foo'</tt> se comporta de la misma manera
    que <tt>redirect to('/foo')</tt>. Se encuentra
    deshabilitada por defecto.
  </dd>

  <dt>protection</dt>
  <dd>
    Define si deben activarse las protecciones para los
    ataques web ms comunes. Para ms detalles mir la
    seccin sobre la configuracin de proteccin de ataques
    ms arriba.
  </dd>

  <dt>public_dir</dt>
  <dd>
    Alias para <tt>public_folder</tt>, que se encuentra a
    continuacin.
  </dd>

  <dt>public_folder</dt>
  <dd>
    Path del directorio desde donde se sirven los archivos
    pblicos. Solo se utiliza cuando se sirven archivos
    estticos (ver la opcin <tt>static</tt>). Si no
    est presente, se infiere del valor de la opcin
    <tt>app_file</tt>.
  </dd>

  <dt>reload_templates</dt>
  <dd>
    Define si se recargan las plantillas entre peticiones.

    Se encuentra activado en el entorno de desarrollo.
  </dd>

  <dt>root</dt>
  <dd>
    Path del directorio raz del proyecto. Si no est
    presente, se infiere del valor de la opcin
    <tt>app_file</tt>.
  </dd>

  <dt>raise_errors</dt>
  <dd>
    Elevar excepciones (detiene la aplicacin). Se
    encuentra activada por defecto cuando el valor de
    <tt>environment</tt>  es <tt>"test"</tt>. En caso
    contrario estar desactivada.
  </dd>

  <dt>run</dt>
  <dd>
    Cuando est habilitada, Sinatra se va a encargar de
    iniciar el servidor web, no la habilits cuando ests
    usando rackup o algn otro medio.
  </dd>

  <dt>running</dt>
  <dd>
    Indica si el servidor integrado est ejecutandose, no
    cambis esta configuracin!.
  </dd>

  <dt>server</dt>
  <dd>
    Servidor, o lista de servidores, para usar como servidor
    integrado. Por defecto: <tt>['thin', 'mongrel', 'webrick']</tt>,
    el orden establece la prioridad.
  </dd>

  <dt>sessions</dt>
  <dd>
    Habilita el soporte de sesiones basadas en cookies a
    travs de <tt>Rack::Session::Cookie</tt>. Ver la
    seccin 'Usando Sesiones' para ms informacin.
  </dd>

  <dt>show_exceptions</dt>
  <dd>
    Muestra un stack trace en el navegador cuando ocurre una
    excepcin. Se encuentra activada por defecto cuando el
    valor de <tt>environment</tt> es <tt>"development"</tt>.
    En caso contrario estar desactivada.
  </dd>

  <dt>static</dt>
  <dd>
    Define si Sinatra debe encargarse de servir archivos
    estticos.

    Deshabilitala cuando uss un servidor capaz de
    hacerlo por s solo, porque mejorar el
    rendimiento. Se encuentra habilitada por
    defecto en el estilo clsico y desactivado en el
    el modular.
  </dd>

  <dt>static_cache_control</dt>
  <dd>
    Cuando Sinatra est sirviendo archivos estticos, y
    est opcin est habilitada, les va a agregar encabezados
    <tt>Cache-Control</tt> a las respuestas. Para esto
    utiliza el helper <tt>cache_control</tt>. Se encuentra
    deshabilitada por defecto. Notar que es necesario
    utilizar un array cuando se asignan mltiples valores:
    <tt>set :static_cache_control, [:public, :max_age => 300]</tt>.
  </dd>

  <dt>views</dt>
  <dd>
    Path del directorio de las vistas. Si no est presente,
    se infiere del valor de la opcin <tt>app_file</tt>.
  </dd>
</dl>

<a name='Entornos'></a>
<h2>Entornos</h2>

<p>Existen tres entornos (<code>environments</code>) predefinidos: <code>development</code>,
<code>production</code> y <code>test</code>. El entorno por defecto es
<code>development</code> y tiene algunas particularidades:</p>

<ul>
<li>Se recargan las plantillas entre una peticin y la siguiente, a diferencia
de <code>production</code> y <code>test</code>, donde se cachean.</li>
<li>Se instalan manejadores de errores <code>not_found</code> y <code>error</code>
especiales que muestran un stack trace en el navegador cuando son disparados.</li>
</ul>

<p>Para utilizar alguno de los otros entornos puede asignarse el valor
correspondiente a la variable de entorno <code>RACK_ENV</code>, o bien utilizar la opcin
<code>-e</code> al ejecutar la aplicacin:</p>
<pre class="highlight shell">ruby mi_app.rb -e &lt;ENTORNO&gt;
</pre>
<p>Los mtodos <code>development?</code>, <code>test?</code> y <code>production?</code> te permiten conocer el
entorno actual.</p>

<a name='Manejo%20de%20Errores'></a>
<h2>Manejo de Errores</h2>

<p>Los manejadores de errores se ejecutan dentro del mismo contexto que las rutas
y los filtros <code>before</code>, lo que significa que pods usar, por ejemplo,
<code>haml</code>, <code>erb</code>, <code>halt</code>, etc.</p>

<a name='No%20encontrado%20%3Cem%3E(Not%20Found)%3C/em%3E'></a>
<h3>No encontrado <em>(Not Found)</em></h3>

<p>Cuando se eleva una excepcin <code>Sinatra::NotFound</code>, o el cdigo de
estado de la respuesta es 404, el manejador <code>not_found</code> es invocado:</p>
<pre class="highlight ruby"><span class="n">not_found</span> <span class="k">do</span>
  <span class="s1">'No existo'</span>
<span class="k">end</span>
</pre>
<a name='Error'></a>
<h3>Error</h3>

<p>El manejador <code>error</code> es invocado cada vez que una excepcin es elevada
desde un bloque de ruta o un filtro. El objeto de la excepcin se puede
obtener de la variable Rack <code>sinatra.error</code>:</p>
<pre class="highlight ruby"><span class="n">error</span> <span class="k">do</span>
  <span class="s1">'Disculp, ocurri un error horrible - '</span> <span class="o">+</span> <span class="n">env</span><span class="o">[</span><span class="s1">'sinatra.error'</span><span class="o">]</span><span class="nf">.name</span>
<span class="k">end</span>
</pre>
<p>Errores personalizados:</p>
<pre class="highlight ruby"><span class="n">error</span> <span class="no">MiErrorPersonalizado</span> <span class="k">do</span>
  <span class="s1">'Lo que pas fue...'</span> <span class="o">+</span> <span class="n">env</span><span class="o">[</span><span class="s1">'sinatra.error'</span><span class="o">]</span><span class="nf">.message</span>
<span class="k">end</span>
</pre>
<p>Entonces, si pasa esto:</p>
<pre class="highlight ruby"><span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="k">raise</span> <span class="no">MiErrorPersonalizado</span><span class="p">,</span> <span class="s1">'algo malo'</span>
<span class="k">end</span>
</pre>
<p>Obtens esto:</p>

<p>Lo que pas fue... algo malo</p>

<p>Tambin, pods instalar un manejador de errores para un cdigo de estado:</p>
<pre class="highlight ruby"><span class="n">error</span> <span class="mi">403</span> <span class="k">do</span>
  <span class="s1">'Acceso prohibido'</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/secreto'</span> <span class="k">do</span>
  <span class="mi">403</span>
<span class="k">end</span>
</pre>
<p>O un rango:</p>
<pre class="highlight ruby"><span class="n">error</span> <span class="mi">400</span><span class="nf">..</span><span class="mi">510</span> <span class="k">do</span>
  <span class="s1">'Boom'</span>
<span class="k">end</span>
</pre>
<p>Sinatra instala manejadores <code>not_found</code> y <code>error</code> especiales
cuando se ejecuta dentro del entorno de desarrollo &quot;development&quot;.</p>

<a name='Rack%20Middleware'></a>
<h2>Rack Middleware</h2>

<p>Sinatra corre sobre Rack[http://rack.rubyforge.org/], una interfaz minimalista
que es un estndar para frameworks webs escritos en Ruby. Una de las
capacidades ms interesantes de Rack para los desarrolladores de aplicaciones
es el soporte de &quot;middleware&quot; -- componentes que se ubican entre el servidor y
tu aplicacin, supervisando y/o manipulando la peticin/respuesta HTTP para
proporcionar varios tipos de funcionalidades comunes.</p>

<p>Sinatra hace muy sencillo construir tuberas de Rack middleware a travs del
mtodo top-level <code>use</code>:</p>
<pre class="highlight ruby"><span class="nb">require</span> <span class="s1">'sinatra'</span>
<span class="nb">require</span> <span class="s1">'mi_middleware_personalizado'</span>

<span class="n">use</span> <span class="no">Rack</span><span class="o">::</span><span class="no">Lint</span>
<span class="n">use</span> <span class="no">MiMiddlewarePersonalizado</span>

<span class="n">get</span> <span class="s1">'/hola'</span> <span class="k">do</span>
  <span class="s1">'Hola Mundo'</span>
<span class="k">end</span>
</pre>
<p>Las semnticas de <code>use</code> son idnticas a las definidas para el DSL
Rack::Builder[http://rack.rubyforge.org/doc/classes/Rack/Builder.html] (ms
frecuentemente usado desde archivos rackup). Por ejemplo, el mtodo <code>use</code>
acepta argumentos mltiples/variables as como bloques:</p>
<pre class="highlight ruby"><span class="n">use</span> <span class="no">Rack</span><span class="o">::</span><span class="no">Auth</span><span class="o">::</span><span class="no">Basic</span> <span class="k">do</span> <span class="o">|</span><span class="n">nombre_de_usuario</span><span class="p">,</span> <span class="n">password</span><span class="o">|</span>
  <span class="n">nombre_de_usuario</span> <span class="o">==</span> <span class="s1">'admin'</span> <span class="o">&amp;&amp;</span> <span class="n">password</span> <span class="o">==</span> <span class="s1">'secreto'</span>
<span class="k">end</span>
</pre>
<p>Rack es distribuido con una variedad de middleware estndar para logging,
debugging, enrutamiento URL, autenticacin, y manejo de sesiones. Sinatra
usa muchos de estos componentes automticamente de acuerdo a su configuracin
para que tpicamente no tengas que usarlas (con <code>use</code>) explcitamente.</p>

<p>Pods encontrar middleware til en
<a href="https://github.com/rack/rack/tree/master/lib/rack">rack</a>,
<a href="https://github.com/rack/rack-contrib#readme">rack-contrib</a>,
con <a href="http://coderack.org/">CodeRack</a> o en la
<a href="https://github.com/rack/rack/wiki/List-of-Middleware">Rack wiki</a>.</p>

<a name='Pruebas'></a>
<h2>Pruebas</h2>

<p>Las pruebas para las aplicaciones Sinatra pueden ser escritas utilizando
cualquier framework o librera de pruebas basada en Rack. Se recomienda usar
<a href="http://rdoc.info/github/brynary/rack-test/master/frames">Rack::Test</a>:</p>
<pre class="highlight ruby"><span class="nb">require</span> <span class="s1">'mi_app_sinatra'</span>
<span class="nb">require</span> <span class="s1">'test/unit'</span>
<span class="nb">require</span> <span class="s1">'rack/test'</span>

<span class="k">class</span> <span class="nc">MiAppTest</span> <span class="o">&lt;</span> <span class="no">Test</span><span class="o">::</span><span class="no">Unit</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="kp">include</span> <span class="no">Rack</span><span class="o">::</span><span class="no">Test</span><span class="o">::</span><span class="no">Methods</span>

  <span class="k">def</span> <span class="nf">app</span>
    <span class="no">Sinatra</span><span class="o">::</span><span class="no">Application</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">test_mi_defecto</span>
    <span class="n">get</span> <span class="s1">'/'</span>
    <span class="n">assert_equal</span> <span class="s1">'Hola Mundo!'</span><span class="p">,</span> <span class="n">last_response</span><span class="nf">.body</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">test_con_parametros</span>
    <span class="n">get</span> <span class="s1">'/saludar'</span><span class="p">,</span> <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">'Franco'</span>
    <span class="n">assert_equal</span> <span class="s1">'Hola Frank!'</span><span class="p">,</span> <span class="n">last_response</span><span class="nf">.body</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">test_con_entorno_rack</span>
    <span class="n">get</span> <span class="s1">'/'</span><span class="p">,</span> <span class="p">{},</span> <span class="s1">'HTTP_USER_AGENT'</span> <span class="o">=&gt;</span> <span class="s1">'Songbird'</span>
    <span class="n">assert_equal</span> <span class="s2">&quot;Ests usando Songbird!&quot;</span><span class="p">,</span> <span class="n">last_response</span><span class="nf">.body</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre>
<a name='Sinatra::Base%20-%20Middleware,%20Libreras,%20y%20Aplicaciones%20Modulares'></a>
<h2>Sinatra::Base - Middleware, Libreras, y Aplicaciones Modulares</h2>

<p>Definir tu aplicacin en el top-level funciona bien para micro-aplicaciones
pero trae inconvenientes considerables a la hora de construir componentes
reutilizables como Rack middleware, Rails metal, simple libreras con un
componente de servidor, o incluso extensiones de Sinatra. El DSL de top-level
asume una configuracin apropiada para micro-aplicaciones (por ejemplo, un
nico archivo de aplicacin, los directorios <code>./public</code> y
<code>./views</code>, logging, pgina con detalles de excepcin, etc.). Ah es
donde <code>Sinatra::Base</code> entra en el juego:</p>
<pre class="highlight ruby"><span class="nb">require</span> <span class="s1">'sinatra/base'</span>

<span class="k">class</span> <span class="nc">MiApp</span> <span class="o">&lt;</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">set</span> <span class="ss">:sessions</span><span class="p">,</span> <span class="kp">true</span>
  <span class="n">set</span> <span class="ss">:foo</span><span class="p">,</span> <span class="s1">'bar'</span>

  <span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
    <span class="s1">'Hola Mundo!'</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre>
<p>Las subclases de <code>Sinatra::Base</code> tienen disponibles exactamente los
mismos mtodos que los provistos por el DSL de top-level. La mayora de las
aplicaciones top-level se pueden convertir en componentes
<code>Sinatra::Base</code> con dos modificaciones:</p>

<ul>
<li>Tu archivo debe requerir <code>sinatra/base</code> en lugar de <code>sinatra</code>; de otra
manera, todos los mtodos del DSL de sinatra son importados dentro del
espacio de nombres principal.</li>
<li>Pon las rutas, manejadores de errores, filtros y opciones de tu aplicacin
en una subclase de <code>Sinatra::Base</code>.</li>
</ul>

<p><code>Sinatra::Base</code> es una pizarra en blanco. La mayora de las opciones estn
desactivadas por defecto, incluyendo el servidor incorporado. Mir
<a href="http://sinatra.github.com/configuration.html">Opciones y Configuraciones</a>
para detalles sobre las opciones disponibles y su comportamiento.</p>

<a name='Estilo%20Modular%20vs.%20Clsico'></a>
<h3>Estilo Modular vs. Clsico</h3>

<p>Contrariamente a la creencia popular, no hay nada de malo con el estilo clsico.
Si se ajusta a tu aplicacin, no es necesario que la cambies a una modular.</p>

<p>Las desventaja de usar el estilo clsico en lugar del modular consiste en que
solamente pods tener una aplicacin Sinatra por proceso Ruby. Si tens
planificado usar ms, cambi al estilo modular. Al mismo tiempo, ten en
cuenta que no hay ninguna razn por la cul no puedas mezclar los estilos
clsico y modular.</p>

<p>A continuacin se detallan las diferencias (sutiles) entre las configuraciones
de ambos estilos:</p>

<table>
  <tr>
    <td>Configuracin</td>
    <td>Clsica</td>
    <td>Modular</td>
  </tr>

  <tr>
    <td>app_file</td>
    <td>archivo que carga sinatra</td>
    <td>archivo con la subclase de Sinatra::Base</td>
  </tr>

  <tr>
    <td>run</td>
    <td>$0 == app_file</td>
    <td>false</td>
  </tr>

  <tr>
    <td>logging</td>
    <td>true</td>
    <td>false</td>
  </tr>

  <tr>
    <td>method_override</td>
    <td>true</td>
    <td>false</td>
  </tr>

  <tr>
    <td>inline_templates</td>
    <td>true</td>
    <td>false</td>
  </tr>

  <tr>
    <td>static</td>
    <td>true</td>
    <td>false</td>
  </tr>
</table>

<a name='Sirviendo%20una%20Aplicacin%20Modular'></a>
<h3>Sirviendo una Aplicacin Modular</h3>

<p>Las dos opciones ms comunes para iniciar una aplicacin modular son, iniciarla
activamente con <code>run!</code>:</p>
<pre class="highlight ruby"><span class="c1"># mi_app.rb</span>
<span class="nb">require</span> <span class="s1">'sinatra/base'</span>

<span class="k">class</span> <span class="nc">MiApp</span> <span class="o">&lt;</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Base</span>
  <span class="c1"># ... cdigo de la app  ...</span>

  <span class="c1"># iniciar el servidor si el archivo fue ejecutado directamente</span>
  <span class="n">run!</span> <span class="k">if</span> <span class="n">app_file</span> <span class="o">==</span> <span class="vg">$0</span>
<span class="k">end</span>
</pre>
<p>Iniciar con:</p>
<pre class="highlight shell">ruby mi_app.rb
</pre>
<p>O, con un archivo <code>config.ru</code>, que permite usar cualquier handler Rack:</p>
<pre class="highlight ruby"><span class="c1"># config.ru</span>
<span class="nb">require</span> <span class="s1">'./mi_app'</span>
<span class="n">run</span> <span class="no">MiApp</span>
</pre>
<p>Despus ejecutar:</p>
<pre class="highlight shell">rackup -p 4567
</pre>
<a name='Usando%20una%20Aplicacin%20Clsica%20con%20un%20Archivo%20config.ru'></a>
<h3>Usando una Aplicacin Clsica con un Archivo config.ru</h3>

<p>Escrib el archivo de tu aplicacin:</p>
<pre class="highlight ruby"><span class="c1"># app.rb</span>
<span class="nb">require</span> <span class="s1">'sinatra'</span>

<span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="s1">'Hola mundo!'</span>
<span class="k">end</span>
</pre>
<p>Y el <code>config.ru</code> correspondiente:</p>
<pre class="highlight ruby"><span class="nb">require</span> <span class="s1">'./app'</span>
<span class="n">run</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Application</span>
</pre>
<a name='Cundo%20Usar%20config.ru?'></a>
<h3>Cundo Usar config.ru?</h3>

<p>Indicadores de que probablemente quers usar <code>config.ru</code>:</p>

<ul>
<li>Quers realizar el deploy con un hanlder Rack distinto (Passenger, Unicorn,
Heroku, ...).</li>
<li>Quers usar ms de una subclase de <code>Sinatra::Base</code>.</li>
<li>Quers usar Sinatra nicamente para middleware, pero no como un endpoint.</li>
</ul>

<p><b>No hay necesidad de utilizar un archivo <code>config.ru</code> exclusivamente
porque tens una aplicacin modular, y no necesits una aplicacin modular para
iniciarla con <code>config.ru</code>.</b></p>

<a name='Utilizando%20Sinatra%20como%20Middleware'></a>
<h3>Utilizando Sinatra como Middleware</h3>

<p>Sinatra no solo es capaz de usar otro Rack middleware, sino que a su vez,
cualquier aplicacin Sinatra puede ser agregada delante de un endpoint Rack
como middleware. Este endpoint puede ser otra aplicacin Sinatra, o cualquier
aplicacin basada en Rack (Rails/Ramaze/Camping/...):</p>
<pre class="highlight ruby"><span class="nb">require</span> <span class="s1">'sinatra/base'</span>

<span class="k">class</span> <span class="nc">PantallaDeLogin</span> <span class="o">&lt;</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">enable</span> <span class="ss">:sessions</span>

  <span class="n">get</span><span class="p">(</span><span class="s1">'/login'</span><span class="p">)</span> <span class="p">{</span> <span class="n">haml</span> <span class="ss">:login</span> <span class="p">}</span>

  <span class="n">post</span><span class="p">(</span><span class="s1">'/login'</span><span class="p">)</span> <span class="k">do</span>
    <span class="k">if</span> <span class="n">params</span><span class="o">[</span><span class="ss">:nombre</span><span class="o">]</span> <span class="o">==</span> <span class="s1">'admin'</span> <span class="o">&amp;&amp;</span> <span class="n">params</span><span class="o">[</span><span class="ss">:password</span><span class="o">]</span> <span class="o">==</span> <span class="s1">'admin'</span>
      <span class="n">session</span><span class="o">[</span><span class="s1">'nombre_de_usuario'</span><span class="o">]</span> <span class="o">=</span> <span class="n">params</span><span class="o">[</span><span class="ss">:nombre</span><span class="o">]</span>
    <span class="k">else</span>
      <span class="n">redirect</span> <span class="s1">'/login'</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">MiApp</span> <span class="o">&lt;</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Base</span>
  <span class="c1"># el middleware se ejecutar antes que los filtros</span>
  <span class="n">use</span> <span class="no">PantallaDeLogin</span>

  <span class="n">before</span> <span class="k">do</span>
    <span class="k">unless</span> <span class="n">session</span><span class="o">[</span><span class="s1">'nombre_de_usuario'</span><span class="o">]</span>
      <span class="n">halt</span> <span class="s2">&quot;Acceso denegado, por favor &lt;a href='/login'&gt;inici sesin&lt;/a&gt;.&quot;</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)</span> <span class="p">{</span> <span class="s2">&quot;Hola </span><span class="si">#{</span><span class="n">session</span><span class="o">[</span><span class="s1">'nombre_de_usuario'</span><span class="o">]</span><span class="si">}</span><span class="s2">.&quot;</span> <span class="p">}</span>
<span class="k">end</span>
</pre>
<a name='Creacin%20Dinmica%20de%20Aplicaciones'></a>
<h3>Creacin Dinmica de Aplicaciones</h3>

<p>Puede que en algunas ocasiones quieras crear nuevas aplicaciones en
tiempo de ejecucin sin tener que asignarlas a una constante. Para
esto tens <code>Sinatra.new</code>:</p>
<pre class="highlight ruby"><span class="nb">require</span> <span class="s1">'sinatra/base'</span>
<span class="n">mi_app</span> <span class="o">=</span> <span class="no">Sinatra</span><span class="nf">.new</span> <span class="p">{</span> <span class="n">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)</span> <span class="p">{</span> <span class="s2">&quot;hola&quot;</span> <span class="p">}</span> <span class="p">}</span>
<span class="n">mi_app</span><span class="nf">.run!</span>
</pre>
<p>Acepta como argumento opcional una aplicacin desde la que se
heredar:</p>
<pre class="highlight ruby"><span class="c1"># config.ru</span>
<span class="nb">require</span> <span class="s1">'sinatra/base'</span>

<span class="n">controller</span> <span class="o">=</span> <span class="no">Sinatra</span><span class="nf">.new</span> <span class="k">do</span>
  <span class="n">enable</span> <span class="ss">:logging</span>
  <span class="n">helpers</span> <span class="no">MisHelpers</span>
<span class="k">end</span>

<span class="n">map</span><span class="p">(</span><span class="s1">'/a'</span><span class="p">)</span> <span class="k">do</span>
  <span class="n">run</span> <span class="no">Sinatra</span><span class="nf">.new</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span> <span class="p">{</span> <span class="n">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)</span> <span class="p">{</span> <span class="s1">'a'</span> <span class="p">}</span> <span class="p">}</span>
<span class="k">end</span>

<span class="n">map</span><span class="p">(</span><span class="s1">'/b'</span><span class="p">)</span> <span class="k">do</span>
  <span class="n">run</span> <span class="no">Sinatra</span><span class="nf">.new</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span> <span class="p">{</span> <span class="n">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)</span> <span class="p">{</span> <span class="s1">'b'</span> <span class="p">}</span> <span class="p">}</span>
<span class="k">end</span>
</pre>
<p>Construir aplicaciones de esta forma resulta especialmente til para
testear extensiones Sinatra o para usar Sinatra en tus libreras.</p>

<p>Por otro lado, hace extremadamente sencillo usar Sinatra como
middleware:</p>
<pre class="highlight ruby"><span class="nb">require</span> <span class="s1">'sinatra/base'</span>

<span class="n">use</span> <span class="no">Sinatra</span> <span class="k">do</span>
  <span class="n">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)</span> <span class="p">{</span> <span class="nf">..</span><span class="o">.</span> <span class="p">}</span>
<span class="k">end</span>

<span class="n">run</span> <span class="no">ProyectoRails</span><span class="o">::</span><span class="no">Application</span>
</pre>
<a name='mbitos%20y%20Ligaduras'></a>
<h2>mbitos y Ligaduras</h2>

<p>El mbito en el que te encontrs determina que mtodos y variables estn
disponibles.</p>

<a name='mbito%20de%20Aplicacin/Clase'></a>
<h3>mbito de Aplicacin/Clase</h3>

<p>Cada aplicacin Sinatra es una subclase de <code>Sinatra::Base</code>. Si ests
usando el DSL de top-level (<code>require &#39;sinatra&#39;</code>), entonces esta clase es
<code>Sinatra::Application</code>, de otra manera es la subclase que creaste
explcitamente. Al nivel de la clase tens mtodos como <code>get</code> o <code>before</code>, pero
no pods acceder a los objetos <code>request</code> o <code>session</code>, ya que hay una nica
clase de la aplicacin para todas las peticiones.</p>

<p>Las opciones creadas utilizando <code>set</code> son mtodos al nivel de la clase:</p>
<pre class="highlight ruby"><span class="k">class</span> <span class="nc">MiApp</span> <span class="o">&lt;</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Base</span>
  <span class="c1"># Ey, estoy en el mbito de la aplicacin!</span>
  <span class="n">set</span> <span class="ss">:foo</span><span class="p">,</span> <span class="mi">42</span>
  <span class="n">foo</span> <span class="c1"># =&gt; 42</span>

  <span class="n">get</span> <span class="s1">'/foo'</span> <span class="k">do</span>
    <span class="c1"># Hey, ya no estoy en el mbito de la aplicacin!</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre>
<p>Tens la ligadura al mbito de la aplicacin dentro de:</p>

<ul>
<li>El cuerpo de la clase de tu aplicacin</li>
<li>Mtodos definidos por extensiones</li>
<li>El bloque pasado a <code>helpers</code></li>
<li>Procs/bloques usados como el valor para <code>set</code></li>
</ul>

<p>Este mbito puede alcanzarse de las siguientes maneras:</p>

<ul>
<li>A travs del objeto pasado a los bloques de configuracin (<code>configure { |c| ...}</code>)</li>
<li>Llamando a <code>settings</code> desde dentro del mbito de la peticin</li>
</ul>

<a name='mbito%20de%20Peticin/Instancia'></a>
<h3>mbito de Peticin/Instancia</h3>

<p>Para cada peticin entrante, una nueva instancia de la clase de tu aplicacin
es creada y todos los bloques de rutas son ejecutados en ese mbito. Desde este
mbito pods acceder a los objetos <code>request</code> y <code>session</code> o llamar a los mtodos
de renderizacin como <code>erb</code> o <code>haml</code>. Pods acceder al mbito de la aplicacin
desde el mbito de la peticin utilizando <code>settings</code>:</p>
<pre class="highlight ruby"><span class="k">class</span> <span class="nc">MiApp</span> <span class="o">&lt;</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Base</span>
  <span class="c1"># Ey, estoy en el mbito de la aplicacin!</span>
  <span class="n">get</span> <span class="s1">'/definir_ruta/:nombre'</span> <span class="k">do</span>
    <span class="c1"># mbito de peticin para '/definir_ruta/:nombre'</span>
    <span class="vi">@valor</span> <span class="o">=</span> <span class="mi">42</span>

    <span class="n">settings</span><span class="nf">.get</span><span class="p">(</span><span class="s2">&quot;/</span><span class="si">#{</span><span class="n">params</span><span class="o">[</span><span class="ss">:nombre</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">do</span>
      <span class="c1"># mbito de peticin para &quot;/#{params[:nombre]}&quot;</span>
      <span class="vi">@valor</span> <span class="c1"># =&gt; nil (no es la misma peticin)</span>
    <span class="k">end</span>

    <span class="s2">&quot;Ruta definida!&quot;</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre>
<p>Tens la ligadura al mbito de la peticin dentro de:</p>

<ul>
<li>bloques pasados a get/head/post/put/delete/options</li>
<li>filtros before/after</li>
<li>mtodos ayudantes</li>
<li>plantillas/vistas</li>
</ul>

<a name='mbito%20de%20Delegacin'></a>
<h3>mbito de Delegacin</h3>

<p>El mbito de delegacin solo reenva mtodos al mbito de clase. De cualquier
manera, no se comporta 100% como el mbito de clase porque no tens la ligadura
de la clase: nicamente mtodos marcados explcitamente para delegacin estn
disponibles y no comparts variables/estado con el mbito de clase (lase:
tens un <code>self</code> diferente). Pods agregar delegaciones de mtodo llamando a
<code>Sinatra::Delegator.delegate :nombre_del_metodo</code>.</p>

<p>Tens la ligadura al mbito de delegacin dentro de:</p>

<ul>
<li>La ligadura del top-level, si hiciste <code>require &quot;sinatra&quot;</code></li>
<li>Un objeto extendido con el mixin <code>Sinatra::Delegator</code></li>
</ul>

<p>Pegale una mirada al cdigo: ac est el
<a href="https://github.com/sinatra/sinatra/blob/ca06364/lib/sinatra/base.rb#L1609-1633">Sinatra::Delegator mixin</a>
que <a href="https://github.com/sinatra/sinatra/blob/ca06364/lib/sinatra/main.rb#L28-30">extiende el objeto main</a>.</p>

<a name='Lnea%20de%20Comandos'></a>
<h2>Lnea de Comandos</h2>

<p>Las aplicaciones Sinatra pueden ser ejecutadas directamente:</p>
<pre class="highlight shell">ruby miapp.rb <span class="o">[</span>-h] <span class="o">[</span>-x] <span class="o">[</span>-e ENTORNO] <span class="o">[</span>-p PUERTO] <span class="o">[</span>-o HOST] <span class="o">[</span>-s MANEJADOR]
</pre>
<p>Las opciones son:</p>
<pre class="highlight text">-h # ayuda
-p # asigna el puerto (4567 es usado por defecto)
-o # asigna el host (0.0.0.0 es usado por defecto)
-e # asigna el entorno (development es usado por defecto)
-s # especifica el servidor/manejador rack (thin es usado por defecto)
-x # activa el mutex lock (est desactivado por defecto)
</pre>
<a name='Versiones%20de%20Ruby%20Soportadas'></a>
<h2>Versiones de Ruby Soportadas</h2>

<p>Las siguientes versiones de Ruby son soportadas oficialmente:</p>

<dl>
  <dt>Ruby 1.8.7</dt>
  <dd>
    1.8.7 es soportado completamente. Sin embargo, si no hay nada que te lo
    prohba, te recomendamos que uss 1.9.2 o cambies a JRuby o Rubinius. No se
    dejar de dar soporte a 1.8.7 hasta Sinatra 2.0 y Ruby 2.0, aunque si se
    libera la versin 1.8.8 de Ruby las cosas podran llegar a cambiar. Sin
    embargo, que eso ocurra es muy poco probable, e incluso el caso de que lo
    haga, puede que se siga dando soporte a 1.8.7. <b>Hemos dejado de soportar
    Ruby 1.8.6.</b> Si quers ejecutar Sinatra sobre 1.8.6, pods utilizar la
    versin 1.2, pero ten en cuenta que una vez que Sinatra 1.4.0 sea liberado,
    ya no se corregirn errores por ms que se reciban reportes de los mismos.
  </dd>

  <dt>Ruby 1.9.2</dt>
  <dd>
    1.9.2 es soportado y recomendado. No uss 1.9.2p0, porque se producen fallos
    de segmentacin cuando se ejecuta Sinatra. El soporte se mantendr al menos
    hasta que se libere la versin 1.9.4/2.0 de Ruby. El soporte para la ltima
    versin de la serie 1.9 se mantendr mientras lo haga el core team de Ruby.
  </dd>

  <dt>Ruby 1.9.3</dt>
  <dd>
    1.9.3 es soportado y recomendado. Ten en cuenta que el cambio a 1.9.3 desde
    una versin anterior va a invalidar todas las sesiones.
  </dd>

  <dt>Rubinius</dt>
  <dd>
    Rubinius es soportado oficialmente (Rubinius >= 1.2.4). Todo funciona
    correctamente, incluyendo los lenguajes de plantillas. La prxima versin,
    2.0, tambin es soportada, incluyendo el modo 1.9.
  </dd>

  <dt>JRuby</dt>
  <dd>
    JRuby es soportado oficialmente (JRuby >= 1.6.7). No se conocen problemas
    con libreras de plantillas de terceras partes. Sin embargo, si elegs usar
    JRuby, deberas examinar sus Rack handlers porque el servidor web Thin no es
    soportado completamente. El soporte de JRuby para extensiones C se encuentra
    en una etapa experimental, sin embargo, de momento solamente RDiscount,
    Redcarpet, RedCloth y Yajl, as como Thin y Mongrel se ven afectadas.
  </dd>
</dl>

<p>Siempre le prestamos atencin a las nuevas versiones de Ruby.</p>

<p>Las siguientes implementaciones de Ruby no se encuentran soportadas
oficialmente. De cualquier manera, pueden ejecutar Sinatra:</p>

<ul>
<li>Versiones anteriores de JRuby y Rubinius</li>
<li>Ruby Enterprise Edition</li>
<li>MacRuby, Maglev e IronRuby</li>
<li>Ruby 1.9.0 y 1.9.1 (pero no te recomendamos que los uss)</li>
</ul>

<p>No estar soportada oficialmente, significa que si las cosas solamente se rompen
ah y no en una plataforma soportada, asumimos que no es nuestro problema sino
el suyo.</p>

<p>Nuestro servidor CI tambin se ejecuta sobre ruby-head (que ser la prxima
versin 2.0.0) y la rama 1.9.4. Como estn en movimiento constante, no podemos
garantizar nada. De todas formas, pods contar con que tanto 1.9.4-p0 como
2.0.0-p0 sea soportadas.</p>

<p>Sinatra debera funcionar en cualquier sistema operativo soportado por la
implementacin de Ruby elegida.</p>

<p>En este momento, no vas a poder ejecutar Sinatra en Cardinal, SmallRuby,
BlueRuby o cualquier versin de Ruby anterior a 1.8.7.</p>

<a name='A%20la%20Vanguardia'></a>
<h2>A la Vanguardia</h2>

<p>Si quers usar el cdigo de Sinatra ms reciente, sentite libre de ejecutar
tu aplicacin sobre la rama master, en general es bastante estable.</p>

<p>Tambin liberamos prereleases de vez en cuando, as, pods hacer</p>
<pre class="highlight shell">gem install sinatra --pre
</pre>
<p>Para obtener algunas de las ltimas caractersticas.</p>

<a name='Con%20Bundler'></a>
<h3>Con Bundler</h3>

<p>Esta es la manera recomendada para ejecutar tu aplicacin sobre la ltima
versin de Sinatra usando <a href="http://gembundler.com/">Bundler</a>.</p>

<p>Primero, instal bundler si no lo hiciste todava:</p>
<pre class="highlight shell">gem install bundler
</pre>
<p>Despus, en el directorio de tu proyecto, cre un archivo <code>Gemfile</code>:</p>
<pre class="highlight ruby"><span class="n">source</span> <span class="ss">:rubygems</span>
<span class="n">gem</span> <span class="s1">'sinatra'</span><span class="p">,</span> <span class="ss">:git</span> <span class="o">=&gt;</span> <span class="s2">&quot;git://github.com/sinatra/sinatra.git&quot;</span>

<span class="c1"># otras dependencias</span>
<span class="n">gem</span> <span class="s1">'haml'</span>                    <span class="c1"># por ejemplo, si uss haml</span>
<span class="n">gem</span> <span class="s1">'activerecord'</span><span class="p">,</span> <span class="s1">'~&gt; 3.0'</span>  <span class="c1"># quizs tambin necesits ActiveRecord 3.x</span>
</pre>
<p>Ten en cuenta que tens que listar todas las dependencias directas de tu
aplicacin. No es necesario listar las dependencias de Sinatra (Rack y Tilt)
porque Bundler las agrega directamente.</p>

<p>Ahora pods arrancar tu aplicacin as:</p>
<pre class="highlight shell">bundle <span class="nb">exec </span>ruby miapp.rb
</pre>
<a name='Con%20Git'></a>
<h3>Con Git</h3>

<p>Clon el repositorio localmente y ejecut tu aplicacin, asegurndote que el
directorio <code>sinatra/lib</code> est en el <code>$LOAD_PATH</code>:</p>
<pre class="highlight shell"><span class="nb">cd </span>miapp
git clone git://github.com/sinatra/sinatra.git
ruby -Isinatra/lib miapp.rb
</pre>
<p>Para actualizar el cdigo fuente de Sinatra en el futuro:</p>
<pre class="highlight shell"><span class="nb">cd </span>miapp/sinatra
git pull
</pre>
<a name='Instalacin%20Global'></a>
<h3>Instalacin Global</h3>

<p>Pods construir la gem vos mismo:</p>
<pre class="highlight shell">git clone git://github.com/sinatra/sinatra.git
<span class="nb">cd </span>sinatra
rake sinatra.gemspec
rake install
</pre>
<p>Si instals tus gems como root, el ltimo paso debera ser</p>
<pre class="highlight shell">sudo rake install
</pre>
<a name='Versionado'></a>
<h2>Versionado</h2>

<p>Sinatra utiliza el <a href="http://semver.org/">Versionado Semntico</a>,
siguiendo las especificaciones SemVer y SemVerTag.</p>

<a name='Lecturas%20Recomendadas'></a>
<h2>Lecturas Recomendadas</h2>

<ul>
<li><a href="http://www.sinatrarb.com/">Sito web del proyecto</a> - Documentacin
adicional, noticias, y enlaces a otros recursos.</li>
<li><a href="http://www.sinatrarb.com/contributing">Contribuyendo</a> - Encontraste un
error?. Necesits ayuda?. Tens un parche?.</li>
<li><a href="http://github.com/sinatra/sinatra/issues">Seguimiento de problemas</a></li>
<li><a href="http://twitter.com/sinatra">Twitter</a></li>
<li><a href="http://groups.google.com/group/sinatrarb/topics">Lista de Correo</a></li>
<li>[IRC: #sinatra](irc://chat.freenode.net/#sinatra) en http://freenode.net</li>
<li><a href="http://sinatra-book.gittr.com">Sinatra Book</a> Tutorial (en ingls).</li>
<li><a href="http://recipes.sinatrarb.com/">Sinatra Recipes</a> Recetas contribuidas
por la comunidad (en ingls).</li>
<li>Documentacin de la API para la
<a href="http://rubydoc.info/gems/sinatra">ltima versin liberada</a> o para la
<a href="http://rubydoc.info/github/sinatra/sinatra">rama de desarrollo actual</a>
en http://rubydoc.info/</li>
<li><a href="http://travis-ci.org/sinatra/sinatra">Servidor de CI</a></li>
</ul>
